!function(t,e){function n(){if(!g.isReady){try{b.documentElement.doScroll("left")}catch(t){return void setTimeout(n,1)}g.ready()}}function i(t,e){e.src?g.ajax({url:e.src,async:!1,dataType:"script"}):g.globalEval(e.text||e.textContent||e.innerHTML||""),e.parentNode&&e.parentNode.removeChild(e)}function o(t,n,i,r,s,a){var l=t.length;if("object"==typeof n){for(var c in n)o(t,c,n[c],r,s,i);return t}if(i!==e){for(r=!a&&r&&g.isFunction(i),c=0;l>c;c++)s(t[c],n,r?i.call(t[c],c,s(t[c],n)):i,a);return t}return l?s(t[0],n):e}function r(){return(new Date).getTime()}function s(){return!1}function a(){return!0}function l(t,e,n){return n[0].type=t,g.event.handle.apply(e,n)}function c(t){var e,n,i,o,r,s,a,l=[],c=[],u=arguments;if(i=g.data(this,"events"),t.liveFired!==this&&i&&i.live&&(!t.button||"click"!==t.type)){t.liveFired=this;var h=i.live.slice(0);for(r=0;r<h.length;r++)i=h[r],i.origType.replace(W,"")===t.type?c.push(i.selector):h.splice(r--,1);for(n=g(t.target).closest(c,t.currentTarget),s=0,a=n.length;a>s;s++)for(r=0;r<h.length;r++)i=h[r],n[s].selector===i.selector&&(o=n[s].elem,c=null,("mouseenter"===i.preType||"mouseleave"===i.preType)&&(c=g(t.relatedTarget).closest(i.selector)[0]),c&&c===o||l.push({elem:o,handleObj:i}));for(s=0,a=l.length;a>s;s++)if(n=l[s],t.currentTarget=n.elem,t.data=n.handleObj.data,t.handleObj=n.handleObj,n.handleObj.origHandler.apply(n.elem,u)===!1){e=!1;break}return e}}function u(t,e){return"live."+(t&&"*"!==t?t+".":"")+e.replace(/\./g,"`").replace(/ /g,"&")}function h(t){return!t||!t.parentNode||11===t.parentNode.nodeType}function m(t,e){var n=0;e.each(function(){if(this.nodeName===(t[n]&&t[n].nodeName)){var e=g.data(t[n++]),i=g.data(this,e);if(e=e&&e.events){delete i.handle,i.events={};for(var o in e)for(var r in e[o])g.event.add(this,o,e[o][r],e[o][r].data)}}})}function p(t,e,n){var i,o,r;return e=e&&e[0]?e[0].ownerDocument||e[0]:b,1===t.length&&"string"==typeof t[0]&&t[0].length<512&&e===b&&!pe.test(t[0])&&(g.support.checkClone||!fe.test(t[0]))&&(o=!0,(r=g.fragments[t[0]])&&1!==r&&(i=r)),i||(i=e.createDocumentFragment(),g.clean(t,e,i,n)),o&&(g.fragments[t[0]]=r?i:1),{fragment:i,cacheable:o}}function f(t,e){var n={};return g.each(Ue.concat.apply([],Ue.slice(0,e)),function(){n[this]=t}),n}function y(t){return"scrollTo"in t&&t.document?t:9===t.nodeType?t.defaultView||t.parentWindow:!1}var d,_,g=function(t,e){return new g.fn.init(t,e)},x=t.jQuery,v=t.$,b=t.document,w=/^[^<]*(<[\w\W]+>)[^>]*$|^#([\w-]+)$/,D=/^.[^:#\[\.,]*$/,B=/\S/,C=/^(\s|\u00A0)+|(\s|\u00A0)+$/g,S=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,A=navigator.userAgent,M=!1,V=[],I=Object.prototype.toString,T=Object.prototype.hasOwnProperty,L=Array.prototype.push,F=Array.prototype.slice,G=Array.prototype.indexOf;g.fn=g.prototype={init:function(t,n){var i,o;if(!t)return this;if(t.nodeType)return this.context=this[0]=t,this.length=1,this;if("body"===t&&!n)return this.context=b,this[0]=b.body,this.selector="body",this.length=1,this;if("string"==typeof t){if(!(i=w.exec(t))||!i[1]&&n)return!n&&/^\w+$/.test(t)?(this.selector=t,this.context=b,t=b.getElementsByTagName(t),g.merge(this,t)):!n||n.jquery?(n||d).find(t):g(n).find(t);if(i[1])return o=n?n.ownerDocument||n:b,(t=S.exec(t))?g.isPlainObject(n)?(t=[b.createElement(t[1])],g.fn.attr.call(t,n,!0)):t=[o.createElement(t[1])]:(t=p([i[1]],[o]),t=(t.cacheable?t.fragment.cloneNode(!0):t.fragment).childNodes),g.merge(this,t);if(n=b.getElementById(i[2])){if(n.id!==i[2])return d.find(t);this.length=1,this[0]=n}return this.context=b,this.selector=t,this}return g.isFunction(t)?d.ready(t):(t.selector!==e&&(this.selector=t.selector,this.context=t.context),g.makeArray(t,this))},selector:"",jquery:"1.4.2",length:0,size:function(){return this.length},toArray:function(){return F.call(this,0)},get:function(t){return null==t?this.toArray():0>t?this.slice(t)[0]:this[t]},pushStack:function(t,e,n){var i=g();return g.isArray(t)?L.apply(i,t):g.merge(i,t),i.prevObject=this,i.context=this.context,"find"===e?i.selector=this.selector+(this.selector?" ":"")+n:e&&(i.selector=this.selector+"."+e+"("+n+")"),i},each:function(t,e){return g.each(this,t,e)},ready:function(t){return g.bindReady(),g.isReady?t.call(b,g):V&&V.push(t),this},eq:function(t){return-1===t?this.slice(t):this.slice(t,+t+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(F.apply(this,arguments),"slice",F.call(arguments).join(","))},map:function(t){return this.pushStack(g.map(this,function(e,n){return t.call(e,n,e)}))},end:function(){return this.prevObject||g(null)},push:L,sort:[].sort,splice:[].splice},g.fn.init.prototype=g.fn,g.extend=g.fn.extend=function(){var t,n,i,o,r=arguments[0]||{},s=1,a=arguments.length,l=!1;for("boolean"==typeof r&&(l=r,r=arguments[1]||{},s=2),"object"==typeof r||g.isFunction(r)||(r={}),a===s&&(r=this,--s);a>s;s++)if(null!=(t=arguments[s]))for(n in t)i=r[n],o=t[n],r!==o&&(l&&o&&(g.isPlainObject(o)||g.isArray(o))?(i=i&&(g.isPlainObject(i)||g.isArray(i))?i:g.isArray(o)?[]:{},r[n]=g.extend(l,i,o)):o!==e&&(r[n]=o));return r},g.extend({noConflict:function(e){return t.$=v,e&&(t.jQuery=x),g},isReady:!1,ready:function(){if(!g.isReady){if(!b.body)return setTimeout(g.ready,13);if(g.isReady=!0,V){for(var t,e=0;t=V[e++];)t.call(b,g);V=null}g.fn.triggerHandler&&g(b).triggerHandler("ready")}},bindReady:function(){if(!M){if(M=!0,"complete"===b.readyState)return g.ready();if(b.addEventListener)b.addEventListener("DOMContentLoaded",_,!1),t.addEventListener("load",g.ready,!1);else if(b.attachEvent){b.attachEvent("onreadystatechange",_),t.attachEvent("onload",g.ready);var e=!1;try{e=null==t.frameElement}catch(i){}b.documentElement.doScroll&&e&&n()}}},isFunction:function(t){return"[object Function]"===I.call(t)},isArray:function(t){return"[object Array]"===I.call(t)},isPlainObject:function(t){if(!t||"[object Object]"!==I.call(t)||t.nodeType||t.setInterval)return!1;if(t.constructor&&!T.call(t,"constructor")&&!T.call(t.constructor.prototype,"isPrototypeOf"))return!1;var n;for(n in t);return n===e||T.call(t,n)},isEmptyObject:function(t){for(var e in t)return!1;return!0},error:function(t){throw t},parseJSON:function(e){return"string"==typeof e&&e?(e=g.trim(e),/^[\],:{}\s]*$/.test(e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))?t.JSON&&t.JSON.parse?t.JSON.parse(e):new Function("return "+e)():void g.error("Invalid JSON: "+e)):null},noop:function(){},globalEval:function(t){if(t&&B.test(t)){var e=b.getElementsByTagName("head")[0]||b.documentElement,n=b.createElement("script");n.type="text/javascript",g.support.scriptEval?n.appendChild(b.createTextNode(t)):n.text=t,e.insertBefore(n,e.firstChild),e.removeChild(n)}},nodeName:function(t,e){return t.nodeName&&t.nodeName.toUpperCase()===e.toUpperCase()},each:function(t,n,i){var o,r=0,s=t.length,a=s===e||g.isFunction(t);if(i)if(a){for(o in t)if(n.apply(t[o],i)===!1)break}else for(;s>r&&n.apply(t[r++],i)!==!1;);else if(a){for(o in t)if(n.call(t[o],o,t[o])===!1)break}else for(i=t[0];s>r&&n.call(i,r,i)!==!1;i=t[++r]);return t},trim:function(t){return(t||"").replace(C,"")},makeArray:function(t,e){return e=e||[],null!=t&&(null==t.length||"string"==typeof t||g.isFunction(t)||"function"!=typeof t&&t.setInterval?L.call(e,t):g.merge(e,t)),e},inArray:function(t,e){if(e.indexOf)return e.indexOf(t);for(var n=0,i=e.length;i>n;n++)if(e[n]===t)return n;return-1},merge:function(t,n){var i=t.length,o=0;if("number"==typeof n.length)for(var r=n.length;r>o;o++)t[i++]=n[o];else for(;n[o]!==e;)t[i++]=n[o++];return t.length=i,t},grep:function(t,e,n){for(var i=[],o=0,r=t.length;r>o;o++)!n!=!e(t[o],o)&&i.push(t[o]);return i},map:function(t,e,n){for(var i,o=[],r=0,s=t.length;s>r;r++)i=e(t[r],r,n),null!=i&&(o[o.length]=i);return o.concat.apply([],o)},guid:1,proxy:function(t,n,i){return 2===arguments.length&&("string"==typeof n?(i=t,t=i[n],n=e):n&&!g.isFunction(n)&&(i=n,n=e)),!n&&t&&(n=function(){return t.apply(i||this,arguments)}),t&&(n.guid=t.guid=t.guid||n.guid||g.guid++),n},uaMatch:function(t){return t=t.toLowerCase(),t=/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version)?[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||!/compatible/.test(t)&&/(mozilla)(?:.*? rv:([\w.]+))?/.exec(t)||[],{browser:t[1]||"",version:t[2]||"0"}},browser:{}}),A=g.uaMatch(A),A.browser&&(g.browser[A.browser]=!0,g.browser.version=A.version),g.browser.webkit&&(g.browser.safari=!0),G&&(g.inArray=function(t,e){return G.call(e,t)}),d=g(b),b.addEventListener?_=function(){b.removeEventListener("DOMContentLoaded",_,!1),g.ready()}:b.attachEvent&&(_=function(){"complete"===b.readyState&&(b.detachEvent("onreadystatechange",_),g.ready())}),function(){g.support={};var e=b.documentElement,n=b.createElement("script"),i=b.createElement("div"),o="script"+r();i.style.display="none",i.innerHTML="   <link/><table></table><a href='/a' style='color:red;float:left;opacity:.55;'>a</a><input type='checkbox'/>";var s=i.getElementsByTagName("*"),a=i.getElementsByTagName("a")[0];if(s&&s.length&&a){g.support={leadingWhitespace:3===i.firstChild.nodeType,tbody:!i.getElementsByTagName("tbody").length,htmlSerialize:!!i.getElementsByTagName("link").length,style:/red/.test(a.getAttribute("style")),hrefNormalized:"/a"===a.getAttribute("href"),opacity:/^0.55$/.test(a.style.opacity),cssFloat:!!a.style.cssFloat,checkOn:"on"===i.getElementsByTagName("input")[0].value,optSelected:b.createElement("select").appendChild(b.createElement("option")).selected,parentNode:null===i.removeChild(i.appendChild(b.createElement("div"))).parentNode,deleteExpando:!0,checkClone:!1,scriptEval:!1,noCloneEvent:!0,boxModel:null},n.type="text/javascript";try{n.appendChild(b.createTextNode("window."+o+"=1;"))}catch(l){}e.insertBefore(n,e.firstChild),t[o]&&(g.support.scriptEval=!0,delete t[o]);try{delete n.test}catch(c){g.support.deleteExpando=!1}e.removeChild(n),i.attachEvent&&i.fireEvent&&(i.attachEvent("onclick",function u(){g.support.noCloneEvent=!1,i.detachEvent("onclick",u)}),i.cloneNode(!0).fireEvent("onclick")),i=b.createElement("div"),i.innerHTML="<input type='radio' name='radiotest' checked='checked'/>",e=b.createDocumentFragment(),e.appendChild(i.firstChild),g.support.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked,g(function(){var t=b.createElement("div");t.style.width=t.style.paddingLeft="1px",b.body.appendChild(t),g.boxModel=g.support.boxModel=2===t.offsetWidth,b.body.removeChild(t).style.display="none"}),e=function(t){var e=b.createElement("div");t="on"+t;var n=t in e;return n||(e.setAttribute(t,"return;"),n="function"==typeof e[t]),n},g.support.submitBubbles=e("submit"),g.support.changeBubbles=e("change"),e=n=i=s=a=null}}(),g.props={"for":"htmlFor","class":"className",readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing",rowspan:"rowSpan",colspan:"colSpan",tabindex:"tabIndex",usemap:"useMap",frameborder:"frameBorder"};var P="jQuery"+r(),k=0,N={};g.extend({cache:{},expando:P,noData:{embed:!0,object:!0,applet:!0},data:function(n,i,o){if(!n.nodeName||!g.noData[n.nodeName.toLowerCase()]){n=n==t?N:n;var r=n[P],s=g.cache;return r||"string"!=typeof i||o!==e?(r||(r=++k),"object"==typeof i?(n[P]=r,s[r]=g.extend(!0,{},i)):s[r]||(n[P]=r,s[r]={}),n=s[r],o!==e&&(n[i]=o),"string"==typeof i?n[i]:n):null}},removeData:function(e,n){if(!e.nodeName||!g.noData[e.nodeName.toLowerCase()]){e=e==t?N:e;var i=e[P],o=g.cache,r=o[i];n?r&&(delete r[n],g.isEmptyObject(r)&&g.removeData(e)):(g.support.deleteExpando?delete e[g.expando]:e.removeAttribute&&e.removeAttribute(g.expando),delete o[i])}}}),g.fn.extend({data:function(t,n){if("undefined"==typeof t&&this.length)return g.data(this[0]);if("object"==typeof t)return this.each(function(){g.data(this,t)});var i=t.split(".");if(i[1]=i[1]?"."+i[1]:"",n===e){var o=this.triggerHandler("getData"+i[1]+"!",[i[0]]);return o===e&&this.length&&(o=g.data(this[0],t)),o===e&&i[1]?this.data(i[0]):o}return this.trigger("setData"+i[1]+"!",[i[0],n]).each(function(){g.data(this,t,n)})},removeData:function(t){return this.each(function(){g.removeData(this,t)})}}),g.extend({queue:function(t,e,n){if(t){e=(e||"fx")+"queue";var i=g.data(t,e);return n?(!i||g.isArray(n)?i=g.data(t,e,g.makeArray(n)):i.push(n),i):i||[]}},dequeue:function(t,e){e=e||"fx";var n=g.queue(t,e),i=n.shift();"inprogress"===i&&(i=n.shift()),i&&("fx"===e&&n.unshift("inprogress"),i.call(t,function(){g.dequeue(t,e)}))}}),g.fn.extend({queue:function(t,n){return"string"!=typeof t&&(n=t,t="fx"),n===e?g.queue(this[0],t):this.each(function(){var e=g.queue(this,t,n);"fx"===t&&"inprogress"!==e[0]&&g.dequeue(this,t)})},dequeue:function(t){return this.each(function(){g.dequeue(this,t)})},delay:function(t,e){return t=g.fx?g.fx.speeds[t]||t:t,e=e||"fx",this.queue(e,function(){var n=this;setTimeout(function(){g.dequeue(n,e)},t)})},clearQueue:function(t){return this.queue(t||"fx",[])}});var J=/[\n\t]/g,R=/\s+/,E=/\r/g,j=/href|src|style/,z=/(button|input)/i,O=/(button|input|object|select|textarea)/i,q=/^(a|area)$/i,U=/radio|checkbox/;g.fn.extend({attr:function(t,e){return o(this,t,e,!0,g.attr)},removeAttr:function(t){return this.each(function(){g.attr(this,t,""),1===this.nodeType&&this.removeAttribute(t)})},addClass:function(t){if(g.isFunction(t))return this.each(function(e){var n=g(this);n.addClass(t.call(this,e,n.attr("class")))});if(t&&"string"==typeof t)for(var e=(t||"").split(R),n=0,i=this.length;i>n;n++){var o=this[n];if(1===o.nodeType)if(o.className){for(var r=" "+o.className+" ",s=o.className,a=0,l=e.length;l>a;a++)r.indexOf(" "+e[a]+" ")<0&&(s+=" "+e[a]);o.className=g.trim(s)}else o.className=t}return this},removeClass:function(t){if(g.isFunction(t))return this.each(function(e){var n=g(this);n.removeClass(t.call(this,e,n.attr("class")))});if(t&&"string"==typeof t||t===e)for(var n=(t||"").split(R),i=0,o=this.length;o>i;i++){var r=this[i];if(1===r.nodeType&&r.className)if(t){for(var s=(" "+r.className+" ").replace(J," "),a=0,l=n.length;l>a;a++)s=s.replace(" "+n[a]+" "," ");r.className=g.trim(s)}else r.className=""}return this},toggleClass:function(t,e){var n=typeof t,i="boolean"==typeof e;return this.each(g.isFunction(t)?function(n){var i=g(this);i.toggleClass(t.call(this,n,i.attr("class"),e),e)}:function(){if("string"===n)for(var o,r=0,s=g(this),a=e,l=t.split(R);o=l[r++];)a=i?a:!s.hasClass(o),s[a?"addClass":"removeClass"](o);else("undefined"===n||"boolean"===n)&&(this.className&&g.data(this,"__className__",this.className),this.className=this.className||t===!1?"":g.data(this,"__className__")||"")})},hasClass:function(t){t=" "+t+" ";for(var e=0,n=this.length;n>e;e++)if((" "+this[e].className+" ").replace(J," ").indexOf(t)>-1)return!0;return!1},val:function(t){if(t===e){var n=this[0];if(n){if(g.nodeName(n,"option"))return(n.attributes.value||{}).specified?n.value:n.text;if(g.nodeName(n,"select")){var i=n.selectedIndex,o=[],r=n.options;if(n="select-one"===n.type,0>i)return null;var s=n?i:0;for(i=n?i+1:r.length;i>s;s++){var a=r[s];if(a.selected){if(t=g(a).val(),n)return t;o.push(t)}}return o}return U.test(n.type)&&!g.support.checkOn?null===n.getAttribute("value")?"on":n.value:(n.value||"").replace(E,"")}return e}var l=g.isFunction(t);return this.each(function(e){var n=g(this),i=t;if(1===this.nodeType)if(l&&(i=t.call(this,e,n.val())),"number"==typeof i&&(i+=""),g.isArray(i)&&U.test(this.type))this.checked=g.inArray(n.val(),i)>=0;else if(g.nodeName(this,"select")){var o=g.makeArray(i);g("option",this).each(function(){this.selected=g.inArray(g(this).val(),o)>=0}),o.length||(this.selectedIndex=-1)}else this.value=i})}}),g.extend({attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(t,n,i,o){if(!t||3===t.nodeType||8===t.nodeType)return e;if(o&&n in g.attrFn)return g(t)[n](i);o=1!==t.nodeType||!g.isXMLDoc(t);var r=i!==e;if(n=o&&g.props[n]||n,1===t.nodeType){var s=j.test(n);return n in t&&o&&!s?(r&&("type"===n&&z.test(t.nodeName)&&t.parentNode&&g.error("type property can't be changed"),t[n]=i),g.nodeName(t,"form")&&t.getAttributeNode(n)?t.getAttributeNode(n).nodeValue:"tabIndex"===n?(n=t.getAttributeNode("tabIndex"))&&n.specified?n.value:O.test(t.nodeName)||q.test(t.nodeName)&&t.href?0:e:t[n]):!g.support.style&&o&&"style"===n?(r&&(t.style.cssText=""+i),t.style.cssText):(r&&t.setAttribute(n,""+i),t=!g.support.hrefNormalized&&o&&s?t.getAttribute(n,2):t.getAttribute(n),null===t?e:t)}return g.style(t,n,i)}});var W=/\.(.*)$/,K=function(t){return t.replace(/[^\w\s\.\|`]/g,function(t){return"\\"+t})};g.event={add:function(n,i,o,r){if(3!==n.nodeType&&8!==n.nodeType){n.setInterval&&n!==t&&!n.frameElement&&(n=t);var s,a;if(o.handler&&(s=o,o=s.handler),o.guid||(o.guid=g.guid++),a=g.data(n)){var l=a.events=a.events||{},c=a.handle;c||(a.handle=c=function(){return"undefined"==typeof g||g.event.triggered?e:g.event.handle.apply(c.elem,arguments)}),c.elem=n,i=i.split(" ");for(var u,h,m=0;u=i[m++];){a=s?g.extend({},s):{handler:o,data:r},u.indexOf(".")>-1?(h=u.split("."),u=h.shift(),a.namespace=h.slice(0).sort().join(".")):(h=[],a.namespace=""),a.type=u,a.guid=o.guid;var p=l[u],f=g.event.special[u]||{};p||(p=l[u]=[],f.setup&&f.setup.call(n,r,h,c)!==!1||(n.addEventListener?n.addEventListener(u,c,!1):n.attachEvent&&n.attachEvent("on"+u,c))),f.add&&(f.add.call(n,a),a.handler.guid||(a.handler.guid=o.guid)),p.push(a),g.event.global[u]=!0}n=null}}},global:{},remove:function(t,e,n,i){if(3!==t.nodeType&&8!==t.nodeType){var o,r,s,a,l,c,u,h=0,m=g.data(t),p=m&&m.events;if(m&&p)if(e&&e.type&&(n=e.handler,e=e.type),!e||"string"==typeof e&&"."===e.charAt(0)){e=e||"";for(o in p)g.event.remove(t,o+e)}else{for(e=e.split(" ");o=e[h++];)if(l=o,r=o.indexOf(".")<0,s=[],r||(s=o.split("."),o=s.shift(),a=new RegExp("(^|\\.)"+g.map(s.slice(0).sort(),K).join("\\.(?:.*\\.)?")+"(\\.|$)")),c=p[o])if(n){for(l=g.event.special[o]||{},f=i||0;f<c.length&&(u=c[f],n.guid!==u.guid||((r||a.test(u.namespace))&&(null==i&&c.splice(f--,1),l.remove&&l.remove.call(t,u)),null==i));f++);(0===c.length||null!=i&&1===c.length)&&(l.teardown&&l.teardown.call(t,s)!==!1||H(t,o,m.handle),delete p[o])}else for(var f=0;f<c.length;f++)u=c[f],(r||a.test(u.namespace))&&(g.event.remove(t,l,u.handler,f),c.splice(f--,1));g.isEmptyObject(p)&&((e=m.handle)&&(e.elem=null),delete m.events,delete m.handle,g.isEmptyObject(m)&&g.removeData(t))}}},trigger:function(t,n,i,o){var r=t.type||t;if(!o){if(t="object"==typeof t?t[P]?t:g.extend(g.Event(r),t):g.Event(r),r.indexOf("!")>=0&&(t.type=r=r.slice(0,-1),t.exclusive=!0),i||(t.stopPropagation(),g.event.global[r]&&g.each(g.cache,function(){this.events&&this.events[r]&&g.event.trigger(t,n,this.handle.elem)})),!i||3===i.nodeType||8===i.nodeType)return e;t.result=e,t.target=i,n=g.makeArray(n),n.unshift(t)}t.currentTarget=i,(o=g.data(i,"handle"))&&o.apply(i,n),o=i.parentNode||i.ownerDocument;try{i&&i.nodeName&&g.noData[i.nodeName.toLowerCase()]||i["on"+r]&&i["on"+r].apply(i,n)===!1&&(t.result=!1)}catch(s){}if(!t.isPropagationStopped()&&o)g.event.trigger(t,n,o,!0);else if(!t.isDefaultPrevented()){o=t.target;var a,l=g.nodeName(o,"a")&&"click"===r,c=g.event.special[r]||{};if(!(c._default&&c._default.call(i,t)!==!1||l||o&&o.nodeName&&g.noData[o.nodeName.toLowerCase()])){try{o[r]&&((a=o["on"+r])&&(o["on"+r]=null),g.event.triggered=!0,o[r]())}catch(u){}a&&(o["on"+r]=a),g.event.triggered=!1}}},handle:function(n){var i,o,r,s;if(n=arguments[0]=g.event.fix(n||t.event),n.currentTarget=this,i=n.type.indexOf(".")<0&&!n.exclusive,i||(o=n.type.split("."),n.type=o.shift(),r=new RegExp("(^|\\.)"+o.slice(0).sort().join("\\.(?:.*\\.)?")+"(\\.|$)")),s=g.data(this,"events"),o=s[n.type],s&&o){o=o.slice(0),s=0;for(var a=o.length;a>s;s++){var l=o[s];if((i||r.test(l.namespace))&&(n.handler=l.handler,n.data=l.data,n.handleObj=l,l=l.handler.apply(this,arguments),l!==e&&(n.result=l,l===!1&&(n.preventDefault(),n.stopPropagation())),n.isImmediatePropagationStopped()))break}}return n.result},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),fix:function(t){if(t[P])return t;var n=t;t=g.Event(n);for(var i,o=this.props.length;o;)i=this.props[--o],t[i]=n[i];return t.target||(t.target=t.srcElement||b),3===t.target.nodeType&&(t.target=t.target.parentNode),!t.relatedTarget&&t.fromElement&&(t.relatedTarget=t.fromElement===t.target?t.toElement:t.fromElement),null==t.pageX&&null!=t.clientX&&(n=b.documentElement,o=b.body,t.pageX=t.clientX+(n&&n.scrollLeft||o&&o.scrollLeft||0)-(n&&n.clientLeft||o&&o.clientLeft||0),t.pageY=t.clientY+(n&&n.scrollTop||o&&o.scrollTop||0)-(n&&n.clientTop||o&&o.clientTop||0)),!t.which&&(t.charCode||0===t.charCode?t.charCode:t.keyCode)&&(t.which=t.charCode||t.keyCode),!t.metaKey&&t.ctrlKey&&(t.metaKey=t.ctrlKey),t.which||t.button===e||(t.which=1&t.button?1:2&t.button?3:4&t.button?2:0),t},guid:1e8,proxy:g.proxy,special:{ready:{setup:g.bindReady,teardown:g.noop},live:{add:function(t){g.event.add(this,t.origType,g.extend({},t,{handler:c}))},remove:function(t){var e=!0,n=t.origType.replace(W,"");g.each(g.data(this,"events").live||[],function(){return n===this.origType.replace(W,"")?e=!1:void 0}),e&&g.event.remove(this,t.origType,c)}},beforeunload:{setup:function(t,e,n){return this.setInterval&&(this.onbeforeunload=n),!1},teardown:function(t,e){this.onbeforeunload===e&&(this.onbeforeunload=null)}}}};var H=b.removeEventListener?function(t,e,n){t.removeEventListener(e,n,!1)}:function(t,e,n){t.detachEvent("on"+e,n)};g.Event=function(t){return this.preventDefault?(t&&t.type?(this.originalEvent=t,this.type=t.type):this.type=t,this.timeStamp=r(),void(this[P]=!0)):new g.Event(t)},g.Event.prototype={preventDefault:function(){this.isDefaultPrevented=a;var t=this.originalEvent;t&&(t.preventDefault&&t.preventDefault(),t.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=a;var t=this.originalEvent;t&&(t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=a,this.stopPropagation()},isDefaultPrevented:s,isPropagationStopped:s,isImmediatePropagationStopped:s};var X=function(t){var e=t.relatedTarget;try{for(;e&&e!==this;)e=e.parentNode;e!==this&&(t.type=t.data,g.event.handle.apply(this,arguments))}catch(n){}},Y=function(t){t.type=t.data,g.event.handle.apply(this,arguments)};if(g.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(t,e){g.event.special[t]={setup:function(n){g.event.add(this,e,n&&n.selector?Y:X,t)},teardown:function(t){g.event.remove(this,e,t&&t.selector?Y:X)}}}),g.support.submitBubbles||(g.event.special.submit={setup:function(){return"form"===this.nodeName.toLowerCase()?!1:(g.event.add(this,"click.specialSubmit",function(t){var e=t.target,n=e.type;return"submit"!==n&&"image"!==n||!g(e).closest("form").length?void 0:l("submit",this,arguments)}),void g.event.add(this,"keypress.specialSubmit",function(t){var e=t.target,n=e.type;return"text"!==n&&"password"!==n||!g(e).closest("form").length||13!==t.keyCode?void 0:l("submit",this,arguments)}))},teardown:function(){g.event.remove(this,".specialSubmit")}}),!g.support.changeBubbles){var Z,$=/textarea|input|select/i,Q=function(t){var e=t.type,n=t.value;return"radio"===e||"checkbox"===e?n=t.checked:"select-multiple"===e?n=t.selectedIndex>-1?g.map(t.options,function(t){return t.selected}).join("-"):"":"select"===t.nodeName.toLowerCase()&&(n=t.selectedIndex),n},te=function(t,n){var i,o,r=t.target;return!$.test(r.nodeName)||r.readOnly||(i=g.data(r,"_change_data"),o=Q(r),("focusout"!==t.type||"radio"!==r.type)&&g.data(r,"_change_data",o),i===e||o===i||null==i&&!o)?void 0:(t.type="change",g.event.trigger(t,n,r))};g.event.special.change={filters:{focusout:te,click:function(t){var e=t.target,n=e.type;return"radio"===n||"checkbox"===n||"select"===e.nodeName.toLowerCase()?te.call(this,t):void 0},keydown:function(t){var e=t.target,n=e.type;return 13===t.keyCode&&"textarea"!==e.nodeName.toLowerCase()||32===t.keyCode&&("checkbox"===n||"radio"===n)||"select-multiple"===n?te.call(this,t):void 0},beforeactivate:function(t){t=t.target,g.data(t,"_change_data",Q(t))}},setup:function(){if("file"===this.type)return!1;for(var t in Z)g.event.add(this,t+".specialChange",Z[t]);return $.test(this.nodeName)},teardown:function(){return g.event.remove(this,".specialChange"),$.test(this.nodeName)}},Z=g.event.special.change.filters}b.addEventListener&&g.each({focus:"focusin",blur:"focusout"},function(t,e){function n(t){return t=g.event.fix(t),t.type=e,g.event.handle.call(this,t)}g.event.special[e]={setup:function(){this.addEventListener(t,n,!0)},teardown:function(){this.removeEventListener(t,n,!0)}}}),g.each(["bind","one"],function(t,n){g.fn[n]=function(t,i,o){if("object"==typeof t){for(var r in t)this[n](r,i,t[r],o);return this}g.isFunction(i)&&(o=i,i=e);var s="one"===n?g.proxy(o,function(t){return g(this).unbind(t,s),o.apply(this,arguments)}):o;if("unload"===t&&"one"!==n)this.one(t,i,o);else{r=0;for(var a=this.length;a>r;r++)g.event.add(this[r],t,s,i)}return this}}),g.fn.extend({unbind:function(t,e){if("object"!=typeof t||t.preventDefault){i=0;for(var n=this.length;n>i;i++)g.event.remove(this[i],t,e)}else for(var i in t)this.unbind(i,t[i]);return this},delegate:function(t,e,n,i){return this.live(e,n,i,t)},undelegate:function(t,e,n){return 0===arguments.length?this.unbind("live"):this.die(e,null,n,t)},trigger:function(t,e){return this.each(function(){g.event.trigger(t,e,this)})},triggerHandler:function(t,e){return this[0]?(t=g.Event(t),t.preventDefault(),t.stopPropagation(),g.event.trigger(t,e,this[0]),t.result):void 0},toggle:function(t){for(var e=arguments,n=1;n<e.length;)g.proxy(t,e[n++]);return this.click(g.proxy(t,function(i){var o=(g.data(this,"lastToggle"+t.guid)||0)%n;return g.data(this,"lastToggle"+t.guid,o+1),i.preventDefault(),e[o].apply(this,arguments)||!1}))},hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}});var ee={focus:"focusin",blur:"focusout",mouseenter:"mouseover",mouseleave:"mouseout"};g.each(["live","die"],function(t,n){g.fn[n]=function(t,i,o,r){var s,a,l,c=0,h=r||this.selector,m=r?this:g(this.context);for(g.isFunction(i)&&(o=i,i=e),t=(t||"").split(" ");null!=(s=t[c++]);)r=W.exec(s),a="",r&&(a=r[0],s=s.replace(W,"")),"hover"===s?t.push("mouseenter"+a,"mouseleave"+a):(l=s,"focus"===s||"blur"===s?(t.push(ee[s]+a),s+=a):s=(ee[s]||s)+a,"live"===n?m.each(function(){g.event.add(this,u(s,h),{data:i,selector:h,handler:o,origType:s,origHandler:o,preType:l})}):m.unbind(u(s,h),o));return this}}),g.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error".split(" "),function(t,e){g.fn[e]=function(t){return t?this.bind(e,t):this.trigger(e)},g.attrFn&&(g.attrFn[e]=!0)}),t.attachEvent&&!t.addEventListener&&t.attachEvent("onunload",function(){for(var t in g.cache)if(g.cache[t].handle)try{g.event.remove(g.cache[t].handle.elem)}catch(e){}}),function(){function t(e){for(var n,i="",o=0;e[o];o++)n=e[o],3===n.nodeType||4===n.nodeType?i+=n.nodeValue:8!==n.nodeType&&(i+=t(n.childNodes));return i}function n(t,e,n,i,o,r){o=0;for(var s=i.length;s>o;o++){var a=i[o];if(a){a=a[t];for(var l=!1;a;){if(a.sizcache===n){l=i[a.sizset];break}if(1!==a.nodeType||r||(a.sizcache=n,a.sizset=o),a.nodeName.toLowerCase()===e){l=a;break}a=a[t]}i[o]=l}}}function i(t,e,n,i,o,r){o=0;for(var s=i.length;s>o;o++){var a=i[o];if(a){a=a[t];for(var l=!1;a;){if(a.sizcache===n){l=i[a.sizset];break}if(1===a.nodeType)if(r||(a.sizcache=n,a.sizset=o),"string"!=typeof e){if(a===e){l=!0;break}}else if(c.filter(e,[a]).length>0){l=a;break}a=a[t]}i[o]=l}}}var o=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,r=0,s=Object.prototype.toString,a=!1,l=!0;[0,0].sort(function(){return l=!1,0});var c=function(t,e,n,i){n=n||[];var r=e=e||b;if(1!==e.nodeType&&9!==e.nodeType)return[];if(!t||"string"!=typeof t)return n;for(var a,l,m,f,y=[],g=!0,v=_(e),w=t;null!==(o.exec(""),a=o.exec(w));)if(w=a[3],y.push(a[1]),a[2]){f=a[3];break}if(y.length>1&&h.exec(t))if(2===y.length&&u.relative[y[0]])l=x(y[0]+y[1],e);else for(l=u.relative[y[0]]?[e]:c(y.shift(),e);y.length;)t=y.shift(),u.relative[t]&&(t+=y.shift()),l=x(t,l);else if(!i&&y.length>1&&9===e.nodeType&&!v&&u.match.ID.test(y[0])&&!u.match.ID.test(y[y.length-1])&&(a=c.find(y.shift(),e,v),e=a.expr?c.filter(a.expr,a.set)[0]:a.set[0]),e)for(a=i?{expr:y.pop(),set:p(i)}:c.find(y.pop(),1!==y.length||"~"!==y[0]&&"+"!==y[0]||!e.parentNode?e:e.parentNode,v),l=a.expr?c.filter(a.expr,a.set):a.set,y.length>0?m=p(l):g=!1;y.length;){var D=y.pop();a=D,u.relative[D]?a=y.pop():D="",null==a&&(a=e),u.relative[D](m,a,v)}else m=[];if(m||(m=l),m||c.error(D||t),"[object Array]"===s.call(m))if(g)if(e&&1===e.nodeType)for(t=0;null!=m[t];t++)m[t]&&(m[t]===!0||1===m[t].nodeType&&d(e,m[t]))&&n.push(l[t]);else for(t=0;null!=m[t];t++)m[t]&&1===m[t].nodeType&&n.push(l[t]);else n.push.apply(n,m);else p(m,n);return f&&(c(f,r,n,i),c.uniqueSort(n)),n};c.uniqueSort=function(t){if(y&&(a=l,t.sort(y),a))for(var e=1;e<t.length;e++)t[e]===t[e-1]&&t.splice(e--,1);return t},c.matches=function(t,e){return c(t,null,null,e)},c.find=function(t,e,n){var i,o;if(!t)return[];for(var r=0,s=u.order.length;s>r;r++){var a=u.order[r];if(o=u.leftMatch[a].exec(t)){var l=o[1];if(o.splice(1,1),"\\"!==l.substr(l.length-1)&&(o[1]=(o[1]||"").replace(/\\/g,""),i=u.find[a](o,e,n),null!=i)){t=t.replace(u.match[a],"");break}}}return i||(i=e.getElementsByTagName("*")),{set:i,expr:t}},c.filter=function(t,n,i,o){for(var r,s,a=t,l=[],h=n,m=n&&n[0]&&_(n[0]);t&&n.length;){for(var p in u.filter)if(null!=(r=u.leftMatch[p].exec(t))&&r[2]){var f,y,d=u.filter[p];if(y=r[1],s=!1,r.splice(1,1),"\\"!==y.substr(y.length-1)){if(h===l&&(l=[]),u.preFilter[p])if(r=u.preFilter[p](r,h,i,l,o,m)){if(r===!0)continue}else s=f=!0;if(r)for(var g=0;null!=(y=h[g]);g++)if(y){f=d(y,r,g,h);var x=o^!!f;i&&null!=f?x?s=!0:h[g]=!1:x&&(l.push(y),s=!0)}if(f!==e){if(i||(h=l),t=t.replace(u.match[p],""),!s)return[];break}}}if(t===a){if(null!=s)break;c.error(t)}a=t}return h},c.error=function(t){throw"Syntax error, unrecognized expression: "+t};var u=c.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(t){return t.getAttribute("href")}},relative:{"+":function(t,e){var n="string"==typeof e,i=n&&!/\W/.test(e);n=n&&!i,i&&(e=e.toLowerCase()),i=0;for(var o,r=t.length;r>i;i++)if(o=t[i]){for(;(o=o.previousSibling)&&1!==o.nodeType;);t[i]=n||o&&o.nodeName.toLowerCase()===e?o||!1:o===e}n&&c.filter(e,t,!0)},">":function(t,e){var n="string"==typeof e;if(n&&!/\W/.test(e)){e=e.toLowerCase();for(var i=0,o=t.length;o>i;i++){var r=t[i];r&&(n=r.parentNode,t[i]=n.nodeName.toLowerCase()===e?n:!1)}}else{for(i=0,o=t.length;o>i;i++)(r=t[i])&&(t[i]=n?r.parentNode:r.parentNode===e);n&&c.filter(e,t,!0)}},"":function(t,e,o){var s=r++,a=i;if("string"==typeof e&&!/\W/.test(e)){var l=e=e.toLowerCase();a=n}a("parentNode",e,s,t,l,o)},"~":function(t,e,o){var s=r++,a=i;if("string"==typeof e&&!/\W/.test(e)){var l=e=e.toLowerCase();a=n}a("previousSibling",e,s,t,l,o)}},find:{ID:function(t,e,n){return"undefined"==typeof e.getElementById||n?void 0:(t=e.getElementById(t[1]))?[t]:[]},NAME:function(t,e){if("undefined"!=typeof e.getElementsByName){var n=[];e=e.getElementsByName(t[1]);for(var i=0,o=e.length;o>i;i++)e[i].getAttribute("name")===t[1]&&n.push(e[i]);return 0===n.length?null:n}},TAG:function(t,e){return e.getElementsByTagName(t[1])}},preFilter:{CLASS:function(t,e,n,i,o,r){if(t=" "+t[1].replace(/\\/g,"")+" ",r)return t;r=0;for(var s;null!=(s=e[r]);r++)s&&(o^(s.className&&(" "+s.className+" ").replace(/[\t\n]/g," ").indexOf(t)>=0)?n||i.push(s):n&&(e[r]=!1));return!1},ID:function(t){return t[1].replace(/\\/g,"")},TAG:function(t){return t[1].toLowerCase()},CHILD:function(t){if("nth"===t[1]){var e=/(-?)(\d*)n((?:\+|-)?\d*)/.exec("even"===t[2]&&"2n"||"odd"===t[2]&&"2n+1"||!/\D/.test(t[2])&&"0n+"+t[2]||t[2]);t[2]=e[1]+(e[2]||1)-0,t[3]=e[3]-0}return t[0]=r++,t},ATTR:function(t,e,n,i,o,r){return e=t[1].replace(/\\/g,""),!r&&u.attrMap[e]&&(t[1]=u.attrMap[e]),"~="===t[2]&&(t[4]=" "+t[4]+" "),t
},PSEUDO:function(t,e,n,i,r){if("not"===t[1]){if(!((o.exec(t[3])||"").length>1||/^\w/.test(t[3])))return t=c.filter(t[3],e,n,!0^r),n||i.push.apply(i,t),!1;t[3]=c(t[3],null,null,e)}else if(u.match.POS.test(t[0])||u.match.CHILD.test(t[0]))return!0;return t},POS:function(t){return t.unshift(!0),t}},filters:{enabled:function(t){return t.disabled===!1&&"hidden"!==t.type},disabled:function(t){return t.disabled===!0},checked:function(t){return t.checked===!0},selected:function(t){return t.selected===!0},parent:function(t){return!!t.firstChild},empty:function(t){return!t.firstChild},has:function(t,e,n){return!!c(n[3],t).length},header:function(t){return/h\d/i.test(t.nodeName)},text:function(t){return"text"===t.type},radio:function(t){return"radio"===t.type},checkbox:function(t){return"checkbox"===t.type},file:function(t){return"file"===t.type},password:function(t){return"password"===t.type},submit:function(t){return"submit"===t.type},image:function(t){return"image"===t.type},reset:function(t){return"reset"===t.type},button:function(t){return"button"===t.type||"button"===t.nodeName.toLowerCase()},input:function(t){return/input|select|textarea|button/i.test(t.nodeName)}},setFilters:{first:function(t,e){return 0===e},last:function(t,e,n,i){return e===i.length-1},even:function(t,e){return e%2===0},odd:function(t,e){return e%2===1},lt:function(t,e,n){return e<n[3]-0},gt:function(t,e,n){return e>n[3]-0},nth:function(t,e,n){return n[3]-0===e},eq:function(t,e,n){return n[3]-0===e}},filter:{PSEUDO:function(e,n,i,o){var r=n[1],s=u.filters[r];if(s)return s(e,i,n,o);if("contains"===r)return(e.textContent||e.innerText||t([e])||"").indexOf(n[3])>=0;if("not"===r){for(n=n[3],i=0,o=n.length;o>i;i++)if(n[i]===e)return!1;return!0}c.error("Syntax error, unrecognized expression: "+r)},CHILD:function(t,e){var n=e[1],i=t;switch(n){case"only":case"first":for(;i=i.previousSibling;)if(1===i.nodeType)return!1;if("first"===n)return!0;i=t;case"last":for(;i=i.nextSibling;)if(1===i.nodeType)return!1;return!0;case"nth":n=e[2];var o=e[3];if(1===n&&0===o)return!0;e=e[0];var r=t.parentNode;if(r&&(r.sizcache!==e||!t.nodeIndex)){var s=0;for(i=r.firstChild;i;i=i.nextSibling)1===i.nodeType&&(i.nodeIndex=++s);r.sizcache=e}return t=t.nodeIndex-o,0===n?0===t:t%n===0&&t/n>=0}},ID:function(t,e){return 1===t.nodeType&&t.getAttribute("id")===e},TAG:function(t,e){return"*"===e&&1===t.nodeType||t.nodeName.toLowerCase()===e},CLASS:function(t,e){return(" "+(t.className||t.getAttribute("class"))+" ").indexOf(e)>-1},ATTR:function(t,e){var n=e[1];t=u.attrHandle[n]?u.attrHandle[n](t):null!=t[n]?t[n]:t.getAttribute(n),n=t+"";var i=e[2];return e=e[4],null==t?"!="===i:"="===i?n===e:"*="===i?n.indexOf(e)>=0:"~="===i?(" "+n+" ").indexOf(e)>=0:e?"!="===i?n!==e:"^="===i?0===n.indexOf(e):"$="===i?n.substr(n.length-e.length)===e:"|="===i?n===e||n.substr(0,e.length+1)===e+"-":!1:n&&t!==!1},POS:function(t,e,n,i){var o=u.setFilters[e[2]];return o?o(t,n,e,i):void 0}}},h=u.match.POS;for(var m in u.match)u.match[m]=new RegExp(u.match[m].source+/(?![^\[]*\])(?![^\(]*\))/.source),u.leftMatch[m]=new RegExp(/(^(?:.|\r|\n)*?)/.source+u.match[m].source.replace(/\\(\d+)/g,function(t,e){return"\\"+(e-0+1)}));var p=function(t,e){return t=Array.prototype.slice.call(t,0),e?(e.push.apply(e,t),e):t};try{Array.prototype.slice.call(b.documentElement.childNodes,0)}catch(f){p=function(t,e){if(e=e||[],"[object Array]"===s.call(t))Array.prototype.push.apply(e,t);else if("number"==typeof t.length)for(var n=0,i=t.length;i>n;n++)e.push(t[n]);else for(n=0;t[n];n++)e.push(t[n]);return e}}var y;b.documentElement.compareDocumentPosition?y=function(t,e){return t.compareDocumentPosition&&e.compareDocumentPosition?(t=4&t.compareDocumentPosition(e)?-1:t===e?0:1,0===t&&(a=!0),t):(t==e&&(a=!0),t.compareDocumentPosition?-1:1)}:"sourceIndex"in b.documentElement?y=function(t,e){return t.sourceIndex&&e.sourceIndex?(t=t.sourceIndex-e.sourceIndex,0===t&&(a=!0),t):(t==e&&(a=!0),t.sourceIndex?-1:1)}:b.createRange&&(y=function(t,e){if(!t.ownerDocument||!e.ownerDocument)return t==e&&(a=!0),t.ownerDocument?-1:1;var n=t.ownerDocument.createRange(),i=e.ownerDocument.createRange();return n.setStart(t,0),n.setEnd(t,0),i.setStart(e,0),i.setEnd(e,0),t=n.compareBoundaryPoints(Range.START_TO_END,i),0===t&&(a=!0),t}),function(){var t=b.createElement("div"),n="script"+(new Date).getTime();t.innerHTML="<a name='"+n+"'/>";var i=b.documentElement;i.insertBefore(t,i.firstChild),b.getElementById(n)&&(u.find.ID=function(t,n,i){return"undefined"==typeof n.getElementById||i?void 0:(n=n.getElementById(t[1]))?n.id===t[1]||"undefined"!=typeof n.getAttributeNode&&n.getAttributeNode("id").nodeValue===t[1]?[n]:e:[]},u.filter.ID=function(t,e){var n="undefined"!=typeof t.getAttributeNode&&t.getAttributeNode("id");return 1===t.nodeType&&n&&n.nodeValue===e}),i.removeChild(t),i=t=null}(),function(){var t=b.createElement("div");t.appendChild(b.createComment("")),t.getElementsByTagName("*").length>0&&(u.find.TAG=function(t,e){if(e=e.getElementsByTagName(t[1]),"*"===t[1]){t=[];for(var n=0;e[n];n++)1===e[n].nodeType&&t.push(e[n]);e=t}return e}),t.innerHTML="<a href='#'></a>",t.firstChild&&"undefined"!=typeof t.firstChild.getAttribute&&"#"!==t.firstChild.getAttribute("href")&&(u.attrHandle.href=function(t){return t.getAttribute("href",2)}),t=null}(),b.querySelectorAll&&function(){var t=c,e=b.createElement("div");if(e.innerHTML="<p class='TEST'></p>",!e.querySelectorAll||0!==e.querySelectorAll(".TEST").length){c=function(e,n,i,o){if(n=n||b,!o&&9===n.nodeType&&!_(n))try{return p(n.querySelectorAll(e),i)}catch(r){}return t(e,n,i,o)};for(var n in t)c[n]=t[n];e=null}}(),function(){var t=b.createElement("div");t.innerHTML="<div class='test e'></div><div class='test'></div>",t.getElementsByClassName&&0!==t.getElementsByClassName("e").length&&(t.lastChild.className="e",1!==t.getElementsByClassName("e").length&&(u.order.splice(1,0,"CLASS"),u.find.CLASS=function(t,e,n){return"undefined"==typeof e.getElementsByClassName||n?void 0:e.getElementsByClassName(t[1])},t=null))}();var d=b.compareDocumentPosition?function(t,e){return!!(16&t.compareDocumentPosition(e))}:function(t,e){return t!==e&&(t.contains?t.contains(e):!0)},_=function(t){return(t=(t?t.ownerDocument||t:0).documentElement)?"HTML"!==t.nodeName:!1},x=function(t,e){var n,i=[],o="";for(e=e.nodeType?[e]:e;n=u.match.PSEUDO.exec(t);)o+=n[0],t=t.replace(u.match.PSEUDO,"");t=u.relative[t]?t+"*":t,n=0;for(var r=e.length;r>n;n++)c(t,e[n],i);return c.filter(o,i)};g.find=c,g.expr=c.selectors,g.expr[":"]=g.expr.filters,g.unique=c.uniqueSort,g.text=t,g.isXMLDoc=_,g.contains=d}();var ne=/Until$/,ie=/^(?:parents|prevUntil|prevAll)/,oe=/,/;F=Array.prototype.slice;var re=function(t,e,n){if(g.isFunction(e))return g.grep(t,function(t,i){return!!e.call(t,i,t)===n});if(e.nodeType)return g.grep(t,function(t){return t===e===n});if("string"==typeof e){var i=g.grep(t,function(t){return 1===t.nodeType});if(D.test(e))return g.filter(e,i,!n);e=g.filter(e,i)}return g.grep(t,function(t){return g.inArray(t,e)>=0===n})};g.fn.extend({find:function(t){for(var e=this.pushStack("","find",t),n=0,i=0,o=this.length;o>i;i++)if(n=e.length,g.find(t,this[i],e),i>0)for(var r=n;r<e.length;r++)for(var s=0;n>s;s++)if(e[s]===e[r]){e.splice(r--,1);break}return e},has:function(t){var e=g(t);return this.filter(function(){for(var t=0,n=e.length;n>t;t++)if(g.contains(this,e[t]))return!0})},not:function(t){return this.pushStack(re(this,t,!1),"not",t)},filter:function(t){return this.pushStack(re(this,t,!0),"filter",t)},is:function(t){return!!t&&g.filter(t,this).length>0},closest:function(t,e){if(g.isArray(t)){var n,i,o=[],r=this[0],s={};if(r&&t.length){n=0;for(var a=t.length;a>n;n++)i=t[n],s[i]||(s[i]=g.expr.match.POS.test(i)?g(i,e||this.context):i);for(;r&&r.ownerDocument&&r!==e;){for(i in s)n=s[i],(n.jquery?n.index(r)>-1:g(r).is(n))&&(o.push({selector:i,elem:r}),delete s[i]);r=r.parentNode}}return o}var l=g.expr.match.POS.test(t)?g(t,e||this.context):null;return this.map(function(n,i){for(;i&&i.ownerDocument&&i!==e;){if(l?l.index(i)>-1:g(i).is(t))return i;i=i.parentNode}return null})},index:function(t){return t&&"string"!=typeof t?g.inArray(t.jquery?t[0]:t,this):g.inArray(this[0],t?g(t):this.parent().children())},add:function(t,e){return t="string"==typeof t?g(t,e||this.context):g.makeArray(t),e=g.merge(this.get(),t),this.pushStack(h(t[0])||h(e[0])?e:g.unique(e))},andSelf:function(){return this.add(this.prevObject)}}),g.each({parent:function(t){return(t=t.parentNode)&&11!==t.nodeType?t:null},parents:function(t){return g.dir(t,"parentNode")},parentsUntil:function(t,e,n){return g.dir(t,"parentNode",n)},next:function(t){return g.nth(t,2,"nextSibling")},prev:function(t){return g.nth(t,2,"previousSibling")},nextAll:function(t){return g.dir(t,"nextSibling")},prevAll:function(t){return g.dir(t,"previousSibling")},nextUntil:function(t,e,n){return g.dir(t,"nextSibling",n)},prevUntil:function(t,e,n){return g.dir(t,"previousSibling",n)},siblings:function(t){return g.sibling(t.parentNode.firstChild,t)},children:function(t){return g.sibling(t.firstChild)},contents:function(t){return g.nodeName(t,"iframe")?t.contentDocument||t.contentWindow.document:g.makeArray(t.childNodes)}},function(t,e){g.fn[t]=function(n,i){var o=g.map(this,e,n);return ne.test(t)||(i=n),i&&"string"==typeof i&&(o=g.filter(i,o)),o=this.length>1?g.unique(o):o,(this.length>1||oe.test(i))&&ie.test(t)&&(o=o.reverse()),this.pushStack(o,t,F.call(arguments).join(","))}}),g.extend({filter:function(t,e,n){return n&&(t=":not("+t+")"),g.find.matches(t,e)},dir:function(t,n,i){var o=[];for(t=t[n];t&&9!==t.nodeType&&(i===e||1!==t.nodeType||!g(t).is(i));)1===t.nodeType&&o.push(t),t=t[n];return o},nth:function(t,e,n){e=e||1;for(var i=0;t&&(1!==t.nodeType||++i!==e);t=t[n]);return t},sibling:function(t,e){for(var n=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&n.push(t);return n}});var se=/ jQuery\d+="(?:\d+|null)"/g,ae=/^\s+/,le=/(<([\w:]+)[^>]*?)\/>/g,ce=/^(?:area|br|col|embed|hr|img|input|link|meta|param)$/i,ue=/<([\w:]+)/,he=/<tbody/i,me=/<|&#?\w+;/,pe=/<script|<object|<embed|<option|<style/i,fe=/checked\s*(?:[^=]|=\s*.checked.)/i,ye=function(t,e,n){return ce.test(n)?t:e+"></"+n+">"},de={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]};de.optgroup=de.option,de.tbody=de.tfoot=de.colgroup=de.caption=de.thead,de.th=de.td,g.support.htmlSerialize||(de._default=[1,"div<div>","</div>"]),g.fn.extend({text:function(t){return g.isFunction(t)?this.each(function(e){var n=g(this);n.text(t.call(this,e,n.text()))}):"object"!=typeof t&&t!==e?this.empty().append((this[0]&&this[0].ownerDocument||b).createTextNode(t)):g.text(this)},wrapAll:function(t){if(g.isFunction(t))return this.each(function(e){g(this).wrapAll(t.call(this,e))});if(this[0]){var e=g(t,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var t=this;t.firstChild&&1===t.firstChild.nodeType;)t=t.firstChild;return t}).append(this)}return this},wrapInner:function(t){return this.each(g.isFunction(t)?function(e){g(this).wrapInner(t.call(this,e))}:function(){var e=g(this),n=e.contents();n.length?n.wrapAll(t):e.append(t)})},wrap:function(t){return this.each(function(){g(this).wrapAll(t)})},unwrap:function(){return this.parent().each(function(){g.nodeName(this,"body")||g(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(t){1===this.nodeType&&this.appendChild(t)})},prepend:function(){return this.domManip(arguments,!0,function(t){1===this.nodeType&&this.insertBefore(t,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(t){this.parentNode.insertBefore(t,this)});if(arguments.length){var t=g(arguments[0]);return t.push.apply(t,this.toArray()),this.pushStack(t,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(t){this.parentNode.insertBefore(t,this.nextSibling)});if(arguments.length){var t=this.pushStack(this,"after",arguments);return t.push.apply(t,g(arguments[0]).toArray()),t}},remove:function(t,e){for(var n,i=0;null!=(n=this[i]);i++)(!t||g.filter(t,[n]).length)&&(e||1!==n.nodeType||(g.cleanData(n.getElementsByTagName("*")),g.cleanData([n])),n.parentNode&&n.parentNode.removeChild(n));return this},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)for(1===t.nodeType&&g.cleanData(t.getElementsByTagName("*"));t.firstChild;)t.removeChild(t.firstChild);return this},clone:function(t){var e=this.map(function(){if(g.support.noCloneEvent||g.isXMLDoc(this))return this.cloneNode(!0);var t=this.outerHTML,e=this.ownerDocument;return t||(t=e.createElement("div"),t.appendChild(this.cloneNode(!0)),t=t.innerHTML),g.clean([t.replace(se,"").replace(/=([^="'>\s]+\/)>/g,'="$1">').replace(ae,"")],e)[0]});return t===!0&&(m(this,e),m(this.find("*"),e.find("*"))),e},html:function(t){if(t===e)return this[0]&&1===this[0].nodeType?this[0].innerHTML.replace(se,""):null;if("string"!=typeof t||pe.test(t)||!g.support.leadingWhitespace&&ae.test(t)||de[(ue.exec(t)||["",""])[1].toLowerCase()])g.isFunction(t)?this.each(function(e){var n=g(this),i=n.html();n.empty().append(function(){return t.call(this,e,i)})}):this.empty().append(t);else{t=t.replace(le,ye);try{for(var n=0,i=this.length;i>n;n++)1===this[n].nodeType&&(g.cleanData(this[n].getElementsByTagName("*")),this[n].innerHTML=t)}catch(o){this.empty().append(t)}}return this},replaceWith:function(t){return this[0]&&this[0].parentNode?g.isFunction(t)?this.each(function(e){var n=g(this),i=n.html();n.replaceWith(t.call(this,e,i))}):("string"!=typeof t&&(t=g(t).detach()),this.each(function(){var e=this.nextSibling,n=this.parentNode;g(this).remove(),e?g(e).before(t):g(n).append(t)})):this.pushStack(g(g.isFunction(t)?t():t),"replaceWith",t)},detach:function(t){return this.remove(t,!0)},domManip:function(t,n,o){function r(t){return g.nodeName(t,"table")?t.getElementsByTagName("tbody")[0]||t.appendChild(t.ownerDocument.createElement("tbody")):t}var s,a,l,c=t[0],u=[];if(!g.support.checkClone&&3===arguments.length&&"string"==typeof c&&fe.test(c))return this.each(function(){g(this).domManip(t,n,o,!0)});if(g.isFunction(c))return this.each(function(i){var r=g(this);t[0]=c.call(this,i,n?r.html():e),r.domManip(t,n,o)});if(this[0]){if(s=c&&c.parentNode,s=g.support.parentNode&&s&&11===s.nodeType&&s.childNodes.length===this.length?{fragment:s}:p(t,this,u),l=s.fragment,a=1===l.childNodes.length?l=l.firstChild:l.firstChild){n=n&&g.nodeName(a,"tr");for(var h=0,m=this.length;m>h;h++)o.call(n?r(this[h],a):this[h],h>0||s.cacheable||this.length>1?l.cloneNode(!0):l)}u.length&&g.each(u,i)}return this}}),g.fragments={},g.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,e){g.fn[t]=function(n){var i=[];n=g(n);var o=1===this.length&&this[0].parentNode;if(o&&11===o.nodeType&&1===o.childNodes.length&&1===n.length)return n[e](this[0]),this;o=0;for(var r=n.length;r>o;o++){var s=(o>0?this.clone(!0):this).get();g.fn[e].apply(g(n[o]),s),i=i.concat(s)}return this.pushStack(i,t,n.selector)}}),g.extend({clean:function(t,e,n,i){e=e||b,"undefined"==typeof e.createElement&&(e=e.ownerDocument||e[0]&&e[0].ownerDocument||b);for(var o,r=[],s=0;null!=(o=t[s]);s++)if("number"==typeof o&&(o+=""),o){if("string"!=typeof o||me.test(o)){if("string"==typeof o){o=o.replace(le,ye);var a=(ue.exec(o)||["",""])[1].toLowerCase(),l=de[a]||de._default,c=l[0],u=e.createElement("div");for(u.innerHTML=l[1]+o+l[2];c--;)u=u.lastChild;if(!g.support.tbody)for(c=he.test(o),a="table"!==a||c?"<table>"!==l[1]||c?[]:u.childNodes:u.firstChild&&u.firstChild.childNodes,l=a.length-1;l>=0;--l)g.nodeName(a[l],"tbody")&&!a[l].childNodes.length&&a[l].parentNode.removeChild(a[l]);!g.support.leadingWhitespace&&ae.test(o)&&u.insertBefore(e.createTextNode(ae.exec(o)[0]),u.firstChild),o=u.childNodes}}else o=e.createTextNode(o);o.nodeType?r.push(o):r=g.merge(r,o)}if(n)for(s=0;r[s];s++)!i||!g.nodeName(r[s],"script")||r[s].type&&"text/javascript"!==r[s].type.toLowerCase()?(1===r[s].nodeType&&r.splice.apply(r,[s+1,0].concat(g.makeArray(r[s].getElementsByTagName("script")))),n.appendChild(r[s])):i.push(r[s].parentNode?r[s].parentNode.removeChild(r[s]):r[s]);return r},cleanData:function(t){for(var e,n,i,o=g.cache,r=g.event.special,s=g.support.deleteExpando,a=0;null!=(i=t[a]);a++)if(n=i[g.expando]){if(e=o[n],e.events)for(var l in e.events)r[l]?g.event.remove(i,l):H(i,l,e.handle);s?delete i[g.expando]:i.removeAttribute&&i.removeAttribute(g.expando),delete o[n]}}});var _e=/z-?index|font-?weight|opacity|zoom|line-?height/i,ge=/alpha\([^)]*\)/,xe=/opacity=([^)]*)/,ve=/float/i,be=/-([a-z])/gi,we=/([A-Z])/g,De=/^-?\d+(?:px)?$/i,Be=/^-?\d/,Ce={position:"absolute",visibility:"hidden",display:"block"},Se=["Left","Right"],Ae=["Top","Bottom"],Me=b.defaultView&&b.defaultView.getComputedStyle,Ve=g.support.cssFloat?"cssFloat":"styleFloat",Ie=function(t,e){return e.toUpperCase()};g.fn.css=function(t,n){return o(this,t,n,!0,function(t,n,i){return i===e?g.curCSS(t,n):("number"!=typeof i||_e.test(n)||(i+="px"),void g.style(t,n,i))})},g.extend({style:function(t,n,i){if(!t||3===t.nodeType||8===t.nodeType)return e;("width"===n||"height"===n)&&parseFloat(i)<0&&(i=e);var o=t.style||t,r=i!==e;return g.support.opacity||"opacity"!==n?(ve.test(n)&&(n=Ve),n=n.replace(be,Ie),r&&(o[n]=i),o[n]):(r&&(o.zoom=1,n=parseInt(i,10)+""=="NaN"?"":"alpha(opacity="+100*i+")",t=o.filter||g.curCSS(t,"filter")||"",o.filter=ge.test(t)?t.replace(ge,n):n),o.filter&&o.filter.indexOf("opacity=")>=0?parseFloat(xe.exec(o.filter)[1])/100+"":"")},css:function(t,e,n,i){function o(){r="width"===e?t.offsetWidth:t.offsetHeight,"border"!==i&&g.each(s,function(){i||(r-=parseFloat(g.curCSS(t,"padding"+this,!0))||0),"margin"===i?r+=parseFloat(g.curCSS(t,"margin"+this,!0))||0:r-=parseFloat(g.curCSS(t,"border"+this+"Width",!0))||0})}if("width"===e||"height"===e){var r,s="width"===e?Se:Ae;return 0!==t.offsetWidth?o():g.swap(t,Ce,o),Math.max(0,Math.round(r))}return g.curCSS(t,e,n)},curCSS:function(t,e,n){var i,o=t.style;if(!g.support.opacity&&"opacity"===e&&t.currentStyle)return i=xe.test(t.currentStyle.filter||"")?parseFloat(RegExp.$1)/100+"":"",""===i?"1":i;if(ve.test(e)&&(e=Ve),!n&&o&&o[e])i=o[e];else if(Me){if(ve.test(e)&&(e="float"),e=e.replace(we,"-$1").toLowerCase(),o=t.ownerDocument.defaultView,!o)return null;(t=o.getComputedStyle(t,null))&&(i=t.getPropertyValue(e)),"opacity"===e&&""===i&&(i="1")}else if(t.currentStyle&&(n=e.replace(be,Ie),i=t.currentStyle[e]||t.currentStyle[n],!De.test(i)&&Be.test(i))){e=o.left;var r=t.runtimeStyle.left;t.runtimeStyle.left=t.currentStyle.left,o.left="fontSize"===n?"1em":i||0,i=o.pixelLeft+"px",o.left=e,t.runtimeStyle.left=r}return i},swap:function(t,e,n){var i={};for(var o in e)i[o]=t.style[o],t.style[o]=e[o];n.call(t);for(o in e)t.style[o]=i[o]}}),g.expr&&g.expr.filters&&(g.expr.filters.hidden=function(t){var e=t.offsetWidth,n=t.offsetHeight,i="tr"===t.nodeName.toLowerCase();return 0!==e||0!==n||i?e>0&&n>0&&!i?!1:"none"===g.curCSS(t,"display"):!0},g.expr.filters.visible=function(t){return!g.expr.filters.hidden(t)});var Te=r(),Le=/<script(.|\s)*?\/script>/gi,Fe=/select|textarea/i,Ge=/color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week/i,Pe=/=\?(&|$)/,ke=/\?/,Ne=/(\?|&)_=.*?(&|$)/,Je=/^(\w+:)?\/\/([^\/?#]+)/,Re=/%20/g,Ee=g.fn.load;g.fn.extend({load:function(t,e,n){if("string"!=typeof t)return Ee.call(this,t);if(!this.length)return this;var i=t.indexOf(" ");if(i>=0){var o=t.slice(i,t.length);t=t.slice(0,i)}i="GET",e&&(g.isFunction(e)?(n=e,e=null):"object"==typeof e&&(e=g.param(e,g.ajaxSettings.traditional),i="POST"));var r=this;return g.ajax({url:t,type:i,dataType:"html",data:e,complete:function(t,e){("success"===e||"notmodified"===e)&&r.html(o?g("<div />").append(t.responseText.replace(Le,"")).find(o):t.responseText),n&&r.each(n,[t.responseText,e,t])}}),this},serialize:function(){return g.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?g.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||Fe.test(this.nodeName)||Ge.test(this.type))}).map(function(t,e){return t=g(this).val(),null==t?null:g.isArray(t)?g.map(t,function(t){return{name:e.name,value:t}}):{name:e.name,value:t}}).get()}}),g.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(t,e){g.fn[e]=function(t){return this.bind(e,t)}}),g.extend({get:function(t,e,n,i){return g.isFunction(e)&&(i=i||n,n=e,e=null),g.ajax({type:"GET",url:t,data:e,success:n,dataType:i})},getScript:function(t,e){return g.get(t,null,e,"script")},getJSON:function(t,e,n){return g.get(t,e,n,"json")},post:function(t,e,n,i){return g.isFunction(e)&&(i=i||n,n=e,e={}),g.ajax({type:"POST",url:t,data:e,success:n,dataType:i})},ajaxSetup:function(t){g.extend(g.ajaxSettings,t)},ajaxSettings:{url:location.href,global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,xhr:!t.XMLHttpRequest||"file:"===t.location.protocol&&t.ActiveXObject?function(){try{return new t.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}:function(){return new t.XMLHttpRequest},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"}},lastModified:{},etag:{},ajax:function(n){function i(){u.success&&u.success.call(h,c,l,v),u.global&&s("ajaxSuccess",[v,u])}function o(){u.complete&&u.complete.call(h,v,l),u.global&&s("ajaxComplete",[v,u]),u.global&&!--g.active&&g.event.trigger("ajaxStop")}function s(t,e){(u.context?g(u.context):g.event).trigger(t,e)}var a,l,c,u=g.extend(!0,{},g.ajaxSettings,n),h=n&&n.context||u,m=u.type.toUpperCase();if(u.data&&u.processData&&"string"!=typeof u.data&&(u.data=g.param(u.data,u.traditional)),"jsonp"===u.dataType&&("GET"===m?Pe.test(u.url)||(u.url+=(ke.test(u.url)?"&":"?")+(u.jsonp||"callback")+"=?"):u.data&&Pe.test(u.data)||(u.data=(u.data?u.data+"&":"")+(u.jsonp||"callback")+"=?"),u.dataType="json"),"json"===u.dataType&&(u.data&&Pe.test(u.data)||Pe.test(u.url))&&(a=u.jsonpCallback||"jsonp"+Te++,u.data&&(u.data=(u.data+"").replace(Pe,"="+a+"$1")),u.url=u.url.replace(Pe,"="+a+"$1"),u.dataType="script",t[a]=t[a]||function(n){c=n,i(),o(),t[a]=e;try{delete t[a]}catch(r){}y&&y.removeChild(d)}),"script"===u.dataType&&null===u.cache&&(u.cache=!1),u.cache===!1&&"GET"===m){var p=r(),f=u.url.replace(Ne,"$1_="+p+"$2");u.url=f+(f===u.url?(ke.test(u.url)?"&":"?")+"_="+p:"")}if(u.data&&"GET"===m&&(u.url+=(ke.test(u.url)?"&":"?")+u.data),u.global&&!g.active++&&g.event.trigger("ajaxStart"),p=(p=Je.exec(u.url))&&(p[1]&&p[1]!==location.protocol||p[2]!==location.host),"script"===u.dataType&&"GET"===m&&p){var y=b.getElementsByTagName("head")[0]||b.documentElement,d=b.createElement("script");if(d.src=u.url,u.scriptCharset&&(d.charset=u.scriptCharset),!a){var _=!1;d.onload=d.onreadystatechange=function(){_||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(_=!0,i(),o(),d.onload=d.onreadystatechange=null,y&&d.parentNode&&y.removeChild(d))}}return y.insertBefore(d,y.firstChild),e}var x=!1,v=u.xhr();if(v){u.username?v.open(m,u.url,u.async,u.username,u.password):v.open(m,u.url,u.async);try{(u.data||n&&n.contentType)&&v.setRequestHeader("Content-Type",u.contentType),u.ifModified&&(g.lastModified[u.url]&&v.setRequestHeader("If-Modified-Since",g.lastModified[u.url]),g.etag[u.url]&&v.setRequestHeader("If-None-Match",g.etag[u.url])),p||v.setRequestHeader("X-Requested-With","XMLHttpRequest"),v.setRequestHeader("Accept",u.dataType&&u.accepts[u.dataType]?u.accepts[u.dataType]+", */*":u.accepts._default)}catch(w){}if(u.beforeSend&&u.beforeSend.call(h,v,u)===!1)return u.global&&!--g.active&&g.event.trigger("ajaxStop"),v.abort(),!1;u.global&&s("ajaxSend",[v,u]);var D=v.onreadystatechange=function(t){if(v&&0!==v.readyState&&"abort"!==t){if(!x&&v&&(4===v.readyState||"timeout"===t)){x=!0,v.onreadystatechange=g.noop,l="timeout"===t?"timeout":g.httpSuccess(v)?u.ifModified&&g.httpNotModified(v,u.url)?"notmodified":"success":"error";var e;if("success"===l)try{c=g.httpData(v,u.dataType,u)}catch(n){l="parsererror",e=n}"success"===l||"notmodified"===l?a||i():g.handleError(u,v,l,e),o(),"timeout"===t&&v.abort(),u.async&&(v=null)}}else x||o(),x=!0,v&&(v.onreadystatechange=g.noop)};try{var B=v.abort;v.abort=function(){v&&B.call(v),D("abort")}}catch(C){}u.async&&u.timeout>0&&setTimeout(function(){v&&!x&&D("timeout")},u.timeout);try{v.send("POST"===m||"PUT"===m||"DELETE"===m?u.data:null)}catch(S){g.handleError(u,v,null,S),o()}return u.async||D(),v}},handleError:function(t,e,n,i){t.error&&t.error.call(t.context||t,e,n,i),t.global&&(t.context?g(t.context):g.event).trigger("ajaxError",[e,t,i])},active:0,httpSuccess:function(t){try{return!t.status&&"file:"===location.protocol||t.status>=200&&t.status<300||304===t.status||1223===t.status||0===t.status}catch(e){}return!1},httpNotModified:function(t,e){var n=t.getResponseHeader("Last-Modified"),i=t.getResponseHeader("Etag");return n&&(g.lastModified[e]=n),i&&(g.etag[e]=i),304===t.status||0===t.status},httpData:function(t,e,n){var i=t.getResponseHeader("content-type")||"",o="xml"===e||!e&&i.indexOf("xml")>=0;return t=o?t.responseXML:t.responseText,o&&"parsererror"===t.documentElement.nodeName&&g.error("parsererror"),n&&n.dataFilter&&(t=n.dataFilter(t,e)),"string"==typeof t&&("json"===e||!e&&i.indexOf("json")>=0?t=g.parseJSON(t):("script"===e||!e&&i.indexOf("javascript")>=0)&&g.globalEval(t)),t},param:function(t,n){function i(t,e){g.isArray(e)?g.each(e,function(e,r){n||/\[\]$/.test(t)?o(t,r):i(t+"["+("object"==typeof r||g.isArray(r)?e:"")+"]",r)}):n||null==e||"object"!=typeof e?o(t,e):g.each(e,function(e,n){i(t+"["+e+"]",n)})}function o(t,e){e=g.isFunction(e)?e():e,r[r.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)}var r=[];if(n===e&&(n=g.ajaxSettings.traditional),g.isArray(t)||t.jquery)g.each(t,function(){o(this.name,this.value)});else for(var s in t)i(s,t[s]);return r.join("&").replace(Re,"+")}});var je,ze={},Oe=/toggle|show|hide/,qe=/^([+-]=)?([\d+-.]+)(.*)$/,Ue=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];g.fn.extend({show:function(t,e){if(t||0===t)return this.animate(f("show",3),t,e);for(t=0,e=this.length;e>t;t++){var n=g.data(this[t],"olddisplay");if(this[t].style.display=n||"","none"===g.css(this[t],"display")){n=this[t].nodeName;var i;if(ze[n])i=ze[n];else{var o=g("<"+n+" />").appendTo("body");i=o.css("display"),"none"===i&&(i="block"),o.remove(),ze[n]=i}g.data(this[t],"olddisplay",i)}}for(t=0,e=this.length;e>t;t++)this[t].style.display=g.data(this[t],"olddisplay")||"";return this},hide:function(t,e){if(t||0===t)return this.animate(f("hide",3),t,e);for(t=0,e=this.length;e>t;t++){var n=g.data(this[t],"olddisplay");!n&&"none"!==n&&g.data(this[t],"olddisplay",g.css(this[t],"display"))}for(t=0,e=this.length;e>t;t++)this[t].style.display="none";return this},_toggle:g.fn.toggle,toggle:function(t,e){var n="boolean"==typeof t;return g.isFunction(t)&&g.isFunction(e)?this._toggle.apply(this,arguments):null==t||n?this.each(function(){var e=n?t:g(this).is(":hidden");g(this)[e?"show":"hide"]()}):this.animate(f("toggle",3),t,e),this},fadeTo:function(t,e,n){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:e},t,n)},animate:function(t,e,n,i){var o=g.speed(e,n,i);return g.isEmptyObject(t)?this.each(o.complete):this[o.queue===!1?"each":"queue"](function(){var e,n=g.extend({},o),i=1===this.nodeType&&g(this).is(":hidden"),r=this;for(e in t){var s=e.replace(be,Ie);if(e!==s&&(t[s]=t[e],delete t[e],e=s),"hide"===t[e]&&i||"show"===t[e]&&!i)return n.complete.call(this);"height"!==e&&"width"!==e||!this.style||(n.display=g.css(this,"display"),n.overflow=this.style.overflow),g.isArray(t[e])&&((n.specialEasing=n.specialEasing||{})[e]=t[e][1],t[e]=t[e][0])}return null!=n.overflow&&(this.style.overflow="hidden"),n.curAnim=g.extend({},t),g.each(t,function(e,o){var s=new g.fx(r,n,e);if(Oe.test(o))s["toggle"===o?i?"show":"hide":o](t);else{var a=qe.exec(o),l=s.cur(!0)||0;if(a){o=parseFloat(a[2]);var c=a[3]||"px";"px"!==c&&(r.style[e]=(o||1)+c,l=(o||1)/s.cur(!0)*l,r.style[e]=l+c),a[1]&&(o=("-="===a[1]?-1:1)*o+l),s.custom(l,o,c)}else s.custom(l,o,"")}}),!0})},stop:function(t,e){var n=g.timers;return t&&this.queue([]),this.each(function(){for(var t=n.length-1;t>=0;t--)n[t].elem===this&&(e&&n[t](!0),n.splice(t,1))}),e||this.dequeue(),this}}),g.each({slideDown:f("show",1),slideUp:f("hide",1),slideToggle:f("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"}},function(t,e){g.fn[t]=function(t,n){return this.animate(e,t,n)}}),g.extend({speed:function(t,e,n){var i=t&&"object"==typeof t?t:{complete:n||!n&&e||g.isFunction(t)&&t,duration:t,easing:n&&e||e&&!g.isFunction(e)&&e};return i.duration=g.fx.off?0:"number"==typeof i.duration?i.duration:g.fx.speeds[i.duration]||g.fx.speeds._default,i.old=i.complete,i.complete=function(){i.queue!==!1&&g(this).dequeue(),g.isFunction(i.old)&&i.old.call(this)},i},easing:{linear:function(t,e,n,i){return n+i*t},swing:function(t,e,n,i){return(-Math.cos(t*Math.PI)/2+.5)*i+n}},timers:[],fx:function(t,e,n){this.options=e,this.elem=t,this.prop=n,e.orig||(e.orig={})}}),g.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(g.fx.step[this.prop]||g.fx.step._default)(this),"height"!==this.prop&&"width"!==this.prop||!this.elem.style||(this.elem.style.display="block")},cur:function(t){return null==this.elem[this.prop]||this.elem.style&&null!=this.elem.style[this.prop]?(t=parseFloat(g.css(this.elem,this.prop,t)))&&t>-1e4?t:parseFloat(g.curCSS(this.elem,this.prop))||0:this.elem[this.prop]},custom:function(t,e,n){function i(t){return o.step(t)}this.startTime=r(),this.start=t,this.end=e,this.unit=n||this.unit||"px",this.now=this.start,this.pos=this.state=0;var o=this;i.elem=this.elem,i()&&g.timers.push(i)&&!je&&(je=setInterval(g.fx.tick,13))},show:function(){this.options.orig[this.prop]=g.style(this.elem,this.prop),this.options.show=!0,this.custom("width"===this.prop||"height"===this.prop?1:0,this.cur()),g(this.elem).show()},hide:function(){this.options.orig[this.prop]=g.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(t){var e=r(),n=!0;if(t||e>=this.options.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),this.options.curAnim[this.prop]=!0;for(var i in this.options.curAnim)this.options.curAnim[i]!==!0&&(n=!1);if(n){if(null!=this.options.display&&(this.elem.style.overflow=this.options.overflow,t=g.data(this.elem,"olddisplay"),this.elem.style.display=t?t:this.options.display,"none"===g.css(this.elem,"display")&&(this.elem.style.display="block")),this.options.hide&&g(this.elem).hide(),this.options.hide||this.options.show)for(var o in this.options.curAnim)g.style(this.elem,o,this.options.orig[o]);this.options.complete.call(this.elem)}return!1}return o=e-this.startTime,this.state=o/this.options.duration,t=this.options.easing||(g.easing.swing?"swing":"linear"),this.pos=g.easing[this.options.specialEasing&&this.options.specialEasing[this.prop]||t](this.state,o,0,1,this.options.duration),this.now=this.start+(this.end-this.start)*this.pos,this.update(),!0}},g.extend(g.fx,{tick:function(){for(var t=g.timers,e=0;e<t.length;e++)t[e]()||t.splice(e--,1);t.length||g.fx.stop()},stop:function(){clearInterval(je),je=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(t){g.style(t.elem,"opacity",t.now)},_default:function(t){t.elem.style&&null!=t.elem.style[t.prop]?t.elem.style[t.prop]=("width"===t.prop||"height"===t.prop?Math.max(0,t.now):t.now)+t.unit:t.elem[t.prop]=t.now}}}),g.expr&&g.expr.filters&&(g.expr.filters.animated=function(t){return g.grep(g.timers,function(e){return t===e.elem}).length}),g.fn.offset="getBoundingClientRect"in b.documentElement?function(t){var e=this[0];if(t)return this.each(function(e){g.offset.setOffset(this,t,e)});if(!e||!e.ownerDocument)return null;if(e===e.ownerDocument.body)return g.offset.bodyOffset(e);var n=e.getBoundingClientRect(),i=e.ownerDocument;return e=i.body,i=i.documentElement,{top:n.top+(self.pageYOffset||g.support.boxModel&&i.scrollTop||e.scrollTop)-(i.clientTop||e.clientTop||0),left:n.left+(self.pageXOffset||g.support.boxModel&&i.scrollLeft||e.scrollLeft)-(i.clientLeft||e.clientLeft||0)}}:function(t){var e=this[0];
if(t)return this.each(function(e){g.offset.setOffset(this,t,e)});if(!e||!e.ownerDocument)return null;if(e===e.ownerDocument.body)return g.offset.bodyOffset(e);g.offset.initialize();var n,i=e.offsetParent,o=e,r=e.ownerDocument,s=r.documentElement,a=r.body;o=(r=r.defaultView)?r.getComputedStyle(e,null):e.currentStyle;for(var l=e.offsetTop,c=e.offsetLeft;(e=e.parentNode)&&e!==a&&e!==s&&(!g.offset.supportsFixedPosition||"fixed"!==o.position);)n=r?r.getComputedStyle(e,null):e.currentStyle,l-=e.scrollTop,c-=e.scrollLeft,e===i&&(l+=e.offsetTop,c+=e.offsetLeft,!g.offset.doesNotAddBorder||g.offset.doesAddBorderForTableAndCells&&/^t(able|d|h)$/i.test(e.nodeName)||(l+=parseFloat(n.borderTopWidth)||0,c+=parseFloat(n.borderLeftWidth)||0),o=i,i=e.offsetParent),g.offset.subtractsBorderForOverflowNotVisible&&"visible"!==n.overflow&&(l+=parseFloat(n.borderTopWidth)||0,c+=parseFloat(n.borderLeftWidth)||0),o=n;return("relative"===o.position||"static"===o.position)&&(l+=a.offsetTop,c+=a.offsetLeft),g.offset.supportsFixedPosition&&"fixed"===o.position&&(l+=Math.max(s.scrollTop,a.scrollTop),c+=Math.max(s.scrollLeft,a.scrollLeft)),{top:l,left:c}},g.offset={initialize:function(){var t,e,n,i=b.body,o=b.createElement("div"),r=parseFloat(g.curCSS(i,"marginTop",!0))||0;g.extend(o.style,{position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"}),o.innerHTML="<div style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;'><div></div></div><table style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>",i.insertBefore(o,i.firstChild),t=o.firstChild,e=t.firstChild,n=t.nextSibling.firstChild.firstChild,this.doesNotAddBorder=5!==e.offsetTop,this.doesAddBorderForTableAndCells=5===n.offsetTop,e.style.position="fixed",e.style.top="20px",this.supportsFixedPosition=20===e.offsetTop||15===e.offsetTop,e.style.position=e.style.top="",t.style.overflow="hidden",t.style.position="relative",this.subtractsBorderForOverflowNotVisible=-5===e.offsetTop,this.doesNotIncludeMarginInBodyOffset=i.offsetTop!==r,i.removeChild(o),g.offset.initialize=g.noop},bodyOffset:function(t){var e=t.offsetTop,n=t.offsetLeft;return g.offset.initialize(),g.offset.doesNotIncludeMarginInBodyOffset&&(e+=parseFloat(g.curCSS(t,"marginTop",!0))||0,n+=parseFloat(g.curCSS(t,"marginLeft",!0))||0),{top:e,left:n}},setOffset:function(t,e,n){/static/.test(g.curCSS(t,"position"))&&(t.style.position="relative");var i=g(t),o=i.offset(),r=parseInt(g.curCSS(t,"top",!0),10)||0,s=parseInt(g.curCSS(t,"left",!0),10)||0;g.isFunction(e)&&(e=e.call(t,n,o)),n={top:e.top-o.top+r,left:e.left-o.left+s},"using"in e?e.using.call(t,n):i.css(n)}},g.fn.extend({position:function(){if(!this[0])return null;var t=this[0],e=this.offsetParent(),n=this.offset(),i=/^body|html$/i.test(e[0].nodeName)?{top:0,left:0}:e.offset();return n.top-=parseFloat(g.curCSS(t,"marginTop",!0))||0,n.left-=parseFloat(g.curCSS(t,"marginLeft",!0))||0,i.top+=parseFloat(g.curCSS(e[0],"borderTopWidth",!0))||0,i.left+=parseFloat(g.curCSS(e[0],"borderLeftWidth",!0))||0,{top:n.top-i.top,left:n.left-i.left}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent||b.body;t&&!/^body|html$/i.test(t.nodeName)&&"static"===g.css(t,"position");)t=t.offsetParent;return t})}}),g.each(["Left","Top"],function(t,n){var i="scroll"+n;g.fn[i]=function(n){var o,r=this[0];return r?n!==e?this.each(function(){(o=y(this))?o.scrollTo(t?g(o).scrollLeft():n,t?n:g(o).scrollTop()):this[i]=n}):(o=y(r))?"pageXOffset"in o?o[t?"pageYOffset":"pageXOffset"]:g.support.boxModel&&o.document.documentElement[i]||o.document.body[i]:r[i]:null}}),g.each(["Height","Width"],function(t,n){var i=n.toLowerCase();g.fn["inner"+n]=function(){return this[0]?g.css(this[0],i,!1,"padding"):null},g.fn["outer"+n]=function(t){return this[0]?g.css(this[0],i,!1,t?"margin":"border"):null},g.fn[i]=function(t){var o=this[0];return o?g.isFunction(t)?this.each(function(e){var n=g(this);n[i](t.call(this,e,n[i]()))}):"scrollTo"in o&&o.document?"CSS1Compat"===o.document.compatMode&&o.document.documentElement["client"+n]||o.document.body["client"+n]:9===o.nodeType?Math.max(o.documentElement["client"+n],o.body["scroll"+n],o.documentElement["scroll"+n],o.body["offset"+n],o.documentElement["offset"+n]):t===e?g.css(o,i):this.css(i,"string"==typeof t?t:t+"px"):null==t?null:this}}),t.jQuery=t.$=g}(window),function(){function t(t,e){try{for(var n in e)Object.defineProperty(t.prototype,n,{value:e[n],enumerable:!1})}catch(i){t.prototype=e}}function e(t){for(var e=-1,n=t.length,i=[];++e<n;)i.push(t[e]);return i}function n(t){return Array.prototype.slice.call(t)}function i(){}function o(){return this}function r(t,e,n){return function(){var i=n.apply(e,arguments);return arguments.length?t:i}}function s(t){return null!=t&&!isNaN(t)}function a(t){return t.length}function l(t){return null==t}function c(t){return t.replace(/(^\s+)|(\s+$)/g,"").replace(/\s+/g," ")}function u(t){for(var e=1;t*e%1;)e*=10;return e}function h(){}function m(t){function e(){for(var e,i=n,o=-1,r=i.length;++o<r;)(e=i[o].on)&&e.apply(this,arguments);return t}var n=[],o=new i;return e.on=function(e,i){var r,s=o.get(e);return arguments.length<2?s&&s.on:(s&&(s.on=null,n=n.slice(0,r=n.indexOf(s)).concat(n.slice(r+1)),o.remove(e)),i&&n.push(o.set(e,{on:i})),t)},e}function p(t,e){return e-(t?1+Math.floor(Math.log(t+Math.pow(10,1+Math.floor(Math.log(t)/Math.LN10)-e))/Math.LN10):1)}function f(t){return t+""}function y(t){for(var e=t.lastIndexOf("."),n=e>=0?t.substring(e):(e=t.length,""),i=[];e>0;)i.push(t.substring(e-=3,e+3));return i.reverse().join(",")+n}function _(t,e){return{scale:Math.pow(10,3*(8-e)),symbol:t}}function g(t){return function(e){return 0>=e?0:e>=1?1:t(e)}}function x(t){return function(e){return 1-t(1-e)}}function v(t){return function(e){return.5*(.5>e?t(2*e):2-t(2-2*e))}}function b(t){return t}function w(t){return function(e){return Math.pow(e,t)}}function D(t){return 1-Math.cos(t*Math.PI/2)}function B(t){return Math.pow(2,10*(t-1))}function C(t){return 1-Math.sqrt(1-t*t)}function S(t,e){var n;return arguments.length<2&&(e=.45),arguments.length<1?(t=1,n=e/4):n=e/(2*Math.PI)*Math.asin(1/t),function(i){return 1+t*Math.pow(2,10*-i)*Math.sin(2*(i-n)*Math.PI/e)}}function A(t){return t||(t=1.70158),function(e){return e*e*((t+1)*e-t)}}function M(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function V(){d3.event.stopPropagation(),d3.event.preventDefault()}function I(){for(var t,e=d3.event;t=e.sourceEvent;)e=t;return e}function T(t){for(var e=new h,n=0,i=arguments.length;++n<i;)e[arguments[n]]=m(e);return e.of=function(n,i){return function(o){try{var r=o.sourceEvent=d3.event;o.target=t,d3.event=o,e[o.type].apply(n,i)}finally{d3.event=r}}},e}function L(t){return"transform"==t?d3.interpolateTransform:d3.interpolate}function F(t,e){return e=e-(t=+t)?1/(e-t):0,function(n){return(n-t)*e}}function G(t,e){return e=e-(t=+t)?1/(e-t):0,function(n){return Math.max(0,Math.min(1,(n-t)*e))}}function P(t,e,n){return new k(t,e,n)}function k(t,e,n){this.r=t,this.g=e,this.b=n}function N(t){return 16>t?"0"+Math.max(0,t).toString(16):Math.min(255,t).toString(16)}function J(t,e,n){var i,o,r,s=0,a=0,l=0;if(i=/([a-z]+)\((.*)\)/i.exec(t))switch(o=i[2].split(","),i[1]){case"hsl":return n(parseFloat(o[0]),parseFloat(o[1])/100,parseFloat(o[2])/100);case"rgb":return e(E(o[0]),E(o[1]),E(o[2]))}return(r=Eo.get(t))?e(r.r,r.g,r.b):(null!=t&&"#"===t.charAt(0)&&(4===t.length?(s=t.charAt(1),s+=s,a=t.charAt(2),a+=a,l=t.charAt(3),l+=l):7===t.length&&(s=t.substring(1,3),a=t.substring(3,5),l=t.substring(5,7)),s=parseInt(s,16),a=parseInt(a,16),l=parseInt(l,16)),e(s,a,l))}function R(t,e,n){var i,o,r=Math.min(t/=255,e/=255,n/=255),s=Math.max(t,e,n),a=s-r,l=(s+r)/2;return a?(o=.5>l?a/(s+r):a/(2-s-r),i=t==s?(e-n)/a+(n>e?6:0):e==s?(n-t)/a+2:(t-e)/a+4,i*=60):o=i=0,j(i,o,l)}function E(t){var e=parseFloat(t);return"%"===t.charAt(t.length-1)?Math.round(2.55*e):e}function j(t,e,n){return new z(t,e,n)}function z(t,e,n){this.h=t,this.s=e,this.l=n}function O(t,e,n){function i(t){return t>360?t-=360:0>t&&(t+=360),60>t?r+(s-r)*t/60:180>t?s:240>t?r+(s-r)*(240-t)/60:r}function o(t){return Math.round(255*i(t))}var r,s;return t%=360,0>t&&(t+=360),e=0>e?0:e>1?1:e,n=0>n?0:n>1?1:n,s=.5>=n?n*(1+e):n+e-n*e,r=2*n-s,P(o(t+120),o(t),o(t-120))}function q(t){return Co(t,Wo),t}function U(t){return function(){return jo(t,this)}}function W(t){return function(){return zo(t,this)}}function K(t,e){function n(){if(e=this.classList)return e.add(t);var e=this.className,n=null!=e.baseVal,i=n?e.baseVal:e;r.lastIndex=0,r.test(i)||(i=c(i+" "+t),n?e.baseVal=i:this.className=i)}function i(){if(e=this.classList)return e.remove(t);var e=this.className,n=null!=e.baseVal,i=n?e.baseVal:e;i=c(i.replace(r," ")),n?e.baseVal=i:this.className=i}function o(){(e.apply(this,arguments)?n:i).call(this)}var r=new RegExp("(^|\\s+)"+d3.requote(t)+"(\\s+|$)","g");if(arguments.length<2){var s=this.node();if(a=s.classList)return a.contains(t);var a=s.className;return r.lastIndex=0,r.test(null!=a.baseVal?a.baseVal:a)}return this.each("function"==typeof e?o:e?n:i)}function H(t){return{__data__:t}}function X(t){return function(){return Uo(this,t)}}function Y(t){return arguments.length||(t=d3.ascending),function(e,n){return t(e&&e.__data__,n&&n.__data__)}}function Z(t){return Co(t,Xo),t}function $(t,e,n){Co(t,Zo);var o=new i,r=d3.dispatch("start","end"),s=rr;return t.id=e,t.time=n,t.tween=function(e,n){return arguments.length<2?o.get(e):(null==n?o.remove(e):o.set(e,n),t)},t.ease=function(e){return arguments.length?(s="function"==typeof e?e:d3.ease.apply(d3,arguments),t):s},t.each=function(e,n){return arguments.length<2?ee.call(t,e):(r.on(e,n),t)},d3.timer(function(i){return t.each(function(a,l,c){function u(t){return _.active>e?m():(_.active=e,o.forEach(function(t,e){(tween=e.call(f,a,l))&&p.push(tween)}),r.start.call(f,a,l),h(t)||d3.timer(h,0,n),1)}function h(t){if(_.active!==e)return m();for(var n=(t-y)/d,i=s(n),o=p.length;o>0;)p[--o].call(f,i);return n>=1?(m(),Qo=e,r.end.call(f,a,l),Qo=0,1):void 0}function m(){return--_.count||delete f.__transition__,1}var p=[],f=this,y=t[c][l].delay,d=t[c][l].duration,_=f.__transition__||(f.__transition__={active:0,count:0});++_.count,i>=y?u(i):d3.timer(u,y,n)}),1},0,n),t}function Q(t,e,n){return""!=n&&Yo}function te(t,e){function n(t,n,i){var r=e.call(this,t,n);return null==r?""!=i&&Yo:i!=r&&o(i,r)}function i(t,n,i){return i!=e&&o(i,e)}var o=L(t);return"function"==typeof e?n:null==e?Q:(e+="",i)}function ee(t){var e=Qo,n=rr,i=ir,o=or;Qo=this.id,rr=this.ease();for(var r=0,s=this.length;s>r;r++)for(var a=this[r],l=0,c=a.length;c>l;l++){var u=a[l];u&&(ir=this[r][l].delay,or=this[r][l].duration,t.call(u=u.node,u.__data__,l,r))}return Qo=e,rr=n,ir=i,or=o,this}function ne(){for(var t,e=Date.now(),n=lr;n;)t=e-n.then,t>=n.delay&&(n.flush=n.callback(t)),n=n.next;var i=ie()-e;i>24?(isFinite(i)&&(clearTimeout(ar),ar=setTimeout(ne,i)),sr=0):(sr=1,cr(ne))}function ie(){for(var t=null,e=lr,n=1/0;e;)e.flush?e=t?t.next=e.next:lr=e.next:(n=Math.min(n,e.then+e.delay),e=(t=e).next);return n}function oe(t){var e=[t.a,t.b],n=[t.c,t.d],i=se(e),o=re(e,n),r=se(ae(n,e,-o))||0;e[0]*n[1]<n[0]*e[1]&&(e[0]*=-1,e[1]*=-1,i*=-1,o*=-1),this.rotate=(i?Math.atan2(e[1],e[0]):Math.atan2(-n[0],n[1]))*ur,this.translate=[t.e,t.f],this.scale=[i,r],this.skew=r?Math.atan2(o,r)*ur:0}function re(t,e){return t[0]*e[0]+t[1]*e[1]}function se(t){var e=Math.sqrt(re(t,t));return e&&(t[0]/=e,t[1]/=e),e}function ae(t,e,n){return t[0]+=n*e[0],t[1]+=n*e[1],t}function le(t,e){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var i=n.createSVGPoint();if(0>hr&&(window.scrollX||window.scrollY)){n=d3.select(document.body).append("svg").style("position","absolute").style("top",0).style("left",0);var o=n[0][0].getScreenCTM();hr=!(o.f||o.e),n.remove()}return hr?(i.x=e.pageX,i.y=e.pageY):(i.x=e.clientX,i.y=e.clientY),i=i.matrixTransform(t.getScreenCTM().inverse()),[i.x,i.y]}var r=t.getBoundingClientRect();return[e.clientX-r.left-t.clientLeft,e.clientY-r.top-t.clientTop]}function ce(t){var e=t[0],n=t[t.length-1];return n>e?[e,n]:[n,e]}function ue(t){return t.rangeExtent?t.rangeExtent():ce(t.range())}function he(t,e){var n,i=0,o=t.length-1,r=t[i],s=t[o];return r>s&&(n=i,i=o,o=n,n=r,r=s,s=n),(n=s-r)&&(e=e(n),t[i]=e.floor(r),t[o]=e.ceil(s)),t}function me(){return Math}function pe(t,e,n,i){function o(){var o=Math.min(t.length,e.length)>2?ve:xe,l=i?G:F;return s=o(t,e,l,n),a=o(e,t,l,d3.interpolate),r}function r(t){return s(t)}var s,a;return r.invert=function(t){return a(t)},r.domain=function(e){return arguments.length?(t=e.map(Number),o()):t},r.range=function(t){return arguments.length?(e=t,o()):e},r.rangeRound=function(t){return r.range(t).interpolate(d3.interpolateRound)},r.clamp=function(t){return arguments.length?(i=t,o()):i},r.interpolate=function(t){return arguments.length?(n=t,o()):n},r.ticks=function(e){return _e(t,e)},r.tickFormat=function(e){return ge(t,e)},r.nice=function(){return he(t,ye),o()},r.copy=function(){return pe(t,e,n,i)},o()}function fe(t,e){return d3.rebind(t,e,"range","rangeRound","interpolate","clamp")}function ye(t){return t=Math.pow(10,Math.round(Math.log(t)/Math.LN10)-1),{floor:function(e){return Math.floor(e/t)*t},ceil:function(e){return Math.ceil(e/t)*t}}}function de(t,e){var n=ce(t),i=n[1]-n[0],o=Math.pow(10,Math.floor(Math.log(i/e)/Math.LN10)),r=e/i*o;return.15>=r?o*=10:.35>=r?o*=5:.75>=r&&(o*=2),n[0]=Math.ceil(n[0]/o)*o,n[1]=Math.floor(n[1]/o)*o+.5*o,n[2]=o,n}function _e(t,e){return d3.range.apply(d3,de(t,e))}function ge(t,e){return d3.format(",."+Math.max(0,-Math.floor(Math.log(de(t,e)[2])/Math.LN10+.01))+"f")}function xe(t,e,n,i){var o=n(t[0],t[1]),r=i(e[0],e[1]);return function(t){return r(o(t))}}function ve(t,e,n,i){var o=[],r=[],s=0,a=Math.min(t.length,e.length)-1;for(t[a]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++s<=a;)o.push(n(t[s-1],t[s])),r.push(i(e[s-1],e[s]));return function(e){var n=d3.bisect(t,e,1,a)-1;return r[n](o[n](e))}}function be(t,e){function n(n){return t(e(n))}var i=e.pow;return n.invert=function(e){return i(t.invert(e))},n.domain=function(o){return arguments.length?(e=o[0]<0?De:we,i=e.pow,t.domain(o.map(e)),n):t.domain().map(i)},n.nice=function(){return t.domain(he(t.domain(),me)),n},n.ticks=function(){var n=ce(t.domain()),o=[];if(n.every(isFinite)){var r=Math.floor(n[0]),s=Math.ceil(n[1]),a=i(n[0]),l=i(n[1]);if(e===De)for(o.push(i(r));r++<s;)for(var c=9;c>0;c--)o.push(i(r)*c);else{for(;s>r;r++)for(var c=1;10>c;c++)o.push(i(r)*c);o.push(i(r))}for(r=0;o[r]<a;r++);for(s=o.length;o[s-1]>l;s--);o=o.slice(r,s)}return o},n.tickFormat=function(t,o){if(arguments.length<2&&(o=mr),arguments.length<1)return o;var r,s=t/n.ticks().length,a=e===De?(r=-1e-12,Math.floor):(r=1e-12,Math.ceil);return function(t){return t/i(a(e(t)+r))<s?o(t):""}},n.copy=function(){return be(t.copy(),e)},fe(n,t)}function we(t){return Math.log(0>t?0:t)/Math.LN10}function De(t){return-Math.log(t>0?0:-t)/Math.LN10}function Be(t,e){function n(e){return t(i(e))}var i=Ce(e),o=Ce(1/e);return n.invert=function(e){return o(t.invert(e))},n.domain=function(e){return arguments.length?(t.domain(e.map(i)),n):t.domain().map(o)},n.ticks=function(t){return _e(n.domain(),t)},n.tickFormat=function(t){return ge(n.domain(),t)},n.nice=function(){return n.domain(he(n.domain(),ye))},n.exponent=function(t){if(!arguments.length)return e;var r=n.domain();return i=Ce(e=t),o=Ce(1/e),n.domain(r)},n.copy=function(){return Be(t.copy(),e)},fe(n,t)}function Ce(t){return function(e){return 0>e?-Math.pow(-e,t):Math.pow(e,t)}}function Se(t,e){function n(e){return s[((r.get(e)||r.set(e,t.push(e)))-1)%s.length]}function o(e,n){return d3.range(t.length).map(function(t){return e+n*t})}var r,s,a;return n.domain=function(o){if(!arguments.length)return t;t=[],r=new i;for(var s,a=-1,l=o.length;++a<l;)r.has(s=o[a])||r.set(s,t.push(s));return n[e.t](e.x,e.p)},n.range=function(t){return arguments.length?(s=t,a=0,e={t:"range",x:t},n):s},n.rangePoints=function(i,r){arguments.length<2&&(r=0);var l=i[0],c=i[1],u=(c-l)/(t.length-1+r);return s=o(t.length<2?(l+c)/2:l+u*r/2,u),a=0,e={t:"rangePoints",x:i,p:r},n},n.rangeBands=function(i,r){arguments.length<2&&(r=0);var l=i[1]<i[0],c=i[l-0],u=i[1-l],h=(u-c)/(t.length+r);return s=o(c+h*r,h),l&&s.reverse(),a=h*(1-r),e={t:"rangeBands",x:i,p:r},n},n.rangeRoundBands=function(i,r){arguments.length<2&&(r=0);var l=i[1]<i[0],c=i[l-0],u=i[1-l],h=Math.floor((u-c)/(t.length+r)),m=u-c-(t.length-r)*h;return s=o(c+Math.round(m/2),h),l&&s.reverse(),a=Math.round(h*(1-r)),e={t:"rangeRoundBands",x:i,p:r},n},n.rangeBand=function(){return a},n.rangeExtent=function(){return ce(e.x)},n.copy=function(){return Se(t,e)},n.domain(t)}function Ae(t,e){function n(){var n=0,r=(t.length,e.length);for(o=[];++n<r;)o[n-1]=d3.quantile(t,n/r);return i}function i(t){return isNaN(t=+t)?0/0:e[d3.bisect(o,t)]}var o;return i.domain=function(e){return arguments.length?(t=e.filter(function(t){return!isNaN(t)}).sort(d3.ascending),n()):t},i.range=function(t){return arguments.length?(e=t,n()):e},i.quantiles=function(){return o},i.copy=function(){return Ae(t,e)},n()}function Me(t,e,n){function i(e){return n[Math.max(0,Math.min(s,Math.floor(r*(e-t))))]}function o(){return r=n.length/(e-t),s=n.length-1,i}var r,s;return i.domain=function(n){return arguments.length?(t=+n[0],e=+n[n.length-1],o()):[t,e]},i.range=function(t){return arguments.length?(n=t,o()):n},i.copy=function(){return Me(t,e,n)},o()}function Ve(t){function e(t){return+t}return e.invert=e,e.domain=e.range=function(n){return arguments.length?(t=n.map(e),e):t},e.ticks=function(e){return _e(t,e)},e.tickFormat=function(e){return ge(t,e)},e.copy=function(){return Ve(t)},e}function Ie(t){return t.innerRadius}function Te(t){return t.outerRadius}function Le(t){return t.startAngle}function Fe(t){return t.endAngle}function Ge(t){function e(e){return e.length<1?null:"M"+r(t(Pe(this,e,n,i)),s)}var n=ke,i=Ne,o=xr,r=vr.get(o),s=.7;return e.x=function(t){return arguments.length?(n=t,e):n},e.y=function(t){return arguments.length?(i=t,e):i},e.interpolate=function(t){return arguments.length?(vr.has(t+="")||(t=xr),r=vr.get(o=t),e):o},e.tension=function(t){return arguments.length?(s=t,e):s},e}function Pe(t,e,n,i){var o,r=[],s=-1,a=e.length,l="function"==typeof n,c="function"==typeof i;if(l&&c)for(;++s<a;)r.push([n.call(t,o=e[s],s),i.call(t,o,s)]);else if(l)for(;++s<a;)r.push([n.call(t,e[s],s),i]);else if(c)for(;++s<a;)r.push([n,i.call(t,e[s],s)]);else for(;++s<a;)r.push([n,i]);return r}function ke(t){return t[0]}function Ne(t){return t[1]}function Je(t){for(var e=0,n=t.length,i=t[0],o=[i[0],",",i[1]];++e<n;)o.push("L",(i=t[e])[0],",",i[1]);return o.join("")}function Re(t){for(var e=0,n=t.length,i=t[0],o=[i[0],",",i[1]];++e<n;)o.push("V",(i=t[e])[1],"H",i[0]);return o.join("")}function Ee(t){for(var e=0,n=t.length,i=t[0],o=[i[0],",",i[1]];++e<n;)o.push("H",(i=t[e])[0],"V",i[1]);return o.join("")}function je(t,e){return t.length<4?Je(t):t[1]+qe(t.slice(1,t.length-1),Ue(t,e))}function ze(t,e){return t.length<3?Je(t):t[0]+qe((t.push(t[0]),t),Ue([t[t.length-2]].concat(t,[t[1]]),e))}function Oe(t,e){return t.length<3?Je(t):t[0]+qe(t,Ue(t,e))}function qe(t,e){if(e.length<1||t.length!=e.length&&t.length!=e.length+2)return Je(t);var n=t.length!=e.length,i="",o=t[0],r=t[1],s=e[0],a=s,l=1;if(n&&(i+="Q"+(r[0]-2*s[0]/3)+","+(r[1]-2*s[1]/3)+","+r[0]+","+r[1],o=t[1],l=2),e.length>1){a=e[1],r=t[l],l++,i+="C"+(o[0]+s[0])+","+(o[1]+s[1])+","+(r[0]-a[0])+","+(r[1]-a[1])+","+r[0]+","+r[1];for(var c=2;c<e.length;c++,l++)r=t[l],a=e[c],i+="S"+(r[0]-a[0])+","+(r[1]-a[1])+","+r[0]+","+r[1]}if(n){var u=t[l];i+="Q"+(r[0]+2*a[0]/3)+","+(r[1]+2*a[1]/3)+","+u[0]+","+u[1]}return i}function Ue(t,e){for(var n,i=[],o=(1-e)/2,r=t[0],s=t[1],a=1,l=t.length;++a<l;)n=r,r=s,s=t[a],i.push([o*(s[0]-n[0]),o*(s[1]-n[1])]);return i}function We(t){if(t.length<3)return Je(t);var e=1,n=t.length,i=t[0],o=i[0],r=i[1],s=[o,o,o,(i=t[1])[0]],a=[r,r,r,i[1]],l=[o,",",r];for(Ze(l,s,a);++e<n;)i=t[e],s.shift(),s.push(i[0]),a.shift(),a.push(i[1]),Ze(l,s,a);for(e=-1;++e<2;)s.shift(),s.push(i[0]),a.shift(),a.push(i[1]),Ze(l,s,a);return l.join("")}function Ke(t){if(t.length<4)return Je(t);for(var e,n=[],i=-1,o=t.length,r=[0],s=[0];++i<3;)e=t[i],r.push(e[0]),s.push(e[1]);for(n.push(Ye(Dr,r)+","+Ye(Dr,s)),--i;++i<o;)e=t[i],r.shift(),r.push(e[0]),s.shift(),s.push(e[1]),Ze(n,r,s);return n.join("")}function He(t){for(var e,n,i=-1,o=t.length,r=o+4,s=[],a=[];++i<4;)n=t[i%o],s.push(n[0]),a.push(n[1]);for(e=[Ye(Dr,s),",",Ye(Dr,a)],--i;++i<r;)n=t[i%o],s.shift(),s.push(n[0]),a.shift(),a.push(n[1]),Ze(e,s,a);return e.join("")}function Xe(t,e){for(var n,i,o=t.length-1,r=t[0][0],s=t[0][1],a=t[o][0]-r,l=t[o][1]-s,c=-1;++c<=o;)n=t[c],i=c/o,n[0]=e*n[0]+(1-e)*(r+i*a),n[1]=e*n[1]+(1-e)*(s+i*l);return We(t)}function Ye(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function Ze(t,e,n){t.push("C",Ye(br,e),",",Ye(br,n),",",Ye(wr,e),",",Ye(wr,n),",",Ye(Dr,e),",",Ye(Dr,n))}function $e(t,e){return(e[1]-t[1])/(e[0]-t[0])}function Qe(t){for(var e=0,n=t.length-1,i=[],o=t[0],r=t[1],s=i[0]=$e(o,r);++e<n;)i[e]=s+(s=$e(o=r,r=t[e+1]));return i[e]=s,i}function tn(t){for(var e,n,i,o,r=[],s=Qe(t),a=-1,l=t.length-1;++a<l;)e=$e(t[a],t[a+1]),Math.abs(e)<1e-6?s[a]=s[a+1]=0:(n=s[a]/e,i=s[a+1]/e,o=n*n+i*i,o>9&&(o=3*e/Math.sqrt(o),s[a]=o*n,s[a+1]=o*i));for(a=-1;++a<=l;)o=(t[Math.min(l,a+1)][0]-t[Math.max(0,a-1)][0])/(6*(1+s[a]*s[a])),r.push([o||0,s[a]*o||0]);return r}function en(t){return t.length<3?Je(t):t[0]+qe(t,tn(t))}function nn(t){for(var e,n,i,o=-1,r=t.length;++o<r;)e=t[o],n=e[0],i=e[1]+_r,e[0]=n*Math.cos(i),e[1]=n*Math.sin(i);return t}function on(t){function e(e){if(e.length<1)return null;var n=Pe(this,e,r,a),u=Pe(this,e,r===s?rn(n):s,a===l?sn(n):l);return"M"+i(t(u),c)+"L"+o(t(n.reverse()),c)+"Z"}var n,i,o,r=ke,s=ke,a=0,l=Ne,c=.7;return e.x=function(t){return arguments.length?(r=s=t,e):s},e.x0=function(t){return arguments.length?(r=t,e):r},e.x1=function(t){return arguments.length?(s=t,e):s},e.y=function(t){return arguments.length?(a=l=t,e):l},e.y0=function(t){return arguments.length?(a=t,e):a},e.y1=function(t){return arguments.length?(l=t,e):l},e.interpolate=function(t){return arguments.length?(vr.has(t+="")||(t=xr),i=vr.get(n=t),o=i.reverse||i,e):n},e.tension=function(t){return arguments.length?(c=t,e):c},e.interpolate("linear")}function rn(t){return function(e,n){return t[n][0]}}function sn(t){return function(e,n){return t[n][1]}}function an(t){return t.source}function ln(t){return t.target}function cn(t){return t.radius}function un(t){return[t.x,t.y]}function hn(t){return function(){var e=t.apply(this,arguments),n=e[0],i=e[1]+_r;return[n*Math.cos(i),n*Math.sin(i)]}}function mn(){return 64}function pn(){return"circle"}function fn(t){var e=Math.sqrt(t/Math.PI);return"M0,"+e+"A"+e+","+e+" 0 1,1 0,"+-e+"A"+e+","+e+" 0 1,1 0,"+e+"Z"}function yn(t,e){t.attr("transform",function(t){return"translate("+e(t)+",0)"})}function dn(t,e){t.attr("transform",function(t){return"translate(0,"+e(t)+")"})}function _n(t,e,n){if(i=[],n&&e.length>1){for(var i,o,r,s=ce(t.domain()),a=-1,l=e.length,c=(e[1]-e[0])/++n;++a<l;)for(o=n;--o>0;)(r=+e[a]-o*c)>=s[0]&&i.push(r);for(--a,o=0;++o<n&&(r=+e[a]+o*c)<s[1];)i.push(r)}return i}function gn(){Vr||(Vr=d3.select("body").append("div").style("visibility","hidden").style("top",0).style("height",0).style("width",0).style("overflow-y","scroll").append("div").style("height","2000px").node().parentNode);var t,e=d3.event;try{Vr.scrollTop=1e3,Vr.dispatchEvent(e),t=1e3-Vr.scrollTop}catch(n){t=e.wheelDelta||5*-e.detail}return t}function xn(t){for(var e=t.source,n=t.target,i=bn(e,n),o=[e];e!==i;)e=e.parent,o.push(e);for(var r=o.length;n!==i;)o.splice(r,0,n),n=n.parent;return o}function vn(t){for(var e=[],n=t.parent;null!=n;)e.push(t),t=n,n=n.parent;return e.push(t),e}function bn(t,e){if(t===e)return t;for(var n=vn(t),i=vn(e),o=n.pop(),r=i.pop(),s=null;o===r;)s=o,o=n.pop(),r=i.pop();return s}function wn(t){t.fixed|=2}function Dn(t){t!==Lr&&(t.fixed&=1)}function Bn(){Lr.fixed&=1,Tr=Lr=null}function Cn(){Lr.px=d3.event.x,Lr.py=d3.event.y,Tr.resume()}function Sn(t,e,n){var i=0,o=0;if(t.charge=0,!t.leaf)for(var r,s=t.nodes,a=s.length,l=-1;++l<a;)r=s[l],null!=r&&(Sn(r,e,n),t.charge+=r.charge,i+=r.charge*r.cx,o+=r.charge*r.cy);if(t.point){t.leaf||(t.point.x+=Math.random()-.5,t.point.y+=Math.random()-.5);var c=e*n[t.point.index];t.charge+=t.pointCharge=c,i+=c*t.point.x,o+=c*t.point.y}t.cx=i/t.charge,t.cy=o/t.charge}function An(){return 20}function Mn(){return 1}function Vn(t){return t.x}function In(t){return t.y}function Tn(t,e,n){t.y0=e,t.y=n}function Ln(t){return d3.range(t.length)}function Fn(t){for(var e=-1,n=t[0].length,i=[];++e<n;)i[e]=0;return i}function Gn(t){for(var e,n=1,i=0,o=t[0][1],r=t.length;r>n;++n)(e=t[n][1])>o&&(i=n,o=e);return i}function Pn(t){return t.reduce(kn,0)}function kn(t,e){return t+e[1]}function Nn(t,e){return Jn(t,Math.ceil(Math.log(e.length)/Math.LN2+1))}function Jn(t,e){for(var n=-1,i=+t[0],o=(t[1]-i)/e,r=[];++n<=e;)r[n]=o*n+i;return r}function Rn(t){return[d3.min(t),d3.max(t)]}function En(t,e){return d3.rebind(t,e,"sort","children","value"),t.links=qn,t.nodes=function(e){return kr=!0,(t.nodes=t)(e)},t}function jn(t){return t.children}function zn(t){return t.value}function On(t,e){return e.value-t.value}function qn(t){return d3.merge(t.map(function(t){return(t.children||[]).map(function(e){return{source:t,target:e}})}))}function Un(t,e){return t.value-e.value}function Wn(t,e){var n=t._pack_next;t._pack_next=e,e._pack_prev=t,e._pack_next=n,n._pack_prev=e}function Kn(t,e){t._pack_next=e,e._pack_prev=t}function Hn(t,e){var n=e.x-t.x,i=e.y-t.y,o=t.r+e.r;return o*o-n*n-i*i>.001}function Xn(t){function e(t){a=Math.min(t.x-t.r,a),l=Math.max(t.x+t.r,l),c=Math.min(t.y-t.r,c),u=Math.max(t.y+t.r,u)}var n,i,o,r,s,a=1/0,l=-1/0,c=1/0,u=-1/0,h=t.length;if(t.forEach(Yn),n=t[0],n.x=-n.r,n.y=0,e(n),h>1&&(i=t[1],i.x=i.r,i.y=0,e(i),h>2)){o=t[2],ti(n,i,o),e(o),Wn(n,o),n._pack_prev=o,Wn(o,i),i=n._pack_next;for(var m=3;h>m;m++){ti(n,i,o=t[m]);var p=0,f=1,y=1;for(r=i._pack_next;r!==i;r=r._pack_next,f++)if(Hn(r,o)){p=1;break}if(1==p)for(s=n._pack_prev;s!==r._pack_prev&&!Hn(s,o);s=s._pack_prev,y++);p?(y>f||f==y&&i.r<n.r?Kn(n,i=r):Kn(n=s,i),m--):(Wn(n,o),i=o,e(o))}}for(var d=(a+l)/2,_=(c+u)/2,g=0,m=0;h>m;m++){var x=t[m];x.x-=d,x.y-=_,g=Math.max(g,x.r+Math.sqrt(x.x*x.x+x.y*x.y))}return t.forEach(Zn),g}function Yn(t){t._pack_next=t._pack_prev=t}function Zn(t){delete t._pack_next,delete t._pack_prev}function $n(t){var e=t.children;e&&e.length?(e.forEach($n),t.r=Xn(e)):t.r=Math.sqrt(t.value)}function Qn(t,e,n,i){var o=t.children;if(t.x=e+=i*t.x,t.y=n+=i*t.y,t.r*=i,o)for(var r=-1,s=o.length;++r<s;)Qn(o[r],e,n,i)}function ti(t,e,n){var i=t.r+n.r,o=e.x-t.x,r=e.y-t.y;if(i&&(o||r)){var s=e.r+n.r,a=Math.sqrt(o*o+r*r),l=Math.max(-1,Math.min(1,(i*i+a*a-s*s)/(2*i*a))),c=Math.acos(l),u=l*(i/=a),h=Math.sin(c)*i;n.x=t.x+u*o+h*r,n.y=t.y+u*r-h*o}else n.x=t.x+i,n.y=t.y}function ei(t){return 1+d3.max(t,function(t){return t.y})}function ni(t){return t.reduce(function(t,e){return t+e.x},0)/t.length}function ii(t){var e=t.children;return e&&e.length?ii(e[0]):t}function oi(t){var e,n=t.children;return n&&(e=n.length)?oi(n[e-1]):t}function ri(t,e){return t.parent==e.parent?1:2}function si(t){var e=t.children;return e&&e.length?e[0]:t._tree.thread}function ai(t){var e,n=t.children;return n&&(e=n.length)?n[e-1]:t._tree.thread}function li(t,e){var n=t.children;if(n&&(o=n.length))for(var i,o,r=-1;++r<o;)e(i=li(n[r],e),t)>0&&(t=i);return t}function ci(t,e){return t.x-e.x}function ui(t,e){return e.x-t.x}function hi(t,e){return t.depth-e.depth}function mi(t,e){function n(t,i){var o=t.children;if(o&&(s=o.length))for(var r,s,a=null,l=-1;++l<s;)r=o[l],n(r,a),a=r;e(t,i)}n(t,null)}function pi(t){for(var e,n=0,i=0,o=t.children,r=o.length;--r>=0;)e=o[r]._tree,e.prelim+=n,e.mod+=n,n+=e.shift+(i+=e.change)}function fi(t,e,n){t=t._tree,e=e._tree;var i=n/(e.number-t.number);t.change+=i,e.change-=i,e.shift+=n,e.prelim+=n,e.mod+=n}function yi(t,e,n){return t._tree.ancestor.parent==e.parent?t._tree.ancestor:n}function di(t){return{x:t.x,y:t.y,dx:t.dx,dy:t.dy}}function _i(t,e){var n=t.x+e[3],i=t.y+e[0],o=t.dx-e[1]-e[3],r=t.dy-e[0]-e[2];return 0>o&&(n+=o/2,o=0),0>r&&(i+=r/2,r=0),{x:n,y:i,dx:o,dy:r}}function gi(t){return t.map(xi).join(",")}function xi(t){return/[",\n]/.test(t)?'"'+t.replace(/\"/g,'""')+'"':t}function vi(t,e){return function(n){return n&&t.hasOwnProperty(n.type)?t[n.type](n):e}}function bi(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}function wi(t,e){Jr.hasOwnProperty(t.type)&&Jr[t.type](t,e)}function Di(t,e){wi(t.geometry,e)}function Bi(t,e){for(var n=t.features,i=0,o=n.length;o>i;i++)wi(n[i].geometry,e)}function Ci(t,e){for(var n=t.geometries,i=0,o=n.length;o>i;i++)wi(n[i],e)}function Si(t,e){for(var n=t.coordinates,i=0,o=n.length;o>i;i++)e.apply(null,n[i])}function Ai(t,e){for(var n=t.coordinates,i=0,o=n.length;o>i;i++)for(var r=n[i],s=0,a=r.length;a>s;s++)e.apply(null,r[s])}function Mi(t,e){for(var n=t.coordinates,i=0,o=n.length;o>i;i++)for(var r=n[i][0],s=0,a=r.length;a>s;s++)e.apply(null,r[s])}function Vi(t,e){e.apply(null,t.coordinates)}function Ii(t,e){for(var n=t.coordinates[0],i=0,o=n.length;o>i;i++)e.apply(null,n[i])}function Ti(t){return t.source}function Li(t){return t.target}function Fi(t,e){function n(t){var e=Math.sin(y-(t*=y))/d,n=Math.sin(t)/d,i=e*a*o+n*p*u,s=e*a*r+n*p*h,c=e*l+n*f;return[Math.atan2(s,i)/Nr,Math.atan2(c,Math.sqrt(i*i+s*s))/Nr]}var i=t[0]*Nr,o=Math.cos(i),r=Math.sin(i),s=t[1]*Nr,a=Math.cos(s),l=Math.sin(s),c=e[0]*Nr,u=Math.cos(c),h=Math.sin(c),m=e[1]*Nr,p=Math.cos(m),f=Math.sin(m),y=n.d=Math.acos(Math.max(-1,Math.min(1,l*f+a*p*Math.cos(c-i)))),d=Math.sin(y);return n}function Gi(t){for(var e=0,n=0;;){if(t(e,n))return[e,n];0===e?(e=n+1,n=0):(e-=1,n+=1)}}function Pi(t,e,n,i){var o,r,s,a,l,c,u;return o=i[t],r=o[0],s=o[1],o=i[e],a=o[0],l=o[1],o=i[n],c=o[0],u=o[1],(u-s)*(a-r)-(l-s)*(c-r)>0}function ki(t,e,n){return(n[0]-e[0])*(t[1]-e[1])<(n[1]-e[1])*(t[0]-e[0])}function Ni(t,e,n,i){var o=t[0],r=e[0],s=n[0],a=i[0],l=t[1],c=e[1],u=n[1],h=i[1],m=o-s,p=r-o,f=a-s,y=l-u,d=c-l,_=h-u,g=(f*y-_*m)/(_*p-f*d);return[o+g*p,l+g*d]}function Ji(t,e){var n={list:t.map(function(t,e){return{index:e,x:t[0],y:t[1]}}).sort(function(t,e){return t.y<e.y?-1:t.y>e.y?1:t.x<e.x?-1:t.x>e.x?1:0}),bottomSite:null},i={list:[],leftEnd:null,rightEnd:null,init:function(){i.leftEnd=i.createHalfEdge(null,"l"),i.rightEnd=i.createHalfEdge(null,"l"),i.leftEnd.r=i.rightEnd,i.rightEnd.l=i.leftEnd,i.list.unshift(i.leftEnd,i.rightEnd)},createHalfEdge:function(t,e){return{edge:t,side:e,vertex:null,l:null,r:null}},insert:function(t,e){e.l=t,e.r=t.r,t.r.l=e,t.r=e},leftBound:function(t){var e=i.leftEnd;do e=e.r;while(e!=i.rightEnd&&o.rightOf(e,t));return e=e.l},del:function(t){t.l.r=t.r,t.r.l=t.l,t.edge=null},right:function(t){return t.r},left:function(t){return t.l},leftRegion:function(t){return null==t.edge?n.bottomSite:t.edge.region[t.side]},rightRegion:function(t){return null==t.edge?n.bottomSite:t.edge.region[jr[t.side]]}},o={bisect:function(t,e){var n={region:{l:t,r:e},ep:{l:null,r:null}},i=e.x-t.x,o=e.y-t.y,r=i>0?i:-i,s=o>0?o:-o;return n.c=t.x*i+t.y*o+.5*(i*i+o*o),r>s?(n.a=1,n.b=o/i,n.c/=i):(n.b=1,n.a=i/o,n.c/=o),n},intersect:function(t,e){var n=t.edge,i=e.edge;if(!n||!i||n.region.r==i.region.r)return null;var o=n.a*i.b-n.b*i.a;if(Math.abs(o)<1e-10)return null;var r,s,a=(n.c*i.b-i.c*n.b)/o,l=(i.c*n.a-n.c*i.a)/o,c=n.region.r,u=i.region.r;c.y<u.y||c.y==u.y&&c.x<u.x?(r=t,s=n):(r=e,s=i);var h=a>=s.region.r.x;return h&&"l"===r.side||!h&&"r"===r.side?null:{x:a,y:l}},rightOf:function(t,e){var n=t.edge,i=n.region.r,o=e.x>i.x;if(o&&"l"===t.side)return 1;if(!o&&"r"===t.side)return 0;if(1===n.a){var r=e.y-i.y,s=e.x-i.x,a=0,l=0;if(!o&&n.b<0||o&&n.b>=0?l=a=r>=n.b*s:(l=e.x+e.y*n.b>n.c,n.b<0&&(l=!l),l||(a=1)),!a){var c=i.x-n.region.l.x;l=n.b*(s*s-r*r)<c*r*(1+2*s/c+n.b*n.b),n.b<0&&(l=!l)}}else{var u=n.c-n.a*e.x,h=e.y-u,m=e.x-i.x,p=u-i.y;l=h*h>m*m+p*p}return"l"===t.side?l:!l},endPoint:function(t,n,i){t.ep[n]=i,t.ep[jr[n]]&&e(t)},distance:function(t,e){var n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)}},r={list:[],insert:function(t,e,n){t.vertex=e,t.ystar=e.y+n;for(var i=0,o=r.list,s=o.length;s>i;i++){var a=o[i];if(!(t.ystar>a.ystar||t.ystar==a.ystar&&e.x>a.vertex.x))break}o.splice(i,0,t)},del:function(t){for(var e=0,n=r.list,i=n.length;i>e&&n[e]!=t;++e);n.splice(e,1)},empty:function(){return 0===r.list.length},nextEvent:function(t){for(var e=0,n=r.list,i=n.length;i>e;++e)if(n[e]==t)return n[e+1];return null},min:function(){var t=r.list[0];
return{x:t.vertex.x,y:t.ystar}},extractMin:function(){return r.list.shift()}};i.init(),n.bottomSite=n.list.shift();for(var s,a,l,c,u,h,m,p,f,y,d,_,g,x=n.list.shift();;)if(r.empty()||(s=r.min()),x&&(r.empty()||x.y<s.y||x.y==s.y&&x.x<s.x))a=i.leftBound(x),l=i.right(a),m=i.rightRegion(a),_=o.bisect(m,x),h=i.createHalfEdge(_,"l"),i.insert(a,h),y=o.intersect(a,h),y&&(r.del(a),r.insert(a,y,o.distance(y,x))),a=h,h=i.createHalfEdge(_,"r"),i.insert(a,h),y=o.intersect(h,l),y&&r.insert(h,y,o.distance(y,x)),x=n.list.shift();else{if(r.empty())break;a=r.extractMin(),c=i.left(a),l=i.right(a),u=i.right(l),m=i.leftRegion(a),p=i.rightRegion(l),d=a.vertex,o.endPoint(a.edge,a.side,d),o.endPoint(l.edge,l.side,d),i.del(a),r.del(l),i.del(l),g="l",m.y>p.y&&(f=m,m=p,p=f,g="r"),_=o.bisect(m,p),h=i.createHalfEdge(_,g),i.insert(c,h),o.endPoint(_,jr[g],d),y=o.intersect(c,h),y&&(r.del(c),r.insert(c,y,o.distance(y,m))),y=o.intersect(h,u),y&&r.insert(h,y,o.distance(y,m))}for(a=i.right(i.leftEnd);a!=i.rightEnd;a=i.right(a))e(a.edge)}function Ri(){return{leaf:!0,nodes:[],point:null}}function Ei(t,e,n,i,o,r){if(!t(e,n,i,o,r)){var s=.5*(n+o),a=.5*(i+r),l=e.nodes;l[0]&&Ei(t,l[0],n,i,s,a),l[1]&&Ei(t,l[1],s,i,o,a),l[2]&&Ei(t,l[2],n,a,s,r),l[3]&&Ei(t,l[3],s,a,o,r)}}function ji(t){return{x:t[0],y:t[1]}}function zi(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function Oi(t,e,n,i){for(var o,r,s=0,a=e.length,l=n.length;a>s;){if(i>=l)return-1;if(o=e.charCodeAt(s++),37==o){if(r=Xr[e.charAt(s++)],!r||(i=r(t,n,i))<0)return-1}else if(o!=n.charCodeAt(i++))return-1}return i}function qi(t,e,n){return Yr.test(e.substring(n,n+=3))?n:-1}function Ui(t,e,n){Zr.lastIndex=0;var i=Zr.exec(e.substring(n,n+10));return i?n+=i[0].length:-1}function Wi(t,e,n){var i=$r.get(e.substring(n,n+=3).toLowerCase());return null==i?-1:(t.m=i,n)}function Ki(t,e,n){Qr.lastIndex=0;var i=Qr.exec(e.substring(n,n+12));return i?(t.m=ts.get(i[0].toLowerCase()),n+=i[0].length):-1}function Hi(t,e,n){return Oi(t,Hr.c.toString(),e,n)}function Xi(t,e,n){return Oi(t,Hr.x.toString(),e,n)}function Yi(t,e,n){return Oi(t,Hr.X.toString(),e,n)}function Zi(t,e,n){ns.lastIndex=0;var i=ns.exec(e.substring(n,n+4));return i?(t.y=+i[0],n+=i[0].length):-1}function $i(t,e,n){ns.lastIndex=0;var i=ns.exec(e.substring(n,n+2));return i?(t.y=Qi()+ +i[0],n+=i[0].length):-1}function Qi(){return 1e3*~~((new Date).getFullYear()/1e3)}function to(t,e,n){ns.lastIndex=0;var i=ns.exec(e.substring(n,n+2));return i?(t.m=i[0]-1,n+=i[0].length):-1}function eo(t,e,n){ns.lastIndex=0;var i=ns.exec(e.substring(n,n+2));return i?(t.d=+i[0],n+=i[0].length):-1}function no(t,e,n){ns.lastIndex=0;var i=ns.exec(e.substring(n,n+2));return i?(t.H=+i[0],n+=i[0].length):-1}function io(t,e,n){ns.lastIndex=0;var i=ns.exec(e.substring(n,n+2));return i?(t.M=+i[0],n+=i[0].length):-1}function oo(t,e,n){ns.lastIndex=0;var i=ns.exec(e.substring(n,n+2));return i?(t.S=+i[0],n+=i[0].length):-1}function ro(t,e,n){ns.lastIndex=0;var i=ns.exec(e.substring(n,n+3));return i?(t.L=+i[0],n+=i[0].length):-1}function so(t,e,n){var i=is.get(e.substring(n,n+=2).toLowerCase());return null==i?-1:(t.p=i,n)}function ao(t){var e=t.getTimezoneOffset(),n=e>0?"-":"+",i=~~(Math.abs(e)/60),o=Math.abs(e)%60;return n+qr(i)+qr(o)}function lo(t){return t.toISOString()}function co(t,e,n){function i(e){var n=t(e),i=r(n,1);return i-e>e-n?n:i}function o(n){return e(n=t(new zr(n-1)),1),n}function r(t,n){return e(t=new zr(+t),n),t}function s(t,i,r){var s=o(t),a=[];if(r>1)for(;i>s;)n(s)%r||a.push(new Date(+s)),e(s,1);else for(;i>s;)a.push(new Date(+s)),e(s,1);return a}function a(t,e,n){try{zr=zi;var i=new zi;return i._=t,s(i,e,n)}finally{zr=Date}}t.floor=t,t.round=i,t.ceil=o,t.offset=r,t.range=s;var l=t.utc=uo(t);return l.floor=l,l.round=uo(i),l.ceil=uo(o),l.offset=uo(r),l.range=a,t}function uo(t){return function(e,n){try{zr=zi;var i=new zi;return i._=e,t(i,n)._}finally{zr=Date}}}function ho(t,e,n){function i(e){return t(e)}return i.invert=function(e){return po(t.invert(e))},i.domain=function(e){return arguments.length?(t.domain(e),i):t.domain().map(po)},i.nice=function(t){var e=mo(i.domain());return i.domain([t.floor(e[0]),t.ceil(e[1])])},i.ticks=function(n,o){var r=mo(i.domain());if("function"!=typeof n){var s=r[1]-r[0],a=s/n,l=d3.bisect(rs,a);if(l==rs.length)return e.year(r,n);if(!l)return t.ticks(n).map(po);Math.log(a/rs[l-1])<Math.log(rs[l]/a)&&--l,n=e[l],o=n[1],n=n[0].range}return n(r[0],new Date(+r[1]+1),o)},i.tickFormat=function(){return n},i.copy=function(){return ho(t.copy(),e,n)},d3.rebind(i,t,"range","rangeRound","interpolate","clamp")}function mo(t){var e=t[0],n=t[t.length-1];return n>e?[e,n]:[n,e]}function po(t){return new Date(t)}function fo(t){return function(e){for(var n=t.length-1,i=t[n];!i[1](e);)i=t[--n];return i[0](e)}}function yo(t){var e=new Date(t,0,1);return e.setFullYear(t),e}function _o(t){var e=t.getFullYear(),n=yo(e),i=yo(e+1);return e+(t-n)/(i-n)}function go(t){var e=new Date(Date.UTC(t,0,1));return e.setUTCFullYear(t),e}function xo(t){var e=t.getUTCFullYear(),n=go(e),i=go(e+1);return e+(t-n)/(i-n)}Date.now||(Date.now=function(){return+new Date});try{document.createElement("div").style.setProperty("opacity",0,"")}catch(vo){var bo=CSSStyleDeclaration.prototype,wo=bo.setProperty;bo.setProperty=function(t,e,n){wo.call(this,t,e+"",n)}}d3={version:"2.8.1"};var Do=n;try{Do(document.documentElement.childNodes)[0].nodeType}catch(Bo){Do=e}var Co=[].__proto__?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)t[n]=e[n]};d3.map=function(t){var e=new i;for(var n in t)e.set(n,t[n]);return e},t(i,{has:function(t){return So+t in this},get:function(t){return this[So+t]},set:function(t,e){return this[So+t]=e},remove:function(t){return t=So+t,t in this&&delete this[t]},keys:function(){var t=[];return this.forEach(function(e){t.push(e)}),t},values:function(){var t=[];return this.forEach(function(e,n){t.push(n)}),t},entries:function(){var t=[];return this.forEach(function(e,n){t.push({key:e,value:n})}),t},forEach:function(t){for(var e in this)e.charCodeAt(0)===Ao&&t.call(this,e.substring(1),this[e])}});var So="\x00",Ao=So.charCodeAt(0);d3.functor=function(t){return"function"==typeof t?t:function(){return t}},d3.rebind=function(t,e){for(var n,i=1,o=arguments.length;++i<o;)t[n=arguments[i]]=r(t,e,e[n]);return t},d3.ascending=function(t,e){return e>t?-1:t>e?1:t>=e?0:0/0},d3.descending=function(t,e){return t>e?-1:e>t?1:e>=t?0:0/0},d3.mean=function(t,e){var n,i=t.length,o=0,r=-1,a=0;if(1===arguments.length)for(;++r<i;)s(n=t[r])&&(o+=(n-o)/++a);else for(;++r<i;)s(n=e.call(t,t[r],r))&&(o+=(n-o)/++a);return a?o:void 0},d3.median=function(t,e){return arguments.length>1&&(t=t.map(e)),t=t.filter(s),t.length?d3.quantile(t.sort(d3.ascending),.5):void 0},d3.min=function(t,e){var n,i,o=-1,r=t.length;if(1===arguments.length){for(;++o<r&&(null==(n=t[o])||n!=n);)n=void 0;for(;++o<r;)null!=(i=t[o])&&n>i&&(n=i)}else{for(;++o<r&&(null==(n=e.call(t,t[o],o))||n!=n);)n=void 0;for(;++o<r;)null!=(i=e.call(t,t[o],o))&&n>i&&(n=i)}return n},d3.max=function(t,e){var n,i,o=-1,r=t.length;if(1===arguments.length){for(;++o<r&&(null==(n=t[o])||n!=n);)n=void 0;for(;++o<r;)null!=(i=t[o])&&i>n&&(n=i)}else{for(;++o<r&&(null==(n=e.call(t,t[o],o))||n!=n);)n=void 0;for(;++o<r;)null!=(i=e.call(t,t[o],o))&&i>n&&(n=i)}return n},d3.extent=function(t,e){var n,i,o,r=-1,s=t.length;if(1===arguments.length){for(;++r<s&&(null==(n=o=t[r])||n!=n);)n=o=void 0;for(;++r<s;)null!=(i=t[r])&&(n>i&&(n=i),i>o&&(o=i))}else{for(;++r<s&&(null==(n=o=e.call(t,t[r],r))||n!=n);)n=void 0;for(;++r<s;)null!=(i=e.call(t,t[r],r))&&(n>i&&(n=i),i>o&&(o=i))}return[n,o]},d3.random={normal:function(t,e){return arguments.length<2&&(e=1),arguments.length<1&&(t=0),function(){var n,i,o;do n=2*Math.random()-1,i=2*Math.random()-1,o=n*n+i*i;while(!o||o>1);return t+e*n*Math.sqrt(-2*Math.log(o)/o)}}},d3.sum=function(t,e){var n,i=0,o=t.length,r=-1;if(1===arguments.length)for(;++r<o;)isNaN(n=+t[r])||(i+=n);else for(;++r<o;)isNaN(n=+e.call(t,t[r],r))||(i+=n);return i},d3.quantile=function(t,e){var n=(t.length-1)*e+1,i=Math.floor(n),o=t[i-1],r=n-i;return r?o+r*(t[i]-o):o},d3.transpose=function(t){return d3.zip.apply(d3,t)},d3.zip=function(){if(!(i=arguments.length))return[];for(var t=-1,e=d3.min(arguments,a),n=new Array(e);++t<e;)for(var i,o=-1,r=n[t]=new Array(i);++o<i;)r[o]=arguments[o][t];return n},d3.bisector=function(t){return{left:function(e,n,i,o){for(arguments.length<3&&(i=0),arguments.length<4&&(o=e.length);o>i;){var r=i+o>>1;t.call(e,e[r],r)<n?i=r+1:o=r}return i},right:function(e,n,i,o){for(arguments.length<3&&(i=0),arguments.length<4&&(o=e.length);o>i;){var r=i+o>>1;n<t.call(e,e[r],r)?o=r:i=r+1}return i}}};var Mo=d3.bisector(function(t){return t});d3.bisectLeft=Mo.left,d3.bisect=d3.bisectRight=Mo.right,d3.first=function(t,e){var n,i=0,o=t.length,r=t[0];for(1===arguments.length&&(e=d3.ascending);++i<o;)e.call(t,r,n=t[i])>0&&(r=n);return r},d3.last=function(t,e){var n,i=0,o=t.length,r=t[0];for(1===arguments.length&&(e=d3.ascending);++i<o;)e.call(t,r,n=t[i])<=0&&(r=n);return r},d3.nest=function(){function t(e,a){if(a>=s.length)return o?o.call(r,e):n?e.sort(n):e;for(var l,c,u,h=-1,m=e.length,p=s[a++],f=new i,y={};++h<m;)(u=f.get(l=p(c=e[h])))?u.push(c):f.set(l,[c]);return f.forEach(function(e){y[e]=t(f.get(e),a)}),y}function e(t,n){if(n>=s.length)return t;var i,o=[],r=a[n++];for(i in t)o.push({key:i,values:e(t[i],n)});return r&&o.sort(function(t,e){return r(t.key,e.key)}),o}var n,o,r={},s=[],a=[];return r.map=function(e){return t(e,0)},r.entries=function(n){return e(t(n,0),0)},r.key=function(t){return s.push(t),r},r.sortKeys=function(t){return a[s.length-1]=t,r},r.sortValues=function(t){return n=t,r},r.rollup=function(t){return o=t,r},r},d3.keys=function(t){var e=[];for(var n in t)e.push(n);return e},d3.values=function(t){var e=[];for(var n in t)e.push(t[n]);return e},d3.entries=function(t){var e=[];for(var n in t)e.push({key:n,value:t[n]});return e},d3.permute=function(t,e){for(var n=[],i=-1,o=e.length;++i<o;)n[i]=t[e[i]];return n},d3.merge=function(t){return Array.prototype.concat.apply([],t)},d3.split=function(t,e){var n,i=[],o=[],r=-1,s=t.length;for(arguments.length<2&&(e=l);++r<s;)e.call(o,n=t[r],r)?o=[]:(o.length||i.push(o),o.push(n));return i},d3.range=function(t,e,n){if(arguments.length<3&&(n=1,arguments.length<2&&(e=t,t=0)),(e-t)/n===1/0)throw new Error("infinite range");var i,o=[],r=u(Math.abs(n)),s=-1;if(t*=r,e*=r,n*=r,0>n)for(;(i=t+n*++s)>e;)o.push(i/r);else for(;(i=t+n*++s)<e;)o.push(i/r);return o},d3.requote=function(t){return t.replace(Vo,"\\$&")};var Vo=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;d3.round=function(t,e){return e?Math.round(t*(e=Math.pow(10,e)))/e:Math.round(t)},d3.xhr=function(t,e,n){var i=new XMLHttpRequest;arguments.length<3?(n=e,e=null):e&&i.overrideMimeType&&i.overrideMimeType(e),i.open("GET",t,!0),e&&i.setRequestHeader("Accept",e),i.onreadystatechange=function(){4===i.readyState&&n(i.status<300?i:null)},i.send(null)},d3.text=function(t,e,n){function i(t){n(t&&t.responseText)}arguments.length<3&&(n=e,e=null),d3.xhr(t,e,i)},d3.json=function(t,e){d3.text(t,"application/json",function(t){e(t?JSON.parse(t):null)})},d3.html=function(t,e){d3.text(t,"text/html",function(t){if(null!=t){var n=document.createRange();n.selectNode(document.body),t=n.createContextualFragment(t)}e(t)})},d3.xml=function(t,e,n){function i(t){n(t&&t.responseXML)}arguments.length<3&&(n=e,e=null),d3.xhr(t,e,i)};var Io={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};d3.ns={prefix:Io,qualify:function(t){var e=t.indexOf(":"),n=t;return e>=0&&(n=t.substring(0,e),t=t.substring(e+1)),Io.hasOwnProperty(n)?{space:Io[n],local:t}:t}},d3.dispatch=function(){for(var t=new h,e=-1,n=arguments.length;++e<n;)t[arguments[e]]=m(t);return t},h.prototype.on=function(t,e){var n=t.indexOf("."),i="";return n>0&&(i=t.substring(n+1),t=t.substring(0,n)),arguments.length<2?this[t].on(i):this[t].on(i,e)},d3.format=function(t){var e=To.exec(t),n=e[1]||" ",i=e[3]||"",o=e[5],r=+e[6],s=e[7],a=e[8],l=e[9],c=1,u="",h=!1;switch(a&&(a=+a.substring(1)),o&&(n="0",s&&(r-=Math.floor((r-1)/4))),l){case"n":s=!0,l="g";break;case"%":c=100,u="%",l="f";break;case"p":c=100,u="%",l="r";break;case"d":h=!0,a=0;break;case"s":c=-1,l="r"}return"r"!=l||a||(l="g"),l=Lo.get(l)||f,function(t){if(h&&t%1)return"";var e=0>t&&(t=-t)?"\u2212":i;if(0>c){var m=d3.formatPrefix(t,a);t*=m.scale,u=m.symbol}else t*=c;if(t=l(t,a),o){var p=t.length+e.length;r>p&&(t=new Array(r-p+1).join(n)+t),s&&(t=y(t)),t=e+t}else{s&&(t=y(t)),t=e+t;var p=t.length;r>p&&(t=new Array(r-p+1).join(n)+t)}return t+u}};var To=/(?:([^{])?([<>=^]))?([+\- ])?(#)?(0)?([0-9]+)?(,)?(\.[0-9]+)?([a-zA-Z%])?/,Lo=d3.map({g:function(t,e){return t.toPrecision(e)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},r:function(t,e){return d3.round(t,e=p(t,e)).toFixed(Math.max(0,Math.min(20,e)))}}),Fo=["y","z","a","f","p","n","\u03bc","m","","k","M","G","T","P","E","Z","Y"].map(_);d3.formatPrefix=function(t,e){var n=0;return t&&(0>t&&(t*=-1),e&&(t=d3.round(t,p(t,e))),n=1+Math.floor(1e-12+Math.log(t)/Math.LN10),n=Math.max(-24,Math.min(24,3*Math.floor((0>=n?n+1:n-1)/3)))),Fo[8+n/3]};var Go=w(2),Po=w(3),ko=function(){return b},No=d3.map({linear:ko,poly:w,quad:function(){return Go},cubic:function(){return Po},sin:function(){return D},exp:function(){return B},circle:function(){return C},elastic:S,back:A,bounce:function(){return M}}),Jo=d3.map({"in":b,out:x,"in-out":v,"out-in":function(t){return v(x(t))}});d3.ease=function(t){var e=t.indexOf("-"),n=e>=0?t.substring(0,e):t,i=e>=0?t.substring(e+1):"in";return n=No.get(n)||ko,i=Jo.get(i)||b,g(i(n.apply(null,Array.prototype.slice.call(arguments,1))))},d3.event=null,d3.interpolate=function(t,e){for(var n,i=d3.interpolators.length;--i>=0&&!(n=d3.interpolators[i](t,e)););return n},d3.interpolateNumber=function(t,e){return e-=t,function(n){return t+e*n}},d3.interpolateRound=function(t,e){return e-=t,function(n){return Math.round(t+e*n)}},d3.interpolateString=function(t,e){var n,i,o,r,s,a=0,l=0,c=[],u=[];for(Ro.lastIndex=0,i=0;n=Ro.exec(e);++i)n.index&&c.push(e.substring(a,l=n.index)),u.push({i:c.length,x:n[0]}),c.push(null),a=Ro.lastIndex;for(a<e.length&&c.push(e.substring(a)),i=0,r=u.length;(n=Ro.exec(t))&&r>i;++i)if(s=u[i],s.x==n[0]){if(s.i)if(null==c[s.i+1])for(c[s.i-1]+=s.x,c.splice(s.i,1),o=i+1;r>o;++o)u[o].i--;else for(c[s.i-1]+=s.x+c[s.i+1],c.splice(s.i,2),o=i+1;r>o;++o)u[o].i-=2;else if(null==c[s.i+1])c[s.i]=s.x;else for(c[s.i]=s.x+c[s.i+1],c.splice(s.i+1,1),o=i+1;r>o;++o)u[o].i--;u.splice(i,1),r--,i--}else s.x=d3.interpolateNumber(parseFloat(n[0]),parseFloat(s.x));for(;r>i;)s=u.pop(),null==c[s.i+1]?c[s.i]=s.x:(c[s.i]=s.x+c[s.i+1],c.splice(s.i+1,1)),r--;return 1===c.length?null==c[0]?u[0].x:function(){return e}:function(t){for(i=0;r>i;++i)c[(s=u[i]).i]=s.x(t);return c.join("")}},d3.interpolateTransform=function(t,e){var n,i=[],o=[],r=d3.transform(t),s=d3.transform(e),a=r.translate,l=s.translate,c=r.rotate,u=s.rotate,h=r.skew,m=s.skew,p=r.scale,f=s.scale;return a[0]!=l[0]||a[1]!=l[1]?(i.push("translate(",null,",",null,")"),o.push({i:1,x:d3.interpolateNumber(a[0],l[0])},{i:3,x:d3.interpolateNumber(a[1],l[1])})):i.push(l[0]||l[1]?"translate("+l+")":""),c!=u?o.push({i:i.push(i.pop()+"rotate(",null,")")-2,x:d3.interpolateNumber(c,u)}):u&&i.push(i.pop()+"rotate("+u+")"),h!=m?o.push({i:i.push(i.pop()+"skewX(",null,")")-2,x:d3.interpolateNumber(h,m)}):m&&i.push(i.pop()+"skewX("+m+")"),p[0]!=f[0]||p[1]!=f[1]?(n=i.push(i.pop()+"scale(",null,",",null,")"),o.push({i:n-4,x:d3.interpolateNumber(p[0],f[0])},{i:n-2,x:d3.interpolateNumber(p[1],f[1])})):(1!=f[0]||1!=f[1])&&i.push(i.pop()+"scale("+f+")"),n=o.length,function(t){for(var e,r=-1;++r<n;)i[(e=o[r]).i]=e.x(t);return i.join("")}},d3.interpolateRgb=function(t,e){t=d3.rgb(t),e=d3.rgb(e);var n=t.r,i=t.g,o=t.b,r=e.r-n,s=e.g-i,a=e.b-o;return function(t){return"#"+N(Math.round(n+r*t))+N(Math.round(i+s*t))+N(Math.round(o+a*t))}},d3.interpolateHsl=function(t,e){t=d3.hsl(t),e=d3.hsl(e);var n=t.h,i=t.s,o=t.l,r=e.h-n,s=e.s-i,a=e.l-o;return function(t){return O(n+r*t,i+s*t,o+a*t).toString()}},d3.interpolateArray=function(t,e){var n,i=[],o=[],r=t.length,s=e.length,a=Math.min(t.length,e.length);for(n=0;a>n;++n)i.push(d3.interpolate(t[n],e[n]));for(;r>n;++n)o[n]=t[n];for(;s>n;++n)o[n]=e[n];return function(t){for(n=0;a>n;++n)o[n]=i[n](t);return o}},d3.interpolateObject=function(t,e){var n,i={},o={};for(n in t)n in e?i[n]=L(n)(t[n],e[n]):o[n]=t[n];for(n in e)n in t||(o[n]=e[n]);return function(t){for(n in i)o[n]=i[n](t);return o}};var Ro=/[-+]?(?:\d*\.?\d+)(?:[eE][-+]?\d+)?/g;d3.interpolators=[d3.interpolateObject,function(t,e){return e instanceof Array&&d3.interpolateArray(t,e)},function(t,e){return("string"==typeof t||"string"==typeof e)&&d3.interpolateString(t+"",e+"")},function(t,e){return("string"==typeof e?Eo.has(e)||/^(#|rgb\(|hsl\()/.test(e):e instanceof k||e instanceof z)&&d3.interpolateRgb(t,e)},function(t,e){return!isNaN(t=+t)&&!isNaN(e=+e)&&d3.interpolateNumber(t,e)}],d3.rgb=function(t,e,n){return 1===arguments.length?t instanceof k?P(t.r,t.g,t.b):J(""+t,P,O):P(~~t,~~e,~~n)},k.prototype.brighter=function(t){t=Math.pow(.7,arguments.length?t:1);var e=this.r,n=this.g,i=this.b,o=30;return e||n||i?(e&&o>e&&(e=o),n&&o>n&&(n=o),i&&o>i&&(i=o),P(Math.min(255,Math.floor(e/t)),Math.min(255,Math.floor(n/t)),Math.min(255,Math.floor(i/t)))):P(o,o,o)},k.prototype.darker=function(t){return t=Math.pow(.7,arguments.length?t:1),P(Math.floor(t*this.r),Math.floor(t*this.g),Math.floor(t*this.b))},k.prototype.hsl=function(){return R(this.r,this.g,this.b)},k.prototype.toString=function(){return"#"+N(this.r)+N(this.g)+N(this.b)};var Eo=d3.map({aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"});Eo.forEach(function(t,e){Eo.set(t,J(e,P,O))}),d3.hsl=function(t,e,n){return 1===arguments.length?t instanceof z?j(t.h,t.s,t.l):J(""+t,R,j):j(+t,+e,+n)},z.prototype.brighter=function(t){return t=Math.pow(.7,arguments.length?t:1),j(this.h,this.s,this.l/t)},z.prototype.darker=function(t){return t=Math.pow(.7,arguments.length?t:1),j(this.h,this.s,t*this.l)},z.prototype.rgb=function(){return O(this.h,this.s,this.l)},z.prototype.toString=function(){return this.rgb().toString()};var jo=function(t,e){return e.querySelector(t)},zo=function(t,e){return e.querySelectorAll(t)},Oo=document.documentElement,qo=Oo.matchesSelector||Oo.webkitMatchesSelector||Oo.mozMatchesSelector||Oo.msMatchesSelector||Oo.oMatchesSelector,Uo=function(t,e){return qo.call(t,e)};"function"==typeof Sizzle&&(jo=function(t,e){return Sizzle(t,e)[0]},zo=function(t,e){return Sizzle.uniqueSort(Sizzle(t,e))},Uo=Sizzle.matchesSelector);var Wo=[];d3.selection=function(){return Ho},d3.selection.prototype=Wo,Wo.select=function(t){var e,n,i,o,r=[];"function"!=typeof t&&(t=U(t));for(var s=-1,a=this.length;++s<a;){r.push(e=[]),e.parentNode=(i=this[s]).parentNode;for(var l=-1,c=i.length;++l<c;)(o=i[l])?(e.push(n=t.call(o,o.__data__,l)),n&&"__data__"in o&&(n.__data__=o.__data__)):e.push(null)}return q(r)},Wo.selectAll=function(t){var e,n,i=[];"function"!=typeof t&&(t=W(t));for(var o=-1,r=this.length;++o<r;)for(var s=this[o],a=-1,l=s.length;++a<l;)(n=s[a])&&(i.push(e=Do(t.call(n,n.__data__,a))),e.parentNode=n);return q(i)},Wo.attr=function(t,e){function n(){this.removeAttribute(t)}function i(){this.removeAttributeNS(t.space,t.local)}function o(){this.setAttribute(t,e)}function r(){this.setAttributeNS(t.space,t.local,e)}function s(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}function a(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}if(t=d3.ns.qualify(t),arguments.length<2){var l=this.node();return t.local?l.getAttributeNS(t.space,t.local):l.getAttribute(t)}return this.each(null==e?t.local?i:n:"function"==typeof e?t.local?a:s:t.local?r:o)},Wo.classed=function(t,e){var n=t.split(Ko),i=n.length,o=-1;if(arguments.length>1){for(;++o<i;)K.call(this,n[o],e);return this}for(;++o<i;)if(!K.call(this,n[o]))return!1;return!0};var Ko=/\s+/g;Wo.style=function(t,e,n){function i(){this.style.removeProperty(t)}function o(){this.style.setProperty(t,e,n)}function r(){var i=e.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,n)}return arguments.length<3&&(n=""),arguments.length<2?window.getComputedStyle(this.node(),null).getPropertyValue(t):this.each(null==e?i:"function"==typeof e?r:o)},Wo.property=function(t,e){function n(){delete this[t]}function i(){this[t]=e}function o(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}return arguments.length<2?this.node()[t]:this.each(null==e?n:"function"==typeof e?o:i)},Wo.text=function(t){return arguments.length<1?this.node().textContent:this.each("function"==typeof t?function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}:null==t?function(){this.textContent=""}:function(){this.textContent=t})},Wo.html=function(t){return arguments.length<1?this.node().innerHTML:this.each("function"==typeof t?function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}:null==t?function(){this.innerHTML=""}:function(){this.innerHTML=t})},Wo.append=function(t){function e(){return this.appendChild(document.createElementNS(this.namespaceURI,t))}function n(){return this.appendChild(document.createElementNS(t.space,t.local))}return t=d3.ns.qualify(t),this.select(t.local?n:e)},Wo.insert=function(t,e){function n(){return this.insertBefore(document.createElementNS(this.namespaceURI,t),jo(e,this))}function i(){return this.insertBefore(document.createElementNS(t.space,t.local),jo(e,this))}return t=d3.ns.qualify(t),this.select(t.local?i:n)},Wo.remove=function(){return this.each(function(){var t=this.parentNode;t&&t.removeChild(this)})},Wo.data=function(t,e){function n(t,n){var o,r,s,a=t.length,h=n.length,m=Math.min(a,h),p=Math.max(a,h),f=[],y=[],d=[];if(e){var _,g=new i,x=[],v=n.length;for(o=-1;++o<a;)_=e.call(r=t[o],r.__data__,o),g.has(_)?d[v++]=r:g.set(_,r),x.push(_);for(o=-1;++o<h;)_=e.call(n,s=n[o],o),g.has(_)?(f[o]=r=g.get(_),r.__data__=s,y[o]=d[o]=null):(y[o]=H(s),f[o]=d[o]=null),g.remove(_);for(o=-1;++o<a;)g.has(x[o])&&(d[o]=t[o])}else{for(o=-1;++o<m;)r=t[o],s=n[o],r?(r.__data__=s,f[o]=r,y[o]=d[o]=null):(y[o]=H(s),f[o]=d[o]=null);for(;h>o;++o)y[o]=H(n[o]),f[o]=d[o]=null;for(;p>o;++o)d[o]=t[o],y[o]=f[o]=null}y.update=f,y.parentNode=f.parentNode=d.parentNode=t.parentNode,l.push(y),c.push(f),u.push(d)}var o,r,s=-1,a=this.length;if(!arguments.length){for(t=new Array(a=(o=this[0]).length);++s<a;)(r=o[s])&&(t[s]=r.__data__);return t}var l=Z([]),c=q([]),u=q([]);if("function"==typeof t)for(;++s<a;)n(o=this[s],t.call(o,o.parentNode.__data__,s));else for(;++s<a;)n(o=this[s],t);return c.enter=function(){return l},c.exit=function(){return u},c},Wo.datum=Wo.map=function(t){return arguments.length<1?this.property("__data__"):this.property("__data__",t)},Wo.filter=function(t){var e,n,i,o=[];"function"!=typeof t&&(t=X(t));for(var r=0,s=this.length;s>r;r++){o.push(e=[]),e.parentNode=(n=this[r]).parentNode;for(var a=0,l=n.length;l>a;a++)(i=n[a])&&t.call(i,i.__data__,a)&&e.push(i)}return q(o)},Wo.order=function(){for(var t=-1,e=this.length;++t<e;)for(var n,i=this[t],o=i.length-1,r=i[o];--o>=0;)(n=i[o])&&(r&&r!==n.nextSibling&&r.parentNode.insertBefore(n,r),r=n);return this},Wo.sort=function(t){t=Y.apply(this,arguments);for(var e=-1,n=this.length;++e<n;)this[e].sort(t);return this.order()},Wo.on=function(t,e,n){arguments.length<3&&(n=!1);var i="__on"+t,o=t.indexOf(".");return o>0&&(t=t.substring(0,o)),arguments.length<2?(o=this.node()[i])&&o._:this.each(function(o,r){function s(t){var n=d3.event;d3.event=t;try{e.call(a,a.__data__,r)}finally{d3.event=n}}var a=this,l=a[i];l&&(a.removeEventListener(t,l,l.$),delete a[i]),e&&(a.addEventListener(t,a[i]=s,s.$=n),s._=e)})},Wo.each=function(t){for(var e=-1,n=this.length;++e<n;)for(var i=this[e],o=-1,r=i.length;++o<r;){var s=i[o];s&&t.call(s,s.__data__,o,e)}return this},Wo.call=function(t){return t.apply(this,(arguments[0]=this,arguments)),this},Wo.empty=function(){return!this.node()},Wo.node=function(){for(var t=0,e=this.length;e>t;t++)for(var n=this[t],i=0,o=n.length;o>i;i++){var r=n[i];if(r)return r}return null},Wo.transition=function(){for(var t,e,n=[],i=-1,o=this.length;++i<o;){n.push(t=[]);for(var r=this[i],s=-1,a=r.length;++s<a;)t.push((e=r[s])?{node:e,delay:ir,duration:or}:null)}return $(n,Qo||++$o,Date.now())};var Ho=q([[document]]);Ho[0].parentNode=Oo,d3.select=function(t){return"string"==typeof t?Ho.select(t):q([[t]])},d3.selectAll=function(t){return"string"==typeof t?Ho.selectAll(t):q([Do(t)])};var Xo=[];d3.selection.enter=Z,d3.selection.enter.prototype=Xo,Xo.append=Wo.append,Xo.insert=Wo.insert,Xo.empty=Wo.empty,Xo.node=Wo.node,Xo.select=function(t){for(var e,n,i,o,r,s=[],a=-1,l=this.length;++a<l;){i=(o=this[a]).update,s.push(e=[]),e.parentNode=o.parentNode;for(var c=-1,u=o.length;++c<u;)(r=o[c])?(e.push(i[c]=n=t.call(o.parentNode,r.__data__,c)),n.__data__=r.__data__):e.push(null)}return q(s)};var Yo={},Zo=[],$o=0,Qo=0,tr=0,er=250,nr=d3.ease("cubic-in-out"),ir=tr,or=er,rr=nr;Zo.call=Wo.call,d3.transition=function(t){return arguments.length?Qo?t.transition():t:Ho.transition()},d3.transition.prototype=Zo,Zo.select=function(t){var e,n,i,o=[];"function"!=typeof t&&(t=U(t));for(var r=-1,s=this.length;++r<s;){o.push(e=[]);for(var a=this[r],l=-1,c=a.length;++l<c;)(i=a[l])&&(n=t.call(i.node,i.node.__data__,l))?("__data__"in i.node&&(n.__data__=i.node.__data__),e.push({node:n,delay:i.delay,duration:i.duration})):e.push(null)}return $(o,this.id,this.time).ease(this.ease())},Zo.selectAll=function(t){var e,n,i,o=[];"function"!=typeof t&&(t=W(t));for(var r=-1,s=this.length;++r<s;)for(var a=this[r],l=-1,c=a.length;++l<c;)if(i=a[l]){n=t.call(i.node,i.node.__data__,l),o.push(e=[]);for(var u=-1,h=n.length;++u<h;)e.push({node:n[u],delay:i.delay,duration:i.duration})}return $(o,this.id,this.time).ease(this.ease())},Zo.attr=function(t,e){return this.attrTween(t,te(t,e))},Zo.attrTween=function(t,e){function n(t,n){var i=e.call(this,t,n,this.getAttribute(o));return i===Yo?(this.removeAttribute(o),null):i&&function(t){this.setAttribute(o,i(t))}}function i(t,n){var i=e.call(this,t,n,this.getAttributeNS(o.space,o.local));return i===Yo?(this.removeAttributeNS(o.space,o.local),null):i&&function(t){this.setAttributeNS(o.space,o.local,i(t))}}var o=d3.ns.qualify(t);return this.tween("attr."+t,o.local?i:n)},Zo.style=function(t,e,n){return arguments.length<3&&(n=""),this.styleTween(t,te(t,e),n)},Zo.styleTween=function(t,e,n){return arguments.length<3&&(n=""),this.tween("style."+t,function(i,o){var r=e.call(this,i,o,window.getComputedStyle(this,null).getPropertyValue(t));return r===Yo?(this.style.removeProperty(t),null):r&&function(e){this.style.setProperty(t,r(e),n)}})},Zo.text=function(t){return this.tween("text",function(e,n){this.textContent="function"==typeof t?t.call(this,e,n):t})},Zo.remove=function(){return this.each("end.transition",function(){var t;!this.__transition__&&(t=this.parentNode)&&t.removeChild(this)})},Zo.delay=function(t){var e=this;return e.each("function"==typeof t?function(n,i,o){e[o][i].delay=0|t.apply(this,arguments)}:(t=0|t,function(n,i,o){e[o][i].delay=t}))},Zo.duration=function(t){var e=this;return e.each("function"==typeof t?function(n,i,o){e[o][i].duration=Math.max(1,0|t.apply(this,arguments))}:(t=Math.max(1,0|t),function(n,i,o){e[o][i].duration=t}))},Zo.transition=function(){return this.select(o)};var sr,ar,lr=null;d3.timer=function(t,e,n){var i,o=!1,r=lr;if(arguments.length<3){if(arguments.length<2)e=0;else if(!isFinite(e))return;n=Date.now()}for(;r;){if(r.callback===t){r.then=n,r.delay=e,o=!0;break}i=r,r=r.next}o||(lr={callback:t,then:n,delay:e,next:lr}),sr||(ar=clearTimeout(ar),sr=1,cr(ne))},d3.timer.flush=function(){for(var t,e=Date.now(),n=lr;n;)t=e-n.then,n.delay||(n.flush=n.callback(t)),n=n.next;ie()};var cr=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,17)};d3.transform=function(t){var e=document.createElementNS(d3.ns.prefix.svg,"g"),n={a:1,b:0,c:0,d:1,e:0,f:0};return(d3.transform=function(t){e.setAttribute("transform",t);var i=e.transform.baseVal.consolidate();return new oe(i?i.matrix:n)})(t)},oe.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var ur=180/Math.PI;d3.mouse=function(t){return le(t,I())};var hr=/WebKit/.test(navigator.userAgent)?-1:0;d3.touches=function(t,e){return arguments.length<2&&(e=I().touches),e?Do(e).map(function(e){var n=le(t,e);return n.identifier=e.identifier,n}):[]},d3.scale={},d3.scale.linear=function(){return pe([0,1],[0,1],d3.interpolate,!1)},d3.scale.log=function(){return be(d3.scale.linear(),we)};var mr=d3.format(".0e");we.pow=function(t){return Math.pow(10,t)},De.pow=function(t){return-Math.pow(10,-t)},d3.scale.pow=function(){return Be(d3.scale.linear(),1)},d3.scale.sqrt=function(){return d3.scale.pow().exponent(.5)},d3.scale.ordinal=function(){return Se([],{t:"range",x:[]})},d3.scale.category10=function(){return d3.scale.ordinal().range(pr)},d3.scale.category20=function(){return d3.scale.ordinal().range(fr)},d3.scale.category20b=function(){return d3.scale.ordinal().range(yr)},d3.scale.category20c=function(){return d3.scale.ordinal().range(dr)};var pr=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],fr=["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],yr=["#393b79","#5254a3","#6b6ecf","#9c9ede","#637939","#8ca252","#b5cf6b","#cedb9c","#8c6d31","#bd9e39","#e7ba52","#e7cb94","#843c39","#ad494a","#d6616b","#e7969c","#7b4173","#a55194","#ce6dbd","#de9ed6"],dr=["#3182bd","#6baed6","#9ecae1","#c6dbef","#e6550d","#fd8d3c","#fdae6b","#fdd0a2","#31a354","#74c476","#a1d99b","#c7e9c0","#756bb1","#9e9ac8","#bcbddc","#dadaeb","#636363","#969696","#bdbdbd","#d9d9d9"];
d3.scale.quantile=function(){return Ae([],[])},d3.scale.quantize=function(){return Me(0,1,[0,1])},d3.scale.identity=function(){return Ve([0,1])},d3.svg={},d3.svg.arc=function(){function t(){var t=e.apply(this,arguments),r=n.apply(this,arguments),s=i.apply(this,arguments)+_r,a=o.apply(this,arguments)+_r,l=(s>a&&(l=s,s=a,a=l),a-s),c=l<Math.PI?"0":"1",u=Math.cos(s),h=Math.sin(s),m=Math.cos(a),p=Math.sin(a);return l>=gr?t?"M0,"+r+"A"+r+","+r+" 0 1,1 0,"+-r+"A"+r+","+r+" 0 1,1 0,"+r+"M0,"+t+"A"+t+","+t+" 0 1,0 0,"+-t+"A"+t+","+t+" 0 1,0 0,"+t+"Z":"M0,"+r+"A"+r+","+r+" 0 1,1 0,"+-r+"A"+r+","+r+" 0 1,1 0,"+r+"Z":t?"M"+r*u+","+r*h+"A"+r+","+r+" 0 "+c+",1 "+r*m+","+r*p+"L"+t*m+","+t*p+"A"+t+","+t+" 0 "+c+",0 "+t*u+","+t*h+"Z":"M"+r*u+","+r*h+"A"+r+","+r+" 0 "+c+",1 "+r*m+","+r*p+"L0,0Z"}var e=Ie,n=Te,i=Le,o=Fe;return t.innerRadius=function(n){return arguments.length?(e=d3.functor(n),t):e},t.outerRadius=function(e){return arguments.length?(n=d3.functor(e),t):n},t.startAngle=function(e){return arguments.length?(i=d3.functor(e),t):i},t.endAngle=function(e){return arguments.length?(o=d3.functor(e),t):o},t.centroid=function(){var t=(e.apply(this,arguments)+n.apply(this,arguments))/2,r=(i.apply(this,arguments)+o.apply(this,arguments))/2+_r;return[Math.cos(r)*t,Math.sin(r)*t]},t};var _r=-Math.PI/2,gr=2*Math.PI-1e-6;d3.svg.line=function(){return Ge(Object)};var xr="linear",vr=d3.map({linear:Je,"step-before":Re,"step-after":Ee,basis:We,"basis-open":Ke,"basis-closed":He,bundle:Xe,cardinal:Oe,"cardinal-open":je,"cardinal-closed":ze,monotone:en}),br=[0,2/3,1/3,0],wr=[0,1/3,2/3,0],Dr=[0,1/6,2/3,1/6];d3.svg.line.radial=function(){var t=Ge(nn);return t.radius=t.x,delete t.x,t.angle=t.y,delete t.y,t},Re.reverse=Ee,Ee.reverse=Re,d3.svg.area=function(){return on(Object)},d3.svg.area.radial=function(){var t=on(nn);return t.radius=t.x,delete t.x,t.innerRadius=t.x0,delete t.x0,t.outerRadius=t.x1,delete t.x1,t.angle=t.y,delete t.y,t.startAngle=t.y0,delete t.y0,t.endAngle=t.y1,delete t.y1,t},d3.svg.chord=function(){function t(t,a){var l=e(this,r,t,a),c=e(this,s,t,a);return"M"+l.p0+i(l.r,l.p1,l.a1-l.a0)+(n(l,c)?o(l.r,l.p1,l.r,l.p0):o(l.r,l.p1,c.r,c.p0)+i(c.r,c.p1,c.a1-c.a0)+o(c.r,c.p1,l.r,l.p0))+"Z"}function e(t,e,n,i){var o=e.call(t,n,i),r=a.call(t,o,i),s=l.call(t,o,i)+_r,u=c.call(t,o,i)+_r;return{r:r,a0:s,a1:u,p0:[r*Math.cos(s),r*Math.sin(s)],p1:[r*Math.cos(u),r*Math.sin(u)]}}function n(t,e){return t.a0==e.a0&&t.a1==e.a1}function i(t,e,n){return"A"+t+","+t+" 0 "+ +(n>Math.PI)+",1 "+e}function o(t,e,n,i){return"Q 0,0 "+i}var r=an,s=ln,a=cn,l=Le,c=Fe;return t.radius=function(e){return arguments.length?(a=d3.functor(e),t):a},t.source=function(e){return arguments.length?(r=d3.functor(e),t):r},t.target=function(e){return arguments.length?(s=d3.functor(e),t):s},t.startAngle=function(e){return arguments.length?(l=d3.functor(e),t):l},t.endAngle=function(e){return arguments.length?(c=d3.functor(e),t):c},t},d3.svg.diagonal=function(){function t(t,o){var r=e.call(this,t,o),s=n.call(this,t,o),a=(r.y+s.y)/2,l=[r,{x:r.x,y:a},{x:s.x,y:a},s];return l=l.map(i),"M"+l[0]+"C"+l[1]+" "+l[2]+" "+l[3]}var e=an,n=ln,i=un;return t.source=function(n){return arguments.length?(e=d3.functor(n),t):e},t.target=function(e){return arguments.length?(n=d3.functor(e),t):n},t.projection=function(e){return arguments.length?(i=e,t):i},t},d3.svg.diagonal.radial=function(){var t=d3.svg.diagonal(),e=un,n=t.projection;return t.projection=function(t){return arguments.length?n(hn(e=t)):e},t},d3.svg.mouse=d3.mouse,d3.svg.touches=d3.touches,d3.svg.symbol=function(){function t(t,i){return(Br.get(e.call(this,t,i))||fn)(n.call(this,t,i))}var e=pn,n=mn;return t.type=function(n){return arguments.length?(e=d3.functor(n),t):e},t.size=function(e){return arguments.length?(n=d3.functor(e),t):n},t};var Br=d3.map({circle:fn,cross:function(t){var e=Math.sqrt(t/5)/2;return"M"+-3*e+","+-e+"H"+-e+"V"+-3*e+"H"+e+"V"+-e+"H"+3*e+"V"+e+"H"+e+"V"+3*e+"H"+-e+"V"+e+"H"+-3*e+"Z"},diamond:function(t){var e=Math.sqrt(t/(2*Sr)),n=e*Sr;return"M0,"+-e+"L"+n+",0 0,"+e+" "+-n+",0Z"},square:function(t){var e=Math.sqrt(t)/2;return"M"+-e+","+-e+"L"+e+","+-e+" "+e+","+e+" "+-e+","+e+"Z"},"triangle-down":function(t){var e=Math.sqrt(t/Cr),n=e*Cr/2;return"M0,"+n+"L"+e+","+-n+" "+-e+","+-n+"Z"},"triangle-up":function(t){var e=Math.sqrt(t/Cr),n=e*Cr/2;return"M0,"+-n+"L"+e+","+n+" "+-e+","+n+"Z"}});d3.svg.symbolTypes=Br.keys();var Cr=Math.sqrt(3),Sr=Math.tan(30*Math.PI/180);d3.svg.axis=function(){function t(t){t.each(function(){var t,h=d3.select(this),m=null==c?n.ticks?n.ticks.apply(n,l):n.domain():c,p=null==e?n.tickFormat?n.tickFormat.apply(n,l):String:e,f=_n(n,m,u),y=h.selectAll(".minor").data(f,String),d=y.enter().insert("line","g").attr("class","tick minor").style("opacity",1e-6),_=d3.transition(y.exit()).style("opacity",1e-6).remove(),g=d3.transition(y).style("opacity",1),x=h.selectAll("g").data(m,String),v=x.enter().insert("g","path").style("opacity",1e-6),b=d3.transition(x.exit()).style("opacity",1e-6).remove(),w=d3.transition(x).style("opacity",1),D=ue(n),B=h.selectAll(".domain").data([0]),C=(B.enter().append("path").attr("class","domain"),d3.transition(B)),S=n.copy(),A=this.__chart__||S;switch(this.__chart__=S,v.append("line").attr("class","tick"),v.append("text"),w.select("text").text(p),i){case"bottom":t=yn,d.attr("y2",r),g.attr("x2",0).attr("y2",r),v.select("line").attr("y2",o),v.select("text").attr("y",Math.max(o,0)+a),w.select("line").attr("x2",0).attr("y2",o),w.select("text").attr("x",0).attr("y",Math.max(o,0)+a).attr("dy",".71em").attr("text-anchor","middle"),C.attr("d","M"+D[0]+","+s+"V0H"+D[1]+"V"+s);break;case"top":t=yn,d.attr("y2",-r),g.attr("x2",0).attr("y2",-r),v.select("line").attr("y2",-o),v.select("text").attr("y",-(Math.max(o,0)+a)),w.select("line").attr("x2",0).attr("y2",-o),w.select("text").attr("x",0).attr("y",-(Math.max(o,0)+a)).attr("dy","0em").attr("text-anchor","middle"),C.attr("d","M"+D[0]+","+-s+"V0H"+D[1]+"V"+-s);break;case"left":t=dn,d.attr("x2",-r),g.attr("x2",-r).attr("y2",0),v.select("line").attr("x2",-o),v.select("text").attr("x",-(Math.max(o,0)+a)),w.select("line").attr("x2",-o).attr("y2",0),w.select("text").attr("x",-(Math.max(o,0)+a)).attr("y",0).attr("dy",".32em").attr("text-anchor","end"),C.attr("d","M"+-s+","+D[0]+"H0V"+D[1]+"H"+-s);break;case"right":t=dn,d.attr("x2",r),g.attr("x2",r).attr("y2",0),v.select("line").attr("x2",o),v.select("text").attr("x",Math.max(o,0)+a),w.select("line").attr("x2",o).attr("y2",0),w.select("text").attr("x",Math.max(o,0)+a).attr("y",0).attr("dy",".32em").attr("text-anchor","start"),C.attr("d","M"+s+","+D[0]+"H0V"+D[1]+"H"+s)}if(n.ticks)v.call(t,A),w.call(t,S),b.call(t,S),d.call(t,A),g.call(t,S),_.call(t,S);else{var M=S.rangeBand()/2,V=function(t){return S(t)+M};v.call(t,V),w.call(t,V)}})}var e,n=d3.scale.linear(),i="bottom",o=6,r=6,s=6,a=3,l=[10],c=null,u=0;return t.scale=function(e){return arguments.length?(n=e,t):n},t.orient=function(e){return arguments.length?(i=e,t):i},t.ticks=function(){return arguments.length?(l=arguments,t):l},t.tickValues=function(e){return arguments.length?(c=e,t):c},t.tickFormat=function(n){return arguments.length?(e=n,t):e},t.tickSize=function(e,n){if(!arguments.length)return o;var i=arguments.length-1;return o=+e,r=i>1?+n:o,s=i>0?+arguments[i]:o,t},t.tickPadding=function(e){return arguments.length?(a=+e,t):a},t.tickSubdivide=function(e){return arguments.length?(u=+e,t):u},t},d3.svg.brush=function(){function t(r){r.each(function(){var r,s=d3.select(this),u=s.selectAll(".background").data([0]),h=s.selectAll(".extent").data([0]),m=s.selectAll(".resize").data(c,String);s.style("pointer-events","all").on("mousedown.brush",o).on("touchstart.brush",o),u.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),h.enter().append("rect").attr("class","extent").style("cursor","move"),m.enter().append("g").attr("class",function(t){return"resize "+t}).style("cursor",function(t){return Ar[t]}).append("rect").attr("x",function(t){return/[ew]$/.test(t)?-3:null}).attr("y",function(t){return/^[ns]/.test(t)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),m.style("display",t.empty()?"none":null),m.exit().remove(),a&&(r=ue(a),u.attr("x",r[0]).attr("width",r[1]-r[0]),n(s)),l&&(r=ue(l),u.attr("y",r[0]).attr("height",r[1]-r[0]),i(s)),e(s)})}function e(t){t.selectAll(".resize").attr("transform",function(t){return"translate("+u[+/e$/.test(t)][0]+","+u[+/^s/.test(t)][1]+")"})}function n(t){t.select(".extent").attr("x",u[0][0]),t.selectAll(".extent,.n>rect,.s>rect").attr("width",u[1][0]-u[0][0])}function i(t){t.select(".extent").attr("y",u[0][1]),t.selectAll(".extent,.e>rect,.w>rect").attr("height",u[1][1]-u[0][1])}function o(){function o(){var t=d3.event.changedTouches;return t?d3.touches(_,t)[0]:d3.mouse(_)}function c(){32==d3.event.keyCode&&(B||(y=null,C[0]-=u[1][0],C[1]-=u[1][1],B=2),V())}function h(){32==d3.event.keyCode&&2==B&&(C[0]+=u[1][0],C[1]+=u[1][1],B=0,V())}function m(){var t=o(),r=!1;d&&(t[0]+=d[0],t[1]+=d[1]),B||(d3.event.altKey?(y||(y=[(u[0][0]+u[1][0])/2,(u[0][1]+u[1][1])/2]),C[0]=u[+(t[0]<y[0])][0],C[1]=u[+(t[1]<y[1])][1]):y=null),w&&p(t,a,0)&&(n(v),r=!0),D&&p(t,l,1)&&(i(v),r=!0),r&&(e(v),x({type:"brush",mode:B?"move":"resize"}))}function p(t,e,n){var i,o,s=ue(e),a=s[0],l=s[1],c=C[n],h=u[1][n]-u[0][n];return B&&(a-=c,l-=h+c),i=Math.max(a,Math.min(l,t[n])),B?o=(i+=c)+h:(y&&(c=Math.max(a,Math.min(l,2*y[n]-i))),i>c?(o=i,i=c):o=c),u[0][n]!==i||u[1][n]!==o?(r=null,u[0][n]=i,u[1][n]=o,!0):void 0}function f(){m(),v.style("pointer-events","all").selectAll(".resize").style("display",t.empty()?"none":null),d3.select("body").style("cursor",null),S.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),x({type:"brushend"}),V()}var y,d,_=this,g=d3.select(d3.event.target),x=s.of(_,arguments),v=d3.select(_),b=g.datum(),w=!/^(n|s)$/.test(b)&&a,D=!/^(e|w)$/.test(b)&&l,B=g.classed("extent"),C=o(),S=d3.select(window).on("mousemove.brush",m).on("mouseup.brush",f).on("touchmove.brush",m).on("touchend.brush",f).on("keydown.brush",c).on("keyup.brush",h);if(B)C[0]=u[0][0]-C[0],C[1]=u[0][1]-C[1];else if(b){var A=+/w$/.test(b),M=+/^n/.test(b);d=[u[1-A][0]-C[0],u[1-M][1]-C[1]],C[0]=u[A][0],C[1]=u[M][1]}else d3.event.altKey&&(y=C.slice());v.style("pointer-events","none").selectAll(".resize").style("display",null),d3.select("body").style("cursor",g.style("cursor")),x({type:"brushstart"}),m(),V()}var r,s=T(t,"brushstart","brush","brushend"),a=null,l=null,c=Mr[0],u=[[0,0],[0,0]];return t.x=function(e){return arguments.length?(a=e,c=Mr[!a<<1|!l],t):a},t.y=function(e){return arguments.length?(l=e,c=Mr[!a<<1|!l],t):l},t.extent=function(e){var n,i,o,s,c;return arguments.length?(r=[[0,0],[0,0]],a&&(n=e[0],i=e[1],l&&(n=n[0],i=i[0]),r[0][0]=n,r[1][0]=i,a.invert&&(n=a(n),i=a(i)),n>i&&(c=n,n=i,i=c),u[0][0]=0|n,u[1][0]=0|i),l&&(o=e[0],s=e[1],a&&(o=o[1],s=s[1]),r[0][1]=o,r[1][1]=s,l.invert&&(o=l(o),s=l(s)),o>s&&(c=o,o=s,s=c),u[0][1]=0|o,u[1][1]=0|s),t):(e=r||u,a&&(n=e[0][0],i=e[1][0],r||(n=u[0][0],i=u[1][0],a.invert&&(n=a.invert(n),i=a.invert(i)),n>i&&(c=n,n=i,i=c))),l&&(o=e[0][1],s=e[1][1],r||(o=u[0][1],s=u[1][1],l.invert&&(o=l.invert(o),s=l.invert(s)),o>s&&(c=o,o=s,s=c))),a&&l?[[n,o],[i,s]]:a?[n,i]:l&&[o,s])},t.clear=function(){return r=null,u[0][0]=u[0][1]=u[1][0]=u[1][1]=0,t},t.empty=function(){return a&&u[0][0]===u[1][0]||l&&u[0][1]===u[1][1]},d3.rebind(t,s,"on")};var Ar={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Mr=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]];d3.behavior={},d3.behavior.drag=function(){function t(){this.on("mousedown.drag",e).on("touchstart.drag",e)}function e(){function t(){var t=a.parentNode,e=d3.event.changedTouches;return e?d3.touches(t,e)[0]:d3.mouse(t)}function e(){if(!a.parentNode)return o();var e=t(),n=e[0]-u[0],i=e[1]-u[1];h|=n|i,u=e,V(),l({type:"drag",x:e[0]+s[0],y:e[1]+s[1],dx:n,dy:i})}function o(){l({type:"dragend"}),h&&(V(),d3.event.target===c&&m.on("click.drag",r,!0)),m.on("mousemove.drag",null).on("touchmove.drag",null).on("mouseup.drag",null).on("touchend.drag",null)}function r(){V(),m.on("click.drag",null)}var s,a=this,l=n.of(a,arguments),c=d3.event.target,u=t(),h=0,m=d3.select(window).on("mousemove.drag",e).on("touchmove.drag",e).on("mouseup.drag",o,!0).on("touchend.drag",o,!0);i?(s=i.apply(a,arguments),s=[s.x-u[0],s.y-u[1]]):s=[0,0],l({type:"dragstart"})}var n=T(t,"drag","dragstart","dragend"),i=null;return t.origin=function(e){return arguments.length?(i=e,t):i},d3.rebind(t,n,"on")},d3.behavior.zoom=function(){function t(){this.on("mousedown.zoom",s).on("mousewheel.zoom",a).on("mousemove.zoom",l).on("DOMMouseScroll.zoom",a).on("dblclick.zoom",c).on("touchstart.zoom",u).on("touchmove.zoom",h).on("touchend.zoom",u)}function e(t){return[(t[0]-x[0])/v,(t[1]-x[1])/v]}function n(t){return[t[0]*v+x[0],t[1]*v+x[1]]}function i(t){v=Math.max(b[0],Math.min(b[1],t))}function o(t,e){e=n(e),x[0]+=t[0]-e[0],x[1]+=t[1]-e[1]}function r(t){y&&y.domain(f.range().map(function(t){return(t-x[0])/v}).map(f.invert)),_&&_.domain(d.range().map(function(t){return(t-x[1])/v}).map(d.invert)),d3.event.preventDefault(),t({type:"zoom",scale:v,translate:x})}function s(){function t(){c=1,o(d3.mouse(s),h),r(a)}function n(){c&&V(),u.on("mousemove.zoom",null).on("mouseup.zoom",null),c&&d3.event.target===l&&u.on("click.zoom",i)}function i(){V(),u.on("click.zoom",null)}var s=this,a=w.of(s,arguments),l=d3.event.target,c=0,u=d3.select(window).on("mousemove.zoom",t).on("mouseup.zoom",n),h=e(d3.mouse(s));window.focus(),V()}function a(){m||(m=e(d3.mouse(this))),i(Math.pow(2,.002*gn())*v),o(d3.mouse(this),m),r(w.of(this,arguments))}function l(){m=null}function c(){var t=d3.mouse(this),n=e(t);i(d3.event.shiftKey?v/2:2*v),o(t,n),r(w.of(this,arguments))}function u(){var t=d3.touches(this),n=Date.now();if(p=v,m={},t.forEach(function(t){m[t.identifier]=e(t)}),V(),1===t.length&&500>n-g){var s=t[0],a=e(t[0]);i(2*v),o(s,a),r(w.of(this,arguments))}g=n}function h(){var t=d3.touches(this),e=t[0],n=m[e.identifier];if(s=t[1]){var s,a=m[s.identifier];e=[(e[0]+s[0])/2,(e[1]+s[1])/2],n=[(n[0]+a[0])/2,(n[1]+a[1])/2],i(d3.event.scale*p)}o(e,n),r(w.of(this,arguments))}var m,p,f,y,d,_,g,x=[0,0],v=1,b=Ir,w=T(t,"zoom");return t.translate=function(e){return arguments.length?(x=e.map(Number),t):x},t.scale=function(e){return arguments.length?(v=+e,t):v},t.scaleExtent=function(e){return arguments.length?(b=null==e?Ir:e.map(Number),t):b},t.x=function(e){return arguments.length?(y=e,f=e.copy(),t):y},t.y=function(e){return arguments.length?(_=e,d=e.copy(),t):_},d3.rebind(t,w,"on")};var Vr,Ir=[0,1/0];d3.layout={},d3.layout.bundle=function(){return function(t){for(var e=[],n=-1,i=t.length;++n<i;)e.push(xn(t[n]));return e}},d3.layout.chord=function(){function t(){var t,c,h,m,p,f={},y=[],d=d3.range(r),_=[];for(n=[],i=[],t=0,m=-1;++m<r;){for(c=0,p=-1;++p<r;)c+=o[m][p];y.push(c),_.push(d3.range(r)),t+=c}for(s&&d.sort(function(t,e){return s(y[t],y[e])}),a&&_.forEach(function(t,e){t.sort(function(t,n){return a(o[e][t],o[e][n])})}),t=(2*Math.PI-u*r)/t,c=0,m=-1;++m<r;){for(h=c,p=-1;++p<r;){var g=d[m],x=_[g][p],v=o[g][x],b=c,w=c+=v*t;f[g+"-"+x]={index:g,subindex:x,startAngle:b,endAngle:w,value:v}}i.push({index:g,startAngle:h,endAngle:c,value:(c-h)/t}),c+=u}for(m=-1;++m<r;)for(p=m-1;++p<r;){var D=f[m+"-"+p],B=f[p+"-"+m];(D.value||B.value)&&n.push(D.value<B.value?{source:B,target:D}:{source:D,target:B})}l&&e()}function e(){n.sort(function(t,e){return l((t.source.value+t.target.value)/2,(e.source.value+e.target.value)/2)})}var n,i,o,r,s,a,l,c={},u=0;return c.matrix=function(t){return arguments.length?(r=(o=t)&&o.length,n=i=null,c):o},c.padding=function(t){return arguments.length?(u=t,n=i=null,c):u},c.sortGroups=function(t){return arguments.length?(s=t,n=i=null,c):s},c.sortSubgroups=function(t){return arguments.length?(a=t,n=null,c):a},c.sortChords=function(t){return arguments.length?(l=t,n&&e(),c):l},c.chords=function(){return n||t(),n},c.groups=function(){return i||t(),i},c},d3.layout.force=function(){function t(t){return function(e,n,i,o){if(e.point!==t){var r=e.cx-t.x,s=e.cy-t.y,a=1/Math.sqrt(r*r+s*s);if(y>(o-n)*a){var l=e.charge*a*a;return t.px-=r*l,t.py-=s*l,!0}if(e.point&&isFinite(a)){var l=e.pointCharge*a*a;t.px-=r*l,t.py-=s*l}}return!e.charge}}function e(t){wn(Lr=t),Tr=a}var n,i,o,r,s,a={},l=d3.dispatch("start","tick","end"),c=[1,1],u=.9,h=An,m=Mn,p=-30,f=.1,y=.8,d=[],_=[];return a.tick=function(){if((i*=.99)<.005)return l.end({type:"end",alpha:i=0}),!0;var e,n,a,h,m,y,g,x,v,b=d.length,w=_.length;for(n=0;w>n;++n)a=_[n],h=a.source,m=a.target,x=m.x-h.x,v=m.y-h.y,(y=x*x+v*v)&&(y=i*r[n]*((y=Math.sqrt(y))-o[n])/y,x*=y,v*=y,m.x-=x*(g=h.weight/(m.weight+h.weight)),m.y-=v*g,h.x+=x*(g=1-g),h.y+=v*g);if((g=i*f)&&(x=c[0]/2,v=c[1]/2,n=-1,g))for(;++n<b;)a=d[n],a.x+=(x-a.x)*g,a.y+=(v-a.y)*g;if(p)for(Sn(e=d3.geom.quadtree(d),i,s),n=-1;++n<b;)(a=d[n]).fixed||e.visit(t(a));for(n=-1;++n<b;)a=d[n],a.fixed?(a.x=a.px,a.y=a.py):(a.x-=(a.px-(a.px=a.x))*u,a.y-=(a.py-(a.py=a.y))*u);l.tick({type:"tick",alpha:i})},a.nodes=function(t){return arguments.length?(d=t,a):d},a.links=function(t){return arguments.length?(_=t,a):_},a.size=function(t){return arguments.length?(c=t,a):c},a.linkDistance=function(t){return arguments.length?(h=d3.functor(t),a):h},a.distance=a.linkDistance,a.linkStrength=function(t){return arguments.length?(m=d3.functor(t),a):m},a.friction=function(t){return arguments.length?(u=t,a):u},a.charge=function(t){return arguments.length?(p="function"==typeof t?t:+t,a):p},a.gravity=function(t){return arguments.length?(f=t,a):f},a.theta=function(t){return arguments.length?(y=t,a):y},a.alpha=function(t){return arguments.length?(i?i=t>0?t:0:t>0&&(l.start({type:"start",alpha:i=t}),d3.timer(a.tick)),a):i},a.start=function(){function t(t,i){for(var o,r=e(n),s=-1,a=r.length;++s<a;)if(!isNaN(o=r[s][t]))return o;return Math.random()*i}function e(){if(!l){for(l=[],i=0;f>i;++i)l[i]=[];for(i=0;y>i;++i){var t=_[i];l[t.source.index].push(t.target),l[t.target.index].push(t.source)}}return l[n]}var n,i,l,u,f=d.length,y=_.length,g=c[0],x=c[1];for(n=0;f>n;++n)(u=d[n]).index=n,u.weight=0;for(o=[],r=[],n=0;y>n;++n)u=_[n],"number"==typeof u.source&&(u.source=d[u.source]),"number"==typeof u.target&&(u.target=d[u.target]),o[n]=h.call(this,u,n),r[n]=m.call(this,u,n),++u.source.weight,++u.target.weight;for(n=0;f>n;++n)u=d[n],isNaN(u.x)&&(u.x=t("x",g)),isNaN(u.y)&&(u.y=t("y",x)),isNaN(u.px)&&(u.px=u.x),isNaN(u.py)&&(u.py=u.y);if(s=[],"function"==typeof p)for(n=0;f>n;++n)s[n]=+p.call(this,d[n],n);else for(n=0;f>n;++n)s[n]=p;return a.resume()},a.resume=function(){return a.alpha(.1)},a.stop=function(){return a.alpha(0)},a.drag=function(){n||(n=d3.behavior.drag().origin(Object).on("dragstart",e).on("drag",Cn).on("dragend",Bn)),this.on("mouseover.force",wn).on("mouseout.force",Dn).call(n)},d3.rebind(a,l,"on")};var Tr,Lr;d3.layout.partition=function(){function t(e,n,i,o){var r=e.children;if(e.x=n,e.y=e.depth*o,e.dx=i,e.dy=o,r&&(s=r.length)){var s,a,l,c=-1;for(i=e.value?i/e.value:0;++c<s;)t(a=r[c],n,l=a.value*i,o),n+=l}}function e(t){var n=t.children,i=0;if(n&&(o=n.length))for(var o,r=-1;++r<o;)i=Math.max(i,e(n[r]));return 1+i}function n(n,r){var s=i.call(this,n,r);return t(s[0],0,o[0],o[1]/e(s[0])),s}var i=d3.layout.hierarchy(),o=[1,1];return n.size=function(t){return arguments.length?(o=t,n):o},En(n,i)},d3.layout.pie=function(){function t(r){var s=r.map(function(n,i){return+e.call(t,n,i)}),a=+("function"==typeof i?i.apply(this,arguments):i),l=(("function"==typeof o?o.apply(this,arguments):o)-i)/d3.sum(s),c=d3.range(r.length);null!=n&&c.sort(n===Fr?function(t,e){return s[e]-s[t]}:function(t,e){return n(r[t],r[e])});var u=[];return c.forEach(function(t){u[t]={data:r[t],value:d=s[t],startAngle:a,endAngle:a+=d*l}}),u}var e=Number,n=Fr,i=0,o=2*Math.PI;return t.value=function(n){return arguments.length?(e=n,t):e},t.sort=function(e){return arguments.length?(n=e,t):n},t.startAngle=function(e){return arguments.length?(i=e,t):i},t.endAngle=function(e){return arguments.length?(o=e,t):o},t};var Fr={};d3.layout.stack=function(){function t(a,l){var c=a.map(function(n,i){return e.call(t,n,i)}),u=c.map(function(e){return e.map(function(e,n){return[r.call(t,e,n),s.call(t,e,n)]})}),h=n.call(t,u,l);c=d3.permute(c,h),u=d3.permute(u,h);var m,p,f,y=i.call(t,u,l),d=c.length,_=c[0].length;for(p=0;_>p;++p)for(o.call(t,c[0][p],f=y[p],u[0][p][1]),m=1;d>m;++m)o.call(t,c[m][p],f+=u[m-1][p][1],u[m][p][1]);return a}var e=Object,n=Ln,i=Fn,o=Tn,r=Vn,s=In;return t.values=function(n){return arguments.length?(e=n,t):e},t.order=function(e){return arguments.length?(n="function"==typeof e?e:Gr.get(e)||Ln,t):n},t.offset=function(e){return arguments.length?(i="function"==typeof e?e:Pr.get(e)||Fn,t):i},t.x=function(e){return arguments.length?(r=e,t):r},t.y=function(e){return arguments.length?(s=e,t):s},t.out=function(e){return arguments.length?(o=e,t):o},t};var Gr=d3.map({"inside-out":function(t){var e,n,i=t.length,o=t.map(Gn),r=t.map(Pn),s=d3.range(i).sort(function(t,e){return o[t]-o[e]}),a=0,l=0,c=[],u=[];for(e=0;i>e;++e)n=s[e],l>a?(a+=r[n],c.push(n)):(l+=r[n],u.push(n));return u.reverse().concat(c)},reverse:function(t){return d3.range(t.length).reverse()},"default":Ln}),Pr=d3.map({silhouette:function(t){var e,n,i,o=t.length,r=t[0].length,s=[],a=0,l=[];for(n=0;r>n;++n){for(e=0,i=0;o>e;e++)i+=t[e][n][1];i>a&&(a=i),s.push(i)}for(n=0;r>n;++n)l[n]=(a-s[n])/2;return l},wiggle:function(t){var e,n,i,o,r,s,a,l,c,u=t.length,h=t[0],m=h.length,p=[];for(p[0]=l=c=0,n=1;m>n;++n){for(e=0,o=0;u>e;++e)o+=t[e][n][1];for(e=0,r=0,a=h[n][0]-h[n-1][0];u>e;++e){for(i=0,s=(t[e][n][1]-t[e][n-1][1])/(2*a);e>i;++i)s+=(t[i][n][1]-t[i][n-1][1])/a;r+=s*t[e][n][1]}p[n]=l-=o?r/o*a:0,c>l&&(c=l)}for(n=0;m>n;++n)p[n]-=c;return p},expand:function(t){var e,n,i,o=t.length,r=t[0].length,s=1/o,a=[];for(n=0;r>n;++n){for(e=0,i=0;o>e;e++)i+=t[e][n][1];if(i)for(e=0;o>e;e++)t[e][n][1]/=i;else for(e=0;o>e;e++)t[e][n][1]=s}for(n=0;r>n;++n)a[n]=0;return a},zero:Fn});d3.layout.histogram=function(){function t(t,r){for(var s,a,l=[],c=t.map(n,this),u=i.call(this,c,r),h=o.call(this,u,c,r),r=-1,m=c.length,p=h.length-1,f=e?1:1/m;++r<p;)s=l[r]=[],s.dx=h[r+1]-(s.x=h[r]),s.y=0;for(r=-1;++r<m;)a=c[r],a>=u[0]&&a<=u[1]&&(s=l[d3.bisect(h,a,1,p)-1],s.y+=f,s.push(t[r]));return l}var e=!0,n=Number,i=Rn,o=Nn;return t.value=function(e){return arguments.length?(n=e,t):n},t.range=function(e){return arguments.length?(i=d3.functor(e),t):i},t.bins=function(e){return arguments.length?(o="number"==typeof e?function(t){return Jn(t,e)}:d3.functor(e),t):o},t.frequency=function(n){return arguments.length?(e=!!n,t):e},t},d3.layout.hierarchy=function(){function t(e,s,a){var l=o.call(n,e,s),c=kr?e:{data:e};if(c.depth=s,a.push(c),l&&(u=l.length)){for(var u,h=-1,m=c.children=[],p=0,f=s+1;++h<u;)d=t(l[h],f,a),d.parent=c,m.push(d),p+=d.value;i&&m.sort(i),r&&(c.value=p)}else r&&(c.value=+r.call(n,e,s)||0);return c}function e(t,i){var o=t.children,s=0;if(o&&(a=o.length))for(var a,l=-1,c=i+1;++l<a;)s+=e(o[l],c);else r&&(s=+r.call(n,kr?t:t.data,i)||0);return r&&(t.value=s),s}function n(e){var n=[];return t(e,0,n),n}var i=On,o=jn,r=zn;return n.sort=function(t){return arguments.length?(i=t,n):i},n.children=function(t){return arguments.length?(o=t,n):o},n.value=function(t){return arguments.length?(r=t,n):r},n.revalue=function(t){return e(t,0),t},n};var kr=!1;d3.layout.pack=function(){function t(t,i){var o=e.call(this,t,i),r=o[0];r.x=0,r.y=0,$n(r);var s=n[0],a=n[1],l=1/Math.max(2*r.r/s,2*r.r/a);return Qn(r,s/2,a/2,l),o}var e=d3.layout.hierarchy().sort(Un),n=[1,1];return t.size=function(e){return arguments.length?(n=e,t):n},En(t,e)},d3.layout.cluster=function(){function t(t,o){var r,s=e.call(this,t,o),a=s[0],l=0;mi(a,function(t){var e=t.children;e&&e.length?(t.x=ni(e),t.y=ei(e)):(t.x=r?l+=n(t,r):0,t.y=0,r=t)});var c=ii(a),u=oi(a),h=c.x-n(c,u)/2,m=u.x+n(u,c)/2;return mi(a,function(t){t.x=(t.x-h)/(m-h)*i[0],t.y=(1-(a.y?t.y/a.y:1))*i[1]}),s}var e=d3.layout.hierarchy().sort(null).value(null),n=ri,i=[1,1];return t.separation=function(e){return arguments.length?(n=e,t):n},t.size=function(e){return arguments.length?(i=e,t):i},En(t,e)},d3.layout.tree=function(){function t(t,o){function r(t,e){var i=t.children,o=t._tree;if(i&&(s=i.length)){for(var s,l,c,u=i[0],h=u,m=-1;++m<s;)c=i[m],r(c,l),h=a(c,l,h),l=c;pi(t);var p=.5*(u._tree.prelim+c._tree.prelim);e?(o.prelim=e._tree.prelim+n(t,e),o.mod=o.prelim-p):o.prelim=p}else e&&(o.prelim=e._tree.prelim+n(t,e))}function s(t,e){t.x=t._tree.prelim+e;var n=t.children;if(n&&(i=n.length)){var i,o=-1;for(e+=t._tree.mod;++o<i;)s(n[o],e)}}function a(t,e,i){if(e){for(var o,r=t,s=t,a=e,l=t.parent.children[0],c=r._tree.mod,u=s._tree.mod,h=a._tree.mod,m=l._tree.mod;a=ai(a),r=si(r),a&&r;)l=si(l),s=ai(s),s._tree.ancestor=t,o=a._tree.prelim+h-r._tree.prelim-c+n(a,r),o>0&&(fi(yi(a,t,i),t,o),c+=o,u+=o),h+=a._tree.mod,c+=r._tree.mod,m+=l._tree.mod,u+=s._tree.mod;a&&!ai(s)&&(s._tree.thread=a,s._tree.mod+=h-u),r&&!si(l)&&(l._tree.thread=r,l._tree.mod+=c-m,i=t)}return i}var l=e.call(this,t,o),c=l[0];mi(c,function(t,e){t._tree={ancestor:t,prelim:0,mod:0,change:0,shift:0,number:e?e._tree.number+1:0}}),r(c),s(c,-c._tree.prelim);var u=li(c,ui),h=li(c,ci),m=li(c,hi),p=u.x-n(u,h)/2,f=h.x+n(h,u)/2,y=m.depth||1;return mi(c,function(t){t.x=(t.x-p)/(f-p)*i[0],t.y=t.depth/y*i[1],delete t._tree}),l}var e=d3.layout.hierarchy().sort(null).value(null),n=ri,i=[1,1];return t.separation=function(e){return arguments.length?(n=e,t):n},t.size=function(e){return arguments.length?(i=e,t):i},En(t,e)},d3.layout.treemap=function(){function t(t,e){for(var n,i,o=-1,r=t.length;++o<r;)i=(n=t[o]).value*(0>e?0:e),n.area=isNaN(i)||0>=i?0:i}function e(n){var r=n.children;if(r&&r.length){var s,a,l,c=h(n),u=[],m=r.slice(),p=1/0,f=Math.min(c.dx,c.dy);for(t(m,c.dx*c.dy/n.value),u.area=0;(l=m.length)>0;)u.push(s=m[l-1]),u.area+=s.area,(a=i(u,f))<=p?(m.pop(),p=a):(u.area-=u.pop().area,o(u,f,c,!1),f=Math.min(c.dx,c.dy),u.length=u.area=0,p=1/0);u.length&&(o(u,f,c,!0),u.length=u.area=0),r.forEach(e)}}function n(e){var i=e.children;if(i&&i.length){var r,s=h(e),a=i.slice(),l=[];for(t(a,s.dx*s.dy/e.value),l.area=0;r=a.pop();)l.push(r),l.area+=r.area,null!=r.z&&(o(l,r.z?s.dx:s.dy,s,!a.length),l.length=l.area=0);i.forEach(n)}}function i(t,e){for(var n,i=t.area,o=0,r=1/0,s=-1,a=t.length;++s<a;)(n=t[s].area)&&(r>n&&(r=n),n>o&&(o=n));return i*=i,e*=e,i?Math.max(e*o*p/i,i/(e*r*p)):1/0}function o(t,e,n,i){var o,r=-1,s=t.length,a=n.x,c=n.y,u=e?l(t.area/e):0;if(e==n.dx){for((i||u>n.dy)&&(u=n.dy);++r<s;)o=t[r],o.x=a,o.y=c,o.dy=u,a+=o.dx=Math.min(n.x+n.dx-a,u?l(o.area/u):0);o.z=!0,o.dx+=n.x+n.dx-a,n.y+=u,n.dy-=u}else{for((i||u>n.dx)&&(u=n.dx);++r<s;)o=t[r],o.x=a,o.y=c,o.dx=u,c+=o.dy=Math.min(n.y+n.dy-c,u?l(o.area/u):0);o.z=!1,o.dy+=n.y+n.dy-c,n.x+=u,n.dx-=u}}function r(i){var o=s||a(i),r=o[0];return r.x=0,r.y=0,r.dx=c[0],r.dy=c[1],s&&a.revalue(r),t([r],r.dx*r.dy/r.value),(s?n:e)(r),m&&(s=o),o}var s,a=d3.layout.hierarchy(),l=Math.round,c=[1,1],u=null,h=di,m=!1,p=.5*(1+Math.sqrt(5));return r.size=function(t){return arguments.length?(c=t,r):c},r.padding=function(t){function e(e){var n=t.call(r,e,e.depth);return null==n?di(e):_i(e,"number"==typeof n?[n,n,n,n]:n)}function n(e){return _i(e,t)}if(!arguments.length)return u;var i;return h=null==(u=t)?di:"function"==(i=typeof t)?e:"number"===i?(t=[t,t,t,t],n):n,r},r.round=function(t){return arguments.length?(l=t?Math.round:Number,r):l!=Number},r.sticky=function(t){return arguments.length?(m=t,s=null,r):m},r.ratio=function(t){return arguments.length?(p=t,r):p},En(r,a)},d3.csv=function(t,e){d3.text(t,"text/csv",function(t){e(t&&d3.csv.parse(t))})},d3.csv.parse=function(t){var e;return d3.csv.parseRows(t,function(t,n){if(n){for(var i={},o=-1,r=e.length;++o<r;)i[e[o]]=t[o];return i}return e=t,null})},d3.csv.parseRows=function(t,e){function n(){if(l.lastIndex>=t.length)return s;if(o)return o=!1,r;var e=l.lastIndex;if(34===t.charCodeAt(e)){for(var n=e;n++<t.length;)if(34===t.charCodeAt(n)){if(34!==t.charCodeAt(n+1))break;n++}l.lastIndex=n+2;var i=t.charCodeAt(n+1);return 13===i?(o=!0,10===t.charCodeAt(n+2)&&l.lastIndex++):10===i&&(o=!0),t.substring(e+1,n).replace(/""/g,'"')}var a=l.exec(t);return a?(o=44!==a[0].charCodeAt(0),t.substring(e,a.index)):(l.lastIndex=t.length,t.substring(e))}var i,o,r={},s={},a=[],l=/\r\n|[,\r\n]/g,c=0;for(l.lastIndex=0;(i=n())!==s;){for(var u=[];i!==r&&i!==s;)u.push(i),i=n();(!e||(u=e(u,c++)))&&a.push(u)}return a},d3.csv.format=function(t){return t.map(gi).join("\n")},d3.geo={};var Nr=Math.PI/180;d3.geo.azimuthal=function(){function t(t){var e,i=t[0]*Nr-n,c=t[1]*Nr,u=Math.cos(i),h=Math.sin(i),m=Math.cos(c),p=Math.sin(c),f="orthographic"!==s?r*p+o*m*u:null,y="stereographic"===s?1/(1+f):"gnomonic"===s?1/f:"equidistant"===s?(e=Math.acos(f),e?e/Math.sin(e):0):"equalarea"===s?Math.sqrt(2/(1+f)):1,d=y*m*h,_=y*(r*m*u-o*p);return[a*d+l[0],a*_+l[1]]}var e,n,i,o,r,s="orthographic",a=200,l=[480,250];return t.invert=function(t){var e=(t[0]-l[0])/a,i=(t[1]-l[1])/a,c=Math.sqrt(e*e+i*i),u="stereographic"===s?2*Math.atan(c):"gnomonic"===s?Math.atan(c):"equidistant"===s?c:"equalarea"===s?2*Math.asin(.5*c):Math.asin(c),h=Math.sin(u),m=Math.cos(u);return[(n+Math.atan2(e*h,c*o*m+i*r*h))/Nr,Math.asin(m*r-(c?i*h*o/c:0))/Nr]},t.mode=function(e){return arguments.length?(s=e+"",t):s},t.origin=function(s){return arguments.length?(e=s,n=e[0]*Nr,i=e[1]*Nr,o=Math.cos(i),r=Math.sin(i),t):e},t.scale=function(e){return arguments.length?(a=+e,t):a},t.translate=function(e){return arguments.length?(l=[+e[0],+e[1]],t):l},t.origin([0,0])},d3.geo.albers=function(){function t(t){var e=i*(Nr*t[0]-n),s=Math.sqrt(o-2*i*Math.sin(Nr*t[1]))/i;return[l*s*Math.sin(e)+c[0],l*(s*Math.cos(e)-r)+c[1]]}function e(){var e=Nr*a[0],l=Nr*a[1],c=Nr*s[1],u=Math.sin(e),h=Math.cos(e);return n=Nr*s[0],i=.5*(u+Math.sin(l)),o=h*h+2*i*u,r=Math.sqrt(o-2*i*Math.sin(c))/i,t}var n,i,o,r,s=[-98,38],a=[29.5,45.5],l=1e3,c=[480,250];return t.invert=function(t){var e=(t[0]-c[0])/l,s=(t[1]-c[1])/l,a=r+s,u=Math.atan2(e,a),h=Math.sqrt(e*e+a*a);return[(n+u/i)/Nr,Math.asin((o-h*h*i*i)/(2*i))/Nr]},t.origin=function(t){return arguments.length?(s=[+t[0],+t[1]],e()):s},t.parallels=function(t){return arguments.length?(a=[+t[0],+t[1]],e()):a},t.scale=function(e){return arguments.length?(l=+e,t):l},t.translate=function(e){return arguments.length?(c=[+e[0],+e[1]],t):c},e()},d3.geo.albersUsa=function(){function t(t){var r=t[0],s=t[1];return(s>50?n:-140>r?i:21>s?o:e)(t)}var e=d3.geo.albers(),n=d3.geo.albers().origin([-160,60]).parallels([55,65]),i=d3.geo.albers().origin([-160,20]).parallels([8,18]),o=d3.geo.albers().origin([-60,10]).parallels([8,18]);return t.scale=function(r){return arguments.length?(e.scale(r),n.scale(.6*r),i.scale(r),o.scale(1.5*r),t.translate(e.translate())):e.scale()},t.translate=function(r){if(!arguments.length)return e.translate();var s=e.scale()/1e3,a=r[0],l=r[1];return e.translate(r),n.translate([a-400*s,l+170*s]),i.translate([a-190*s,l+200*s]),o.translate([a+580*s,l+430*s]),t},t.scale(e.scale())},d3.geo.bonne=function(){function t(t){var a=t[0]*Nr-e,l=t[1]*Nr-n;if(i){var c=o+i-l,u=a*Math.cos(l)/c;a=c*Math.sin(u),l=c*Math.cos(u)-o}else a*=Math.cos(l),l*=-1;return[r*a+s[0],r*l+s[1]]}var e,n,i,o,r=200,s=[480,250];return t.invert=function(t){var n=(t[0]-s[0])/r,a=(t[1]-s[1])/r;if(i){var l=o+a,c=Math.sqrt(n*n+l*l);a=o+i-c,n=e+c*Math.atan2(n,l)/Math.cos(a)}else a*=-1,n/=Math.cos(a);return[n/Nr,a/Nr]},t.parallel=function(e){return arguments.length?(o=1/Math.tan(i=e*Nr),t):i/Nr},t.origin=function(i){return arguments.length?(e=i[0]*Nr,n=i[1]*Nr,t):[e/Nr,n/Nr]},t.scale=function(e){return arguments.length?(r=+e,t):r},t.translate=function(e){return arguments.length?(s=[+e[0],+e[1]],t):s},t.origin([0,0]).parallel(45)},d3.geo.equirectangular=function(){function t(t){var i=t[0]/360,o=-t[1]/360;return[e*i+n[0],e*o+n[1]]}var e=500,n=[480,250];return t.invert=function(t){var i=(t[0]-n[0])/e,o=(t[1]-n[1])/e;return[360*i,-360*o]},t.scale=function(n){return arguments.length?(e=+n,t):e},t.translate=function(e){return arguments.length?(n=[+e[0],+e[1]],t):n},t},d3.geo.mercator=function(){function t(t){var i=t[0]/360,o=-(Math.log(Math.tan(Math.PI/4+t[1]*Nr/2))/Nr)/360;return[e*i+n[0],e*Math.max(-.5,Math.min(.5,o))+n[1]]}var e=500,n=[480,250];return t.invert=function(t){var i=(t[0]-n[0])/e,o=(t[1]-n[1])/e;return[360*i,2*Math.atan(Math.exp(-360*o*Nr))/Nr-90]},t.scale=function(n){return arguments.length?(e=+n,t):e},t.translate=function(e){return arguments.length?(n=[+e[0],+e[1]],t):n},t},d3.geo.path=function(){function t(t){return"function"==typeof r&&(s=bi(r.apply(this,arguments))),l(t)||null}function e(t){return a(t).join(",")
}function n(t){for(var e=o(t[0]),n=0,i=t.length;++n<i;)e-=o(t[n]);return e}function i(t){for(var e=d3.geom.polygon(t[0].map(a)),n=e.area(),i=e.centroid(0>n?(n*=-1,1):-1),o=i[0],r=i[1],s=n,l=0,c=t.length;++l<c;)e=d3.geom.polygon(t[l].map(a)),n=e.area(),i=e.centroid(0>n?(n*=-1,1):-1),o-=i[0],r-=i[1],s-=n;return[o,r,6*s]}function o(t){return Math.abs(d3.geom.polygon(t.map(a)).area())}var r=4.5,s=bi(r),a=d3.geo.albersUsa(),l=vi({FeatureCollection:function(t){for(var e=[],n=t.features,i=-1,o=n.length;++i<o;)e.push(l(n[i].geometry));return e.join("")},Feature:function(t){return l(t.geometry)},Point:function(t){return"M"+e(t.coordinates)+s},MultiPoint:function(t){for(var n=[],i=t.coordinates,o=-1,r=i.length;++o<r;)n.push("M",e(i[o]),s);return n.join("")},LineString:function(t){for(var n=["M"],i=t.coordinates,o=-1,r=i.length;++o<r;)n.push(e(i[o]),"L");return n.pop(),n.join("")},MultiLineString:function(t){for(var n,i,o,r=[],s=t.coordinates,a=-1,l=s.length;++a<l;){for(n=s[a],i=-1,o=n.length,r.push("M");++i<o;)r.push(e(n[i]),"L");r.pop()}return r.join("")},Polygon:function(t){for(var n,i,o,r=[],s=t.coordinates,a=-1,l=s.length;++a<l;)if(n=s[a],i=-1,(o=n.length-1)>0){for(r.push("M");++i<o;)r.push(e(n[i]),"L");r[r.length-1]="Z"}return r.join("")},MultiPolygon:function(t){for(var n,i,o,r,s,a,l=[],c=t.coordinates,u=-1,h=c.length;++u<h;)for(n=c[u],i=-1,o=n.length;++i<o;)if(r=n[i],s=-1,(a=r.length-1)>0){for(l.push("M");++s<a;)l.push(e(r[s]),"L");l[l.length-1]="Z"}return l.join("")},GeometryCollection:function(t){for(var e=[],n=t.geometries,i=-1,o=n.length;++i<o;)e.push(l(n[i]));return e.join("")}}),c=t.area=vi({FeatureCollection:function(t){for(var e=0,n=t.features,i=-1,o=n.length;++i<o;)e+=c(n[i]);return e},Feature:function(t){return c(t.geometry)},Polygon:function(t){return n(t.coordinates)},MultiPolygon:function(t){for(var e=0,i=t.coordinates,o=-1,r=i.length;++o<r;)e+=n(i[o]);return e},GeometryCollection:function(t){for(var e=0,n=t.geometries,i=-1,o=n.length;++i<o;)e+=c(n[i]);return e}},0),u=t.centroid=vi({Feature:function(t){return u(t.geometry)},Polygon:function(t){var e=i(t.coordinates);return[e[0]/e[2],e[1]/e[2]]},MultiPolygon:function(t){for(var e,n=t.coordinates,o=0,r=0,s=0,a=-1,l=n.length;++a<l;)e=i(n[a]),o+=e[0],r+=e[1],s+=e[2];return[o/s,r/s]}});return t.projection=function(e){return a=e,t},t.pointRadius=function(e){return"function"==typeof e?r=e:(r=+e,s=bi(r)),t},t},d3.geo.bounds=function(t){var e=1/0,n=1/0,i=-1/0,o=-1/0;return wi(t,function(t,r){e>t&&(e=t),t>i&&(i=t),n>r&&(n=r),r>o&&(o=r)}),[[e,n],[i,o]]};var Jr={Feature:Di,FeatureCollection:Bi,GeometryCollection:Ci,LineString:Si,MultiLineString:Ai,MultiPoint:Si,MultiPolygon:Mi,Point:Vi,Polygon:Ii};d3.geo.circle=function(){function t(){}function e(t){return a.distance(t)<s}function n(t){for(var e,n,o,r,l,c=-1,u=t.length,h=[];++c<u;)l=a.distance(o=t[c]),s>l?(n&&h.push(Fi(n,o)((r-s)/(r-l))),h.push(o),e=n=null):(n=o,!e&&h.length&&(h.push(Fi(h[h.length-1],n)((s-r)/(l-r))),e=n)),r=l;return n&&h.length&&(l=a.distance(o=h[0]),h.push(Fi(n,o)((r-s)/(r-l)))),i(h)}function i(t){for(var e,n,i,o=0,r=t.length,s=r?[t[0]]:t,l=a.source();++o<r;)for(i=a.source(t[o-1])(t[o]).coordinates,e=0,n=i.length;++e<n;)s.push(i[e]);return a.source(l),s}var o=[0,0],r=89.99,s=r*Nr,a=d3.geo.greatArc().target(Object);t.clip=function(t){return a.source("function"==typeof o?o.apply(this,arguments):o),l(t)};var l=vi({FeatureCollection:function(t){var e=t.features.map(l).filter(Object);return e&&(t=Object.create(t),t.features=e,t)},Feature:function(t){var e=l(t.geometry);return e&&(t=Object.create(t),t.geometry=e,t)},Point:function(t){return e(t.coordinates)&&t},MultiPoint:function(t){var n=t.coordinates.filter(e);return n.length&&{type:t.type,coordinates:n}},LineString:function(t){var e=n(t.coordinates);return e.length&&(t=Object.create(t),t.coordinates=e,t)},MultiLineString:function(t){var e=t.coordinates.map(n).filter(function(t){return t.length});return e.length&&(t=Object.create(t),t.coordinates=e,t)},Polygon:function(t){var e=t.coordinates.map(n);return e[0].length&&(t=Object.create(t),t.coordinates=e,t)},MultiPolygon:function(t){var e=t.coordinates.map(function(t){return t.map(n)}).filter(function(t){return t[0].length});return e.length&&(t=Object.create(t),t.coordinates=e,t)},GeometryCollection:function(t){var e=t.geometries.map(l).filter(Object);return e.length&&(t=Object.create(t),t.geometries=e,t)}});return t.origin=function(e){return arguments.length?(o=e,t):o},t.angle=function(e){return arguments.length?(s=(r=+e)*Nr,t):r},t.precision=function(e){return arguments.length?(a.precision(e),t):a.precision()},t},d3.geo.greatArc=function(){function t(){for(var t="function"==typeof e?e.apply(this,arguments):e,o="function"==typeof n?n.apply(this,arguments):n,r=Fi(t,o),s=i/r.d,a=0,l=[t];(a+=s)<1;)l.push(r(a));return l.push(o),{type:"LineString",coordinates:l}}var e=Ti,n=Li,i=6*Nr;return t.distance=function(){var t="function"==typeof e?e.apply(this,arguments):e,i="function"==typeof n?n.apply(this,arguments):n;return Fi(t,i).d},t.source=function(n){return arguments.length?(e=n,t):e},t.target=function(e){return arguments.length?(n=e,t):n},t.precision=function(e){return arguments.length?(i=e*Nr,t):i/Nr},t},d3.geo.greatCircle=d3.geo.circle,d3.geom={},d3.geom.contour=function(t,e){var n=e||Gi(t),i=[],o=n[0],r=n[1],s=0,a=0,l=0/0,c=0/0,u=0;do u=0,t(o-1,r-1)&&(u+=1),t(o,r-1)&&(u+=2),t(o-1,r)&&(u+=4),t(o,r)&&(u+=8),6===u?(s=-1===c?-1:1,a=0):9===u?(s=0,a=1===l?-1:1):(s=Rr[u],a=Er[u]),s!=l&&a!=c&&(i.push([o,r]),l=s,c=a),o+=s,r+=a;while(n[0]!=o||n[1]!=r);return i};var Rr=[1,0,1,1,-1,0,-1,1,0,0,0,0,-1,0,-1,0/0],Er=[0,-1,0,0,0,-1,0,0,1,-1,1,1,0,-1,0,0/0];d3.geom.hull=function(t){if(t.length<3)return[];var e,n,i,o,r,s,a,l,c,u,h=t.length,m=h-1,p=[],f=[],y=0;for(e=1;h>e;++e)t[e][1]<t[y][1]?y=e:t[e][1]==t[y][1]&&(y=t[e][0]<t[y][0]?e:y);for(e=0;h>e;++e)e!==y&&(o=t[e][1]-t[y][1],i=t[e][0]-t[y][0],p.push({angle:Math.atan2(o,i),index:e}));for(p.sort(function(t,e){return t.angle-e.angle}),c=p[0].angle,l=p[0].index,a=0,e=1;m>e;++e)n=p[e].index,c==p[e].angle?(i=t[l][0]-t[y][0],o=t[l][1]-t[y][1],r=t[n][0]-t[y][0],s=t[n][1]-t[y][1],i*i+o*o>=r*r+s*s?p[e].index=-1:(p[a].index=-1,c=p[e].angle,a=e,l=n)):(c=p[e].angle,a=e,l=n);for(f.push(y),e=0,n=0;2>e;++n)-1!==p[n].index&&(f.push(p[n].index),e++);for(u=f.length;m>n;++n)if(-1!==p[n].index){for(;!Pi(f[u-2],f[u-1],p[n].index,t);)--u;f[u++]=p[n].index}var d=[];for(e=0;u>e;++e)d.push(t[f[e]]);return d},d3.geom.polygon=function(t){return t.area=function(){for(var e=0,n=t.length,i=t[n-1][0]*t[0][1],o=t[n-1][1]*t[0][0];++e<n;)i+=t[e-1][0]*t[e][1],o+=t[e-1][1]*t[e][0];return.5*(o-i)},t.centroid=function(e){var n,i,o=-1,r=t.length,s=0,a=0,l=t[r-1];for(arguments.length||(e=-1/(6*t.area()));++o<r;)n=l,l=t[o],i=n[0]*l[1]-l[0]*n[1],s+=(n[0]+l[0])*i,a+=(n[1]+l[1])*i;return[s*e,a*e]},t.clip=function(e){for(var n,i,o,r,s,a,l=-1,c=t.length,u=t[c-1];++l<c;){for(n=e.slice(),e.length=0,r=t[l],s=n[(o=n.length)-1],i=-1;++i<o;)a=n[i],ki(a,u,r)?(ki(s,u,r)||e.push(Ni(s,a,u,r)),e.push(a)):ki(s,u,r)&&e.push(Ni(s,a,u,r)),s=a;u=r}return e},t},d3.geom.voronoi=function(t){var e=t.map(function(){return[]});return Ji(t,function(t){var n,i,o,r,s,a;1===t.a&&t.b>=0?(n=t.ep.r,i=t.ep.l):(n=t.ep.l,i=t.ep.r),1===t.a?(s=n?n.y:-1e6,o=t.c-t.b*s,a=i?i.y:1e6,r=t.c-t.b*a):(o=n?n.x:-1e6,s=t.c-t.a*o,r=i?i.x:1e6,a=t.c-t.a*r);var l=[o,s],c=[r,a];e[t.region.l.index].push(l,c),e[t.region.r.index].push(l,c)}),e.map(function(e,n){var i=t[n][0],o=t[n][1];return e.forEach(function(t){t.angle=Math.atan2(t[0]-i,t[1]-o)}),e.sort(function(t,e){return t.angle-e.angle}).filter(function(t,n){return!n||t.angle-e[n-1].angle>1e-10})})};var jr={l:"r",r:"l"};d3.geom.delaunay=function(t){var e=t.map(function(){return[]}),n=[];return Ji(t,function(n){e[n.region.l.index].push(t[n.region.r.index])}),e.forEach(function(e,i){var o=t[i],r=o[0],s=o[1];e.forEach(function(t){t.angle=Math.atan2(t[0]-r,t[1]-s)}),e.sort(function(t,e){return t.angle-e.angle});for(var a=0,l=e.length-1;l>a;a++)n.push([o,e[a],e[a+1]])}),n},d3.geom.quadtree=function(t,e,n,i,o){function r(t,e,n,i,o,r){if(!isNaN(e.x)&&!isNaN(e.y))if(t.leaf){var a=t.point;a?Math.abs(a.x-e.x)+Math.abs(a.y-e.y)<.01?s(t,e,n,i,o,r):(t.point=null,s(t,a,n,i,o,r),s(t,e,n,i,o,r)):t.point=e}else s(t,e,n,i,o,r)}function s(t,e,n,i,o,s){var a=.5*(n+o),l=.5*(i+s),c=e.x>=a,u=e.y>=l,h=(u<<1)+c;t.leaf=!1,t=t.nodes[h]||(t.nodes[h]=Ri()),c?n=a:o=a,u?i=l:s=l,r(t,e,n,i,o,s)}var a,l=-1,c=t.length;if(c&&isNaN(t[0].x)&&(t=t.map(ji)),arguments.length<5)if(3===arguments.length)o=i=n,n=e;else{for(e=n=1/0,i=o=-1/0;++l<c;)a=t[l],a.x<e&&(e=a.x),a.y<n&&(n=a.y),a.x>i&&(i=a.x),a.y>o&&(o=a.y);var u=i-e,h=o-n;u>h?o=n+u:i=e+h}var m=Ri();return m.add=function(t){r(m,t,e,n,i,o)},m.visit=function(t){Ei(t,m,e,n,i,o)},t.forEach(m.add),m},d3.time={};var zr=Date;zi.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){Or.setUTCDate.apply(this._,arguments)},setDay:function(){Or.setUTCDay.apply(this._,arguments)},setFullYear:function(){Or.setUTCFullYear.apply(this._,arguments)},setHours:function(){Or.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){Or.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){Or.setUTCMinutes.apply(this._,arguments)},setMonth:function(){Or.setUTCMonth.apply(this._,arguments)},setSeconds:function(){Or.setUTCSeconds.apply(this._,arguments)},setTime:function(){Or.setTime.apply(this._,arguments)}};var Or=Date.prototype;d3.time.format=function(t){function e(e){for(var i,o,r=[],s=-1,a=0;++s<n;)37==t.charCodeAt(s)&&(r.push(t.substring(a,s),(o=Hr[i=t.charAt(++s)])?o(e):i),a=s+1);return r.push(t.substring(a,s)),r.join("")}var n=t.length;return e.parse=function(e){var n={y:1900,m:0,d:1,H:0,M:0,S:0,L:0},i=Oi(n,t,e,0);if(i!=e.length)return null;"p"in n&&(n.H=n.H%12+12*n.p);var o=new zr;return o.setFullYear(n.y,n.m,n.d),o.setHours(n.H,n.M,n.S,n.L),o},e.toString=function(){return t},e};var qr=d3.format("02d"),Ur=d3.format("03d"),Wr=d3.format("04d"),Kr=d3.format("2d"),Hr={a:function(t){return d3_time_weekdays[t.getDay()].substring(0,3)},A:function(t){return d3_time_weekdays[t.getDay()]},b:function(t){return es[t.getMonth()].substring(0,3)},B:function(t){return es[t.getMonth()]},c:d3.time.format("%a %b %e %H:%M:%S %Y"),d:function(t){return qr(t.getDate())},e:function(t){return Kr(t.getDate())},H:function(t){return qr(t.getHours())},I:function(t){return qr(t.getHours()%12||12)},j:function(t){return Ur(1+d3.time.dayOfYear(t))},L:function(t){return Ur(t.getMilliseconds())},m:function(t){return qr(t.getMonth()+1)},M:function(t){return qr(t.getMinutes())},p:function(t){return t.getHours()>=12?"PM":"AM"},S:function(t){return qr(t.getSeconds())},U:function(t){return qr(d3.time.sundayOfYear(t))},w:function(t){return t.getDay()},W:function(t){return qr(d3.time.mondayOfYear(t))},x:d3.time.format("%m/%d/%y"),X:d3.time.format("%H:%M:%S"),y:function(t){return qr(t.getFullYear()%100)},Y:function(t){return Wr(t.getFullYear()%1e4)},Z:ao,"%":function(){return"%"}},Xr={a:qi,A:Ui,b:Wi,B:Ki,c:Hi,d:eo,e:eo,H:no,I:no,L:ro,m:to,M:io,p:so,S:oo,x:Xi,X:Yi,y:$i,Y:Zi},Yr=/^(?:sun|mon|tue|wed|thu|fri|sat)/i,Zr=/^(?:Sunday|Monday|Tuesday|Wednesday|Thursday|Friday|Saturday)/i;d3_time_weekdays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var $r=d3.map({jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11}),Qr=/^(?:January|February|March|April|May|June|July|August|September|October|November|December)/gi,ts=d3.map({january:0,february:1,march:2,april:3,may:4,june:5,july:6,august:7,september:8,october:9,november:10,december:11}),es=["January","February","March","April","May","June","July","August","September","October","November","December"],ns=/\s*\d+/,is=d3.map({am:0,pm:1});d3.time.format.utc=function(t){function e(t){try{zr=zi;var e=new zr;return e._=t,n(e)}finally{zr=Date}}var n=d3.time.format(t);return e.parse=function(t){try{zr=zi;var e=n.parse(t);return e&&e._}finally{zr=Date}},e.toString=n.toString,e};var os=d3.time.format.utc("%Y-%m-%dT%H:%M:%S.%LZ");d3.time.format.iso=Date.prototype.toISOString?lo:os,lo.parse=function(t){return new Date(t)},lo.toString=os.toString,d3.time.second=co(function(t){return new zr(1e3*Math.floor(t/1e3))},function(t,e){t.setTime(t.getTime()+1e3*Math.floor(e))},function(t){return t.getSeconds()}),d3.time.seconds=d3.time.second.range,d3.time.seconds.utc=d3.time.second.utc.range,d3.time.minute=co(function(t){return new zr(6e4*Math.floor(t/6e4))},function(t,e){t.setTime(t.getTime()+6e4*Math.floor(e))},function(t){return t.getMinutes()}),d3.time.minutes=d3.time.minute.range,d3.time.minutes.utc=d3.time.minute.utc.range,d3.time.hour=co(function(t){var e=t.getTimezoneOffset()/60;return new zr(36e5*(Math.floor(t/36e5-e)+e))},function(t,e){t.setTime(t.getTime()+36e5*Math.floor(e))},function(t){return t.getHours()}),d3.time.hours=d3.time.hour.range,d3.time.hours.utc=d3.time.hour.utc.range,d3.time.day=co(function(t){return new zr(t.getFullYear(),t.getMonth(),t.getDate())},function(t,e){t.setDate(t.getDate()+e)},function(t){return t.getDate()-1}),d3.time.days=d3.time.day.range,d3.time.days.utc=d3.time.day.utc.range,d3.time.dayOfYear=function(t){var e=d3.time.year(t);return Math.floor((t-e)/864e5-(t.getTimezoneOffset()-e.getTimezoneOffset())/1440)},d3_time_weekdays.forEach(function(t,e){t=t.toLowerCase(),e=7-e;var n=d3.time[t]=co(function(t){return(t=d3.time.day(t)).setDate(t.getDate()-(t.getDay()+e)%7),t},function(t,e){t.setDate(t.getDate()+7*Math.floor(e))},function(t){var n=d3.time.year(t).getDay();return Math.floor((d3.time.dayOfYear(t)+(n+e)%7)/7)-(n!==e)});d3.time[t+"s"]=n.range,d3.time[t+"s"].utc=n.utc.range,d3.time[t+"OfYear"]=function(t){var n=d3.time.year(t).getDay();return Math.floor((d3.time.dayOfYear(t)+(n+e)%7)/7)}}),d3.time.week=d3.time.sunday,d3.time.weeks=d3.time.sunday.range,d3.time.weeks.utc=d3.time.sunday.utc.range,d3.time.weekOfYear=d3.time.sundayOfYear,d3.time.month=co(function(t){return new zr(t.getFullYear(),t.getMonth(),1)},function(t,e){t.setMonth(t.getMonth()+e)},function(t){return t.getMonth()}),d3.time.months=d3.time.month.range,d3.time.months.utc=d3.time.month.utc.range,d3.time.year=co(function(t){return new zr(t.getFullYear(),0,1)},function(t,e){t.setFullYear(t.getFullYear()+e)},function(t){return t.getFullYear()}),d3.time.years=d3.time.year.range,d3.time.years.utc=d3.time.year.utc.range;var rs=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],ss=[[d3.time.second,1],[d3.time.second,5],[d3.time.second,15],[d3.time.second,30],[d3.time.minute,1],[d3.time.minute,5],[d3.time.minute,15],[d3.time.minute,30],[d3.time.hour,1],[d3.time.hour,3],[d3.time.hour,6],[d3.time.hour,12],[d3.time.day,1],[d3.time.day,2],[d3.time.week,1],[d3.time.month,1],[d3.time.month,3],[d3.time.year,1]],as=[[d3.time.format("%Y"),function(){return!0}],[d3.time.format("%B"),function(t){return t.getMonth()}],[d3.time.format("%b %d"),function(t){return 1!=t.getDate()}],[d3.time.format("%a %d"),function(t){return t.getDay()&&1!=t.getDate()}],[d3.time.format("%I %p"),function(t){return t.getHours()}],[d3.time.format("%I:%M"),function(t){return t.getMinutes()}],[d3.time.format(":%S"),function(t){return t.getSeconds()}],[d3.time.format(".%L"),function(t){return t.getMilliseconds()}]],ls=d3.scale.linear(),cs=fo(as);ss.year=function(t,e){return ls.domain(t.map(_o)).ticks(e).map(yo)},d3.time.scale=function(){return ho(d3.scale.linear(),ss,cs)};var us=ss.map(function(t){return[t[0].utc,t[1]]}),hs=[[d3.time.format.utc("%Y"),function(){return!0}],[d3.time.format.utc("%B"),function(t){return t.getUTCMonth()}],[d3.time.format.utc("%b %d"),function(t){return 1!=t.getUTCDate()}],[d3.time.format.utc("%a %d"),function(t){return t.getUTCDay()&&1!=t.getUTCDate()}],[d3.time.format.utc("%I %p"),function(t){return t.getUTCHours()}],[d3.time.format.utc("%I:%M"),function(t){return t.getUTCMinutes()}],[d3.time.format.utc(":%S"),function(t){return t.getUTCSeconds()}],[d3.time.format.utc(".%L"),function(t){return t.getUTCMilliseconds()}]],ms=fo(hs);us.year=function(t,e){return ls.domain(t.map(xo)).ticks(e).map(go)},d3.time.scale.utc=function(){return ho(d3.scale.linear(),us,ms)}}();var Box2D={};!function(t,e){function n(){}!(Object.prototype.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function&&(Object.defineProperty=function(t,e,n){n.get instanceof Function&&t.__defineGetter__(e,n.get),n.set instanceof Function&&t.__defineSetter__(e,n.set)}),t.inherit=function(t,e){n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t},t.generateCallback=function(t,e){return function(){e.apply(t,arguments)}},t.NVector=function(t){t===e&&(t=0);for(var n=Array(t||0),i=0;t>i;++i)n[i]=0;return n},t.is=function(t,n){return null===t?!1:n instanceof Function&&t instanceof n?!0:t.constructor.__implements!=e&&t.constructor.__implements[n]?!0:!1},t.parseUInt=function(t){return Math.abs(parseInt(t))}}(Box2D);var Vector=Array,Vector_a2j_Number=Box2D.NVector;"undefined"==typeof Box2D&&(Box2D={}),"undefined"==typeof Box2D.Collision&&(Box2D.Collision={}),"undefined"==typeof Box2D.Collision.Shapes&&(Box2D.Collision.Shapes={}),"undefined"==typeof Box2D.Common&&(Box2D.Common={}),"undefined"==typeof Box2D.Common.Math&&(Box2D.Common.Math={}),"undefined"==typeof Box2D.Dynamics&&(Box2D.Dynamics={}),"undefined"==typeof Box2D.Dynamics.Contacts&&(Box2D.Dynamics.Contacts={}),"undefined"==typeof Box2D.Dynamics.Controllers&&(Box2D.Dynamics.Controllers={}),"undefined"==typeof Box2D.Dynamics.Joints&&(Box2D.Dynamics.Joints={}),function(){function t(){t.b2AABB.apply(this,arguments)}function e(){e.b2Bound.apply(this,arguments)}function n(){n.b2BoundValues.apply(this,arguments),this.constructor===n&&this.b2BoundValues.apply(this,arguments)}function i(){i.b2Collision.apply(this,arguments)}function o(){o.b2ContactID.apply(this,arguments),this.constructor===o&&this.b2ContactID.apply(this,arguments)}function r(){r.b2ContactPoint.apply(this,arguments)}function s(){s.b2Distance.apply(this,arguments)}function a(){a.b2DistanceInput.apply(this,arguments)}function l(){l.b2DistanceOutput.apply(this,arguments)}function c(){c.b2DistanceProxy.apply(this,arguments)}function u(){u.b2DynamicTree.apply(this,arguments),this.constructor===u&&this.b2DynamicTree.apply(this,arguments)}function h(){h.b2DynamicTreeBroadPhase.apply(this,arguments)}function m(){m.b2DynamicTreeNode.apply(this,arguments)}function p(){p.b2DynamicTreePair.apply(this,arguments)}function f(){f.b2Manifold.apply(this,arguments),this.constructor===f&&this.b2Manifold.apply(this,arguments)}function y(){y.b2ManifoldPoint.apply(this,arguments),this.constructor===y&&this.b2ManifoldPoint.apply(this,arguments)}function d(){d.b2Point.apply(this,arguments)}function _(){_.b2RayCastInput.apply(this,arguments),this.constructor===_&&this.b2RayCastInput.apply(this,arguments)}function g(){g.b2RayCastOutput.apply(this,arguments)}function x(){x.b2Segment.apply(this,arguments)}function v(){v.b2SeparationFunction.apply(this,arguments)}function b(){b.b2Simplex.apply(this,arguments),this.constructor===b&&this.b2Simplex.apply(this,arguments)}function w(){w.b2SimplexCache.apply(this,arguments)}function D(){D.b2SimplexVertex.apply(this,arguments)}function B(){B.b2TimeOfImpact.apply(this,arguments)}function C(){C.b2TOIInput.apply(this,arguments)}function S(){S.b2WorldManifold.apply(this,arguments),this.constructor===S&&this.b2WorldManifold.apply(this,arguments)}function A(){A.ClipVertex.apply(this,arguments)}function M(){M.Features.apply(this,arguments)}function V(){V.b2CircleShape.apply(this,arguments),this.constructor===V&&this.b2CircleShape.apply(this,arguments)}function I(){I.b2EdgeChainDef.apply(this,arguments),this.constructor===I&&this.b2EdgeChainDef.apply(this,arguments)}function T(){T.b2EdgeShape.apply(this,arguments),this.constructor===T&&this.b2EdgeShape.apply(this,arguments)}function L(){L.b2MassData.apply(this,arguments)}function F(){F.b2PolygonShape.apply(this,arguments),this.constructor===F&&this.b2PolygonShape.apply(this,arguments)}function G(){G.b2Shape.apply(this,arguments),this.constructor===G&&this.b2Shape.apply(this,arguments)}function P(){P.b2Color.apply(this,arguments),this.constructor===P&&this.b2Color.apply(this,arguments)}function k(){k.b2Settings.apply(this,arguments)}function N(){N.b2Mat22.apply(this,arguments),this.constructor===N&&this.b2Mat22.apply(this,arguments)}function J(){J.b2Mat33.apply(this,arguments),this.constructor===J&&this.b2Mat33.apply(this,arguments)}function R(){R.b2Math.apply(this,arguments)}function E(){E.b2Sweep.apply(this,arguments)}function j(){j.b2Transform.apply(this,arguments),this.constructor===j&&this.b2Transform.apply(this,arguments)}function z(){z.b2Vec2.apply(this,arguments),this.constructor===z&&this.b2Vec2.apply(this,arguments)}function O(){O.b2Vec3.apply(this,arguments),this.constructor===O&&this.b2Vec3.apply(this,arguments)}function q(){q.b2Body.apply(this,arguments),this.constructor===q&&this.b2Body.apply(this,arguments)}function U(){U.b2BodyDef.apply(this,arguments),this.constructor===U&&this.b2BodyDef.apply(this,arguments)}function W(){W.b2ContactFilter.apply(this,arguments)}function K(){K.b2ContactImpulse.apply(this,arguments)}function H(){H.b2ContactListener.apply(this,arguments)}function X(){X.b2ContactManager.apply(this,arguments),this.constructor===X&&this.b2ContactManager.apply(this,arguments)}function Y(){Y.b2DebugDraw.apply(this,arguments),this.constructor===Y&&this.b2DebugDraw.apply(this,arguments)}function Z(){Z.b2DestructionListener.apply(this,arguments)}function $(){$.b2FilterData.apply(this,arguments)}function Q(){Q.b2Fixture.apply(this,arguments),this.constructor===Q&&this.b2Fixture.apply(this,arguments)}function te(){te.b2FixtureDef.apply(this,arguments),this.constructor===te&&this.b2FixtureDef.apply(this,arguments)}function ee(){ee.b2Island.apply(this,arguments),this.constructor===ee&&this.b2Island.apply(this,arguments)}function ne(){ne.b2TimeStep.apply(this,arguments)}function ie(){ie.b2World.apply(this,arguments),this.constructor===ie&&this.b2World.apply(this,arguments)}function oe(){oe.b2CircleContact.apply(this,arguments)}function re(){re.b2Contact.apply(this,arguments),this.constructor===re&&this.b2Contact.apply(this,arguments)}function se(){se.b2ContactConstraint.apply(this,arguments),this.constructor===se&&this.b2ContactConstraint.apply(this,arguments)}function ae(){ae.b2ContactConstraintPoint.apply(this,arguments)}function le(){le.b2ContactEdge.apply(this,arguments)}function ce(){ce.b2ContactFactory.apply(this,arguments),this.constructor===ce&&this.b2ContactFactory.apply(this,arguments)}function ue(){ue.b2ContactRegister.apply(this,arguments)}function he(){he.b2ContactResult.apply(this,arguments)}function me(){me.b2ContactSolver.apply(this,arguments),this.constructor===me&&this.b2ContactSolver.apply(this,arguments)}function pe(){pe.b2EdgeAndCircleContact.apply(this,arguments)}function fe(){fe.b2NullContact.apply(this,arguments),this.constructor===fe&&this.b2NullContact.apply(this,arguments)}function ye(){ye.b2PolyAndCircleContact.apply(this,arguments)}function de(){de.b2PolyAndEdgeContact.apply(this,arguments)}function _e(){_e.b2PolygonContact.apply(this,arguments)}function ge(){ge.b2PositionSolverManifold.apply(this,arguments),this.constructor===ge&&this.b2PositionSolverManifold.apply(this,arguments)}function xe(){xe.b2BuoyancyController.apply(this,arguments)}function ve(){ve.b2ConstantAccelController.apply(this,arguments)}function be(){be.b2ConstantForceController.apply(this,arguments)}function we(){we.b2Controller.apply(this,arguments)}function De(){De.b2ControllerEdge.apply(this,arguments)}function Be(){Be.b2GravityController.apply(this,arguments)}function Ce(){Ce.b2TensorDampingController.apply(this,arguments)}function Se(){Se.b2DistanceJoint.apply(this,arguments),this.constructor===Se&&this.b2DistanceJoint.apply(this,arguments)}function Ae(){Ae.b2DistanceJointDef.apply(this,arguments),this.constructor===Ae&&this.b2DistanceJointDef.apply(this,arguments)}function Me(){Me.b2FrictionJoint.apply(this,arguments),this.constructor===Me&&this.b2FrictionJoint.apply(this,arguments)}function Ve(){Ve.b2FrictionJointDef.apply(this,arguments),this.constructor===Ve&&this.b2FrictionJointDef.apply(this,arguments)}function Ie(){Ie.b2GearJoint.apply(this,arguments),this.constructor===Ie&&this.b2GearJoint.apply(this,arguments)}function Te(){Te.b2GearJointDef.apply(this,arguments),this.constructor===Te&&this.b2GearJointDef.apply(this,arguments)}function Le(){Le.b2Jacobian.apply(this,arguments)}function Fe(){Fe.b2Joint.apply(this,arguments),this.constructor===Fe&&this.b2Joint.apply(this,arguments)}function Ge(){Ge.b2JointDef.apply(this,arguments),this.constructor===Ge&&this.b2JointDef.apply(this,arguments)}function Pe(){Pe.b2JointEdge.apply(this,arguments)}function ke(){ke.b2LineJoint.apply(this,arguments),this.constructor===ke&&this.b2LineJoint.apply(this,arguments)}function Ne(){Ne.b2LineJointDef.apply(this,arguments),this.constructor===Ne&&this.b2LineJointDef.apply(this,arguments)}function Je(){Je.b2MouseJoint.apply(this,arguments),this.constructor===Je&&this.b2MouseJoint.apply(this,arguments)}function Re(){Re.b2MouseJointDef.apply(this,arguments),this.constructor===Re&&this.b2MouseJointDef.apply(this,arguments)}function Ee(){Ee.b2PrismaticJoint.apply(this,arguments),this.constructor===Ee&&this.b2PrismaticJoint.apply(this,arguments)}function je(){je.b2PrismaticJointDef.apply(this,arguments),this.constructor===je&&this.b2PrismaticJointDef.apply(this,arguments)}function ze(){ze.b2PulleyJoint.apply(this,arguments),this.constructor===ze&&this.b2PulleyJoint.apply(this,arguments)}function Oe(){Oe.b2PulleyJointDef.apply(this,arguments),this.constructor===Oe&&this.b2PulleyJointDef.apply(this,arguments)}function qe(){qe.b2RevoluteJoint.apply(this,arguments),this.constructor===qe&&this.b2RevoluteJoint.apply(this,arguments)}function Ue(){Ue.b2RevoluteJointDef.apply(this,arguments),this.constructor===Ue&&this.b2RevoluteJointDef.apply(this,arguments)}function We(){We.b2WeldJoint.apply(this,arguments),this.constructor===We&&this.b2WeldJoint.apply(this,arguments)}function Ke(){Ke.b2WeldJointDef.apply(this,arguments),this.constructor===Ke&&this.b2WeldJointDef.apply(this,arguments)}Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase",Box2D.Collision.b2AABB=t,Box2D.Collision.b2Bound=e,Box2D.Collision.b2BoundValues=n,Box2D.Collision.b2Collision=i,Box2D.Collision.b2ContactID=o,Box2D.Collision.b2ContactPoint=r,Box2D.Collision.b2Distance=s,Box2D.Collision.b2DistanceInput=a,Box2D.Collision.b2DistanceOutput=l,Box2D.Collision.b2DistanceProxy=c,Box2D.Collision.b2DynamicTree=u,Box2D.Collision.b2DynamicTreeBroadPhase=h,Box2D.Collision.b2DynamicTreeNode=m,Box2D.Collision.b2DynamicTreePair=p,Box2D.Collision.b2Manifold=f,Box2D.Collision.b2ManifoldPoint=y,Box2D.Collision.b2Point=d,Box2D.Collision.b2RayCastInput=_,Box2D.Collision.b2RayCastOutput=g,Box2D.Collision.b2Segment=x,Box2D.Collision.b2SeparationFunction=v,Box2D.Collision.b2Simplex=b,Box2D.Collision.b2SimplexCache=w,Box2D.Collision.b2SimplexVertex=D,Box2D.Collision.b2TimeOfImpact=B,Box2D.Collision.b2TOIInput=C,Box2D.Collision.b2WorldManifold=S,Box2D.Collision.ClipVertex=A,Box2D.Collision.Features=M,Box2D.Collision.Shapes.b2CircleShape=V,Box2D.Collision.Shapes.b2EdgeChainDef=I,Box2D.Collision.Shapes.b2EdgeShape=T,Box2D.Collision.Shapes.b2MassData=L,Box2D.Collision.Shapes.b2PolygonShape=F,Box2D.Collision.Shapes.b2Shape=G,Box2D.Common.b2internal="Box2D.Common.b2internal",Box2D.Common.b2Color=P,Box2D.Common.b2Settings=k,Box2D.Common.Math.b2Mat22=N,Box2D.Common.Math.b2Mat33=J,Box2D.Common.Math.b2Math=R,Box2D.Common.Math.b2Sweep=E,Box2D.Common.Math.b2Transform=j,Box2D.Common.Math.b2Vec2=z,Box2D.Common.Math.b2Vec3=O,Box2D.Dynamics.b2Body=q,Box2D.Dynamics.b2BodyDef=U,Box2D.Dynamics.b2ContactFilter=W,Box2D.Dynamics.b2ContactImpulse=K,Box2D.Dynamics.b2ContactListener=H,Box2D.Dynamics.b2ContactManager=X,Box2D.Dynamics.b2DebugDraw=Y,Box2D.Dynamics.b2DestructionListener=Z,Box2D.Dynamics.b2FilterData=$,Box2D.Dynamics.b2Fixture=Q,Box2D.Dynamics.b2FixtureDef=te,Box2D.Dynamics.b2Island=ee,Box2D.Dynamics.b2TimeStep=ne,Box2D.Dynamics.b2World=ie,Box2D.Dynamics.Contacts.b2CircleContact=oe,Box2D.Dynamics.Contacts.b2Contact=re,Box2D.Dynamics.Contacts.b2ContactConstraint=se,Box2D.Dynamics.Contacts.b2ContactConstraintPoint=ae,Box2D.Dynamics.Contacts.b2ContactEdge=le,Box2D.Dynamics.Contacts.b2ContactFactory=ce,Box2D.Dynamics.Contacts.b2ContactRegister=ue,Box2D.Dynamics.Contacts.b2ContactResult=he,Box2D.Dynamics.Contacts.b2ContactSolver=me,Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=pe,Box2D.Dynamics.Contacts.b2NullContact=fe,Box2D.Dynamics.Contacts.b2PolyAndCircleContact=ye,Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=de,Box2D.Dynamics.Contacts.b2PolygonContact=_e,Box2D.Dynamics.Contacts.b2PositionSolverManifold=ge,Box2D.Dynamics.Controllers.b2BuoyancyController=xe,Box2D.Dynamics.Controllers.b2ConstantAccelController=ve,Box2D.Dynamics.Controllers.b2ConstantForceController=be,Box2D.Dynamics.Controllers.b2Controller=we,Box2D.Dynamics.Controllers.b2ControllerEdge=De,Box2D.Dynamics.Controllers.b2GravityController=Be,Box2D.Dynamics.Controllers.b2TensorDampingController=Ce,Box2D.Dynamics.Joints.b2DistanceJoint=Se,Box2D.Dynamics.Joints.b2DistanceJointDef=Ae,Box2D.Dynamics.Joints.b2FrictionJoint=Me,Box2D.Dynamics.Joints.b2FrictionJointDef=Ve,Box2D.Dynamics.Joints.b2GearJoint=Ie,Box2D.Dynamics.Joints.b2GearJointDef=Te,Box2D.Dynamics.Joints.b2Jacobian=Le,Box2D.Dynamics.Joints.b2Joint=Fe,Box2D.Dynamics.Joints.b2JointDef=Ge,Box2D.Dynamics.Joints.b2JointEdge=Pe,Box2D.Dynamics.Joints.b2LineJoint=ke,Box2D.Dynamics.Joints.b2LineJointDef=Ne,Box2D.Dynamics.Joints.b2MouseJoint=Je,Box2D.Dynamics.Joints.b2MouseJointDef=Re,Box2D.Dynamics.Joints.b2PrismaticJoint=Ee,Box2D.Dynamics.Joints.b2PrismaticJointDef=je,Box2D.Dynamics.Joints.b2PulleyJoint=ze,Box2D.Dynamics.Joints.b2PulleyJointDef=Oe,Box2D.Dynamics.Joints.b2RevoluteJoint=qe,Box2D.Dynamics.Joints.b2RevoluteJointDef=Ue,Box2D.Dynamics.Joints.b2WeldJoint=We,Box2D.Dynamics.Joints.b2WeldJointDef=Ke}(),Box2D.postDefs=[],function(){var t=Box2D.Collision.Shapes.b2CircleShape,e=Box2D.Collision.Shapes.b2PolygonShape,n=Box2D.Collision.Shapes.b2Shape,i=Box2D.Common.b2Settings,o=Box2D.Common.Math.b2Math,r=Box2D.Common.Math.b2Sweep,s=Box2D.Common.Math.b2Transform,a=Box2D.Common.Math.b2Vec2,l=Box2D.Collision.b2AABB,c=Box2D.Collision.b2Bound,u=Box2D.Collision.b2BoundValues,h=Box2D.Collision.b2Collision,m=Box2D.Collision.b2ContactID,p=Box2D.Collision.b2ContactPoint,f=Box2D.Collision.b2Distance,y=Box2D.Collision.b2DistanceInput,d=Box2D.Collision.b2DistanceOutput,_=Box2D.Collision.b2DistanceProxy,g=Box2D.Collision.b2DynamicTree,x=Box2D.Collision.b2DynamicTreeBroadPhase,v=Box2D.Collision.b2DynamicTreeNode,b=Box2D.Collision.b2DynamicTreePair,w=Box2D.Collision.b2Manifold,D=Box2D.Collision.b2ManifoldPoint,B=Box2D.Collision.b2Point,C=Box2D.Collision.b2RayCastInput,S=Box2D.Collision.b2RayCastOutput,A=Box2D.Collision.b2Segment,M=Box2D.Collision.b2SeparationFunction,V=Box2D.Collision.b2Simplex,I=Box2D.Collision.b2SimplexCache,T=Box2D.Collision.b2SimplexVertex,L=Box2D.Collision.b2TimeOfImpact,F=Box2D.Collision.b2TOIInput,G=Box2D.Collision.b2WorldManifold,P=Box2D.Collision.ClipVertex,k=Box2D.Collision.Features,N=Box2D.Collision.IBroadPhase;l.b2AABB=function(){this.lowerBound=new a,this.upperBound=new a},l.prototype.IsValid=function(){var t=this.upperBound.y-this.lowerBound.y;return t=(t=this.upperBound.x-this.lowerBound.x>=0&&t>=0)&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},l.prototype.GetCenter=function(){return new a((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)},l.prototype.GetExtents=function(){return new a((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)},l.prototype.Contains=function(t){var e=!0;return e=(e=(e=(e=e&&this.lowerBound.x<=t.lowerBound.x)&&this.lowerBound.y<=t.lowerBound.y)&&t.upperBound.x<=this.upperBound.x)&&t.upperBound.y<=this.upperBound.y},l.prototype.RayCast=function(t,e){var n=-Number.MAX_VALUE,i=Number.MAX_VALUE,o=e.p1.x,r=e.p1.y,s=e.p2.x-e.p1.x,a=e.p2.y-e.p1.y,l=Math.abs(a),c=t.normal,u=0,h=0,m=u=0;if(m=0,Math.abs(s)<Number.MIN_VALUE){if(o<this.lowerBound.x||this.upperBound.x<o)return!1
}else if(u=1/s,h=(this.lowerBound.x-o)*u,u=(this.upperBound.x-o)*u,m=-1,h>u&&(m=h,h=u,u=m,m=1),h>n&&(c.x=m,c.y=0,n=h),i=Math.min(i,u),n>i)return!1;if(l<Number.MIN_VALUE){if(r<this.lowerBound.y||this.upperBound.y<r)return!1}else if(u=1/a,h=(this.lowerBound.y-r)*u,u=(this.upperBound.y-r)*u,m=-1,h>u&&(m=h,h=u,u=m,m=1),h>n&&(c.y=m,c.x=0,n=h),i=Math.min(i,u),n>i)return!1;return t.fraction=n,!0},l.prototype.TestOverlap=function(t){var e=t.lowerBound.y-this.upperBound.y,n=this.lowerBound.y-t.upperBound.y;return t.lowerBound.x-this.upperBound.x>0||e>0?!1:this.lowerBound.x-t.upperBound.x>0||n>0?!1:!0},l.Combine=function(t,e){var n=new l;return n.Combine(t,e),n},l.prototype.Combine=function(t,e){this.lowerBound.x=Math.min(t.lowerBound.x,e.lowerBound.x),this.lowerBound.y=Math.min(t.lowerBound.y,e.lowerBound.y),this.upperBound.x=Math.max(t.upperBound.x,e.upperBound.x),this.upperBound.y=Math.max(t.upperBound.y,e.upperBound.y)},c.b2Bound=function(){},c.prototype.IsLower=function(){return 0==(1&this.value)},c.prototype.IsUpper=function(){return 1==(1&this.value)},c.prototype.Swap=function(t){var e=this.value,n=this.proxy,i=this.stabbingCount;this.value=t.value,this.proxy=t.proxy,this.stabbingCount=t.stabbingCount,t.value=e,t.proxy=n,t.stabbingCount=i},u.b2BoundValues=function(){},u.prototype.b2BoundValues=function(){this.lowerValues=new Vector_a2j_Number,this.lowerValues[0]=0,this.lowerValues[1]=0,this.upperValues=new Vector_a2j_Number,this.upperValues[0]=0,this.upperValues[1]=0},h.b2Collision=function(){},h.ClipSegmentToLine=function(t,e,n,i){void 0===i&&(i=0);var o,r=0;o=e[0];var s=o.v;o=e[1];var a=o.v,l=n.x*s.x+n.y*s.y-i;return o=n.x*a.x+n.y*a.y-i,0>=l&&t[r++].Set(e[0]),0>=o&&t[r++].Set(e[1]),0>l*o&&(n=l/(l-o),o=t[r],o=o.v,o.x=s.x+n*(a.x-s.x),o.y=s.y+n*(a.y-s.y),o=t[r],o.id=(l>0?e[0]:e[1]).id,++r),r},h.EdgeSeparation=function(t,e,n,i,o){void 0===n&&(n=0),parseInt(t.m_vertexCount);var r=t.m_vertices;t=t.m_normals;var s,a,l=parseInt(i.m_vertexCount),c=i.m_vertices;s=e.R,a=t[n],t=s.col1.x*a.x+s.col2.x*a.y,i=s.col1.y*a.x+s.col2.y*a.y,s=o.R;var u=s.col1.x*t+s.col1.y*i;s=s.col2.x*t+s.col2.y*i;for(var h=0,m=Number.MAX_VALUE,p=0;l>p;++p)a=c[p],a=a.x*u+a.y*s,m>a&&(m=a,h=p);return a=r[n],s=e.R,n=e.position.x+(s.col1.x*a.x+s.col2.x*a.y),e=e.position.y+(s.col1.y*a.x+s.col2.y*a.y),a=c[h],s=o.R,r=o.position.x+(s.col1.x*a.x+s.col2.x*a.y),o=o.position.y+(s.col1.y*a.x+s.col2.y*a.y),r-=n,o-=e,r*t+o*i},h.FindMaxSeparation=function(t,e,n,i,o){var r,s,a=parseInt(e.m_vertexCount),l=e.m_normals;s=o.R,r=i.m_centroid;var c=o.position.x+(s.col1.x*r.x+s.col2.x*r.y),u=o.position.y+(s.col1.y*r.x+s.col2.y*r.y);s=n.R,r=e.m_centroid,c-=n.position.x+(s.col1.x*r.x+s.col2.x*r.y),u-=n.position.y+(s.col1.y*r.x+s.col2.y*r.y),s=c*n.R.col1.x+u*n.R.col1.y,u=c*n.R.col2.x+u*n.R.col2.y,c=0;for(var m=-Number.MAX_VALUE,p=0;a>p;++p)r=l[p],r=r.x*s+r.y*u,r>m&&(m=r,c=p);l=h.EdgeSeparation(e,n,c,i,o),r=parseInt(c-1>=0?c-1:a-1),s=h.EdgeSeparation(e,n,r,i,o),u=parseInt(a>c+1?c+1:0),m=h.EdgeSeparation(e,n,u,i,o);var f=p=0,y=0;if(s>l&&s>m)y=-1,p=r,f=s;else{if(!(m>l))return t[0]=c,l;y=1,p=u,f=m}for(;c=-1==y?p-1>=0?p-1:a-1:a>p+1?p+1:0,l=h.EdgeSeparation(e,n,c,i,o),l>f;)p=c,f=l;return t[0]=p,f},h.FindIncidentEdge=function(t,e,n,i,o,r){void 0===i&&(i=0),parseInt(e.m_vertexCount);var s=e.m_normals,a=parseInt(o.m_vertexCount);e=o.m_vertices,o=o.m_normals;var l;l=n.R,n=s[i],s=l.col1.x*n.x+l.col2.x*n.y;var c=l.col1.y*n.x+l.col2.y*n.y;l=r.R,n=l.col1.x*s+l.col1.y*c,c=l.col2.x*s+l.col2.y*c,s=n,l=0;for(var u=Number.MAX_VALUE,h=0;a>h;++h)n=o[h],n=s*n.x+c*n.y,u>n&&(u=n,l=h);o=parseInt(l),s=parseInt(a>o+1?o+1:0),a=t[0],n=e[o],l=r.R,a.v.x=r.position.x+(l.col1.x*n.x+l.col2.x*n.y),a.v.y=r.position.y+(l.col1.y*n.x+l.col2.y*n.y),a.id.features.referenceEdge=i,a.id.features.incidentEdge=o,a.id.features.incidentVertex=0,a=t[1],n=e[s],l=r.R,a.v.x=r.position.x+(l.col1.x*n.x+l.col2.x*n.y),a.v.y=r.position.y+(l.col1.y*n.x+l.col2.y*n.y),a.id.features.referenceEdge=i,a.id.features.incidentEdge=s,a.id.features.incidentVertex=1},h.MakeClipPointVector=function(){var t=new Vector(2);return t[0]=new P,t[1]=new P,t},h.CollidePolygons=function(t,e,n,o,r){var s;t.m_pointCount=0;var a=e.m_radius+o.m_radius;s=0,h.s_edgeAO[0]=s;var l=h.FindMaxSeparation(h.s_edgeAO,e,n,o,r);if(s=h.s_edgeAO[0],!(l>a)){var c=0;h.s_edgeBO[0]=c;var u=h.FindMaxSeparation(h.s_edgeBO,o,r,e,n);if(c=h.s_edgeBO[0],!(u>a)){var m=0,p=0;u>.98*l+.001?(l=o,o=e,e=r,n=n,m=c,t.m_type=w.e_faceB,p=1):(l=e,o=o,e=n,n=r,m=s,t.m_type=w.e_faceA,p=0),s=h.s_incidentEdge,h.FindIncidentEdge(s,l,e,m,o,n),c=parseInt(l.m_vertexCount),r=l.m_vertices,l=r[m];var f;f=c>m+1?r[parseInt(m+1)]:r[0],m=h.s_localTangent,m.Set(f.x-l.x,f.y-l.y),m.Normalize(),r=h.s_localNormal,r.x=m.y,r.y=-m.x,o=h.s_planePoint,o.Set(.5*(l.x+f.x),.5*(l.y+f.y)),u=h.s_tangent,c=e.R,u.x=c.col1.x*m.x+c.col2.x*m.y,u.y=c.col1.y*m.x+c.col2.y*m.y;var y=h.s_tangent2;y.x=-u.x,y.y=-u.y,m=h.s_normal,m.x=u.y,m.y=-u.x;var d=h.s_v11,_=h.s_v12;if(d.x=e.position.x+(c.col1.x*l.x+c.col2.x*l.y),d.y=e.position.y+(c.col1.y*l.x+c.col2.y*l.y),_.x=e.position.x+(c.col1.x*f.x+c.col2.x*f.y),_.y=e.position.y+(c.col1.y*f.x+c.col2.y*f.y),e=m.x*d.x+m.y*d.y,c=u.x*_.x+u.y*_.y+a,f=h.s_clipPoints1,l=h.s_clipPoints2,_=0,_=h.ClipSegmentToLine(f,s,y,-u.x*d.x-u.y*d.y+a),!(2>_||(_=h.ClipSegmentToLine(l,f,u,c),2>_))){for(t.m_localPlaneNormal.SetV(r),t.m_localPoint.SetV(o),o=r=0;o<i.b2_maxManifoldPoints;++o)s=l[o],m.x*s.v.x+m.y*s.v.y-e<=a&&(u=t.m_points[r],c=n.R,y=s.v.x-n.position.x,d=s.v.y-n.position.y,u.m_localPoint.x=y*c.col1.x+d*c.col1.y,u.m_localPoint.y=y*c.col2.x+d*c.col2.y,u.m_id.Set(s.id),u.m_id.features.flip=p,++r);t.m_pointCount=r}}}},h.CollideCircles=function(t,e,n,i,o){t.m_pointCount=0;var r,s;r=n.R,s=e.m_p;var a=n.position.x+(r.col1.x*s.x+r.col2.x*s.y);n=n.position.y+(r.col1.y*s.x+r.col2.y*s.y),r=o.R,s=i.m_p,a=o.position.x+(r.col1.x*s.x+r.col2.x*s.y)-a,o=o.position.y+(r.col1.y*s.x+r.col2.y*s.y)-n,r=e.m_radius+i.m_radius,a*a+o*o>r*r||(t.m_type=w.e_circles,t.m_localPoint.SetV(e.m_p),t.m_localPlaneNormal.SetZero(),t.m_pointCount=1,t.m_points[0].m_localPoint.SetV(i.m_p),t.m_points[0].m_id.key=0)},h.CollidePolygonAndCircle=function(t,e,n,i,o){var r,s,a=t.m_pointCount=0,l=0;s=o.R,r=i.m_p;var c=o.position.y+(s.col1.y*r.x+s.col2.y*r.y);a=o.position.x+(s.col1.x*r.x+s.col2.x*r.y)-n.position.x,l=c-n.position.y,s=n.R,n=a*s.col1.x+l*s.col1.y,s=a*s.col2.x+l*s.col2.y;var u=0;c=-Number.MAX_VALUE,o=e.m_radius+i.m_radius;var h=parseInt(e.m_vertexCount),m=e.m_vertices;e=e.m_normals;for(var p=0;h>p;++p){if(r=m[p],a=n-r.x,l=s-r.y,r=e[p],a=r.x*a+r.y*l,a>o)return;a>c&&(c=a,u=p)}if(a=parseInt(u),l=parseInt(h>a+1?a+1:0),r=m[a],m=m[l],c<Number.MIN_VALUE)t.m_pointCount=1,t.m_type=w.e_faceA,t.m_localPlaneNormal.SetV(e[u]),t.m_localPoint.x=.5*(r.x+m.x),t.m_localPoint.y=.5*(r.y+m.y);else if(c=(n-m.x)*(r.x-m.x)+(s-m.y)*(r.y-m.y),(n-r.x)*(m.x-r.x)+(s-r.y)*(m.y-r.y)<=0){if((n-r.x)*(n-r.x)+(s-r.y)*(s-r.y)>o*o)return;t.m_pointCount=1,t.m_type=w.e_faceA,t.m_localPlaneNormal.x=n-r.x,t.m_localPlaneNormal.y=s-r.y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.SetV(r)}else if(0>=c){if((n-m.x)*(n-m.x)+(s-m.y)*(s-m.y)>o*o)return;t.m_pointCount=1,t.m_type=w.e_faceA,t.m_localPlaneNormal.x=n-m.x,t.m_localPlaneNormal.y=s-m.y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.SetV(m)}else{if(u=.5*(r.x+m.x),r=.5*(r.y+m.y),c=(n-u)*e[a].x+(s-r)*e[a].y,c>o)return;t.m_pointCount=1,t.m_type=w.e_faceA,t.m_localPlaneNormal.x=e[a].x,t.m_localPlaneNormal.y=e[a].y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.Set(u,r)}t.m_points[0].m_localPoint.SetV(i.m_p),t.m_points[0].m_id.key=0},h.TestOverlap=function(t,e){var n=e.lowerBound,i=t.upperBound,o=n.x-i.x,r=n.y-i.y;n=t.lowerBound,i=e.upperBound;var s=n.y-i.y;return o>0||r>0?!1:n.x-i.x>0||s>0?!1:!0},Box2D.postDefs.push(function(){Box2D.Collision.b2Collision.s_incidentEdge=h.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints1=h.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints2=h.MakeClipPointVector(),Box2D.Collision.b2Collision.s_edgeAO=new Vector_a2j_Number(1),Box2D.Collision.b2Collision.s_edgeBO=new Vector_a2j_Number(1),Box2D.Collision.b2Collision.s_localTangent=new a,Box2D.Collision.b2Collision.s_localNormal=new a,Box2D.Collision.b2Collision.s_planePoint=new a,Box2D.Collision.b2Collision.s_normal=new a,Box2D.Collision.b2Collision.s_tangent=new a,Box2D.Collision.b2Collision.s_tangent2=new a,Box2D.Collision.b2Collision.s_v11=new a,Box2D.Collision.b2Collision.s_v12=new a,Box2D.Collision.b2Collision.b2CollidePolyTempVec=new a,Box2D.Collision.b2Collision.b2_nullFeature=255}),m.b2ContactID=function(){this.features=new k},m.prototype.b2ContactID=function(){this.features._m_id=this},m.prototype.Set=function(t){this.key=t._key},m.prototype.Copy=function(){var t=new m;return t.key=this.key,t},Object.defineProperty(m.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key}}),Object.defineProperty(m.prototype,"key",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._key=t,this.features._referenceEdge=255&this._key,this.features._incidentEdge=(65280&this._key)>>8&255,this.features._incidentVertex=(16711680&this._key)>>16&255,this.features._flip=(4278190080&this._key)>>24&255}}),p.b2ContactPoint=function(){this.position=new a,this.velocity=new a,this.normal=new a,this.id=new m},f.b2Distance=function(){},f.Distance=function(t,e,n){++f.b2_gjkCalls;var r=n.proxyA,s=n.proxyB,l=n.transformA,c=n.transformB,u=f.s_simplex;u.ReadCache(e,r,l,s,c);var h=u.m_vertices,m=f.s_saveA,p=f.s_saveB,y=0;u.GetClosestPoint().LengthSquared();for(var d,_=0,g=0;20>g;){for(y=u.m_count,_=0;y>_;_++)m[_]=h[_].indexA,p[_]=h[_].indexB;switch(u.m_count){case 1:break;case 2:u.Solve2();break;case 3:u.Solve3();break;default:i.b2Assert(!1)}if(3==u.m_count)break;if(d=u.GetClosestPoint(),d.LengthSquared(),_=u.GetSearchDirection(),_.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;d=h[u.m_count],d.indexA=r.GetSupport(o.MulTMV(l.R,_.GetNegative())),d.wA=o.MulX(l,r.GetVertex(d.indexA)),d.indexB=s.GetSupport(o.MulTMV(c.R,_)),d.wB=o.MulX(c,s.GetVertex(d.indexB)),d.w=o.SubtractVV(d.wB,d.wA),++g,++f.b2_gjkIters;var x=!1;for(_=0;y>_;_++)if(d.indexA==m[_]&&d.indexB==p[_]){x=!0;break}if(x)break;++u.m_count}f.b2_gjkMaxIters=o.Max(f.b2_gjkMaxIters,g),u.GetWitnessPoints(t.pointA,t.pointB),t.distance=o.SubtractVV(t.pointA,t.pointB).Length(),t.iterations=g,u.WriteCache(e),n.useRadii&&(e=r.m_radius,s=s.m_radius,t.distance>e+s&&t.distance>Number.MIN_VALUE?(t.distance-=e+s,n=o.SubtractVV(t.pointB,t.pointA),n.Normalize(),t.pointA.x+=e*n.x,t.pointA.y+=e*n.y,t.pointB.x-=s*n.x,t.pointB.y-=s*n.y):(d=new a,d.x=.5*(t.pointA.x+t.pointB.x),d.y=.5*(t.pointA.y+t.pointB.y),t.pointA.x=t.pointB.x=d.x,t.pointA.y=t.pointB.y=d.y,t.distance=0))},Box2D.postDefs.push(function(){Box2D.Collision.b2Distance.s_simplex=new V,Box2D.Collision.b2Distance.s_saveA=new Vector_a2j_Number(3),Box2D.Collision.b2Distance.s_saveB=new Vector_a2j_Number(3)}),y.b2DistanceInput=function(){},d.b2DistanceOutput=function(){this.pointA=new a,this.pointB=new a},_.b2DistanceProxy=function(){},_.prototype.Set=function(o){switch(o.GetType()){case n.e_circleShape:o=o instanceof t?o:null,this.m_vertices=new Vector(1,!0),this.m_vertices[0]=o.m_p,this.m_count=1,this.m_radius=o.m_radius;break;case n.e_polygonShape:o=o instanceof e?o:null,this.m_vertices=o.m_vertices,this.m_count=o.m_vertexCount,this.m_radius=o.m_radius;break;default:i.b2Assert(!1)}},_.prototype.GetSupport=function(t){for(var e=0,n=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,i=1;i<this.m_count;++i){var o=this.m_vertices[i].x*t.x+this.m_vertices[i].y*t.y;o>n&&(e=i,n=o)}return e},_.prototype.GetSupportVertex=function(t){for(var e=0,n=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,i=1;i<this.m_count;++i){var o=this.m_vertices[i].x*t.x+this.m_vertices[i].y*t.y;o>n&&(e=i,n=o)}return this.m_vertices[e]},_.prototype.GetVertexCount=function(){return this.m_count},_.prototype.GetVertex=function(t){return void 0===t&&(t=0),i.b2Assert(t>=0&&t<this.m_count),this.m_vertices[t]},g.b2DynamicTree=function(){},g.prototype.b2DynamicTree=function(){this.m_freeList=this.m_root=null,this.m_insertionCount=this.m_path=0},g.prototype.CreateProxy=function(t,e){var n=this.AllocateNode(),o=i.b2_aabbExtension,r=i.b2_aabbExtension;return n.aabb.lowerBound.x=t.lowerBound.x-o,n.aabb.lowerBound.y=t.lowerBound.y-r,n.aabb.upperBound.x=t.upperBound.x+o,n.aabb.upperBound.y=t.upperBound.y+r,n.userData=e,this.InsertLeaf(n),n},g.prototype.DestroyProxy=function(t){this.RemoveLeaf(t),this.FreeNode(t)},g.prototype.MoveProxy=function(t,e,n){if(i.b2Assert(t.IsLeaf()),t.aabb.Contains(e))return!1;this.RemoveLeaf(t);var o=i.b2_aabbExtension+i.b2_aabbMultiplier*(n.x>0?n.x:-n.x);return n=i.b2_aabbExtension+i.b2_aabbMultiplier*(n.y>0?n.y:-n.y),t.aabb.lowerBound.x=e.lowerBound.x-o,t.aabb.lowerBound.y=e.lowerBound.y-n,t.aabb.upperBound.x=e.upperBound.x+o,t.aabb.upperBound.y=e.upperBound.y+n,this.InsertLeaf(t),!0},g.prototype.Rebalance=function(t){if(void 0===t&&(t=0),null!=this.m_root)for(var e=0;t>e;e++){for(var n=this.m_root,i=0;0==n.IsLeaf();)n=this.m_path>>i&1?n.child2:n.child1,i=i+1&31;++this.m_path,this.RemoveLeaf(n),this.InsertLeaf(n)}},g.prototype.GetFatAABB=function(t){return t.aabb},g.prototype.GetUserData=function(t){return t.userData},g.prototype.Query=function(t,e){if(null!=this.m_root){var n=new Vector,i=0;for(n[i++]=this.m_root;i>0;){var o=n[--i];if(o.aabb.TestOverlap(e))if(o.IsLeaf()){if(!t(o))break}else n[i++]=o.child1,n[i++]=o.child2}}},g.prototype.RayCast=function(t,e){if(null!=this.m_root){var n=e.p1,i=e.p2,r=o.SubtractVV(n,i);r.Normalize(),r=o.CrossFV(1,r);var s=o.AbsV(r),a=e.maxFraction,c=new l,u=0,h=0;u=n.x+a*(i.x-n.x),h=n.y+a*(i.y-n.y),c.lowerBound.x=Math.min(n.x,u),c.lowerBound.y=Math.min(n.y,h),c.upperBound.x=Math.max(n.x,u),c.upperBound.y=Math.max(n.y,h);var m=new Vector,p=0;for(m[p++]=this.m_root;p>0;)if(a=m[--p],0!=a.aabb.TestOverlap(c)&&(u=a.aabb.GetCenter(),h=a.aabb.GetExtents(),!(Math.abs(r.x*(n.x-u.x)+r.y*(n.y-u.y))-s.x*h.x-s.y*h.y>0)))if(a.IsLeaf()){if(u=new C,u.p1=e.p1,u.p2=e.p2,u.maxFraction=e.maxFraction,a=t(u,a),0==a)break;a>0&&(u=n.x+a*(i.x-n.x),h=n.y+a*(i.y-n.y),c.lowerBound.x=Math.min(n.x,u),c.lowerBound.y=Math.min(n.y,h),c.upperBound.x=Math.max(n.x,u),c.upperBound.y=Math.max(n.y,h))}else m[p++]=a.child1,m[p++]=a.child2}},g.prototype.AllocateNode=function(){if(this.m_freeList){var t=this.m_freeList;return this.m_freeList=t.parent,t.parent=null,t.child1=null,t.child2=null,t}return new v},g.prototype.FreeNode=function(t){t.parent=this.m_freeList,this.m_freeList=t},g.prototype.InsertLeaf=function(t){if(++this.m_insertionCount,null==this.m_root)this.m_root=t,this.m_root.parent=null;else{var e=t.aabb.GetCenter(),n=this.m_root;if(0==n.IsLeaf())do{var i=n.child1;n=n.child2,n=Math.abs((i.aabb.lowerBound.x+i.aabb.upperBound.x)/2-e.x)+Math.abs((i.aabb.lowerBound.y+i.aabb.upperBound.y)/2-e.y)<Math.abs((n.aabb.lowerBound.x+n.aabb.upperBound.x)/2-e.x)+Math.abs((n.aabb.lowerBound.y+n.aabb.upperBound.y)/2-e.y)?i:n}while(0==n.IsLeaf());if(e=n.parent,i=this.AllocateNode(),i.parent=e,i.userData=null,i.aabb.Combine(t.aabb,n.aabb),e){n.parent.child1==n?e.child1=i:e.child2=i,i.child1=n,i.child2=t,n.parent=i,t.parent=i;do{if(e.aabb.Contains(i.aabb))break;e.aabb.Combine(e.child1.aabb,e.child2.aabb),i=e,e=e.parent}while(e)}else i.child1=n,i.child2=t,n.parent=i,this.m_root=t.parent=i}},g.prototype.RemoveLeaf=function(t){if(t==this.m_root)this.m_root=null;else{var e=t.parent,n=e.parent;if(t=e.child1==t?e.child2:e.child1,n)for(n.child1==e?n.child1=t:n.child2=t,t.parent=n,this.FreeNode(e);n&&(e=n.aabb,n.aabb=l.Combine(n.child1.aabb,n.child2.aabb),!e.Contains(n.aabb));)n=n.parent;else this.m_root=t,t.parent=null,this.FreeNode(e)}},x.b2DynamicTreeBroadPhase=function(){this.m_tree=new g,this.m_moveBuffer=new Vector,this.m_pairBuffer=new Vector,this.m_pairCount=0},x.prototype.CreateProxy=function(t,e){var n=this.m_tree.CreateProxy(t,e);return++this.m_proxyCount,this.BufferMove(n),n},x.prototype.DestroyProxy=function(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)},x.prototype.MoveProxy=function(t,e,n){this.m_tree.MoveProxy(t,e,n)&&this.BufferMove(t)},x.prototype.TestOverlap=function(t,e){var n=this.m_tree.GetFatAABB(t),i=this.m_tree.GetFatAABB(e);return n.TestOverlap(i)},x.prototype.GetUserData=function(t){return this.m_tree.GetUserData(t)},x.prototype.GetFatAABB=function(t){return this.m_tree.GetFatAABB(t)},x.prototype.GetProxyCount=function(){return this.m_proxyCount},x.prototype.UpdatePairs=function(t){var e,n=this,i=n.m_pairCount=0;for(i=0;i<n.m_moveBuffer.length;++i){e=n.m_moveBuffer[i];var o=n.m_tree.GetFatAABB(e);n.m_tree.Query(function(t){if(t==e)return!0;n.m_pairCount==n.m_pairBuffer.length&&(n.m_pairBuffer[n.m_pairCount]=new b);var i=n.m_pairBuffer[n.m_pairCount];return i.proxyA=e>t?t:e,i.proxyB=t>=e?t:e,++n.m_pairCount,!0},o)}for(i=n.m_moveBuffer.length=0;i<n.m_pairCount;){o=n.m_pairBuffer[i];var r=n.m_tree.GetUserData(o.proxyA),s=n.m_tree.GetUserData(o.proxyB);for(t(r,s),++i;i<n.m_pairCount&&(r=n.m_pairBuffer[i],r.proxyA==o.proxyA&&r.proxyB==o.proxyB);)++i}},x.prototype.Query=function(t,e){this.m_tree.Query(t,e)},x.prototype.RayCast=function(t,e){this.m_tree.RayCast(t,e)},x.prototype.Validate=function(){},x.prototype.Rebalance=function(t){void 0===t&&(t=0),this.m_tree.Rebalance(t)},x.prototype.BufferMove=function(t){this.m_moveBuffer[this.m_moveBuffer.length]=t},x.prototype.UnBufferMove=function(t){this.m_moveBuffer.splice(parseInt(this.m_moveBuffer.indexOf(t)),1)},x.prototype.ComparePairs=function(){return 0},x.__implements={},x.__implements[N]=!0,v.b2DynamicTreeNode=function(){this.aabb=new l},v.prototype.IsLeaf=function(){return null==this.child1},b.b2DynamicTreePair=function(){},w.b2Manifold=function(){this.m_pointCount=0},w.prototype.b2Manifold=function(){this.m_points=new Vector(i.b2_maxManifoldPoints);for(var t=0;t<i.b2_maxManifoldPoints;t++)this.m_points[t]=new D;this.m_localPlaneNormal=new a,this.m_localPoint=new a},w.prototype.Reset=function(){for(var t=0;t<i.b2_maxManifoldPoints;t++)(this.m_points[t]instanceof D?this.m_points[t]:null).Reset();this.m_localPlaneNormal.SetZero(),this.m_localPoint.SetZero(),this.m_pointCount=this.m_type=0},w.prototype.Set=function(t){this.m_pointCount=t.m_pointCount;for(var e=0;e<i.b2_maxManifoldPoints;e++)(this.m_points[e]instanceof D?this.m_points[e]:null).Set(t.m_points[e]);this.m_localPlaneNormal.SetV(t.m_localPlaneNormal),this.m_localPoint.SetV(t.m_localPoint),this.m_type=t.m_type},w.prototype.Copy=function(){var t=new w;return t.Set(this),t},Box2D.postDefs.push(function(){Box2D.Collision.b2Manifold.e_circles=1,Box2D.Collision.b2Manifold.e_faceA=2,Box2D.Collision.b2Manifold.e_faceB=4}),D.b2ManifoldPoint=function(){this.m_localPoint=new a,this.m_id=new m},D.prototype.b2ManifoldPoint=function(){this.Reset()},D.prototype.Reset=function(){this.m_localPoint.SetZero(),this.m_tangentImpulse=this.m_normalImpulse=0,this.m_id.key=0},D.prototype.Set=function(t){this.m_localPoint.SetV(t.m_localPoint),this.m_normalImpulse=t.m_normalImpulse,this.m_tangentImpulse=t.m_tangentImpulse,this.m_id.Set(t.m_id)},B.b2Point=function(){this.p=new a},B.prototype.Support=function(){return this.p},B.prototype.GetFirstVertex=function(){return this.p},C.b2RayCastInput=function(){this.p1=new a,this.p2=new a},C.prototype.b2RayCastInput=function(t,e,n){void 0===t&&(t=null),void 0===e&&(e=null),void 0===n&&(n=1),t&&this.p1.SetV(t),e&&this.p2.SetV(e),this.maxFraction=n},S.b2RayCastOutput=function(){this.normal=new a},A.b2Segment=function(){this.p1=new a,this.p2=new a},A.prototype.TestSegment=function(t,e,n,i){void 0===i&&(i=0);var o=n.p1,r=n.p2.x-o.x,s=n.p2.y-o.y;n=this.p2.y-this.p1.y;var a=-(this.p2.x-this.p1.x),l=100*Number.MIN_VALUE,c=-(r*n+s*a);if(c>l){var u=o.x-this.p1.x,h=o.y-this.p1.y;if(o=u*n+h*a,o>=0&&i*c>=o&&(i=-r*h+s*u,i>=-l*c&&c*(1+l)>=i))return o/=c,i=Math.sqrt(n*n+a*a),n/=i,a/=i,t[0]=o,e.Set(n,a),!0}return!1},A.prototype.Extend=function(t){this.ExtendForward(t),this.ExtendBackward(t)},A.prototype.ExtendForward=function(t){var e=this.p2.x-this.p1.x,n=this.p2.y-this.p1.y;t=Math.min(e>0?(t.upperBound.x-this.p1.x)/e:0>e?(t.lowerBound.x-this.p1.x)/e:Number.POSITIVE_INFINITY,n>0?(t.upperBound.y-this.p1.y)/n:0>n?(t.lowerBound.y-this.p1.y)/n:Number.POSITIVE_INFINITY),this.p2.x=this.p1.x+e*t,this.p2.y=this.p1.y+n*t},A.prototype.ExtendBackward=function(t){var e=-this.p2.x+this.p1.x,n=-this.p2.y+this.p1.y;t=Math.min(e>0?(t.upperBound.x-this.p2.x)/e:0>e?(t.lowerBound.x-this.p2.x)/e:Number.POSITIVE_INFINITY,n>0?(t.upperBound.y-this.p2.y)/n:0>n?(t.lowerBound.y-this.p2.y)/n:Number.POSITIVE_INFINITY),this.p1.x=this.p2.x+e*t,this.p1.y=this.p2.y+n*t},M.b2SeparationFunction=function(){this.m_localPoint=new a,this.m_axis=new a},M.prototype.Initialize=function(t,e,n,r,s){this.m_proxyA=e,this.m_proxyB=r;var l=parseInt(t.count);i.b2Assert(l>0&&3>l);var c,u,h,m,p=m=h=r=e=0,f=0;p=0,1==l?(this.m_type=M.e_points,c=this.m_proxyA.GetVertex(t.indexA[0]),u=this.m_proxyB.GetVertex(t.indexB[0]),l=c,t=n.R,e=n.position.x+(t.col1.x*l.x+t.col2.x*l.y),r=n.position.y+(t.col1.y*l.x+t.col2.y*l.y),l=u,t=s.R,h=s.position.x+(t.col1.x*l.x+t.col2.x*l.y),m=s.position.y+(t.col1.y*l.x+t.col2.y*l.y),this.m_axis.x=h-e,this.m_axis.y=m-r,this.m_axis.Normalize()):(t.indexB[0]==t.indexB[1]?(this.m_type=M.e_faceA,e=this.m_proxyA.GetVertex(t.indexA[0]),r=this.m_proxyA.GetVertex(t.indexA[1]),u=this.m_proxyB.GetVertex(t.indexB[0]),this.m_localPoint.x=.5*(e.x+r.x),this.m_localPoint.y=.5*(e.y+r.y),this.m_axis=o.CrossVF(o.SubtractVV(r,e),1),this.m_axis.Normalize(),l=this.m_axis,t=n.R,p=t.col1.x*l.x+t.col2.x*l.y,f=t.col1.y*l.x+t.col2.y*l.y,l=this.m_localPoint,t=n.R,e=n.position.x+(t.col1.x*l.x+t.col2.x*l.y),r=n.position.y+(t.col1.y*l.x+t.col2.y*l.y),l=u,t=s.R,h=s.position.x+(t.col1.x*l.x+t.col2.x*l.y),m=s.position.y+(t.col1.y*l.x+t.col2.y*l.y),p=(h-e)*p+(m-r)*f):t.indexA[0]==t.indexA[0]?(this.m_type=M.e_faceB,h=this.m_proxyB.GetVertex(t.indexB[0]),m=this.m_proxyB.GetVertex(t.indexB[1]),c=this.m_proxyA.GetVertex(t.indexA[0]),this.m_localPoint.x=.5*(h.x+m.x),this.m_localPoint.y=.5*(h.y+m.y),this.m_axis=o.CrossVF(o.SubtractVV(m,h),1),this.m_axis.Normalize(),l=this.m_axis,t=s.R,p=t.col1.x*l.x+t.col2.x*l.y,f=t.col1.y*l.x+t.col2.y*l.y,l=this.m_localPoint,t=s.R,h=s.position.x+(t.col1.x*l.x+t.col2.x*l.y),m=s.position.y+(t.col1.y*l.x+t.col2.y*l.y),l=c,t=n.R,e=n.position.x+(t.col1.x*l.x+t.col2.x*l.y),r=n.position.y+(t.col1.y*l.x+t.col2.y*l.y),p=(e-h)*p+(r-m)*f):(e=this.m_proxyA.GetVertex(t.indexA[0]),r=this.m_proxyA.GetVertex(t.indexA[1]),h=this.m_proxyB.GetVertex(t.indexB[0]),m=this.m_proxyB.GetVertex(t.indexB[1]),o.MulX(n,c),c=o.MulMV(n.R,o.SubtractVV(r,e)),o.MulX(s,u),p=o.MulMV(s.R,o.SubtractVV(m,h)),s=c.x*c.x+c.y*c.y,u=p.x*p.x+p.y*p.y,t=o.SubtractVV(p,c),n=c.x*t.x+c.y*t.y,t=p.x*t.x+p.y*t.y,c=c.x*p.x+c.y*p.y,f=s*u-c*c,p=0,0!=f&&(p=o.Clamp((c*t-n*u)/f,0,1)),0>(c*p+t)/u&&(p=o.Clamp((c-n)/s,0,1)),c=new a,c.x=e.x+p*(r.x-e.x),c.y=e.y+p*(r.y-e.y),u=new a,u.x=h.x+p*(m.x-h.x),u.y=h.y+p*(m.y-h.y),0==p||1==p?(this.m_type=M.e_faceB,this.m_axis=o.CrossVF(o.SubtractVV(m,h),1),this.m_axis.Normalize(),this.m_localPoint=u):(this.m_type=M.e_faceA,this.m_axis=o.CrossVF(o.SubtractVV(r,e),1),this.m_localPoint=c)),0>p&&this.m_axis.NegativeSelf())},M.prototype.Evaluate=function(t,e){var n,r,s=0;switch(this.m_type){case M.e_points:return n=o.MulTMV(t.R,this.m_axis),r=o.MulTMV(e.R,this.m_axis.GetNegative()),n=this.m_proxyA.GetSupportVertex(n),r=this.m_proxyB.GetSupportVertex(r),n=o.MulX(t,n),r=o.MulX(e,r),s=(r.x-n.x)*this.m_axis.x+(r.y-n.y)*this.m_axis.y;case M.e_faceA:return s=o.MulMV(t.R,this.m_axis),n=o.MulX(t,this.m_localPoint),r=o.MulTMV(e.R,s.GetNegative()),r=this.m_proxyB.GetSupportVertex(r),r=o.MulX(e,r),s=(r.x-n.x)*s.x+(r.y-n.y)*s.y;case M.e_faceB:return s=o.MulMV(e.R,this.m_axis),r=o.MulX(e,this.m_localPoint),n=o.MulTMV(t.R,s.GetNegative()),n=this.m_proxyA.GetSupportVertex(n),n=o.MulX(t,n),s=(n.x-r.x)*s.x+(n.y-r.y)*s.y;default:return i.b2Assert(!1),0}},Box2D.postDefs.push(function(){Box2D.Collision.b2SeparationFunction.e_points=1,Box2D.Collision.b2SeparationFunction.e_faceA=2,Box2D.Collision.b2SeparationFunction.e_faceB=4}),V.b2Simplex=function(){this.m_v1=new T,this.m_v2=new T,this.m_v3=new T,this.m_vertices=new Vector(3)},V.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3},V.prototype.ReadCache=function(t,e,n,r,s){i.b2Assert(0<=t.count&&t.count<=3);var a,l;this.m_count=t.count;for(var c=this.m_vertices,u=0;u<this.m_count;u++){var h=c[u];h.indexA=t.indexA[u],h.indexB=t.indexB[u],a=e.GetVertex(h.indexA),l=r.GetVertex(h.indexB),h.wA=o.MulX(n,a),h.wB=o.MulX(s,l),h.w=o.SubtractVV(h.wB,h.wA),h.a=0}this.m_count>1&&(t=t.metric,a=this.GetMetric(),(.5*t>a||a>2*t||a<Number.MIN_VALUE)&&(this.m_count=0)),0==this.m_count&&(h=c[0],h.indexA=0,h.indexB=0,a=e.GetVertex(0),l=r.GetVertex(0),h.wA=o.MulX(n,a),h.wB=o.MulX(s,l),h.w=o.SubtractVV(h.wB,h.wA),this.m_count=1)},V.prototype.WriteCache=function(t){t.metric=this.GetMetric(),t.count=Box2D.parseUInt(this.m_count);for(var e=this.m_vertices,n=0;n<this.m_count;n++)t.indexA[n]=Box2D.parseUInt(e[n].indexA),t.indexB[n]=Box2D.parseUInt(e[n].indexB)},V.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var t=o.SubtractVV(this.m_v2.w,this.m_v1.w);return o.CrossVV(t,this.m_v1.w.GetNegative())>0?o.CrossFV(1,t):o.CrossVF(t,1);default:return i.b2Assert(!1),new a}},V.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return i.b2Assert(!1),new a;case 1:return this.m_v1.w;case 2:return new a(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return i.b2Assert(!1),new a}},V.prototype.GetWitnessPoints=function(t,e){switch(this.m_count){case 0:i.b2Assert(!1);break;case 1:t.SetV(this.m_v1.wA),e.SetV(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:i.b2Assert(!1)}},V.prototype.GetMetric=function(){switch(this.m_count){case 0:return i.b2Assert(!1),0;case 1:return 0;case 2:return o.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return o.CrossVV(o.SubtractVV(this.m_v2.w,this.m_v1.w),o.SubtractVV(this.m_v3.w,this.m_v1.w));default:return i.b2Assert(!1),0}},V.prototype.Solve2=function(){var t=this.m_v1.w,e=this.m_v2.w,n=o.SubtractVV(e,t);t=-(t.x*n.x+t.y*n.y),0>=t?this.m_count=this.m_v1.a=1:(e=e.x*n.x+e.y*n.y,0>=e?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):(n=1/(e+t),this.m_v1.a=e*n,this.m_v2.a=t*n,this.m_count=2))},V.prototype.Solve3=function(){var t=this.m_v1.w,e=this.m_v2.w,n=this.m_v3.w,i=o.SubtractVV(e,t),r=o.Dot(t,i),s=o.Dot(e,i);r=-r;var a=o.SubtractVV(n,t),l=o.Dot(t,a),c=o.Dot(n,a);l=-l;var u=o.SubtractVV(n,e),h=o.Dot(e,u);u=o.Dot(n,u),h=-h,a=o.CrossVV(i,a),i=a*o.CrossVV(e,n),n=a*o.CrossVV(n,t),t=a*o.CrossVV(t,e),0>=r&&0>=l?this.m_count=this.m_v1.a=1:s>0&&r>0&&0>=t?(c=1/(s+r),this.m_v1.a=s*c,this.m_v2.a=r*c,this.m_count=2):c>0&&l>0&&0>=n?(s=1/(c+l),this.m_v1.a=c*s,this.m_v3.a=l*s,this.m_count=2,this.m_v2.Set(this.m_v3)):0>=s&&0>=h?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):0>=c&&0>=u?(this.m_count=this.m_v3.a=1,this.m_v1.Set(this.m_v3)):u>0&&h>0&&0>=i?(s=1/(u+h),this.m_v2.a=u*s,this.m_v3.a=h*s,this.m_count=2,this.m_v1.Set(this.m_v3)):(s=1/(i+n+t),this.m_v1.a=i*s,this.m_v2.a=n*s,this.m_v3.a=t*s,this.m_count=3)},I.b2SimplexCache=function(){this.indexA=new Vector_a2j_Number(3),this.indexB=new Vector_a2j_Number(3)},T.b2SimplexVertex=function(){},T.prototype.Set=function(t){this.wA.SetV(t.wA),this.wB.SetV(t.wB),this.w.SetV(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB},L.b2TimeOfImpact=function(){},L.TimeOfImpact=function(t){++L.b2_toiCalls;var e=t.proxyA,n=t.proxyB,r=t.sweepA,s=t.sweepB;i.b2Assert(r.t0==s.t0),i.b2Assert(1-r.t0>Number.MIN_VALUE);var a=e.m_radius+n.m_radius;t=t.tolerance;var l=0,c=0,u=0;for(L.s_cache.count=0,L.s_distanceInput.useRadii=!1;;){if(r.GetTransform(L.s_xfA,l),s.GetTransform(L.s_xfB,l),L.s_distanceInput.proxyA=e,L.s_distanceInput.proxyB=n,L.s_distanceInput.transformA=L.s_xfA,L.s_distanceInput.transformB=L.s_xfB,f.Distance(L.s_distanceOutput,L.s_cache,L.s_distanceInput),L.s_distanceOutput.distance<=0){l=1;break}L.s_fcn.Initialize(L.s_cache,e,L.s_xfA,n,L.s_xfB);var h=L.s_fcn.Evaluate(L.s_xfA,L.s_xfB);if(0>=h){l=1;break}if(0==c&&(u=h>a?o.Max(a-t,.75*a):o.Max(h-t,.02*a)),.5*t>h-u){if(0==c){l=1;break}break}var m=l,p=l,y=1;h=h,r.GetTransform(L.s_xfA,y),s.GetTransform(L.s_xfB,y);var d=L.s_fcn.Evaluate(L.s_xfA,L.s_xfB);if(d>=u){l=1;break}for(var _=0;;){var g=0;g=1&_?p+(u-h)*(y-p)/(d-h):.5*(p+y),r.GetTransform(L.s_xfA,g),s.GetTransform(L.s_xfB,g);var x=L.s_fcn.Evaluate(L.s_xfA,L.s_xfB);if(o.Abs(x-u)<.025*t){m=g;break}if(x>u?(p=g,h=x):(y=g,d=x),++_,++L.b2_toiRootIters,50==_)break}if(L.b2_toiMaxRootIters=o.Max(L.b2_toiMaxRootIters,_),m<(1+100*Number.MIN_VALUE)*l)break;if(l=m,c++,++L.b2_toiIters,1e3==c)break}return L.b2_toiMaxIters=o.Max(L.b2_toiMaxIters,c),l},Box2D.postDefs.push(function(){Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0,Box2D.Collision.b2TimeOfImpact.b2_toiIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0,Box2D.Collision.b2TimeOfImpact.s_cache=new I,Box2D.Collision.b2TimeOfImpact.s_distanceInput=new y,Box2D.Collision.b2TimeOfImpact.s_xfA=new s,Box2D.Collision.b2TimeOfImpact.s_xfB=new s,Box2D.Collision.b2TimeOfImpact.s_fcn=new M,Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new d}),F.b2TOIInput=function(){this.proxyA=new _,this.proxyB=new _,this.sweepA=new r,this.sweepB=new r},G.b2WorldManifold=function(){this.m_normal=new a},G.prototype.b2WorldManifold=function(){this.m_points=new Vector(i.b2_maxManifoldPoints);for(var t=0;t<i.b2_maxManifoldPoints;t++)this.m_points[t]=new a},G.prototype.Initialize=function(t,e,n,i,o){if(void 0===n&&(n=0),void 0===o&&(o=0),0!=t.m_pointCount){var r,s,a=0,l=0,c=0,u=0,h=0,m=0;switch(r=0,t.m_type){case w.e_circles:s=e.R,r=t.m_localPoint,a=e.position.x+s.col1.x*r.x+s.col2.x*r.y,e=e.position.y+s.col1.y*r.x+s.col2.y*r.y,s=i.R,r=t.m_points[0].m_localPoint,t=i.position.x+s.col1.x*r.x+s.col2.x*r.y,i=i.position.y+s.col1.y*r.x+s.col2.y*r.y,r=t-a,s=i-e,l=r*r+s*s,l>Number.MIN_VALUE*Number.MIN_VALUE?(l=Math.sqrt(l),this.m_normal.x=r/l,this.m_normal.y=s/l):(this.m_normal.x=1,this.m_normal.y=0),r=e+n*this.m_normal.y,i-=o*this.m_normal.y,this.m_points[0].x=.5*(a+n*this.m_normal.x+(t-o*this.m_normal.x)),this.m_points[0].y=.5*(r+i);break;case w.e_faceA:for(s=e.R,r=t.m_localPlaneNormal,l=s.col1.x*r.x+s.col2.x*r.y,c=s.col1.y*r.x+s.col2.y*r.y,s=e.R,r=t.m_localPoint,u=e.position.x+s.col1.x*r.x+s.col2.x*r.y,h=e.position.y+s.col1.y*r.x+s.col2.y*r.y,this.m_normal.x=l,this.m_normal.y=c,a=0;a<t.m_pointCount;a++)s=i.R,r=t.m_points[a].m_localPoint,m=i.position.x+s.col1.x*r.x+s.col2.x*r.y,r=i.position.y+s.col1.y*r.x+s.col2.y*r.y,this.m_points[a].x=m+.5*(n-(m-u)*l-(r-h)*c-o)*l,this.m_points[a].y=r+.5*(n-(m-u)*l-(r-h)*c-o)*c;break;case w.e_faceB:for(s=i.R,r=t.m_localPlaneNormal,l=s.col1.x*r.x+s.col2.x*r.y,c=s.col1.y*r.x+s.col2.y*r.y,s=i.R,r=t.m_localPoint,u=i.position.x+s.col1.x*r.x+s.col2.x*r.y,h=i.position.y+s.col1.y*r.x+s.col2.y*r.y,this.m_normal.x=-l,this.m_normal.y=-c,a=0;a<t.m_pointCount;a++)s=e.R,r=t.m_points[a].m_localPoint,m=e.position.x+s.col1.x*r.x+s.col2.x*r.y,r=e.position.y+s.col1.y*r.x+s.col2.y*r.y,this.m_points[a].x=m+.5*(o-(m-u)*l-(r-h)*c-n)*l,this.m_points[a].y=r+.5*(o-(m-u)*l-(r-h)*c-n)*c}}},P.ClipVertex=function(){this.v=new a,this.id=new m},P.prototype.Set=function(t){this.v.SetV(t.v),this.id.Set(t.id)},k.Features=function(){},Object.defineProperty(k.prototype,"referenceEdge",{enumerable:!1,configurable:!0,get:function(){return this._referenceEdge}}),Object.defineProperty(k.prototype,"referenceEdge",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._referenceEdge=t,this._m_id._key=4294967040&this._m_id._key|255&this._referenceEdge}}),Object.defineProperty(k.prototype,"incidentEdge",{enumerable:!1,configurable:!0,get:function(){return this._incidentEdge}}),Object.defineProperty(k.prototype,"incidentEdge",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._incidentEdge=t,this._m_id._key=4294902015&this._m_id._key|this._incidentEdge<<8&65280}}),Object.defineProperty(k.prototype,"incidentVertex",{enumerable:!1,configurable:!0,get:function(){return this._incidentVertex
}}),Object.defineProperty(k.prototype,"incidentVertex",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._incidentVertex=t,this._m_id._key=4278255615&this._m_id._key|this._incidentVertex<<16&16711680}}),Object.defineProperty(k.prototype,"flip",{enumerable:!1,configurable:!0,get:function(){return this._flip}}),Object.defineProperty(k.prototype,"flip",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._flip=t,this._m_id._key=16777215&this._m_id._key|this._flip<<24&4278190080}})}(),function(){var t=Box2D.Common.b2Settings,e=Box2D.Collision.Shapes.b2CircleShape,n=Box2D.Collision.Shapes.b2EdgeChainDef,i=Box2D.Collision.Shapes.b2EdgeShape,o=Box2D.Collision.Shapes.b2MassData,r=Box2D.Collision.Shapes.b2PolygonShape,s=Box2D.Collision.Shapes.b2Shape,a=Box2D.Common.Math.b2Mat22,l=Box2D.Common.Math.b2Math,c=Box2D.Common.Math.b2Transform,u=Box2D.Common.Math.b2Vec2,h=Box2D.Collision.b2Distance,m=Box2D.Collision.b2DistanceInput,p=Box2D.Collision.b2DistanceOutput,f=Box2D.Collision.b2DistanceProxy,y=Box2D.Collision.b2SimplexCache;Box2D.inherit(e,Box2D.Collision.Shapes.b2Shape),e.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,e.b2CircleShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.m_p=new u},e.prototype.Copy=function(){var t=new e;return t.Set(this),t},e.prototype.Set=function(t){this.__super.Set.call(this,t),Box2D.is(t,e)&&this.m_p.SetV((t instanceof e?t:null).m_p)},e.prototype.TestPoint=function(t,e){var n=t.R,i=t.position.x+(n.col1.x*this.m_p.x+n.col2.x*this.m_p.y);return n=t.position.y+(n.col1.y*this.m_p.x+n.col2.y*this.m_p.y),i=e.x-i,n=e.y-n,i*i+n*n<=this.m_radius*this.m_radius},e.prototype.RayCast=function(t,e,n){var i=n.R,o=e.p1.x-(n.position.x+(i.col1.x*this.m_p.x+i.col2.x*this.m_p.y));n=e.p1.y-(n.position.y+(i.col1.y*this.m_p.x+i.col2.y*this.m_p.y)),i=e.p2.x-e.p1.x;var r=e.p2.y-e.p1.y,s=o*i+n*r,a=i*i+r*r,l=s*s-a*(o*o+n*n-this.m_radius*this.m_radius);return 0>l||a<Number.MIN_VALUE?!1:(s=-(s+Math.sqrt(l)),s>=0&&s<=e.maxFraction*a?(s/=a,t.fraction=s,t.normal.x=o+s*i,t.normal.y=n+s*r,t.normal.Normalize(),!0):!1)},e.prototype.ComputeAABB=function(t,e){var n=e.R,i=e.position.x+(n.col1.x*this.m_p.x+n.col2.x*this.m_p.y);n=e.position.y+(n.col1.y*this.m_p.x+n.col2.y*this.m_p.y),t.lowerBound.Set(i-this.m_radius,n-this.m_radius),t.upperBound.Set(i+this.m_radius,n+this.m_radius)},e.prototype.ComputeMass=function(e,n){void 0===n&&(n=0),e.mass=n*t.b2_pi*this.m_radius*this.m_radius,e.center.SetV(this.m_p),e.I=e.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))},e.prototype.ComputeSubmergedArea=function(t,e,n,i){void 0===e&&(e=0),n=l.MulX(n,this.m_p);var o=-(l.Dot(t,n)-e);if(o<-this.m_radius+Number.MIN_VALUE)return 0;if(o>this.m_radius)return i.SetV(n),Math.PI*this.m_radius*this.m_radius;e=this.m_radius*this.m_radius;var r=o*o;return o=e*(Math.asin(o/this.m_radius)+Math.PI/2)+o*Math.sqrt(e-r),e=-2/3*Math.pow(e-r,1.5)/o,i.x=n.x+t.x*e,i.y=n.y+t.y*e,o},e.prototype.GetLocalPosition=function(){return this.m_p},e.prototype.SetLocalPosition=function(t){this.m_p.SetV(t)},e.prototype.GetRadius=function(){return this.m_radius},e.prototype.SetRadius=function(t){void 0===t&&(t=0),this.m_radius=t},e.prototype.b2CircleShape=function(t){void 0===t&&(t=0),this.__super.b2Shape.call(this),this.m_type=s.e_circleShape,this.m_radius=t},n.b2EdgeChainDef=function(){},n.prototype.b2EdgeChainDef=function(){this.vertexCount=0,this.isALoop=!0,this.vertices=[]},Box2D.inherit(i,Box2D.Collision.Shapes.b2Shape),i.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,i.b2EdgeShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.s_supportVec=new u,this.m_v1=new u,this.m_v2=new u,this.m_coreV1=new u,this.m_coreV2=new u,this.m_normal=new u,this.m_direction=new u,this.m_cornerDir1=new u,this.m_cornerDir2=new u},i.prototype.TestPoint=function(){return!1},i.prototype.RayCast=function(t,e,n){var i,o=e.p2.x-e.p1.x,r=e.p2.y-e.p1.y;i=n.R;var s=n.position.x+(i.col1.x*this.m_v1.x+i.col2.x*this.m_v1.y),a=n.position.y+(i.col1.y*this.m_v1.x+i.col2.y*this.m_v1.y),l=n.position.y+(i.col1.y*this.m_v2.x+i.col2.y*this.m_v2.y)-a;n=-(n.position.x+(i.col1.x*this.m_v2.x+i.col2.x*this.m_v2.y)-s),i=100*Number.MIN_VALUE;var c=-(o*l+r*n);if(c>i){s=e.p1.x-s;var u=e.p1.y-a;if(a=s*l+u*n,a>=0&&a<=e.maxFraction*c&&(e=-o*u+r*s,e>=-i*c&&c*(1+i)>=e))return a/=c,t.fraction=a,e=Math.sqrt(l*l+n*n),t.normal.x=l/e,t.normal.y=n/e,!0}return!1},i.prototype.ComputeAABB=function(t,e){var n=e.R,i=e.position.x+(n.col1.x*this.m_v1.x+n.col2.x*this.m_v1.y),o=e.position.y+(n.col1.y*this.m_v1.x+n.col2.y*this.m_v1.y),r=e.position.x+(n.col1.x*this.m_v2.x+n.col2.x*this.m_v2.y);n=e.position.y+(n.col1.y*this.m_v2.x+n.col2.y*this.m_v2.y),r>i?(t.lowerBound.x=i,t.upperBound.x=r):(t.lowerBound.x=r,t.upperBound.x=i),n>o?(t.lowerBound.y=o,t.upperBound.y=n):(t.lowerBound.y=n,t.upperBound.y=o)},i.prototype.ComputeMass=function(t){t.mass=0,t.center.SetV(this.m_v1),t.I=0},i.prototype.ComputeSubmergedArea=function(t,e,n,i){void 0===e&&(e=0);var o=new u(t.x*e,t.y*e),r=l.MulX(n,this.m_v1);n=l.MulX(n,this.m_v2);var s=l.Dot(t,r)-e;if(t=l.Dot(t,n)-e,s>0){if(t>0)return 0;r.x=-t/(s-t)*r.x+s/(s-t)*n.x,r.y=-t/(s-t)*r.y+s/(s-t)*n.y}else t>0&&(n.x=-t/(s-t)*r.x+s/(s-t)*n.x,n.y=-t/(s-t)*r.y+s/(s-t)*n.y);return i.x=(o.x+r.x+n.x)/3,i.y=(o.y+r.y+n.y)/3,.5*((r.x-o.x)*(n.y-o.y)-(r.y-o.y)*(n.x-o.x))},i.prototype.GetLength=function(){return this.m_length},i.prototype.GetVertex1=function(){return this.m_v1},i.prototype.GetVertex2=function(){return this.m_v2},i.prototype.GetCoreVertex1=function(){return this.m_coreV1},i.prototype.GetCoreVertex2=function(){return this.m_coreV2},i.prototype.GetNormalVector=function(){return this.m_normal},i.prototype.GetDirectionVector=function(){return this.m_direction},i.prototype.GetCorner1Vector=function(){return this.m_cornerDir1},i.prototype.GetCorner2Vector=function(){return this.m_cornerDir2},i.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1},i.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2},i.prototype.GetFirstVertex=function(t){var e=t.R;return new u(t.position.x+(e.col1.x*this.m_coreV1.x+e.col2.x*this.m_coreV1.y),t.position.y+(e.col1.y*this.m_coreV1.x+e.col2.y*this.m_coreV1.y))},i.prototype.GetNextEdge=function(){return this.m_nextEdge},i.prototype.GetPrevEdge=function(){return this.m_prevEdge},i.prototype.Support=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=0);var i=t.R,o=t.position.x+(i.col1.x*this.m_coreV1.x+i.col2.x*this.m_coreV1.y),r=t.position.y+(i.col1.y*this.m_coreV1.x+i.col2.y*this.m_coreV1.y),s=t.position.x+(i.col1.x*this.m_coreV2.x+i.col2.x*this.m_coreV2.y);return t=t.position.y+(i.col1.y*this.m_coreV2.x+i.col2.y*this.m_coreV2.y),o*e+r*n>s*e+t*n?(this.s_supportVec.x=o,this.s_supportVec.y=r):(this.s_supportVec.x=s,this.s_supportVec.y=t),this.s_supportVec},i.prototype.b2EdgeShape=function(e,n){this.__super.b2Shape.call(this),this.m_type=s.e_edgeShape,this.m_nextEdge=this.m_prevEdge=null,this.m_v1=e,this.m_v2=n,this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y),this.m_length=this.m_direction.Normalize(),this.m_normal.Set(this.m_direction.y,-this.m_direction.x),this.m_coreV1.Set(-t.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-t.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y),this.m_coreV2.Set(-t.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-t.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y),this.m_cornerDir1=this.m_normal,this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)},i.prototype.SetPrevEdge=function(t,e,n,i){this.m_prevEdge=t,this.m_coreV1=e,this.m_cornerDir1=n,this.m_cornerConvex1=i},i.prototype.SetNextEdge=function(t,e,n,i){this.m_nextEdge=t,this.m_coreV2=e,this.m_cornerDir2=n,this.m_cornerConvex2=i},o.b2MassData=function(){this.mass=0,this.center=new u(0,0),this.I=0},Box2D.inherit(r,Box2D.Collision.Shapes.b2Shape),r.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,r.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)},r.prototype.Copy=function(){var t=new r;return t.Set(this),t},r.prototype.Set=function(t){if(this.__super.Set.call(this,t),Box2D.is(t,r)){t=t instanceof r?t:null,this.m_centroid.SetV(t.m_centroid),this.m_vertexCount=t.m_vertexCount,this.Reserve(this.m_vertexCount);for(var e=0;e<this.m_vertexCount;e++)this.m_vertices[e].SetV(t.m_vertices[e]),this.m_normals[e].SetV(t.m_normals[e])}},r.prototype.SetAsArray=function(t,e){void 0===e&&(e=0);var n,i=new Vector,o=0;for(o=0;o<t.length;++o)n=t[o],i.push(n);this.SetAsVector(i,e)},r.AsArray=function(t,e){void 0===e&&(e=0);var n=new r;return n.SetAsArray(t,e),n},r.prototype.SetAsVector=function(e,n){void 0===n&&(n=0),0==n&&(n=e.length),t.b2Assert(n>=2),this.m_vertexCount=n,this.Reserve(n);var i=0;for(i=0;i<this.m_vertexCount;i++)this.m_vertices[i].SetV(e[i]);for(i=0;i<this.m_vertexCount;++i){var o=parseInt(i),s=parseInt(i+1<this.m_vertexCount?i+1:0);o=l.SubtractVV(this.m_vertices[s],this.m_vertices[o]),t.b2Assert(o.LengthSquared()>Number.MIN_VALUE),this.m_normals[i].SetV(l.CrossVF(o,1)),this.m_normals[i].Normalize()}this.m_centroid=r.ComputeCentroid(this.m_vertices,this.m_vertexCount)},r.AsVector=function(t,e){void 0===e&&(e=0);var n=new r;return n.SetAsVector(t,e),n},r.prototype.SetAsBox=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero()},r.AsBox=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);var n=new r;return n.SetAsBox(t,e),n},r.prototype.SetAsOrientedBox=function(t,e,n,i){for(void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=null),void 0===i&&(i=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid=n,t=new c,t.position=n,t.R.Set(i),n=0;n<this.m_vertexCount;++n)this.m_vertices[n]=l.MulX(t,this.m_vertices[n]),this.m_normals[n]=l.MulMV(t.R,this.m_normals[n])},r.AsOrientedBox=function(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=null),void 0===i&&(i=0);var o=new r;return o.SetAsOrientedBox(t,e,n,i),o},r.prototype.SetAsEdge=function(t,e){this.m_vertexCount=2,this.Reserve(2),this.m_vertices[0].SetV(t),this.m_vertices[1].SetV(e),this.m_centroid.x=.5*(t.x+e.x),this.m_centroid.y=.5*(t.y+e.y),this.m_normals[0]=l.CrossVF(l.SubtractVV(e,t),1),this.m_normals[0].Normalize(),this.m_normals[1].x=-this.m_normals[0].x,this.m_normals[1].y=-this.m_normals[0].y},r.AsEdge=function(t,e){var n=new r;return n.SetAsEdge(t,e),n},r.prototype.TestPoint=function(t,e){var n;n=t.R;for(var i=e.x-t.position.x,o=e.y-t.position.y,r=i*n.col1.x+o*n.col1.y,s=i*n.col2.x+o*n.col2.y,a=0;a<this.m_vertexCount;++a)if(n=this.m_vertices[a],i=r-n.x,o=s-n.y,n=this.m_normals[a],n.x*i+n.y*o>0)return!1;return!0},r.prototype.RayCast=function(t,e,n){var i,o,r=0,s=e.maxFraction,a=0,l=0;a=e.p1.x-n.position.x,l=e.p1.y-n.position.y,i=n.R;var c=a*i.col1.x+l*i.col1.y,u=a*i.col2.x+l*i.col2.y;a=e.p2.x-n.position.x,l=e.p2.y-n.position.y,i=n.R,e=a*i.col1.x+l*i.col1.y-c,i=a*i.col2.x+l*i.col2.y-u;for(var h=parseInt(-1),m=0;m<this.m_vertexCount;++m){if(o=this.m_vertices[m],a=o.x-c,l=o.y-u,o=this.m_normals[m],a=o.x*a+o.y*l,l=o.x*e+o.y*i,0==l){if(0>a)return!1}else 0>l&&r*l>a?(r=a/l,h=m):l>0&&s*l>a&&(s=a/l);if(s<r-Number.MIN_VALUE)return!1}return h>=0?(t.fraction=r,i=n.R,o=this.m_normals[h],t.normal.x=i.col1.x*o.x+i.col2.x*o.y,t.normal.y=i.col1.y*o.x+i.col2.y*o.y,!0):!1},r.prototype.ComputeAABB=function(t,e){for(var n=e.R,i=this.m_vertices[0],o=e.position.x+(n.col1.x*i.x+n.col2.x*i.y),r=e.position.y+(n.col1.y*i.x+n.col2.y*i.y),s=o,a=r,l=1;l<this.m_vertexCount;++l){i=this.m_vertices[l];var c=e.position.x+(n.col1.x*i.x+n.col2.x*i.y);i=e.position.y+(n.col1.y*i.x+n.col2.y*i.y),o=c>o?o:c,r=i>r?r:i,s=s>c?s:c,a=a>i?a:i}t.lowerBound.x=o-this.m_radius,t.lowerBound.y=r-this.m_radius,t.upperBound.x=s+this.m_radius,t.upperBound.y=a+this.m_radius},r.prototype.ComputeMass=function(t,e){if(void 0===e&&(e=0),2==this.m_vertexCount)t.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),t.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),t.mass=0,t.I=0;else{for(var n=0,i=0,o=0,r=0,s=1/3,a=0;a<this.m_vertexCount;++a){var l=this.m_vertices[a],c=a+1<this.m_vertexCount?this.m_vertices[parseInt(a+1)]:this.m_vertices[0],u=l.x-0,h=l.y-0,m=c.x-0,p=c.y-0,f=u*p-h*m,y=.5*f;o+=y,n+=y*s*(0+l.x+c.x),i+=y*s*(0+l.y+c.y),l=u,h=h,m=m,p=p,r+=f*(s*(.25*(l*l+m*l+m*m)+(0*l+0*m))+0+(s*(.25*(h*h+p*h+p*p)+(0*h+0*p))+0))}t.mass=e*o,n*=1/o,i*=1/o,t.center.Set(n,i),t.I=e*r}},r.prototype.ComputeSubmergedArea=function(t,e,n,i){void 0===e&&(e=0);var r=l.MulTMV(n.R,t),s=e-l.Dot(t,n.position),a=new Vector_a2j_Number,c=0,h=parseInt(-1);e=parseInt(-1);var m=!1;for(t=t=0;t<this.m_vertexCount;++t){a[t]=l.Dot(r,this.m_vertices[t])-s;var p=a[t]<-Number.MIN_VALUE;t>0&&(p?m||(h=t-1,c++):m&&(e=t-1,c++)),m=p}switch(c){case 0:return m?(t=new o,this.ComputeMass(t,1),i.SetV(l.MulX(n,t.center)),t.mass):0;case 1:-1==h?h=this.m_vertexCount-1:e=this.m_vertexCount-1}for(t=parseInt((h+1)%this.m_vertexCount),r=parseInt((e+1)%this.m_vertexCount),s=(0-a[h])/(a[t]-a[h]),a=(0-a[e])/(a[r]-a[e]),h=new u(this.m_vertices[h].x*(1-s)+this.m_vertices[t].x*s,this.m_vertices[h].y*(1-s)+this.m_vertices[t].y*s),e=new u(this.m_vertices[e].x*(1-a)+this.m_vertices[r].x*a,this.m_vertices[e].y*(1-a)+this.m_vertices[r].y*a),a=0,s=new u,c=this.m_vertices[t],t=t;t!=r;)t=(t+1)%this.m_vertexCount,m=t==r?e:this.m_vertices[t],p=.5*((c.x-h.x)*(m.y-h.y)-(c.y-h.y)*(m.x-h.x)),a+=p,s.x+=p*(h.x+c.x+m.x)/3,s.y+=p*(h.y+c.y+m.y)/3,c=m;return s.Multiply(1/a),i.SetV(l.MulX(n,s)),a},r.prototype.GetVertexCount=function(){return this.m_vertexCount},r.prototype.GetVertices=function(){return this.m_vertices},r.prototype.GetNormals=function(){return this.m_normals},r.prototype.GetSupport=function(t){for(var e=0,n=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,i=1;i<this.m_vertexCount;++i){var o=this.m_vertices[i].x*t.x+this.m_vertices[i].y*t.y;o>n&&(e=i,n=o)}return e},r.prototype.GetSupportVertex=function(t){for(var e=0,n=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,i=1;i<this.m_vertexCount;++i){var o=this.m_vertices[i].x*t.x+this.m_vertices[i].y*t.y;o>n&&(e=i,n=o)}return this.m_vertices[e]},r.prototype.Validate=function(){return!1},r.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this),this.m_type=s.e_polygonShape,this.m_centroid=new u,this.m_vertices=new Vector,this.m_normals=new Vector},r.prototype.Reserve=function(t){void 0===t&&(t=0);for(var e=parseInt(this.m_vertices.length);t>e;e++)this.m_vertices[e]=new u,this.m_normals[e]=new u},r.ComputeCentroid=function(t,e){void 0===e&&(e=0);for(var n=new u,i=0,o=1/3,r=0;e>r;++r){var s=t[r],a=e>r+1?t[parseInt(r+1)]:t[0],l=.5*((s.x-0)*(a.y-0)-(s.y-0)*(a.x-0));i+=l,n.x+=l*o*(0+s.x+a.x),n.y+=l*o*(0+s.y+a.y)}return n.x*=1/i,n.y*=1/i,n},r.ComputeOBB=function(t,e,n){void 0===n&&(n=0);var i=0,o=new Vector(n+1);for(i=0;n>i;++i)o[i]=e[i];for(o[n]=o[0],e=Number.MAX_VALUE,i=1;n>=i;++i){var r=o[parseInt(i-1)],s=o[i].x-r.x,a=o[i].y-r.y,l=Math.sqrt(s*s+a*a);s/=l,a/=l;for(var c=-a,u=s,h=l=Number.MAX_VALUE,m=-Number.MAX_VALUE,p=-Number.MAX_VALUE,f=0;n>f;++f){var y=o[f].x-r.x,d=o[f].y-r.y,_=s*y+a*d;y=c*y+u*d,l>_&&(l=_),h>y&&(h=y),_>m&&(m=_),y>p&&(p=y)}f=(m-l)*(p-h),.95*e>f&&(e=f,t.R.col1.x=s,t.R.col1.y=a,t.R.col2.x=c,t.R.col2.y=u,s=.5*(l+m),a=.5*(h+p),c=t.R,t.center.x=r.x+(c.col1.x*s+c.col2.x*a),t.center.y=r.y+(c.col1.y*s+c.col2.y*a),t.extents.x=.5*(m-l),t.extents.y=.5*(p-h))}},Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2PolygonShape.s_mat=new a}),s.b2Shape=function(){},s.prototype.Copy=function(){return null},s.prototype.Set=function(t){this.m_radius=t.m_radius},s.prototype.GetType=function(){return this.m_type},s.prototype.TestPoint=function(){return!1},s.prototype.RayCast=function(){return!1},s.prototype.ComputeAABB=function(){},s.prototype.ComputeMass=function(){},s.prototype.ComputeSubmergedArea=function(){return 0},s.TestOverlap=function(t,e,n,i){var o=new m;return o.proxyA=new f,o.proxyA.Set(t),o.proxyB=new f,o.proxyB.Set(n),o.transformA=e,o.transformB=i,o.useRadii=!0,t=new y,t.count=0,e=new p,h.Distance(e,t,o),e.distance<10*Number.MIN_VALUE},s.prototype.b2Shape=function(){this.m_type=s.e_unknownShape,this.m_radius=t.b2_linearSlop},Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1),Box2D.Collision.Shapes.b2Shape.e_circleShape=0,Box2D.Collision.Shapes.b2Shape.e_polygonShape=1,Box2D.Collision.Shapes.b2Shape.e_edgeShape=2,Box2D.Collision.Shapes.b2Shape.e_shapeTypeCount=3,Box2D.Collision.Shapes.b2Shape.e_hitCollide=1,Box2D.Collision.Shapes.b2Shape.e_missCollide=0,Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1)})}(),function(){var t=Box2D.Common.b2Color,e=Box2D.Common.b2Settings,n=Box2D.Common.Math.b2Math;t.b2Color=function(){this._b=this._g=this._r=0},t.prototype.b2Color=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this._r=Box2D.parseUInt(255*n.Clamp(t,0,1)),this._g=Box2D.parseUInt(255*n.Clamp(e,0,1)),this._b=Box2D.parseUInt(255*n.Clamp(i,0,1))},t.prototype.Set=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this._r=Box2D.parseUInt(255*n.Clamp(t,0,1)),this._g=Box2D.parseUInt(255*n.Clamp(e,0,1)),this._b=Box2D.parseUInt(255*n.Clamp(i,0,1))},Object.defineProperty(t.prototype,"r",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._r=Box2D.parseUInt(255*n.Clamp(t,0,1))}}),Object.defineProperty(t.prototype,"g",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._g=Box2D.parseUInt(255*n.Clamp(t,0,1))}}),Object.defineProperty(t.prototype,"b",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._b=Box2D.parseUInt(255*n.Clamp(t,0,1))}}),Object.defineProperty(t.prototype,"color",{enumerable:!1,configurable:!0,get:function(){return this._r<<16|this._g<<8|this._b}}),e.b2Settings=function(){},e.b2MixFriction=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),Math.sqrt(t*e)},e.b2MixRestitution=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),t>e?t:e},e.b2Assert=function(t){if(!t)throw"Assertion Failed"},Box2D.postDefs.push(function(){Box2D.Common.b2Settings.VERSION="2.1alpha",Box2D.Common.b2Settings.USHRT_MAX=65535,Box2D.Common.b2Settings.b2_pi=Math.PI,Box2D.Common.b2Settings.b2_maxManifoldPoints=2,Box2D.Common.b2Settings.b2_aabbExtension=.1,Box2D.Common.b2Settings.b2_aabbMultiplier=2,Box2D.Common.b2Settings.b2_polygonRadius=2*e.b2_linearSlop,Box2D.Common.b2Settings.b2_linearSlop=.005,Box2D.Common.b2Settings.b2_angularSlop=2/180*e.b2_pi,Box2D.Common.b2Settings.b2_toiSlop=8*e.b2_linearSlop,Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32,Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32,Box2D.Common.b2Settings.b2_velocityThreshold=1,Box2D.Common.b2Settings.b2_maxLinearCorrection=.2,Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*e.b2_pi,Box2D.Common.b2Settings.b2_maxTranslation=2,Box2D.Common.b2Settings.b2_maxTranslationSquared=e.b2_maxTranslation*e.b2_maxTranslation,Box2D.Common.b2Settings.b2_maxRotation=.5*e.b2_pi,Box2D.Common.b2Settings.b2_maxRotationSquared=e.b2_maxRotation*e.b2_maxRotation,Box2D.Common.b2Settings.b2_contactBaumgarte=.2,Box2D.Common.b2Settings.b2_timeToSleep=.5,Box2D.Common.b2Settings.b2_linearSleepTolerance=.01,Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*e.b2_pi})}(),function(){var t=Box2D.Common.Math.b2Mat22,e=Box2D.Common.Math.b2Mat33,n=Box2D.Common.Math.b2Math,i=Box2D.Common.Math.b2Sweep,o=Box2D.Common.Math.b2Transform,r=Box2D.Common.Math.b2Vec2,s=Box2D.Common.Math.b2Vec3;t.b2Mat22=function(){this.col1=new r,this.col2=new r},t.prototype.b2Mat22=function(){this.SetIdentity()},t.FromAngle=function(e){void 0===e&&(e=0);var n=new t;return n.Set(e),n},t.FromVV=function(e,n){var i=new t;return i.SetVV(e,n),i},t.prototype.Set=function(t){void 0===t&&(t=0);var e=Math.cos(t);t=Math.sin(t),this.col1.x=e,this.col2.x=-t,this.col1.y=t,this.col2.y=e},t.prototype.SetVV=function(t,e){this.col1.SetV(t),this.col2.SetV(e)},t.prototype.Copy=function(){var e=new t;return e.SetM(this),e},t.prototype.SetM=function(t){this.col1.SetV(t.col1),this.col2.SetV(t.col2)},t.prototype.AddM=function(t){this.col1.x+=t.col1.x,this.col1.y+=t.col1.y,this.col2.x+=t.col2.x,this.col2.y+=t.col2.y},t.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col1.y=0,this.col2.y=1},t.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col1.y=0,this.col2.y=0},t.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)},t.prototype.GetInverse=function(t){var e=this.col1.x,n=this.col2.x,i=this.col1.y,o=this.col2.y,r=e*o-n*i;return 0!=r&&(r=1/r),t.col1.x=r*o,t.col2.x=-r*n,t.col1.y=-r*i,t.col2.y=r*e,t},t.prototype.Solve=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=0);var i=this.col1.x,o=this.col2.x,r=this.col1.y,s=this.col2.y,a=i*s-o*r;return 0!=a&&(a=1/a),t.x=a*(s*e-o*n),t.y=a*(i*n-r*e),t},t.prototype.Abs=function(){this.col1.Abs(),this.col2.Abs()},e.b2Mat33=function(){this.col1=new s,this.col2=new s,this.col3=new s},e.prototype.b2Mat33=function(t,e,n){void 0===t&&(t=null),void 0===e&&(e=null),void 0===n&&(n=null),t||e||n?(this.col1.SetV(t),this.col2.SetV(e),this.col3.SetV(n)):(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero())},e.prototype.SetVVV=function(t,e,n){this.col1.SetV(t),this.col2.SetV(e),this.col3.SetV(n)},e.prototype.Copy=function(){return new e(this.col1,this.col2,this.col3)},e.prototype.SetM=function(t){this.col1.SetV(t.col1),this.col2.SetV(t.col2),this.col3.SetV(t.col3)},e.prototype.AddM=function(t){this.col1.x+=t.col1.x,this.col1.y+=t.col1.y,this.col1.z+=t.col1.z,this.col2.x+=t.col2.x,this.col2.y+=t.col2.y,this.col2.z+=t.col2.z,this.col3.x+=t.col3.x,this.col3.y+=t.col3.y,this.col3.z+=t.col3.z},e.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=1,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=1},e.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=0,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=0},e.prototype.Solve22=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=0);var i=this.col1.x,o=this.col2.x,r=this.col1.y,s=this.col2.y,a=i*s-o*r;return 0!=a&&(a=1/a),t.x=a*(s*e-o*n),t.y=a*(i*n-r*e),t},e.prototype.Solve33=function(t,e,n,i){void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0);var o=this.col1.x,r=this.col1.y,s=this.col1.z,a=this.col2.x,l=this.col2.y,c=this.col2.z,u=this.col3.x,h=this.col3.y,m=this.col3.z,p=o*(l*m-c*h)+r*(c*u-a*m)+s*(a*h-l*u);return 0!=p&&(p=1/p),t.x=p*(e*(l*m-c*h)+n*(c*u-a*m)+i*(a*h-l*u)),t.y=p*(o*(n*m-i*h)+r*(i*u-e*m)+s*(e*h-n*u)),t.z=p*(o*(l*i-c*n)+r*(c*e-a*i)+s*(a*n-l*e)),t},n.b2Math=function(){},n.IsValid=function(t){return void 0===t&&(t=0),isFinite(t)},n.Dot=function(t,e){return t.x*e.x+t.y*e.y},n.CrossVV=function(t,e){return t.x*e.y-t.y*e.x},n.CrossVF=function(t,e){return void 0===e&&(e=0),new r(e*t.y,-e*t.x)},n.CrossFV=function(t,e){return void 0===t&&(t=0),new r(-t*e.y,t*e.x)},n.MulMV=function(t,e){return new r(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y)},n.MulTMV=function(t,e){return new r(n.Dot(e,t.col1),n.Dot(e,t.col2))},n.MulX=function(t,e){var i=n.MulMV(t.R,e);return i.x+=t.position.x,i.y+=t.position.y,i},n.MulXT=function(t,e){var i=n.SubtractVV(e,t.position),o=i.x*t.R.col1.x+i.y*t.R.col1.y;return i.y=i.x*t.R.col2.x+i.y*t.R.col2.y,i.x=o,i},n.AddVV=function(t,e){return new r(t.x+e.x,t.y+e.y)},n.SubtractVV=function(t,e){return new r(t.x-e.x,t.y-e.y)},n.Distance=function(t,e){var n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)},n.DistanceSquared=function(t,e){var n=t.x-e.x,i=t.y-e.y;return n*n+i*i},n.MulFV=function(t,e){return void 0===t&&(t=0),new r(t*e.x,t*e.y)},n.AddMM=function(e,i){return t.FromVV(n.AddVV(e.col1,i.col1),n.AddVV(e.col2,i.col2))},n.MulMM=function(e,i){return t.FromVV(n.MulMV(e,i.col1),n.MulMV(e,i.col2))},n.MulTMM=function(e,i){var o=new r(n.Dot(e.col1,i.col1),n.Dot(e.col2,i.col1)),s=new r(n.Dot(e.col1,i.col2),n.Dot(e.col2,i.col2));return t.FromVV(o,s)},n.Abs=function(t){return void 0===t&&(t=0),t>0?t:-t},n.AbsV=function(t){return new r(n.Abs(t.x),n.Abs(t.y))},n.AbsM=function(e){return t.FromVV(n.AbsV(e.col1),n.AbsV(e.col2))},n.Min=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),e>t?t:e},n.MinV=function(t,e){return new r(n.Min(t.x,e.x),n.Min(t.y,e.y))},n.Max=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),t>e?t:e},n.MaxV=function(t,e){return new r(n.Max(t.x,e.x),n.Max(t.y,e.y))},n.Clamp=function(t,e,n){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),e>t?e:t>n?n:t},n.ClampV=function(t,e,i){return n.MaxV(e,n.MinV(t,i))},n.Swap=function(t,e){var n=t[0];t[0]=e[0],e[0]=n},n.Random=function(){return 2*Math.random()-1},n.RandomRange=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);var n=Math.random();return n=(e-t)*n+t},n.NextPowerOfTwo=function(t){return void 0===t&&(t=0),t|=t>>1&2147483647,t|=t>>2&1073741823,t|=t>>4&268435455,t|=t>>8&16777215,t|=t>>16&65535,t+1},n.IsPowerOfTwo=function(t){return void 0===t&&(t=0),t>0&&0==(t&t-1)},Box2D.postDefs.push(function(){Box2D.Common.Math.b2Math.b2Vec2_zero=new r(0,0),Box2D.Common.Math.b2Math.b2Mat22_identity=t.FromVV(new r(1,0),new r(0,1)),Box2D.Common.Math.b2Math.b2Transform_identity=new o(n.b2Vec2_zero,n.b2Mat22_identity)}),i.b2Sweep=function(){this.localCenter=new r,this.c0=new r,this.c=new r},i.prototype.Set=function(t){this.localCenter.SetV(t.localCenter),this.c0.SetV(t.c0),this.c.SetV(t.c),this.a0=t.a0,this.a=t.a,this.t0=t.t0},i.prototype.Copy=function(){var t=new i;return t.localCenter.SetV(this.localCenter),t.c0.SetV(this.c0),t.c.SetV(this.c),t.a0=this.a0,t.a=this.a,t.t0=this.t0,t},i.prototype.GetTransform=function(t,e){void 0===e&&(e=0),t.position.x=(1-e)*this.c0.x+e*this.c.x,t.position.y=(1-e)*this.c0.y+e*this.c.y,t.R.Set((1-e)*this.a0+e*this.a);var n=t.R;t.position.x-=n.col1.x*this.localCenter.x+n.col2.x*this.localCenter.y,t.position.y-=n.col1.y*this.localCenter.x+n.col2.y*this.localCenter.y},i.prototype.Advance=function(t){if(void 0===t&&(t=0),this.t0<t&&1-this.t0>Number.MIN_VALUE){var e=(t-this.t0)/(1-this.t0);this.c0.x=(1-e)*this.c0.x+e*this.c.x,this.c0.y=(1-e)*this.c0.y+e*this.c.y,this.a0=(1-e)*this.a0+e*this.a,this.t0=t}},o.b2Transform=function(){this.position=new r,this.R=new t},o.prototype.b2Transform=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null),t&&(this.position.SetV(t),this.R.SetM(e))},o.prototype.Initialize=function(t,e){this.position.SetV(t),this.R.SetM(e)},o.prototype.SetIdentity=function(){this.position.SetZero(),this.R.SetIdentity()},o.prototype.Set=function(t){this.position.SetV(t.position),this.R.SetM(t.R)},o.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)},r.b2Vec2=function(){},r.prototype.b2Vec2=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e},r.prototype.SetZero=function(){this.y=this.x=0},r.prototype.Set=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e},r.prototype.SetV=function(t){this.x=t.x,this.y=t.y},r.prototype.GetNegative=function(){return new r(-this.x,-this.y)},r.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y},r.Make=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),new r(t,e)},r.prototype.Copy=function(){return new r(this.x,this.y)},r.prototype.Add=function(t){this.x+=t.x,this.y+=t.y},r.prototype.Subtract=function(t){this.x-=t.x,this.y-=t.y},r.prototype.Multiply=function(t){void 0===t&&(t=0),this.x*=t,this.y*=t},r.prototype.MulM=function(t){var e=this.x;this.x=t.col1.x*e+t.col2.x*this.y,this.y=t.col1.y*e+t.col2.y*this.y},r.prototype.MulTM=function(t){var e=n.Dot(this,t.col1);this.y=n.Dot(this,t.col2),this.x=e},r.prototype.CrossVF=function(t){void 0===t&&(t=0);var e=this.x;this.x=t*this.y,this.y=-t*e},r.prototype.CrossFV=function(t){void 0===t&&(t=0);var e=this.x;this.x=-t*this.y,this.y=t*e},r.prototype.MinV=function(t){this.x=this.x<t.x?this.x:t.x,this.y=this.y<t.y?this.y:t.y},r.prototype.MaxV=function(t){this.x=this.x>t.x?this.x:t.x,this.y=this.y>t.y?this.y:t.y},r.prototype.Abs=function(){this.x<0&&(this.x=-this.x),this.y<0&&(this.y=-this.y)},r.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},r.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},r.prototype.Normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);if(t<Number.MIN_VALUE)return 0;var e=1/t;return this.x*=e,this.y*=e,t},r.prototype.IsValid=function(){return n.IsValid(this.x)&&n.IsValid(this.y)},s.b2Vec3=function(){},s.prototype.b2Vec3=function(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this.x=t,this.y=e,this.z=n},s.prototype.SetZero=function(){this.x=this.y=this.z=0},s.prototype.Set=function(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this.x=t,this.y=e,this.z=n},s.prototype.SetV=function(t){this.x=t.x,this.y=t.y,this.z=t.z},s.prototype.GetNegative=function(){return new s(-this.x,-this.y,-this.z)},s.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},s.prototype.Copy=function(){return new s(this.x,this.y,this.z)},s.prototype.Add=function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},s.prototype.Subtract=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z},s.prototype.Multiply=function(t){void 0===t&&(t=0),this.x*=t,this.y*=t,this.z*=t}}(),function(){var t=Box2D.Common.Math.b2Math,e=Box2D.Common.Math.b2Sweep,n=Box2D.Common.Math.b2Transform,i=Box2D.Common.Math.b2Vec2,o=Box2D.Common.b2Color,r=Box2D.Common.b2Settings,s=Box2D.Collision.b2AABB,a=Box2D.Collision.b2ContactPoint,l=Box2D.Collision.b2DynamicTreeBroadPhase,c=Box2D.Collision.b2RayCastInput,u=Box2D.Collision.b2RayCastOutput,h=Box2D.Collision.Shapes.b2CircleShape,m=Box2D.Collision.Shapes.b2EdgeShape,p=Box2D.Collision.Shapes.b2MassData,f=Box2D.Collision.Shapes.b2PolygonShape,y=Box2D.Collision.Shapes.b2Shape,d=Box2D.Dynamics.b2Body,_=Box2D.Dynamics.b2BodyDef,g=Box2D.Dynamics.b2ContactFilter,x=Box2D.Dynamics.b2ContactImpulse,v=Box2D.Dynamics.b2ContactListener,b=Box2D.Dynamics.b2ContactManager,w=Box2D.Dynamics.b2DebugDraw,D=Box2D.Dynamics.b2DestructionListener,B=Box2D.Dynamics.b2FilterData,C=Box2D.Dynamics.b2Fixture,S=Box2D.Dynamics.b2FixtureDef,A=Box2D.Dynamics.b2Island,M=Box2D.Dynamics.b2TimeStep,V=Box2D.Dynamics.b2World,I=Box2D.Dynamics.Contacts.b2Contact,T=Box2D.Dynamics.Contacts.b2ContactFactory,L=Box2D.Dynamics.Contacts.b2ContactSolver,F=Box2D.Dynamics.Joints.b2Joint,G=Box2D.Dynamics.Joints.b2PulleyJoint;d.b2Body=function(){this.m_xf=new n,this.m_sweep=new e,this.m_linearVelocity=new i,this.m_force=new i},d.prototype.connectEdges=function(e,n,i){void 0===i&&(i=0);var o=Math.atan2(n.GetDirectionVector().y,n.GetDirectionVector().x);i=t.MulFV(Math.tan(.5*(o-i)),n.GetDirectionVector()),i=t.SubtractVV(i,n.GetNormalVector()),i=t.MulFV(r.b2_toiSlop,i),i=t.AddVV(i,n.GetVertex1());var s=t.AddVV(e.GetDirectionVector(),n.GetDirectionVector());s.Normalize();var a=t.Dot(e.GetDirectionVector(),n.GetNormalVector())>0;return e.SetNextEdge(n,i,s,a),n.SetPrevEdge(e,i,s,a),o},d.prototype.CreateFixture=function(t){if(1==this.m_world.IsLocked())return null;var e=new C;return e.Create(this,this.m_xf,t),this.m_flags&d.e_activeFlag&&e.CreateProxy(this.m_world.m_contactManager.m_broadPhase,this.m_xf),e.m_next=this.m_fixtureList,this.m_fixtureList=e,++this.m_fixtureCount,e.m_body=this,e.m_density>0&&this.ResetMassData(),this.m_world.m_flags|=V.e_newFixture,e},d.prototype.CreateFixture2=function(t,e){void 0===e&&(e=0);var n=new S;return n.shape=t,n.density=e,this.CreateFixture(n)},d.prototype.DestroyFixture=function(t){if(1!=this.m_world.IsLocked()){for(var e=this.m_fixtureList,n=null;null!=e;){if(e==t){n?n.m_next=t.m_next:this.m_fixtureList=t.m_next;break}n=e,e=e.m_next}for(e=this.m_contactList;e;){n=e.contact,e=e.next;var i=n.GetFixtureA(),o=n.GetFixtureB();(t==i||t==o)&&this.m_world.m_contactManager.Destroy(n)}this.m_flags&d.e_activeFlag&&t.DestroyProxy(this.m_world.m_contactManager.m_broadPhase),t.Destroy(),t.m_body=null,t.m_next=null,--this.m_fixtureCount,this.ResetMassData()}},d.prototype.SetPositionAndAngle=function(t,e){void 0===e&&(e=0);var n;if(1!=this.m_world.IsLocked()){this.m_xf.R.Set(e),this.m_xf.position.SetV(t),n=this.m_xf.R;var i=this.m_sweep.localCenter;for(this.m_sweep.c.x=n.col1.x*i.x+n.col2.x*i.y,this.m_sweep.c.y=n.col1.y*i.x+n.col2.y*i.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=e,i=this.m_world.m_contactManager.m_broadPhase,n=this.m_fixtureList;n;n=n.m_next)n.Synchronize(i,this.m_xf,this.m_xf);
this.m_world.m_contactManager.FindNewContacts()}},d.prototype.SetTransform=function(t){this.SetPositionAndAngle(t.position,t.GetAngle())},d.prototype.GetTransform=function(){return this.m_xf},d.prototype.GetPosition=function(){return this.m_xf.position},d.prototype.SetPosition=function(t){this.SetPositionAndAngle(t,this.GetAngle())},d.prototype.GetAngle=function(){return this.m_sweep.a},d.prototype.SetAngle=function(t){void 0===t&&(t=0),this.SetPositionAndAngle(this.GetPosition(),t)},d.prototype.GetWorldCenter=function(){return this.m_sweep.c},d.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},d.prototype.SetLinearVelocity=function(t){this.m_type!=d.b2_staticBody&&this.m_linearVelocity.SetV(t)},d.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},d.prototype.SetAngularVelocity=function(t){void 0===t&&(t=0),this.m_type!=d.b2_staticBody&&(this.m_angularVelocity=t)},d.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},d.prototype.GetDefinition=function(){var t=new _;return t.type=this.GetType(),t.allowSleep=(this.m_flags&d.e_allowSleepFlag)==d.e_allowSleepFlag,t.angle=this.GetAngle(),t.angularDamping=this.m_angularDamping,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=(this.m_flags&d.e_fixedRotationFlag)==d.e_fixedRotationFlag,t.bullet=(this.m_flags&d.e_bulletFlag)==d.e_bulletFlag,t.awake=(this.m_flags&d.e_awakeFlag)==d.e_awakeFlag,t.linearDamping=this.m_linearDamping,t.linearVelocity.SetV(this.GetLinearVelocity()),t.position=this.GetPosition(),t.userData=this.GetUserData(),t},d.prototype.ApplyForce=function(t,e){this.m_type==d.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_force.x+=t.x,this.m_force.y+=t.y,this.m_torque+=(e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x)},d.prototype.ApplyTorque=function(t){void 0===t&&(t=0),this.m_type==d.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_torque+=t)},d.prototype.ApplyImpulse=function(t,e){this.m_type==d.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y,this.m_angularVelocity+=this.m_invI*((e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x))},d.prototype.Split=function(e){for(var n,i=this.GetLinearVelocity().Copy(),o=this.GetAngularVelocity(),r=this.GetWorldCenter(),s=this.m_world.CreateBody(this.GetDefinition()),a=this.m_fixtureList;a;)if(e(a)){var l=a.m_next;n?n.m_next=l:this.m_fixtureList=l,this.m_fixtureCount--,a.m_next=s.m_fixtureList,s.m_fixtureList=a,s.m_fixtureCount++,a.m_body=s,a=l}else n=a,a=a.m_next;return this.ResetMassData(),s.ResetMassData(),n=this.GetWorldCenter(),e=s.GetWorldCenter(),n=t.AddVV(i,t.CrossFV(o,t.SubtractVV(n,r))),i=t.AddVV(i,t.CrossFV(o,t.SubtractVV(e,r))),this.SetLinearVelocity(n),s.SetLinearVelocity(i),this.SetAngularVelocity(o),s.SetAngularVelocity(o),this.SynchronizeFixtures(),s.SynchronizeFixtures(),s},d.prototype.Merge=function(t){var e;for(e=t.m_fixtureList;e;){var n=e.m_next;t.m_fixtureCount--,e.m_next=this.m_fixtureList,this.m_fixtureList=e,this.m_fixtureCount++,e.m_body=o,e=n}i.m_fixtureCount=0;var i=this,o=t;i.GetWorldCenter(),o.GetWorldCenter(),i.GetLinearVelocity().Copy(),o.GetLinearVelocity().Copy(),i.GetAngularVelocity(),o.GetAngularVelocity(),i.ResetMassData(),this.SynchronizeFixtures()},d.prototype.GetMass=function(){return this.m_mass},d.prototype.GetInertia=function(){return this.m_I},d.prototype.GetMassData=function(t){t.mass=this.m_mass,t.I=this.m_I,t.center.SetV(this.m_sweep.localCenter)},d.prototype.SetMassData=function(e){if(r.b2Assert(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked()&&this.m_type==d.b2_dynamicBody){this.m_invI=this.m_I=this.m_invMass=0,this.m_mass=e.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,e.I>0&&0==(this.m_flags&d.e_fixedRotationFlag)&&(this.m_I=e.I-this.m_mass*(e.center.x*e.center.x+e.center.y*e.center.y),this.m_invI=1/this.m_I);var n=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(e.center),this.m_sweep.c0.SetV(t.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-n.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-n.x)}},d.prototype.ResetMassData=function(){if(this.m_invI=this.m_I=this.m_invMass=this.m_mass=0,this.m_sweep.localCenter.SetZero(),this.m_type!=d.b2_staticBody&&this.m_type!=d.b2_kinematicBody){for(var e=i.Make(0,0),n=this.m_fixtureList;n;n=n.m_next)if(0!=n.m_density){var o=n.GetMassData();this.m_mass+=o.mass,e.x+=o.center.x*o.mass,e.y+=o.center.y*o.mass,this.m_I+=o.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,e.x*=this.m_invMass,e.y*=this.m_invMass):this.m_invMass=this.m_mass=1,this.m_I>0&&0==(this.m_flags&d.e_fixedRotationFlag)?(this.m_I-=this.m_mass*(e.x*e.x+e.y*e.y),this.m_I*=this.m_inertiaScale,r.b2Assert(this.m_I>0),this.m_invI=1/this.m_I):this.m_invI=this.m_I=0,n=this.m_sweep.c.Copy(),this.m_sweep.localCenter.SetV(e),this.m_sweep.c0.SetV(t.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-n.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-n.x)}},d.prototype.GetWorldPoint=function(t){var e=this.m_xf.R;return t=new i(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y),t.x+=this.m_xf.position.x,t.y+=this.m_xf.position.y,t},d.prototype.GetWorldVector=function(e){return t.MulMV(this.m_xf.R,e)},d.prototype.GetLocalPoint=function(e){return t.MulXT(this.m_xf,e)},d.prototype.GetLocalVector=function(e){return t.MulTMV(this.m_xf.R,e)},d.prototype.GetLinearVelocityFromWorldPoint=function(t){return new i(this.m_linearVelocity.x-this.m_angularVelocity*(t.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(t.x-this.m_sweep.c.x))},d.prototype.GetLinearVelocityFromLocalPoint=function(t){var e=this.m_xf.R;return t=new i(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y),t.x+=this.m_xf.position.x,t.y+=this.m_xf.position.y,new i(this.m_linearVelocity.x-this.m_angularVelocity*(t.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(t.x-this.m_sweep.c.x))},d.prototype.GetLinearDamping=function(){return this.m_linearDamping},d.prototype.SetLinearDamping=function(t){void 0===t&&(t=0),this.m_linearDamping=t},d.prototype.GetAngularDamping=function(){return this.m_angularDamping},d.prototype.SetAngularDamping=function(t){void 0===t&&(t=0),this.m_angularDamping=t},d.prototype.SetType=function(t){if(void 0===t&&(t=0),this.m_type!=t)for(this.m_type=t,this.ResetMassData(),this.m_type==d.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0,t=this.m_contactList;t;t=t.next)t.contact.FlagForFiltering()},d.prototype.GetType=function(){return this.m_type},d.prototype.SetBullet=function(t){t?this.m_flags|=d.e_bulletFlag:this.m_flags&=~d.e_bulletFlag},d.prototype.IsBullet=function(){return(this.m_flags&d.e_bulletFlag)==d.e_bulletFlag},d.prototype.SetSleepingAllowed=function(t){t?this.m_flags|=d.e_allowSleepFlag:(this.m_flags&=~d.e_allowSleepFlag,this.SetAwake(!0))},d.prototype.SetAwake=function(t){t?(this.m_flags|=d.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~d.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},d.prototype.IsAwake=function(){return(this.m_flags&d.e_awakeFlag)==d.e_awakeFlag},d.prototype.SetFixedRotation=function(t){t?this.m_flags|=d.e_fixedRotationFlag:this.m_flags&=~d.e_fixedRotationFlag,this.ResetMassData()},d.prototype.IsFixedRotation=function(){return(this.m_flags&d.e_fixedRotationFlag)==d.e_fixedRotationFlag},d.prototype.SetActive=function(t){if(t!=this.IsActive()){var e;if(t)for(this.m_flags|=d.e_activeFlag,t=this.m_world.m_contactManager.m_broadPhase,e=this.m_fixtureList;e;e=e.m_next)e.CreateProxy(t,this.m_xf);else{for(this.m_flags&=~d.e_activeFlag,t=this.m_world.m_contactManager.m_broadPhase,e=this.m_fixtureList;e;e=e.m_next)e.DestroyProxy(t);for(t=this.m_contactList;t;)e=t,t=t.next,this.m_world.m_contactManager.Destroy(e.contact);this.m_contactList=null}}},d.prototype.IsActive=function(){return(this.m_flags&d.e_activeFlag)==d.e_activeFlag},d.prototype.IsSleepingAllowed=function(){return(this.m_flags&d.e_allowSleepFlag)==d.e_allowSleepFlag},d.prototype.GetFixtureList=function(){return this.m_fixtureList},d.prototype.GetJointList=function(){return this.m_jointList},d.prototype.GetControllerList=function(){return this.m_controllerList},d.prototype.GetContactList=function(){return this.m_contactList},d.prototype.GetNext=function(){return this.m_next},d.prototype.GetUserData=function(){return this.m_userData},d.prototype.SetUserData=function(t){this.m_userData=t},d.prototype.GetWorld=function(){return this.m_world},d.prototype.b2Body=function(t,e){this.m_flags=0,t.bullet&&(this.m_flags|=d.e_bulletFlag),t.fixedRotation&&(this.m_flags|=d.e_fixedRotationFlag),t.allowSleep&&(this.m_flags|=d.e_allowSleepFlag),t.awake&&(this.m_flags|=d.e_awakeFlag),t.active&&(this.m_flags|=d.e_activeFlag),this.m_world=e,this.m_xf.position.SetV(t.position),this.m_xf.R.Set(t.angle),this.m_sweep.localCenter.SetZero(),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=t.angle;var n=this.m_xf.R,i=this.m_sweep.localCenter;this.m_sweep.c.x=n.col1.x*i.x+n.col2.x*i.y,this.m_sweep.c.y=n.col1.y*i.x+n.col2.y*i.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_contactList=this.m_controllerList=this.m_jointList=null,this.m_controllerCount=0,this.m_next=this.m_prev=null,this.m_linearVelocity.SetV(t.linearVelocity),this.m_angularVelocity=t.angularVelocity,this.m_linearDamping=t.linearDamping,this.m_angularDamping=t.angularDamping,this.m_force.Set(0,0),this.m_sleepTime=this.m_torque=0,this.m_type=t.type,this.m_invMass=this.m_mass=this.m_type==d.b2_dynamicBody?1:0,this.m_invI=this.m_I=0,this.m_inertiaScale=t.inertiaScale,this.m_userData=t.userData,this.m_fixtureList=null,this.m_fixtureCount=0},d.prototype.SynchronizeFixtures=function(){var t=d.s_xf1;t.R.Set(this.m_sweep.a0);var e=t.R,n=this.m_sweep.localCenter;for(t.position.x=this.m_sweep.c0.x-(e.col1.x*n.x+e.col2.x*n.y),t.position.y=this.m_sweep.c0.y-(e.col1.y*n.x+e.col2.y*n.y),n=this.m_world.m_contactManager.m_broadPhase,e=this.m_fixtureList;e;e=e.m_next)e.Synchronize(n,t,this.m_xf)},d.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var t=this.m_xf.R,e=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(t.col1.x*e.x+t.col2.x*e.y),this.m_xf.position.y=this.m_sweep.c.y-(t.col1.y*e.x+t.col2.y*e.y)},d.prototype.ShouldCollide=function(t){if(this.m_type!=d.b2_dynamicBody&&t.m_type!=d.b2_dynamicBody)return!1;for(var e=this.m_jointList;e;e=e.next)if(e.other==t&&0==e.joint.m_collideConnected)return!1;return!0},d.prototype.Advance=function(t){void 0===t&&(t=0),this.m_sweep.Advance(t),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()},Box2D.postDefs.push(function(){Box2D.Dynamics.b2Body.s_xf1=new n,Box2D.Dynamics.b2Body.e_islandFlag=1,Box2D.Dynamics.b2Body.e_awakeFlag=2,Box2D.Dynamics.b2Body.e_allowSleepFlag=4,Box2D.Dynamics.b2Body.e_bulletFlag=8,Box2D.Dynamics.b2Body.e_fixedRotationFlag=16,Box2D.Dynamics.b2Body.e_activeFlag=32,Box2D.Dynamics.b2Body.b2_staticBody=0,Box2D.Dynamics.b2Body.b2_kinematicBody=1,Box2D.Dynamics.b2Body.b2_dynamicBody=2}),_.b2BodyDef=function(){this.position=new i,this.linearVelocity=new i},_.prototype.b2BodyDef=function(){this.userData=null,this.position.Set(0,0),this.angle=0,this.linearVelocity.Set(0,0),this.angularDamping=this.linearDamping=this.angularVelocity=0,this.awake=this.allowSleep=!0,this.bullet=this.fixedRotation=!1,this.type=d.b2_staticBody,this.active=!0,this.inertiaScale=1},g.b2ContactFilter=function(){},g.prototype.ShouldCollide=function(t,e){var n=t.GetFilterData(),i=e.GetFilterData();return n.groupIndex==i.groupIndex&&0!=n.groupIndex?n.groupIndex>0:0!=(n.maskBits&i.categoryBits)&&0!=(n.categoryBits&i.maskBits)},g.prototype.RayCollide=function(t,e){return t?this.ShouldCollide(t instanceof C?t:null,e):!0},Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new g}),x.b2ContactImpulse=function(){this.normalImpulses=new Vector_a2j_Number(r.b2_maxManifoldPoints),this.tangentImpulses=new Vector_a2j_Number(r.b2_maxManifoldPoints)},v.b2ContactListener=function(){},v.prototype.BeginContact=function(){},v.prototype.EndContact=function(){},v.prototype.PreSolve=function(){},v.prototype.PostSolve=function(){},Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactListener.b2_defaultListener=new v}),b.b2ContactManager=function(){},b.prototype.b2ContactManager=function(){this.m_world=null,this.m_contactCount=0,this.m_contactFilter=g.b2_defaultFilter,this.m_contactListener=v.b2_defaultListener,this.m_contactFactory=new T(this.m_allocator),this.m_broadPhase=new l},b.prototype.AddPair=function(t,e){var n=t instanceof C?t:null,i=e instanceof C?e:null,o=n.GetBody(),r=i.GetBody();if(o!=r){for(var s=r.GetContactList();s;){if(s.other==o){var a=s.contact.GetFixtureA(),l=s.contact.GetFixtureB();if(a==n&&l==i)return;if(a==i&&l==n)return}s=s.next}0!=r.ShouldCollide(o)&&0!=this.m_contactFilter.ShouldCollide(n,i)&&(s=this.m_contactFactory.Create(n,i),n=s.GetFixtureA(),i=s.GetFixtureB(),o=n.m_body,r=i.m_body,s.m_prev=null,s.m_next=this.m_world.m_contactList,null!=this.m_world.m_contactList&&(this.m_world.m_contactList.m_prev=s),this.m_world.m_contactList=s,s.m_nodeA.contact=s,s.m_nodeA.other=r,s.m_nodeA.prev=null,s.m_nodeA.next=o.m_contactList,null!=o.m_contactList&&(o.m_contactList.prev=s.m_nodeA),o.m_contactList=s.m_nodeA,s.m_nodeB.contact=s,s.m_nodeB.other=o,s.m_nodeB.prev=null,s.m_nodeB.next=r.m_contactList,null!=r.m_contactList&&(r.m_contactList.prev=s.m_nodeB),r.m_contactList=s.m_nodeB,++this.m_world.m_contactCount)}},b.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(Box2D.generateCallback(this,this.AddPair))},b.prototype.Destroy=function(t){var e=t.GetFixtureA(),n=t.GetFixtureB();e=e.GetBody(),n=n.GetBody(),t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_world.m_contactList&&(this.m_world.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA==e.m_contactList&&(e.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB==n.m_contactList&&(n.m_contactList=t.m_nodeB.next),this.m_contactFactory.Destroy(t),--this.m_contactCount},b.prototype.Collide=function(){for(var t=this.m_world.m_contactList;t;){var e=t.GetFixtureA(),n=t.GetFixtureB(),i=e.GetBody(),o=n.GetBody();if(0==i.IsAwake()&&0==o.IsAwake())t=t.GetNext();else{if(t.m_flags&I.e_filterFlag){if(0==o.ShouldCollide(i)){e=t,t=e.GetNext(),this.Destroy(e);continue}if(0==this.m_contactFilter.ShouldCollide(e,n)){e=t,t=e.GetNext(),this.Destroy(e);continue}t.m_flags&=~I.e_filterFlag}0==this.m_broadPhase.TestOverlap(e.m_proxy,n.m_proxy)?(e=t,t=e.GetNext(),this.Destroy(e)):(t.Update(this.m_contactListener),t=t.GetNext())}}},Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactManager.s_evalCP=new a}),w.b2DebugDraw=function(){},w.prototype.b2DebugDraw=function(){},w.prototype.SetFlags=function(){},w.prototype.GetFlags=function(){},w.prototype.AppendFlags=function(){},w.prototype.ClearFlags=function(){},w.prototype.SetSprite=function(){},w.prototype.GetSprite=function(){},w.prototype.SetDrawScale=function(){},w.prototype.GetDrawScale=function(){},w.prototype.SetLineThickness=function(){},w.prototype.GetLineThickness=function(){},w.prototype.SetAlpha=function(){},w.prototype.GetAlpha=function(){},w.prototype.SetFillAlpha=function(){},w.prototype.GetFillAlpha=function(){},w.prototype.SetXFormScale=function(){},w.prototype.GetXFormScale=function(){},w.prototype.DrawPolygon=function(){},w.prototype.DrawSolidPolygon=function(){},w.prototype.DrawCircle=function(){},w.prototype.DrawSolidCircle=function(){},w.prototype.DrawSegment=function(){},w.prototype.DrawTransform=function(){},Box2D.postDefs.push(function(){Box2D.Dynamics.b2DebugDraw.e_shapeBit=1,Box2D.Dynamics.b2DebugDraw.e_jointBit=2,Box2D.Dynamics.b2DebugDraw.e_aabbBit=4,Box2D.Dynamics.b2DebugDraw.e_pairBit=8,Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16,Box2D.Dynamics.b2DebugDraw.e_controllerBit=32}),D.b2DestructionListener=function(){},D.prototype.SayGoodbyeJoint=function(){},D.prototype.SayGoodbyeFixture=function(){},B.b2FilterData=function(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0},B.prototype.Copy=function(){var t=new B;return t.categoryBits=this.categoryBits,t.maskBits=this.maskBits,t.groupIndex=this.groupIndex,t},C.b2Fixture=function(){this.m_filter=new B},C.prototype.GetType=function(){return this.m_shape.GetType()},C.prototype.GetShape=function(){return this.m_shape},C.prototype.SetSensor=function(t){if(this.m_isSensor!=t&&(this.m_isSensor=t,null!=this.m_body))for(t=this.m_body.GetContactList();t;){var e=t.contact,n=e.GetFixtureA(),i=e.GetFixtureB();(n==this||i==this)&&e.SetSensor(n.IsSensor()||i.IsSensor()),t=t.next}},C.prototype.IsSensor=function(){return this.m_isSensor},C.prototype.SetFilterData=function(t){if(this.m_filter=t.Copy(),!this.m_body)for(t=this.m_body.GetContactList();t;){var e=t.contact,n=e.GetFixtureA(),i=e.GetFixtureB();(n==this||i==this)&&e.FlagForFiltering(),t=t.next}},C.prototype.GetFilterData=function(){return this.m_filter.Copy()},C.prototype.GetBody=function(){return this.m_body},C.prototype.GetNext=function(){return this.m_next},C.prototype.GetUserData=function(){return this.m_userData},C.prototype.SetUserData=function(t){this.m_userData=t},C.prototype.TestPoint=function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)},C.prototype.RayCast=function(t,e){return this.m_shape.RayCast(t,e,this.m_body.GetTransform())},C.prototype.GetMassData=function(t){return void 0===t&&(t=null),null==t&&(t=new p),this.m_shape.ComputeMass(t,this.m_density),t},C.prototype.SetDensity=function(t){void 0===t&&(t=0),this.m_density=t},C.prototype.GetDensity=function(){return this.m_density},C.prototype.GetFriction=function(){return this.m_friction},C.prototype.SetFriction=function(t){void 0===t&&(t=0),this.m_friction=t},C.prototype.GetRestitution=function(){return this.m_restitution},C.prototype.SetRestitution=function(t){void 0===t&&(t=0),this.m_restitution=t},C.prototype.GetAABB=function(){return this.m_aabb},C.prototype.b2Fixture=function(){this.m_aabb=new s,this.m_shape=this.m_next=this.m_body=this.m_userData=null,this.m_restitution=this.m_friction=this.m_density=0},C.prototype.Create=function(t,e,n){this.m_userData=n.userData,this.m_friction=n.friction,this.m_restitution=n.restitution,this.m_body=t,this.m_next=null,this.m_filter=n.filter.Copy(),this.m_isSensor=n.isSensor,this.m_shape=n.shape.Copy(),this.m_density=n.density},C.prototype.Destroy=function(){this.m_shape=null},C.prototype.CreateProxy=function(t,e){this.m_shape.ComputeAABB(this.m_aabb,e),this.m_proxy=t.CreateProxy(this.m_aabb,this)},C.prototype.DestroyProxy=function(t){null!=this.m_proxy&&(t.DestroyProxy(this.m_proxy),this.m_proxy=null)},C.prototype.Synchronize=function(e,n,i){if(this.m_proxy){var o=new s,r=new s;this.m_shape.ComputeAABB(o,n),this.m_shape.ComputeAABB(r,i),this.m_aabb.Combine(o,r),n=t.SubtractVV(i.position,n.position),e.MoveProxy(this.m_proxy,this.m_aabb,n)}},S.b2FixtureDef=function(){this.filter=new B},S.prototype.b2FixtureDef=function(){this.userData=this.shape=null,this.friction=.2,this.density=this.restitution=0,this.filter.categoryBits=1,this.filter.maskBits=65535,this.filter.groupIndex=0,this.isSensor=!1},A.b2Island=function(){},A.prototype.b2Island=function(){this.m_bodies=new Vector,this.m_contacts=new Vector,this.m_joints=new Vector},A.prototype.Initialize=function(t,e,n,i,o,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0);var s=0;for(this.m_bodyCapacity=t,this.m_contactCapacity=e,this.m_jointCapacity=n,this.m_jointCount=this.m_contactCount=this.m_bodyCount=0,this.m_allocator=i,this.m_listener=o,this.m_contactSolver=r,s=this.m_bodies.length;t>s;s++)this.m_bodies[s]=null;for(s=this.m_contacts.length;e>s;s++)this.m_contacts[s]=null;for(s=this.m_joints.length;n>s;s++)this.m_joints[s]=null},A.prototype.Clear=function(){this.m_jointCount=this.m_contactCount=this.m_bodyCount=0},A.prototype.Solve=function(e,n,i){var o,s=0,a=0;for(s=0;s<this.m_bodyCount;++s)a=this.m_bodies[s],a.GetType()==d.b2_dynamicBody&&(a.m_linearVelocity.x+=e.dt*(n.x+a.m_invMass*a.m_force.x),a.m_linearVelocity.y+=e.dt*(n.y+a.m_invMass*a.m_force.y),a.m_angularVelocity+=e.dt*a.m_invI*a.m_torque,a.m_linearVelocity.Multiply(t.Clamp(1-e.dt*a.m_linearDamping,0,1)),a.m_angularVelocity*=t.Clamp(1-e.dt*a.m_angularDamping,0,1));for(this.m_contactSolver.Initialize(e,this.m_contacts,this.m_contactCount,this.m_allocator),n=this.m_contactSolver,n.InitVelocityConstraints(e),s=0;s<this.m_jointCount;++s)o=this.m_joints[s],o.InitVelocityConstraints(e);for(s=0;s<e.velocityIterations;++s){for(a=0;a<this.m_jointCount;++a)o=this.m_joints[a],o.SolveVelocityConstraints(e);n.SolveVelocityConstraints()}for(s=0;s<this.m_jointCount;++s)o=this.m_joints[s],o.FinalizeVelocityConstraints();for(n.FinalizeVelocityConstraints(),s=0;s<this.m_bodyCount;++s)if(a=this.m_bodies[s],a.GetType()!=d.b2_staticBody){var l=e.dt*a.m_linearVelocity.x,c=e.dt*a.m_linearVelocity.y;l*l+c*c>r.b2_maxTranslationSquared&&(a.m_linearVelocity.Normalize(),a.m_linearVelocity.x*=r.b2_maxTranslation*e.inv_dt,a.m_linearVelocity.y*=r.b2_maxTranslation*e.inv_dt),l=e.dt*a.m_angularVelocity,l*l>r.b2_maxRotationSquared&&(a.m_angularVelocity=a.m_angularVelocity<0?-r.b2_maxRotation*e.inv_dt:r.b2_maxRotation*e.inv_dt),a.m_sweep.c0.SetV(a.m_sweep.c),a.m_sweep.a0=a.m_sweep.a,a.m_sweep.c.x+=e.dt*a.m_linearVelocity.x,a.m_sweep.c.y+=e.dt*a.m_linearVelocity.y,a.m_sweep.a+=e.dt*a.m_angularVelocity,a.SynchronizeTransform()}for(s=0;s<e.positionIterations;++s){for(l=n.SolvePositionConstraints(r.b2_contactBaumgarte),c=!0,a=0;a<this.m_jointCount;++a)o=this.m_joints[a],o=o.SolvePositionConstraints(r.b2_contactBaumgarte),c=c&&o;if(l&&c)break}if(this.Report(n.m_constraints),i){for(i=Number.MAX_VALUE,n=r.b2_linearSleepTolerance*r.b2_linearSleepTolerance,l=r.b2_angularSleepTolerance*r.b2_angularSleepTolerance,s=0;s<this.m_bodyCount;++s)a=this.m_bodies[s],a.GetType()!=d.b2_staticBody&&(0==(a.m_flags&d.e_allowSleepFlag)&&(i=a.m_sleepTime=0),0==(a.m_flags&d.e_allowSleepFlag)||a.m_angularVelocity*a.m_angularVelocity>l||t.Dot(a.m_linearVelocity,a.m_linearVelocity)>n?i=a.m_sleepTime=0:(a.m_sleepTime+=e.dt,i=t.Min(i,a.m_sleepTime)));if(i>=r.b2_timeToSleep)for(s=0;s<this.m_bodyCount;++s)a=this.m_bodies[s],a.SetAwake(!1)}},A.prototype.SolveTOI=function(t){var e=0,n=0;this.m_contactSolver.Initialize(t,this.m_contacts,this.m_contactCount,this.m_allocator);var i=this.m_contactSolver;for(e=0;e<this.m_jointCount;++e)this.m_joints[e].InitVelocityConstraints(t);for(e=0;e<t.velocityIterations;++e)for(i.SolveVelocityConstraints(),n=0;n<this.m_jointCount;++n)this.m_joints[n].SolveVelocityConstraints(t);for(e=0;e<this.m_bodyCount;++e)if(n=this.m_bodies[e],n.GetType()!=d.b2_staticBody){var o=t.dt*n.m_linearVelocity.x,s=t.dt*n.m_linearVelocity.y;o*o+s*s>r.b2_maxTranslationSquared&&(n.m_linearVelocity.Normalize(),n.m_linearVelocity.x*=r.b2_maxTranslation*t.inv_dt,n.m_linearVelocity.y*=r.b2_maxTranslation*t.inv_dt),o=t.dt*n.m_angularVelocity,o*o>r.b2_maxRotationSquared&&(n.m_angularVelocity=n.m_angularVelocity<0?-r.b2_maxRotation*t.inv_dt:r.b2_maxRotation*t.inv_dt),n.m_sweep.c0.SetV(n.m_sweep.c),n.m_sweep.a0=n.m_sweep.a,n.m_sweep.c.x+=t.dt*n.m_linearVelocity.x,n.m_sweep.c.y+=t.dt*n.m_linearVelocity.y,n.m_sweep.a+=t.dt*n.m_angularVelocity,n.SynchronizeTransform()}for(e=0;e<t.positionIterations;++e){for(o=i.SolvePositionConstraints(.75),s=!0,n=0;n<this.m_jointCount;++n){var a=this.m_joints[n].SolvePositionConstraints(r.b2_contactBaumgarte);s=s&&a}if(o&&s)break}this.Report(i.m_constraints)},A.prototype.Report=function(t){if(null!=this.m_listener)for(var e=0;e<this.m_contactCount;++e){for(var n=this.m_contacts[e],i=t[e],o=0;o<i.pointCount;++o)A.s_impulse.normalImpulses[o]=i.points[o].normalImpulse,A.s_impulse.tangentImpulses[o]=i.points[o].tangentImpulse;this.m_listener.PostSolve(n,A.s_impulse)}},A.prototype.AddBody=function(t){t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=t},A.prototype.AddContact=function(t){this.m_contacts[this.m_contactCount++]=t},A.prototype.AddJoint=function(t){this.m_joints[this.m_jointCount++]=t},Box2D.postDefs.push(function(){Box2D.Dynamics.b2Island.s_impulse=new x}),M.b2TimeStep=function(){},M.prototype.Set=function(t){this.dt=t.dt,this.inv_dt=t.inv_dt,this.positionIterations=t.positionIterations,this.velocityIterations=t.velocityIterations,this.warmStarting=t.warmStarting},V.b2World=function(){this.s_stack=new Vector,this.m_contactManager=new b,this.m_contactSolver=new L,this.m_island=new A},V.prototype.b2World=function(t,e){this.m_controllerList=this.m_jointList=this.m_contactList=this.m_bodyList=this.m_debugDraw=this.m_destructionListener=null,this.m_controllerCount=this.m_jointCount=this.m_contactCount=this.m_bodyCount=0,V.m_warmStarting=!0,V.m_continuousPhysics=!0,this.m_allowSleep=e,this.m_gravity=t,this.m_inv_dt0=0,this.m_contactManager.m_world=this,this.m_groundBody=this.CreateBody(new _)},V.prototype.SetDestructionListener=function(t){this.m_destructionListener=t},V.prototype.SetContactFilter=function(t){this.m_contactManager.m_contactFilter=t},V.prototype.SetContactListener=function(t){this.m_contactManager.m_contactListener=t},V.prototype.SetDebugDraw=function(t){this.m_debugDraw=t},V.prototype.SetBroadPhase=function(t){var e=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=t;for(var n=this.m_bodyList;n;n=n.m_next)for(var i=n.m_fixtureList;i;i=i.m_next)i.m_proxy=t.CreateProxy(e.GetFatAABB(i.m_proxy),i)},V.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()},V.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},V.prototype.CreateBody=function(t){return 1==this.IsLocked()?null:(t=new d(t,this),t.m_prev=null,(t.m_next=this.m_bodyList)&&(this.m_bodyList.m_prev=t),this.m_bodyList=t,++this.m_bodyCount,t)},V.prototype.DestroyBody=function(t){if(1!=this.IsLocked()){for(var e=t.m_jointList;e;){var n=e;e=e.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(n.joint),this.DestroyJoint(n.joint)}for(e=t.m_controllerList;e;)n=e,e=e.nextController,n.controller.RemoveBody(t);for(e=t.m_contactList;e;)n=e,e=e.next,this.m_contactManager.Destroy(n.contact);for(t.m_contactList=null,e=t.m_fixtureList;e;)n=e,e=e.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(n),n.DestroyProxy(this.m_contactManager.m_broadPhase),n.Destroy();t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount}},V.prototype.CreateJoint=function(t){var e=F.Create(t,null);e.m_prev=null,(e.m_next=this.m_jointList)&&(this.m_jointList.m_prev=e),this.m_jointList=e,++this.m_jointCount,e.m_edgeA.joint=e,e.m_edgeA.other=e.m_bodyB,e.m_edgeA.prev=null,(e.m_edgeA.next=e.m_bodyA.m_jointList)&&(e.m_bodyA.m_jointList.prev=e.m_edgeA),e.m_bodyA.m_jointList=e.m_edgeA,e.m_edgeB.joint=e,e.m_edgeB.other=e.m_bodyA,e.m_edgeB.prev=null,(e.m_edgeB.next=e.m_bodyB.m_jointList)&&(e.m_bodyB.m_jointList.prev=e.m_edgeB),e.m_bodyB.m_jointList=e.m_edgeB;var n=t.bodyA,i=t.bodyB;if(0==t.collideConnected)for(t=i.GetContactList();t;)t.other==n&&t.contact.FlagForFiltering(),t=t.next;return e},V.prototype.DestroyJoint=function(t){var e=t.m_collideConnected;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var n=t.m_bodyA,i=t.m_bodyB;if(n.SetAwake(!0),i.SetAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA==n.m_jointList&&(n.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB==i.m_jointList&&(i.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,F.Destroy(t,null),--this.m_jointCount,0==e)for(t=i.GetContactList();t;)t.other==n&&t.contact.FlagForFiltering(),t=t.next},V.prototype.AddController=function(t){return t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList=t,t.m_world=this,this.m_controllerCount++,t},V.prototype.RemoveController=function(t){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),this.m_controllerList==t&&(this.m_controllerList=t.m_next),this.m_controllerCount--},V.prototype.CreateController=function(t){if(t.m_world!=this)throw Error("Controller can only be a member of one world");return t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=t),this.m_controllerList=t,++this.m_controllerCount,t.m_world=this,t},V.prototype.DestroyController=function(t){t.Clear(),t.m_next&&(t.m_next.m_prev=t.m_prev),t.m_prev&&(t.m_prev.m_next=t.m_next),t==this.m_controllerList&&(this.m_controllerList=t.m_next),--this.m_controllerCount},V.prototype.SetWarmStarting=function(t){V.m_warmStarting=t},V.prototype.SetContinuousPhysics=function(t){V.m_continuousPhysics=t},V.prototype.GetBodyCount=function(){return this.m_bodyCount},V.prototype.GetJointCount=function(){return this.m_jointCount},V.prototype.GetContactCount=function(){return this.m_contactCount},V.prototype.SetGravity=function(t){this.m_gravity=t},V.prototype.GetGravity=function(){return this.m_gravity},V.prototype.GetGroundBody=function(){return this.m_groundBody},V.prototype.Step=function(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this.m_flags&V.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~V.e_newFixture),this.m_flags|=V.e_locked;var i=V.s_timestep2;i.dt=t,i.velocityIterations=e,i.positionIterations=n,i.inv_dt=t>0?1/t:0,i.dtRatio=this.m_inv_dt0*t,i.warmStarting=V.m_warmStarting,this.m_contactManager.Collide(),i.dt>0&&this.Solve(i),V.m_continuousPhysics&&i.dt>0&&this.SolveTOI(i),i.dt>0&&(this.m_inv_dt0=i.inv_dt),this.m_flags&=~V.e_locked},V.prototype.ClearForces=function(){for(var t=this.m_bodyList;t;t=t.m_next)t.m_force.SetZero(),t.m_torque=0},V.prototype.DrawDebugData=function(){if(null!=this.m_debugDraw){this.m_debugDraw.m_sprite.graphics.clear();var t,e,n,r=this.m_debugDraw.GetFlags();new i,new i,new i;var a;new s,new s,a=[new i,new i,new i,new i];var l=new o(0,0,0);if(r&w.e_shapeBit)for(t=this.m_bodyList;t;t=t.m_next)for(a=t.m_xf,e=t.GetFixtureList();e;e=e.m_next)n=e.GetShape(),0==t.IsActive()?l.Set(.5,.5,.3):t.GetType()==d.b2_staticBody?l.Set(.5,.9,.5):t.GetType()==d.b2_kinematicBody?l.Set(.5,.5,.9):0==t.IsAwake()?l.Set(.6,.6,.6):l.Set(.9,.7,.7),this.DrawShape(n,a,l);if(r&w.e_jointBit)for(t=this.m_jointList;t;t=t.m_next)this.DrawJoint(t);if(r&w.e_controllerBit)for(t=this.m_controllerList;t;t=t.m_next)t.Draw(this.m_debugDraw);if(r&w.e_pairBit)for(l.Set(.3,.9,.9),t=this.m_contactManager.m_contactList;t;t=t.GetNext())n=t.GetFixtureA(),e=t.GetFixtureB(),n=n.GetAABB().GetCenter(),e=e.GetAABB().GetCenter(),this.m_debugDraw.DrawSegment(n,e,l);if(r&w.e_aabbBit)for(n=this.m_contactManager.m_broadPhase,a=[new i,new i,new i,new i],t=this.m_bodyList;t;t=t.GetNext())if(0!=t.IsActive())for(e=t.GetFixtureList();e;e=e.GetNext()){var c=n.GetFatAABB(e.m_proxy);a[0].Set(c.lowerBound.x,c.lowerBound.y),a[1].Set(c.upperBound.x,c.lowerBound.y),a[2].Set(c.upperBound.x,c.upperBound.y),a[3].Set(c.lowerBound.x,c.upperBound.y),this.m_debugDraw.DrawPolygon(a,4,l)}if(r&w.e_centerOfMassBit)for(t=this.m_bodyList;t;t=t.m_next)a=V.s_xf,a.R=t.m_xf.R,a.position=t.GetWorldCenter(),this.m_debugDraw.DrawTransform(a)}},V.prototype.QueryAABB=function(t,e){var n=this.m_contactManager.m_broadPhase;n.Query(function(e){return t(n.GetUserData(e))},e)},V.prototype.QueryShape=function(t,e,i){void 0===i&&(i=null),null==i&&(i=new n,i.SetIdentity());var o=this.m_contactManager.m_broadPhase,r=new s;e.ComputeAABB(r,i),o.Query(function(n){return n=o.GetUserData(n)instanceof C?o.GetUserData(n):null,y.TestOverlap(e,i,n.GetShape(),n.GetBody().GetTransform())?t(n):!0},r)},V.prototype.QueryPoint=function(t,e){var n=this.m_contactManager.m_broadPhase,i=new s;i.lowerBound.Set(e.x-r.b2_linearSlop,e.y-r.b2_linearSlop),i.upperBound.Set(e.x+r.b2_linearSlop,e.y+r.b2_linearSlop),n.Query(function(i){return i=n.GetUserData(i)instanceof C?n.GetUserData(i):null,i.TestPoint(e)?t(i):!0
},i)},V.prototype.RayCast=function(t,e,n){var o=this.m_contactManager.m_broadPhase,r=new u,s=new c(e,n);o.RayCast(function(s,a){var l=o.GetUserData(a);if(l=l instanceof C?l:null,l.RayCast(r,s)){var c=r.fraction,u=new i((1-c)*e.x+c*n.x,(1-c)*e.y+c*n.y);return t(l,u,r.normal,c)}return s.maxFraction},s)},V.prototype.RayCastOne=function(t,e){var n;return this.RayCast(function(t,e,i,o){return void 0===o&&(o=0),n=t,o},t,e),n},V.prototype.RayCastAll=function(t,e){var n=new Vector;return this.RayCast(function(t){return n[n.length]=t,1},t,e),n},V.prototype.GetBodyList=function(){return this.m_bodyList},V.prototype.GetJointList=function(){return this.m_jointList},V.prototype.GetContactList=function(){return this.m_contactList},V.prototype.IsLocked=function(){return(this.m_flags&V.e_locked)>0},V.prototype.Solve=function(t){for(var e,n=this.m_controllerList;n;n=n.m_next)n.Step(t);for(n=this.m_island,n.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver),e=this.m_bodyList;e;e=e.m_next)e.m_flags&=~d.e_islandFlag;for(var i=this.m_contactList;i;i=i.m_next)i.m_flags&=~I.e_islandFlag;for(i=this.m_jointList;i;i=i.m_next)i.m_islandFlag=!1;parseInt(this.m_bodyCount),i=this.s_stack;for(var o=this.m_bodyList;o;o=o.m_next)if(!(o.m_flags&d.e_islandFlag)&&0!=o.IsAwake()&&0!=o.IsActive()&&o.GetType()!=d.b2_staticBody){n.Clear();var r=0;for(i[r++]=o,o.m_flags|=d.e_islandFlag;r>0;)if(e=i[--r],n.AddBody(e),0==e.IsAwake()&&e.SetAwake(!0),e.GetType()!=d.b2_staticBody){for(var s,a=e.m_contactList;a;a=a.next)a.contact.m_flags&I.e_islandFlag||1!=a.contact.IsSensor()&&0!=a.contact.IsEnabled()&&0!=a.contact.IsTouching()&&(n.AddContact(a.contact),a.contact.m_flags|=I.e_islandFlag,s=a.other,s.m_flags&d.e_islandFlag||(i[r++]=s,s.m_flags|=d.e_islandFlag));for(e=e.m_jointList;e;e=e.next)1!=e.joint.m_islandFlag&&(s=e.other,0!=s.IsActive()&&(n.AddJoint(e.joint),e.joint.m_islandFlag=!0,s.m_flags&d.e_islandFlag||(i[r++]=s,s.m_flags|=d.e_islandFlag)))}for(n.Solve(t,this.m_gravity,this.m_allowSleep),r=0;r<n.m_bodyCount;++r)e=n.m_bodies[r],e.GetType()==d.b2_staticBody&&(e.m_flags&=~d.e_islandFlag)}for(r=0;r<i.length&&i[r];++r)i[r]=null;for(e=this.m_bodyList;e;e=e.m_next)0==e.IsAwake()||0==e.IsActive()||e.GetType()!=d.b2_staticBody&&e.SynchronizeFixtures();this.m_contactManager.FindNewContacts()},V.prototype.SolveTOI=function(t){var e,n,i,o=this.m_island;o.Initialize(this.m_bodyCount,r.b2_maxTOIContactsPerIsland,r.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var s=V.s_queue;for(e=this.m_bodyList;e;e=e.m_next)e.m_flags&=~d.e_islandFlag,e.m_sweep.t0=0;for(i=this.m_contactList;i;i=i.m_next)i.m_flags&=~(I.e_toiFlag|I.e_islandFlag);for(i=this.m_jointList;i;i=i.m_next)i.m_islandFlag=!1;for(;;){var a=null,l=1;for(i=this.m_contactList;i;i=i.m_next)if(1!=i.IsSensor()&&0!=i.IsEnabled()&&0!=i.IsContinuous()){if(e=1,i.m_flags&I.e_toiFlag)e=i.m_toi;else{if(e=i.m_fixtureA,n=i.m_fixtureB,e=e.m_body,n=n.m_body,!(e.GetType()==d.b2_dynamicBody&&0!=e.IsAwake()||n.GetType()==d.b2_dynamicBody&&0!=n.IsAwake()))continue;var c=e.m_sweep.t0;e.m_sweep.t0<n.m_sweep.t0?(c=n.m_sweep.t0,e.m_sweep.Advance(c)):n.m_sweep.t0<e.m_sweep.t0&&(c=e.m_sweep.t0,n.m_sweep.Advance(c)),e=i.ComputeTOI(e.m_sweep,n.m_sweep),r.b2Assert(e>=0&&1>=e),e>0&&1>e&&(e=(1-e)*c+e,e>1&&(e=1)),i.m_toi=e,i.m_flags|=I.e_toiFlag}Number.MIN_VALUE<e&&l>e&&(a=i,l=e)}if(null==a||1-100*Number.MIN_VALUE<l)break;if(e=a.m_fixtureA,n=a.m_fixtureB,e=e.m_body,n=n.m_body,V.s_backupA.Set(e.m_sweep),V.s_backupB.Set(n.m_sweep),e.Advance(l),n.Advance(l),a.Update(this.m_contactManager.m_contactListener),a.m_flags&=~I.e_toiFlag,1==a.IsSensor()||0==a.IsEnabled())e.m_sweep.Set(V.s_backupA),n.m_sweep.Set(V.s_backupB),e.SynchronizeTransform(),n.SynchronizeTransform();else if(0!=a.IsTouching()){for(e=e,e.GetType()!=d.b2_dynamicBody&&(e=n),o.Clear(),a=i=0,s[i+a++]=e,e.m_flags|=d.e_islandFlag;a>0;)if(e=s[i++],--a,o.AddBody(e),0==e.IsAwake()&&e.SetAwake(!0),e.GetType()==d.b2_dynamicBody){for(n=e.m_contactList;n&&o.m_contactCount!=o.m_contactCapacity;n=n.next)n.contact.m_flags&I.e_islandFlag||1!=n.contact.IsSensor()&&0!=n.contact.IsEnabled()&&0!=n.contact.IsTouching()&&(o.AddContact(n.contact),n.contact.m_flags|=I.e_islandFlag,c=n.other,c.m_flags&d.e_islandFlag||(c.GetType()!=d.b2_staticBody&&(c.Advance(l),c.SetAwake(!0)),s[i+a]=c,++a,c.m_flags|=d.e_islandFlag));for(e=e.m_jointList;e;e=e.next)o.m_jointCount!=o.m_jointCapacity&&1!=e.joint.m_islandFlag&&(c=e.other,0!=c.IsActive()&&(o.AddJoint(e.joint),e.joint.m_islandFlag=!0,c.m_flags&d.e_islandFlag||(c.GetType()!=d.b2_staticBody&&(c.Advance(l),c.SetAwake(!0)),s[i+a]=c,++a,c.m_flags|=d.e_islandFlag)))}for(i=V.s_timestep,i.warmStarting=!1,i.dt=(1-l)*t.dt,i.inv_dt=1/i.dt,i.dtRatio=0,i.velocityIterations=t.velocityIterations,i.positionIterations=t.positionIterations,o.SolveTOI(i),l=l=0;l<o.m_bodyCount;++l)if(e=o.m_bodies[l],e.m_flags&=~d.e_islandFlag,0!=e.IsAwake()&&e.GetType()==d.b2_dynamicBody)for(e.SynchronizeFixtures(),n=e.m_contactList;n;n=n.next)n.contact.m_flags&=~I.e_toiFlag;for(l=0;l<o.m_contactCount;++l)i=o.m_contacts[l],i.m_flags&=~(I.e_toiFlag|I.e_islandFlag);for(l=0;l<o.m_jointCount;++l)i=o.m_joints[l],i.m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}},V.prototype.DrawJoint=function(t){var e=t.GetBodyA(),n=t.GetBodyB(),i=e.m_xf.position,o=n.m_xf.position,r=t.GetAnchorA(),s=t.GetAnchorB(),a=V.s_jointColor;switch(t.m_type){case F.e_distanceJoint:this.m_debugDraw.DrawSegment(r,s,a);break;case F.e_pulleyJoint:e=t instanceof G?t:null,t=e.GetGroundAnchorA(),e=e.GetGroundAnchorB(),this.m_debugDraw.DrawSegment(t,r,a),this.m_debugDraw.DrawSegment(e,s,a),this.m_debugDraw.DrawSegment(t,e,a);break;case F.e_mouseJoint:this.m_debugDraw.DrawSegment(r,s,a);break;default:e!=this.m_groundBody&&this.m_debugDraw.DrawSegment(i,r,a),this.m_debugDraw.DrawSegment(r,s,a),n!=this.m_groundBody&&this.m_debugDraw.DrawSegment(o,s,a)}},V.prototype.DrawShape=function(e,n,i){switch(e.m_type){case y.e_circleShape:var o=e instanceof h?e:null;this.m_debugDraw.DrawSolidCircle(t.MulX(n,o.m_p),o.m_radius,n.R.col1,i);break;case y.e_polygonShape:o=0,o=e instanceof f?e:null,e=parseInt(o.GetVertexCount());var r=o.GetVertices(),s=new Vector(e);for(o=0;e>o;++o)s[o]=t.MulX(n,r[o]);this.m_debugDraw.DrawSolidPolygon(s,e,i);break;case y.e_edgeShape:o=e instanceof m?e:null,this.m_debugDraw.DrawSegment(t.MulX(n,o.GetVertex1()),t.MulX(n,o.GetVertex2()),i)}},Box2D.postDefs.push(function(){Box2D.Dynamics.b2World.s_timestep2=new M,Box2D.Dynamics.b2World.s_xf=new n,Box2D.Dynamics.b2World.s_backupA=new e,Box2D.Dynamics.b2World.s_backupB=new e,Box2D.Dynamics.b2World.s_timestep=new M,Box2D.Dynamics.b2World.s_queue=new Vector,Box2D.Dynamics.b2World.s_jointColor=new o(.5,.8,.8),Box2D.Dynamics.b2World.e_newFixture=1,Box2D.Dynamics.b2World.e_locked=2})}(),function(){var t=Box2D.Collision.Shapes.b2CircleShape,e=Box2D.Collision.Shapes.b2EdgeShape,n=Box2D.Collision.Shapes.b2PolygonShape,i=Box2D.Collision.Shapes.b2Shape,o=Box2D.Dynamics.Contacts.b2CircleContact,r=Box2D.Dynamics.Contacts.b2Contact,s=Box2D.Dynamics.Contacts.b2ContactConstraint,a=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,l=Box2D.Dynamics.Contacts.b2ContactEdge,c=Box2D.Dynamics.Contacts.b2ContactFactory,u=Box2D.Dynamics.Contacts.b2ContactRegister,h=Box2D.Dynamics.Contacts.b2ContactResult,m=Box2D.Dynamics.Contacts.b2ContactSolver,p=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,f=Box2D.Dynamics.Contacts.b2NullContact,y=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,d=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,_=Box2D.Dynamics.Contacts.b2PolygonContact,g=Box2D.Dynamics.Contacts.b2PositionSolverManifold,x=Box2D.Dynamics.b2Body,v=Box2D.Dynamics.b2TimeStep,b=Box2D.Common.b2Settings,w=Box2D.Common.Math.b2Mat22,D=Box2D.Common.Math.b2Math,B=Box2D.Common.Math.b2Vec2,C=Box2D.Collision.b2Collision,S=Box2D.Collision.b2ContactID,A=Box2D.Collision.b2Manifold,M=Box2D.Collision.b2TimeOfImpact,V=Box2D.Collision.b2TOIInput,I=Box2D.Collision.b2WorldManifold;Box2D.inherit(o,Box2D.Dynamics.Contacts.b2Contact),o.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,o.b2CircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},o.Create=function(){return new o},o.Destroy=function(){},o.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e)},o.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody(),n=this.m_fixtureB.GetBody();C.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof t?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,n.m_xf)},r.b2Contact=function(){this.m_nodeA=new l,this.m_nodeB=new l,this.m_manifold=new A,this.m_oldManifold=new A},r.prototype.GetManifold=function(){return this.m_manifold},r.prototype.GetWorldManifold=function(t){var e=this.m_fixtureA.GetBody(),n=this.m_fixtureB.GetBody(),i=this.m_fixtureA.GetShape(),o=this.m_fixtureB.GetShape();t.Initialize(this.m_manifold,e.GetTransform(),i.m_radius,n.GetTransform(),o.m_radius)},r.prototype.IsTouching=function(){return(this.m_flags&r.e_touchingFlag)==r.e_touchingFlag},r.prototype.IsContinuous=function(){return(this.m_flags&r.e_continuousFlag)==r.e_continuousFlag},r.prototype.SetSensor=function(t){t?this.m_flags|=r.e_sensorFlag:this.m_flags&=~r.e_sensorFlag},r.prototype.IsSensor=function(){return(this.m_flags&r.e_sensorFlag)==r.e_sensorFlag},r.prototype.SetEnabled=function(t){t?this.m_flags|=r.e_enabledFlag:this.m_flags&=~r.e_enabledFlag},r.prototype.IsEnabled=function(){return(this.m_flags&r.e_enabledFlag)==r.e_enabledFlag},r.prototype.GetNext=function(){return this.m_next},r.prototype.GetFixtureA=function(){return this.m_fixtureA},r.prototype.GetFixtureB=function(){return this.m_fixtureB},r.prototype.FlagForFiltering=function(){this.m_flags|=r.e_filterFlag},r.prototype.b2Contact=function(){},r.prototype.Reset=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=null),this.m_flags=r.e_enabledFlag,t&&e){(t.IsSensor()||e.IsSensor())&&(this.m_flags|=r.e_sensorFlag);var n=t.GetBody(),i=e.GetBody();(n.GetType()!=x.b2_dynamicBody||n.IsBullet()||i.GetType()!=x.b2_dynamicBody||i.IsBullet())&&(this.m_flags|=r.e_continuousFlag),this.m_fixtureA=t,this.m_fixtureB=e,this.m_manifold.m_pointCount=0,this.m_next=this.m_prev=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null}else this.m_fixtureB=this.m_fixtureA=null},r.prototype.Update=function(t){var e=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=e,this.m_flags|=r.e_enabledFlag;var n=!1;e=(this.m_flags&r.e_touchingFlag)==r.e_touchingFlag;var o=this.m_fixtureA.m_body,s=this.m_fixtureB.m_body,a=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&r.e_sensorFlag)a&&(n=this.m_fixtureA.GetShape(),a=this.m_fixtureB.GetShape(),o=o.GetTransform(),s=s.GetTransform(),n=i.TestOverlap(n,o,a,s)),this.m_manifold.m_pointCount=0;else{if(o.GetType()!=x.b2_dynamicBody||o.IsBullet()||s.GetType()!=x.b2_dynamicBody||s.IsBullet()?this.m_flags|=r.e_continuousFlag:this.m_flags&=~r.e_continuousFlag,a)for(this.Evaluate(),n=this.m_manifold.m_pointCount>0,a=0;a<this.m_manifold.m_pointCount;++a){var l=this.m_manifold.m_points[a];l.m_normalImpulse=0,l.m_tangentImpulse=0;for(var c=l.m_id,u=0;u<this.m_oldManifold.m_pointCount;++u){var h=this.m_oldManifold.m_points[u];if(h.m_id.key==c.key){l.m_normalImpulse=h.m_normalImpulse,l.m_tangentImpulse=h.m_tangentImpulse;break}}}else this.m_manifold.m_pointCount=0;n!=e&&(o.SetAwake(!0),s.SetAwake(!0))}n?this.m_flags|=r.e_touchingFlag:this.m_flags&=~r.e_touchingFlag,0==e&&1==n&&t.BeginContact(this),1==e&&0==n&&t.EndContact(this),0==(this.m_flags&r.e_sensorFlag)&&t.PreSolve(this,this.m_oldManifold)},r.prototype.Evaluate=function(){},r.prototype.ComputeTOI=function(t,e){return r.s_input.proxyA.Set(this.m_fixtureA.GetShape()),r.s_input.proxyB.Set(this.m_fixtureB.GetShape()),r.s_input.sweepA=t,r.s_input.sweepB=e,r.s_input.tolerance=b.b2_linearSlop,M.TimeOfImpact(r.s_input)},Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2Contact.e_sensorFlag=1,Box2D.Dynamics.Contacts.b2Contact.e_continuousFlag=2,Box2D.Dynamics.Contacts.b2Contact.e_islandFlag=4,Box2D.Dynamics.Contacts.b2Contact.e_toiFlag=8,Box2D.Dynamics.Contacts.b2Contact.e_touchingFlag=16,Box2D.Dynamics.Contacts.b2Contact.e_enabledFlag=32,Box2D.Dynamics.Contacts.b2Contact.e_filterFlag=64,Box2D.Dynamics.Contacts.b2Contact.s_input=new V}),s.b2ContactConstraint=function(){this.localPlaneNormal=new B,this.localPoint=new B,this.normal=new B,this.normalMass=new w,this.K=new w},s.prototype.b2ContactConstraint=function(){this.points=new Vector(b.b2_maxManifoldPoints);for(var t=0;t<b.b2_maxManifoldPoints;t++)this.points[t]=new a},a.b2ContactConstraintPoint=function(){this.localPoint=new B,this.rA=new B,this.rB=new B},l.b2ContactEdge=function(){},c.b2ContactFactory=function(){},c.prototype.b2ContactFactory=function(t){this.m_allocator=t,this.InitializeRegisters()},c.prototype.AddType=function(t,e,n,i){void 0===n&&(n=0),void 0===i&&(i=0),this.m_registers[n][i].createFcn=t,this.m_registers[n][i].destroyFcn=e,this.m_registers[n][i].primary=!0,n!=i&&(this.m_registers[i][n].createFcn=t,this.m_registers[i][n].destroyFcn=e,this.m_registers[i][n].primary=!1)},c.prototype.InitializeRegisters=function(){this.m_registers=new Vector(i.e_shapeTypeCount);for(var t=0;t<i.e_shapeTypeCount;t++){this.m_registers[t]=new Vector(i.e_shapeTypeCount);for(var e=0;e<i.e_shapeTypeCount;e++)this.m_registers[t][e]=new u}this.AddType(o.Create,o.Destroy,i.e_circleShape,i.e_circleShape),this.AddType(y.Create,y.Destroy,i.e_polygonShape,i.e_circleShape),this.AddType(_.Create,_.Destroy,i.e_polygonShape,i.e_polygonShape),this.AddType(p.Create,p.Destroy,i.e_edgeShape,i.e_circleShape),this.AddType(d.Create,d.Destroy,i.e_polygonShape,i.e_edgeShape)},c.prototype.Create=function(t,e){var n=parseInt(t.GetType()),i=parseInt(e.GetType());return n=this.m_registers[n][i],n.pool?(i=n.pool,n.pool=i.m_next,n.poolCount--,i.Reset(t,e),i):(i=n.createFcn,null!=i?(n.primary?(i=i(this.m_allocator),i.Reset(t,e)):(i=i(this.m_allocator),i.Reset(e,t)),i):null)},c.prototype.Destroy=function(t){t.m_manifold.m_pointCount>0&&(t.m_fixtureA.m_body.SetAwake(!0),t.m_fixtureB.m_body.SetAwake(!0));var e=parseInt(t.m_fixtureA.GetType()),n=parseInt(t.m_fixtureB.GetType());e=this.m_registers[e][n],e.poolCount++,t.m_next=e.pool,e.pool=t,(e=e.destroyFcn)(t,this.m_allocator)},u.b2ContactRegister=function(){},h.b2ContactResult=function(){this.position=new B,this.normal=new B,this.id=new S},m.b2ContactSolver=function(){this.m_step=new v,this.m_constraints=new Vector},m.prototype.b2ContactSolver=function(){},m.prototype.Initialize=function(t,e,n,i){void 0===n&&(n=0);var o;for(this.m_step.Set(t),this.m_allocator=i,t=0,this.m_constraintCount=n;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new s;for(t=0;n>t;++t){o=e[t],i=o.m_fixtureA;var r=o.m_fixtureB,a=i.m_shape.m_radius,l=r.m_shape.m_radius,c=i.m_body,u=r.m_body,h=o.GetManifold(),p=b.b2MixFriction(i.GetFriction(),r.GetFriction()),f=b.b2MixRestitution(i.GetRestitution(),r.GetRestitution()),y=c.m_linearVelocity.x,d=c.m_linearVelocity.y,_=u.m_linearVelocity.x,g=u.m_linearVelocity.y,x=c.m_angularVelocity,v=u.m_angularVelocity;for(b.b2Assert(h.m_pointCount>0),m.s_worldManifold.Initialize(h,c.m_xf,a,u.m_xf,l),r=m.s_worldManifold.m_normal.x,o=m.s_worldManifold.m_normal.y,i=this.m_constraints[t],i.bodyA=c,i.bodyB=u,i.manifold=h,i.normal.x=r,i.normal.y=o,i.pointCount=h.m_pointCount,i.friction=p,i.restitution=f,i.localPlaneNormal.x=h.m_localPlaneNormal.x,i.localPlaneNormal.y=h.m_localPlaneNormal.y,i.localPoint.x=h.m_localPoint.x,i.localPoint.y=h.m_localPoint.y,i.radius=a+l,i.type=h.m_type,a=0;a<i.pointCount;++a){p=h.m_points[a],l=i.points[a],l.normalImpulse=p.m_normalImpulse,l.tangentImpulse=p.m_tangentImpulse,l.localPoint.SetV(p.m_localPoint),p=l.rA.x=m.s_worldManifold.m_points[a].x-c.m_sweep.c.x,f=l.rA.y=m.s_worldManifold.m_points[a].y-c.m_sweep.c.y;var w=l.rB.x=m.s_worldManifold.m_points[a].x-u.m_sweep.c.x,D=l.rB.y=m.s_worldManifold.m_points[a].y-u.m_sweep.c.y,B=p*o-f*r,C=w*o-D*r;B*=B,C*=C,l.normalMass=1/(c.m_invMass+u.m_invMass+c.m_invI*B+u.m_invI*C);var S=c.m_mass*c.m_invMass+u.m_mass*u.m_invMass;S+=c.m_mass*c.m_invI*B+u.m_mass*u.m_invI*C,l.equalizedMass=1/S,C=o,S=-r,B=p*S-f*C,C=w*S-D*C,B*=B,C*=C,l.tangentMass=1/(c.m_invMass+u.m_invMass+c.m_invI*B+u.m_invI*C),l.velocityBias=0,p=i.normal.x*(_+-v*D-y- -x*f)+i.normal.y*(g+v*w-d-x*p),p<-b.b2_velocityThreshold&&(l.velocityBias+=-i.restitution*p)}2==i.pointCount&&(g=i.points[0],_=i.points[1],h=c.m_invMass,c=c.m_invI,y=u.m_invMass,u=u.m_invI,d=g.rA.x*o-g.rA.y*r,g=g.rB.x*o-g.rB.y*r,x=_.rA.x*o-_.rA.y*r,_=_.rB.x*o-_.rB.y*r,r=h+y+c*d*d+u*g*g,o=h+y+c*x*x+u*_*_,u=h+y+c*d*x+u*g*_,100*(r*o-u*u)>r*r?(i.K.col1.Set(r,u),i.K.col2.Set(u,o),i.K.GetInverse(i.normalMass)):i.pointCount=1)}},m.prototype.InitVelocityConstraints=function(t){for(var e=0;e<this.m_constraintCount;++e){var n=this.m_constraints[e],i=n.bodyA,o=n.bodyB,r=i.m_invMass,s=i.m_invI,a=o.m_invMass,l=o.m_invI,c=n.normal.x,u=n.normal.y,h=u,m=-c,p=0,f=0;if(t.warmStarting)for(f=n.pointCount,p=0;f>p;++p){var y=n.points[p];y.normalImpulse*=t.dtRatio,y.tangentImpulse*=t.dtRatio;var d=y.normalImpulse*c+y.tangentImpulse*h,_=y.normalImpulse*u+y.tangentImpulse*m;i.m_angularVelocity-=s*(y.rA.x*_-y.rA.y*d),i.m_linearVelocity.x-=r*d,i.m_linearVelocity.y-=r*_,o.m_angularVelocity+=l*(y.rB.x*_-y.rB.y*d),o.m_linearVelocity.x+=a*d,o.m_linearVelocity.y+=a*_}else for(f=n.pointCount,p=0;f>p;++p)i=n.points[p],i.normalImpulse=0,i.tangentImpulse=0}},m.prototype.SolveVelocityConstraints=function(){for(var t,e,n=0,i=0,o=0,r=0,s=o=o=i=i=0,a=i=i=0,l=i=r=0,c=0,u=0;u<this.m_constraintCount;++u){r=this.m_constraints[u];var h=r.bodyA,m=r.bodyB,p=h.m_angularVelocity,f=m.m_angularVelocity,y=h.m_linearVelocity,d=m.m_linearVelocity,_=h.m_invMass,g=h.m_invI,x=m.m_invMass,v=m.m_invI;l=r.normal.x;var b=c=r.normal.y;for(e=-l,a=r.friction,n=0;n<r.pointCount;n++)t=r.points[n],i=d.x-f*t.rB.y-y.x+p*t.rA.y,o=d.y+f*t.rB.x-y.y-p*t.rA.x,i=i*b+o*e,i=t.tangentMass*-i,o=a*t.normalImpulse,o=D.Clamp(t.tangentImpulse+i,-o,o),i=o-t.tangentImpulse,s=i*b,i*=e,y.x-=_*s,y.y-=_*i,p-=g*(t.rA.x*i-t.rA.y*s),d.x+=x*s,d.y+=x*i,f+=v*(t.rB.x*i-t.rB.y*s),t.tangentImpulse=o;if(parseInt(r.pointCount),1==r.pointCount)t=r.points[0],i=d.x+-f*t.rB.y-y.x- -p*t.rA.y,o=d.y+f*t.rB.x-y.y-p*t.rA.x,r=i*l+o*c,i=-t.normalMass*(r-t.velocityBias),o=t.normalImpulse+i,o=o>0?o:0,i=o-t.normalImpulse,s=i*l,i*=c,y.x-=_*s,y.y-=_*i,p-=g*(t.rA.x*i-t.rA.y*s),d.x+=x*s,d.y+=x*i,f+=v*(t.rB.x*i-t.rB.y*s),t.normalImpulse=o;else{t=r.points[0],n=r.points[1],i=t.normalImpulse,a=n.normalImpulse;var w=(d.x-f*t.rB.y-y.x+p*t.rA.y)*l+(d.y+f*t.rB.x-y.y-p*t.rA.x)*c,B=(d.x-f*n.rB.y-y.x+p*n.rA.y)*l+(d.y+f*n.rB.x-y.y-p*n.rA.x)*c;for(o=w-t.velocityBias,s=B-n.velocityBias,e=r.K,o-=e.col1.x*i+e.col2.x*a,s-=e.col1.y*i+e.col2.y*a;;){if(e=r.normalMass,b=-(e.col1.x*o+e.col2.x*s),e=-(e.col1.y*o+e.col2.y*s),b>=0&&e>=0){i=b-i,a=e-a,r=i*l,i*=c,l=a*l,c=a*c,y.x-=_*(r+l),y.y-=_*(i+c),p-=g*(t.rA.x*i-t.rA.y*r+n.rA.x*c-n.rA.y*l),d.x+=x*(r+l),d.y+=x*(i+c),f+=v*(t.rB.x*i-t.rB.y*r+n.rB.x*c-n.rB.y*l),t.normalImpulse=b,n.normalImpulse=e;break}if(b=-t.normalMass*o,e=0,B=r.K.col1.y*b+s,b>=0&&B>=0){i=b-i,a=e-a,r=i*l,i*=c,l=a*l,c=a*c,y.x-=_*(r+l),y.y-=_*(i+c),p-=g*(t.rA.x*i-t.rA.y*r+n.rA.x*c-n.rA.y*l),d.x+=x*(r+l),d.y+=x*(i+c),f+=v*(t.rB.x*i-t.rB.y*r+n.rB.x*c-n.rB.y*l),t.normalImpulse=b,n.normalImpulse=e;break}if(b=0,e=-n.normalMass*s,w=r.K.col2.x*e+o,e>=0&&w>=0){i=b-i,a=e-a,r=i*l,i*=c,l=a*l,c=a*c,y.x-=_*(r+l),y.y-=_*(i+c),p-=g*(t.rA.x*i-t.rA.y*r+n.rA.x*c-n.rA.y*l),d.x+=x*(r+l),d.y+=x*(i+c),f+=v*(t.rB.x*i-t.rB.y*r+n.rB.x*c-n.rB.y*l),t.normalImpulse=b,n.normalImpulse=e;break}if(e=b=0,w=o,B=s,w>=0&&B>=0){i=b-i,a=e-a,r=i*l,i*=c,l=a*l,c=a*c,y.x-=_*(r+l),y.y-=_*(i+c),p-=g*(t.rA.x*i-t.rA.y*r+n.rA.x*c-n.rA.y*l),d.x+=x*(r+l),d.y+=x*(i+c),f+=v*(t.rB.x*i-t.rB.y*r+n.rB.x*c-n.rB.y*l),t.normalImpulse=b,n.normalImpulse=e;break}break}}h.m_angularVelocity=p,m.m_angularVelocity=f}},m.prototype.FinalizeVelocityConstraints=function(){for(var t=0;t<this.m_constraintCount;++t)for(var e=this.m_constraints[t],n=e.manifold,i=0;i<e.pointCount;++i){var o=n.m_points[i],r=e.points[i];o.m_normalImpulse=r.normalImpulse,o.m_tangentImpulse=r.tangentImpulse}},m.prototype.SolvePositionConstraints=function(t){void 0===t&&(t=0);for(var e=0,n=0;n<this.m_constraintCount;n++){var i=this.m_constraints[n],o=i.bodyA,r=i.bodyB,s=o.m_mass*o.m_invMass,a=o.m_mass*o.m_invI,l=r.m_mass*r.m_invMass,c=r.m_mass*r.m_invI;m.s_psm.Initialize(i);for(var u=m.s_psm.m_normal,h=0;h<i.pointCount;h++){var p=i.points[h],f=m.s_psm.m_points[h],y=m.s_psm.m_separations[h],d=f.x-o.m_sweep.c.x,_=f.y-o.m_sweep.c.y,g=f.x-r.m_sweep.c.x;f=f.y-r.m_sweep.c.y,e=y>e?e:y,y=D.Clamp(t*(y+b.b2_linearSlop),-b.b2_maxLinearCorrection,0),y=-p.equalizedMass*y,p=y*u.x,y*=u.y,o.m_sweep.c.x-=s*p,o.m_sweep.c.y-=s*y,o.m_sweep.a-=a*(d*y-_*p),o.SynchronizeTransform(),r.m_sweep.c.x+=l*p,r.m_sweep.c.y+=l*y,r.m_sweep.a+=c*(g*y-f*p),r.SynchronizeTransform()}}return e>-1.5*b.b2_linearSlop},Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new I,Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new g}),Box2D.inherit(p,Box2D.Dynamics.Contacts.b2Contact),p.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,p.b2EdgeAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},p.Create=function(){return new p},p.Destroy=function(){},p.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e)},p.prototype.Evaluate=function(){var n=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof e?this.m_fixtureA.GetShape():null,n.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,i.m_xf)},p.prototype.b2CollideEdgeAndCircle=function(){},Box2D.inherit(f,Box2D.Dynamics.Contacts.b2Contact),f.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,f.b2NullContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},f.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)},f.prototype.Evaluate=function(){},Box2D.inherit(y,Box2D.Dynamics.Contacts.b2Contact),y.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,y.b2PolyAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},y.Create=function(){return new y},y.Destroy=function(){},y.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e),b.b2Assert(t.GetType()==i.e_polygonShape),b.b2Assert(e.GetType()==i.e_circleShape)},y.prototype.Evaluate=function(){var e=this.m_fixtureA.m_body,i=this.m_fixtureB.m_body;C.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof n?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,i.m_xf)},Box2D.inherit(d,Box2D.Dynamics.Contacts.b2Contact),d.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,d.b2PolyAndEdgeContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},d.Create=function(){return new d},d.Destroy=function(){},d.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e),b.b2Assert(t.GetType()==i.e_polygonShape),b.b2Assert(e.GetType()==i.e_edgeShape)},d.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof n?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,i.m_xf)},d.prototype.b2CollidePolyAndEdge=function(){},Box2D.inherit(_,Box2D.Dynamics.Contacts.b2Contact),_.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,_.b2PolygonContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},_.Create=function(){return new _},_.Destroy=function(){},_.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e)},_.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody(),e=this.m_fixtureB.GetBody();C.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof n?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof n?this.m_fixtureB.GetShape():null,e.m_xf)},g.b2PositionSolverManifold=function(){},g.prototype.b2PositionSolverManifold=function(){this.m_normal=new B,this.m_separations=new Vector_a2j_Number(b.b2_maxManifoldPoints),this.m_points=new Vector(b.b2_maxManifoldPoints);for(var t=0;t<b.b2_maxManifoldPoints;t++)this.m_points[t]=new B},g.prototype.Initialize=function(t){b.b2Assert(t.pointCount>0);var e,n=0,i=0,o=0,r=0,s=0;switch(t.type){case A.e_circles:e=t.bodyA.m_xf.R,o=t.localPoint,n=t.bodyA.m_xf.position.x+(e.col1.x*o.x+e.col2.x*o.y),i=t.bodyA.m_xf.position.y+(e.col1.y*o.x+e.col2.y*o.y),e=t.bodyB.m_xf.R,o=t.points[0].localPoint,r=t.bodyB.m_xf.position.x+(e.col1.x*o.x+e.col2.x*o.y),e=t.bodyB.m_xf.position.y+(e.col1.y*o.x+e.col2.y*o.y),o=r-n,s=e-i;var a=o*o+s*s;a>Number.MIN_VALUE*Number.MIN_VALUE?(a=Math.sqrt(a),this.m_normal.x=o/a,this.m_normal.y=s/a):(this.m_normal.x=1,this.m_normal.y=0),this.m_points[0].x=.5*(n+r),this.m_points[0].y=.5*(i+e),this.m_separations[0]=o*this.m_normal.x+s*this.m_normal.y-t.radius;break;case A.e_faceA:for(e=t.bodyA.m_xf.R,o=t.localPlaneNormal,this.m_normal.x=e.col1.x*o.x+e.col2.x*o.y,this.m_normal.y=e.col1.y*o.x+e.col2.y*o.y,e=t.bodyA.m_xf.R,o=t.localPoint,r=t.bodyA.m_xf.position.x+(e.col1.x*o.x+e.col2.x*o.y),s=t.bodyA.m_xf.position.y+(e.col1.y*o.x+e.col2.y*o.y),e=t.bodyB.m_xf.R,n=0;n<t.pointCount;++n)o=t.points[n].localPoint,i=t.bodyB.m_xf.position.x+(e.col1.x*o.x+e.col2.x*o.y),o=t.bodyB.m_xf.position.y+(e.col1.y*o.x+e.col2.y*o.y),this.m_separations[n]=(i-r)*this.m_normal.x+(o-s)*this.m_normal.y-t.radius,this.m_points[n].x=i,this.m_points[n].y=o;break;case A.e_faceB:for(e=t.bodyB.m_xf.R,o=t.localPlaneNormal,this.m_normal.x=e.col1.x*o.x+e.col2.x*o.y,this.m_normal.y=e.col1.y*o.x+e.col2.y*o.y,e=t.bodyB.m_xf.R,o=t.localPoint,r=t.bodyB.m_xf.position.x+(e.col1.x*o.x+e.col2.x*o.y),s=t.bodyB.m_xf.position.y+(e.col1.y*o.x+e.col2.y*o.y),e=t.bodyA.m_xf.R,n=0;n<t.pointCount;++n)o=t.points[n].localPoint,i=t.bodyA.m_xf.position.x+(e.col1.x*o.x+e.col2.x*o.y),o=t.bodyA.m_xf.position.y+(e.col1.y*o.x+e.col2.y*o.y),this.m_separations[n]=(i-r)*this.m_normal.x+(o-s)*this.m_normal.y-t.radius,this.m_points[n].Set(i,o);this.m_normal.x*=-1,this.m_normal.y*=-1}},Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new B,Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new B})}(),function(){var t=Box2D.Common.Math.b2Mat22,e=Box2D.Common.Math.b2Math,n=Box2D.Common.Math.b2Vec2,i=Box2D.Common.b2Color,o=Box2D.Dynamics.Controllers.b2BuoyancyController,r=Box2D.Dynamics.Controllers.b2ConstantAccelController,s=Box2D.Dynamics.Controllers.b2ConstantForceController,a=Box2D.Dynamics.Controllers.b2Controller,l=Box2D.Dynamics.Controllers.b2ControllerEdge,c=Box2D.Dynamics.Controllers.b2GravityController,u=Box2D.Dynamics.Controllers.b2TensorDampingController;Box2D.inherit(o,Box2D.Dynamics.Controllers.b2Controller),o.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,o.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.normal=new n(0,-1),this.density=this.offset=0,this.velocity=new n(0,0),this.linearDrag=2,this.angularDrag=1,this.useDensity=!1,this.useWorldGravity=!0,this.gravity=null},o.prototype.Step=function(){if(this.m_bodyList){this.useWorldGravity&&(this.gravity=this.GetWorld().GetGravity().Copy());for(var t=this.m_bodyList;t;t=t.nextBody){var e=t.body;if(0!=e.IsAwake()){for(var i=new n,o=new n,r=0,s=0,a=e.GetFixtureList();a;a=a.GetNext()){var l=new n,c=a.GetShape().ComputeSubmergedArea(this.normal,this.offset,e.GetTransform(),l);r+=c,i.x+=c*l.x,i.y+=c*l.y;var u=0;u=1,s+=c*u,o.x+=c*l.x*u,o.y+=c*l.y*u}i.x/=r,i.y/=r,o.x/=s,o.y/=s,r<Number.MIN_VALUE||(s=this.gravity.GetNegative(),s.Multiply(this.density*r),e.ApplyForce(s,o),o=e.GetLinearVelocityFromWorldPoint(i),o.Subtract(this.velocity),o.Multiply(-this.linearDrag*r),e.ApplyForce(o,i),e.ApplyTorque(-e.GetInertia()/e.GetMass()*r*e.GetAngularVelocity()*this.angularDrag))}}}},o.prototype.Draw=function(t){var e=new n,o=new n;e.x=this.normal.x*this.offset+1e3*this.normal.y,e.y=this.normal.y*this.offset-1e3*this.normal.x,o.x=this.normal.x*this.offset-1e3*this.normal.y,o.y=this.normal.y*this.offset+1e3*this.normal.x;var r=new i(0,0,1);t.DrawSegment(e,o,r)},Box2D.inherit(r,Box2D.Dynamics.Controllers.b2Controller),r.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,r.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.A=new n(0,0)},r.prototype.Step=function(t){t=new n(this.A.x*t.dt,this.A.y*t.dt);for(var e=this.m_bodyList;e;e=e.nextBody){var i=e.body;i.IsAwake()&&i.SetLinearVelocity(new n(i.GetLinearVelocity().x+t.x,i.GetLinearVelocity().y+t.y))}},Box2D.inherit(s,Box2D.Dynamics.Controllers.b2Controller),s.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,s.b2ConstantForceController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.F=new n(0,0)},s.prototype.Step=function(){for(var t=this.m_bodyList;t;t=t.nextBody){var e=t.body;e.IsAwake()&&e.ApplyForce(this.F,e.GetWorldCenter())}},a.b2Controller=function(){},a.prototype.Step=function(){},a.prototype.Draw=function(){},a.prototype.AddBody=function(t){var e=new l;e.controller=this,e.body=t,e.nextBody=this.m_bodyList,e.prevBody=null,this.m_bodyList=e,e.nextBody&&(e.nextBody.prevBody=e),this.m_bodyCount++,e.nextController=t.m_controllerList,e.prevController=null,t.m_controllerList=e,e.nextController&&(e.nextController.prevController=e),t.m_controllerCount++},a.prototype.RemoveBody=function(t){for(var e=t.m_controllerList;e&&e.controller!=this;)e=e.nextController;e.prevBody&&(e.prevBody.nextBody=e.nextBody),e.nextBody&&(e.nextBody.prevBody=e.prevBody),e.nextController&&(e.nextController.prevController=e.prevController),e.prevController&&(e.prevController.nextController=e.nextController),this.m_bodyList==e&&(this.m_bodyList=e.nextBody),t.m_controllerList==e&&(t.m_controllerList=e.nextController),t.m_controllerCount--,this.m_bodyCount--},a.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)},a.prototype.GetNext=function(){return this.m_next},a.prototype.GetWorld=function(){return this.m_world},a.prototype.GetBodyList=function(){return this.m_bodyList},l.b2ControllerEdge=function(){},Box2D.inherit(c,Box2D.Dynamics.Controllers.b2Controller),c.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,c.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.G=1,this.invSqr=!0},c.prototype.Step=function(){var t=null,e=null,i=null,o=0,r=null,s=null,a=null,l=0,c=0,u=0;if(l=null,this.invSqr)for(t=this.m_bodyList;t;t=t.nextBody)for(e=t.body,i=e.GetWorldCenter(),o=e.GetMass(),r=this.m_bodyList;r!=t;r=r.nextBody)s=r.body,a=s.GetWorldCenter(),l=a.x-i.x,c=a.y-i.y,u=l*l+c*c,u<Number.MIN_VALUE||(l=new n(l,c),l.Multiply(this.G/u/Math.sqrt(u)*o*s.GetMass()),e.IsAwake()&&e.ApplyForce(l,i),l.Multiply(-1),s.IsAwake()&&s.ApplyForce(l,a));else for(t=this.m_bodyList;t;t=t.nextBody)for(e=t.body,i=e.GetWorldCenter(),o=e.GetMass(),r=this.m_bodyList;r!=t;r=r.nextBody)s=r.body,a=s.GetWorldCenter(),l=a.x-i.x,c=a.y-i.y,u=l*l+c*c,u<Number.MIN_VALUE||(l=new n(l,c),l.Multiply(this.G/u*o*s.GetMass()),e.IsAwake()&&e.ApplyForce(l,i),l.Multiply(-1),s.IsAwake()&&s.ApplyForce(l,a))},Box2D.inherit(u,Box2D.Dynamics.Controllers.b2Controller),u.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,u.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.T=new t,this.maxTimestep=0},u.prototype.SetAxisAligned=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.T.col1.x=-t,this.T.col1.y=0,this.T.col2.x=0,this.T.col2.y=-e,this.maxTimestep=t>0||e>0?1/Math.max(t,e):0},u.prototype.Step=function(t){if(t=t.dt,!(t<=Number.MIN_VALUE)){t>this.maxTimestep&&this.maxTimestep>0&&(t=this.maxTimestep);for(var i=this.m_bodyList;i;i=i.nextBody){var o=i.body;if(o.IsAwake()){var r=o.GetWorldVector(e.MulMV(this.T,o.GetLocalVector(o.GetLinearVelocity())));o.SetLinearVelocity(new n(o.GetLinearVelocity().x+r.x*t,o.GetLinearVelocity().y+r.y*t))}}}}}(),function(){var t=Box2D.Common.b2Settings,e=Box2D.Common.Math.b2Mat22,n=Box2D.Common.Math.b2Mat33,i=Box2D.Common.Math.b2Math,o=Box2D.Common.Math.b2Vec2,r=Box2D.Common.Math.b2Vec3,s=Box2D.Dynamics.Joints.b2DistanceJoint,a=Box2D.Dynamics.Joints.b2DistanceJointDef,l=Box2D.Dynamics.Joints.b2FrictionJoint,c=Box2D.Dynamics.Joints.b2FrictionJointDef,u=Box2D.Dynamics.Joints.b2GearJoint,h=Box2D.Dynamics.Joints.b2GearJointDef,m=Box2D.Dynamics.Joints.b2Jacobian,p=Box2D.Dynamics.Joints.b2Joint,f=Box2D.Dynamics.Joints.b2JointDef,y=Box2D.Dynamics.Joints.b2JointEdge,d=Box2D.Dynamics.Joints.b2LineJoint,_=Box2D.Dynamics.Joints.b2LineJointDef,g=Box2D.Dynamics.Joints.b2MouseJoint,x=Box2D.Dynamics.Joints.b2MouseJointDef,v=Box2D.Dynamics.Joints.b2PrismaticJoint,b=Box2D.Dynamics.Joints.b2PrismaticJointDef,w=Box2D.Dynamics.Joints.b2PulleyJoint,D=Box2D.Dynamics.Joints.b2PulleyJointDef,B=Box2D.Dynamics.Joints.b2RevoluteJoint,C=Box2D.Dynamics.Joints.b2RevoluteJointDef,S=Box2D.Dynamics.Joints.b2WeldJoint,A=Box2D.Dynamics.Joints.b2WeldJointDef;
Box2D.inherit(s,Box2D.Dynamics.Joints.b2Joint),s.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,s.b2DistanceJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new o,this.m_localAnchor2=new o,this.m_u=new o},s.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},s.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},s.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new o(t*this.m_impulse*this.m_u.x,t*this.m_impulse*this.m_u.y)},s.prototype.GetReactionTorque=function(){return 0},s.prototype.GetLength=function(){return this.m_length},s.prototype.SetLength=function(t){void 0===t&&(t=0),this.m_length=t},s.prototype.GetFrequency=function(){return this.m_frequencyHz},s.prototype.SetFrequency=function(t){void 0===t&&(t=0),this.m_frequencyHz=t},s.prototype.GetDampingRatio=function(){return this.m_dampingRatio},s.prototype.SetDampingRatio=function(t){void 0===t&&(t=0),this.m_dampingRatio=t},s.prototype.b2DistanceJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_length=t.length,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_bias=this.m_gamma=this.m_impulse=0},s.prototype.InitVelocityConstraints=function(e){var n,i=0,o=this.m_bodyA,r=this.m_bodyB;n=o.m_xf.R;var s=this.m_localAnchor1.x-o.m_sweep.localCenter.x,a=this.m_localAnchor1.y-o.m_sweep.localCenter.y;i=n.col1.x*s+n.col2.x*a,a=n.col1.y*s+n.col2.y*a,s=i,n=r.m_xf.R;var l=this.m_localAnchor2.x-r.m_sweep.localCenter.x,c=this.m_localAnchor2.y-r.m_sweep.localCenter.y;i=n.col1.x*l+n.col2.x*c,c=n.col1.y*l+n.col2.y*c,l=i,this.m_u.x=r.m_sweep.c.x+l-o.m_sweep.c.x-s,this.m_u.y=r.m_sweep.c.y+c-o.m_sweep.c.y-a,i=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y),i>t.b2_linearSlop?this.m_u.Multiply(1/i):this.m_u.SetZero(),n=s*this.m_u.y-a*this.m_u.x;var u=l*this.m_u.y-c*this.m_u.x;if(n=o.m_invMass+o.m_invI*n*n+r.m_invMass+r.m_invI*u*u,this.m_mass=0!=n?1/n:0,this.m_frequencyHz>0){i-=this.m_length,u=2*Math.PI*this.m_frequencyHz;var h=this.m_mass*u*u;this.m_gamma=e.dt*(2*this.m_mass*this.m_dampingRatio*u+e.dt*h),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=i*e.dt*h*this.m_gamma,this.m_mass=n+this.m_gamma,this.m_mass=0!=this.m_mass?1/this.m_mass:0}e.warmStarting?(this.m_impulse*=e.dtRatio,e=this.m_impulse*this.m_u.x,n=this.m_impulse*this.m_u.y,o.m_linearVelocity.x-=o.m_invMass*e,o.m_linearVelocity.y-=o.m_invMass*n,o.m_angularVelocity-=o.m_invI*(s*n-a*e),r.m_linearVelocity.x+=r.m_invMass*e,r.m_linearVelocity.y+=r.m_invMass*n,r.m_angularVelocity+=r.m_invI*(l*n-c*e)):this.m_impulse=0},s.prototype.SolveVelocityConstraints=function(){var t,e=this.m_bodyA,n=this.m_bodyB;t=e.m_xf.R;var i=this.m_localAnchor1.x-e.m_sweep.localCenter.x,o=this.m_localAnchor1.y-e.m_sweep.localCenter.y,r=t.col1.x*i+t.col2.x*o;o=t.col1.y*i+t.col2.y*o,i=r,t=n.m_xf.R;var s=this.m_localAnchor2.x-n.m_sweep.localCenter.x,a=this.m_localAnchor2.y-n.m_sweep.localCenter.y;r=t.col1.x*s+t.col2.x*a,a=t.col1.y*s+t.col2.y*a,s=r,r=-this.m_mass*(this.m_u.x*(n.m_linearVelocity.x+-n.m_angularVelocity*a-(e.m_linearVelocity.x+-e.m_angularVelocity*o))+this.m_u.y*(n.m_linearVelocity.y+n.m_angularVelocity*s-(e.m_linearVelocity.y+e.m_angularVelocity*i))+this.m_bias+this.m_gamma*this.m_impulse),this.m_impulse+=r,t=r*this.m_u.x,r*=this.m_u.y,e.m_linearVelocity.x-=e.m_invMass*t,e.m_linearVelocity.y-=e.m_invMass*r,e.m_angularVelocity-=e.m_invI*(i*r-o*t),n.m_linearVelocity.x+=n.m_invMass*t,n.m_linearVelocity.y+=n.m_invMass*r,n.m_angularVelocity+=n.m_invI*(s*r-a*t)},s.prototype.SolvePositionConstraints=function(){var e;if(this.m_frequencyHz>0)return!0;var n=this.m_bodyA,o=this.m_bodyB;e=n.m_xf.R;var r=this.m_localAnchor1.x-n.m_sweep.localCenter.x,s=this.m_localAnchor1.y-n.m_sweep.localCenter.y,a=e.col1.x*r+e.col2.x*s;s=e.col1.y*r+e.col2.y*s,r=a,e=o.m_xf.R;var l=this.m_localAnchor2.x-o.m_sweep.localCenter.x,c=this.m_localAnchor2.y-o.m_sweep.localCenter.y;a=e.col1.x*l+e.col2.x*c,c=e.col1.y*l+e.col2.y*c,l=a,a=o.m_sweep.c.x+l-n.m_sweep.c.x-r;var u=o.m_sweep.c.y+c-n.m_sweep.c.y-s;e=Math.sqrt(a*a+u*u),a/=e,u/=e,e-=this.m_length,e=i.Clamp(e,-t.b2_maxLinearCorrection,t.b2_maxLinearCorrection);var h=-this.m_mass*e;return this.m_u.Set(a,u),a=h*this.m_u.x,u=h*this.m_u.y,n.m_sweep.c.x-=n.m_invMass*a,n.m_sweep.c.y-=n.m_invMass*u,n.m_sweep.a-=n.m_invI*(r*u-s*a),o.m_sweep.c.x+=o.m_invMass*a,o.m_sweep.c.y+=o.m_invMass*u,o.m_sweep.a+=o.m_invI*(l*u-c*a),n.SynchronizeTransform(),o.SynchronizeTransform(),i.Abs(e)<t.b2_linearSlop},Box2D.inherit(a,Box2D.Dynamics.Joints.b2JointDef),a.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,a.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new o,this.localAnchorB=new o},a.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this),this.type=p.e_distanceJoint,this.length=1,this.dampingRatio=this.frequencyHz=0},a.prototype.Initialize=function(t,e,n,i){this.bodyA=t,this.bodyB=e,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(i)),t=i.x-n.x,n=i.y-n.y,this.length=Math.sqrt(t*t+n*n),this.dampingRatio=this.frequencyHz=0},Box2D.inherit(l,Box2D.Dynamics.Joints.b2Joint),l.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,l.b2FrictionJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new o,this.m_localAnchorB=new o,this.m_linearMass=new e,this.m_linearImpulse=new o},l.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},l.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},l.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new o(t*this.m_linearImpulse.x,t*this.m_linearImpulse.y)},l.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_angularImpulse},l.prototype.SetMaxForce=function(t){void 0===t&&(t=0),this.m_maxForce=t},l.prototype.GetMaxForce=function(){return this.m_maxForce},l.prototype.SetMaxTorque=function(t){void 0===t&&(t=0),this.m_maxTorque=t},l.prototype.GetMaxTorque=function(){return this.m_maxTorque},l.prototype.b2FrictionJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchorA.SetV(t.localAnchorA),this.m_localAnchorB.SetV(t.localAnchorB),this.m_linearMass.SetZero(),this.m_angularMass=0,this.m_linearImpulse.SetZero(),this.m_angularImpulse=0,this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque},l.prototype.InitVelocityConstraints=function(t){var n,i=0,o=this.m_bodyA,r=this.m_bodyB;n=o.m_xf.R;var s=this.m_localAnchorA.x-o.m_sweep.localCenter.x,a=this.m_localAnchorA.y-o.m_sweep.localCenter.y;i=n.col1.x*s+n.col2.x*a,a=n.col1.y*s+n.col2.y*a,s=i,n=r.m_xf.R;var l=this.m_localAnchorB.x-r.m_sweep.localCenter.x,c=this.m_localAnchorB.y-r.m_sweep.localCenter.y;i=n.col1.x*l+n.col2.x*c,c=n.col1.y*l+n.col2.y*c,l=i,n=o.m_invMass,i=r.m_invMass;var u=o.m_invI,h=r.m_invI,m=new e;m.col1.x=n+i,m.col2.x=0,m.col1.y=0,m.col2.y=n+i,m.col1.x+=u*a*a,m.col2.x+=-u*s*a,m.col1.y+=-u*s*a,m.col2.y+=u*s*s,m.col1.x+=h*c*c,m.col2.x+=-h*l*c,m.col1.y+=-h*l*c,m.col2.y+=h*l*l,m.GetInverse(this.m_linearMass),this.m_angularMass=u+h,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.warmStarting?(this.m_linearImpulse.x*=t.dtRatio,this.m_linearImpulse.y*=t.dtRatio,this.m_angularImpulse*=t.dtRatio,t=this.m_linearImpulse,o.m_linearVelocity.x-=n*t.x,o.m_linearVelocity.y-=n*t.y,o.m_angularVelocity-=u*(s*t.y-a*t.x+this.m_angularImpulse),r.m_linearVelocity.x+=i*t.x,r.m_linearVelocity.y+=i*t.y,r.m_angularVelocity+=h*(l*t.y-c*t.x+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0)},l.prototype.SolveVelocityConstraints=function(t){var e,n=0,r=this.m_bodyA,s=this.m_bodyB,a=r.m_linearVelocity,l=r.m_angularVelocity,c=s.m_linearVelocity,u=s.m_angularVelocity,h=r.m_invMass,m=s.m_invMass,p=r.m_invI,f=s.m_invI;e=r.m_xf.R;var y=this.m_localAnchorA.x-r.m_sweep.localCenter.x,d=this.m_localAnchorA.y-r.m_sweep.localCenter.y;n=e.col1.x*y+e.col2.x*d,d=e.col1.y*y+e.col2.y*d,y=n,e=s.m_xf.R;var _=this.m_localAnchorB.x-s.m_sweep.localCenter.x,g=this.m_localAnchorB.y-s.m_sweep.localCenter.y;n=e.col1.x*_+e.col2.x*g,g=e.col1.y*_+e.col2.y*g,_=n,e=0,n=-this.m_angularMass*(u-l);var x=this.m_angularImpulse;e=t.dt*this.m_maxTorque,this.m_angularImpulse=i.Clamp(this.m_angularImpulse+n,-e,e),n=this.m_angularImpulse-x,l-=p*n,u+=f*n,e=i.MulMV(this.m_linearMass,new o(-(c.x-u*g-a.x+l*d),-(c.y+u*_-a.y-l*y))),n=this.m_linearImpulse.Copy(),this.m_linearImpulse.Add(e),e=t.dt*this.m_maxForce,this.m_linearImpulse.LengthSquared()>e*e&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(e)),e=i.SubtractVV(this.m_linearImpulse,n),a.x-=h*e.x,a.y-=h*e.y,l-=p*(y*e.y-d*e.x),c.x+=m*e.x,c.y+=m*e.y,u+=f*(_*e.y-g*e.x),r.m_angularVelocity=l,s.m_angularVelocity=u},l.prototype.SolvePositionConstraints=function(){return!0},Box2D.inherit(c,Box2D.Dynamics.Joints.b2JointDef),c.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,c.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new o,this.localAnchorB=new o},c.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this),this.type=p.e_frictionJoint,this.maxTorque=this.maxForce=0},c.prototype.Initialize=function(t,e,n){this.bodyA=t,this.bodyB=e,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(n))},Box2D.inherit(u,Box2D.Dynamics.Joints.b2Joint),u.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,u.b2GearJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new o,this.m_groundAnchor2=new o,this.m_localAnchor1=new o,this.m_localAnchor2=new o,this.m_J=new m},u.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},u.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},u.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new o(t*this.m_impulse*this.m_J.linearB.x,t*this.m_impulse*this.m_J.linearB.y)},u.prototype.GetReactionTorque=function(t){void 0===t&&(t=0);var e=this.m_bodyB.m_xf.R,n=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,i=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,o=e.col1.x*n+e.col2.x*i;return i=e.col1.y*n+e.col2.y*i,n=o,t*(this.m_impulse*this.m_J.angularB-n*this.m_impulse*this.m_J.linearB.y+i*this.m_impulse*this.m_J.linearB.x)},u.prototype.GetRatio=function(){return this.m_ratio},u.prototype.SetRatio=function(t){void 0===t&&(t=0),this.m_ratio=t},u.prototype.b2GearJoint=function(t){this.__super.b2Joint.call(this,t);var e=parseInt(t.joint1.m_type),n=parseInt(t.joint2.m_type);this.m_prismatic2=this.m_revolute2=this.m_prismatic1=this.m_revolute1=null;var i=0,o=0;this.m_ground1=t.joint1.GetBodyA(),this.m_bodyA=t.joint1.GetBodyB(),e==p.e_revoluteJoint?(this.m_revolute1=t.joint1 instanceof B?t.joint1:null,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),i=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=t.joint1 instanceof v?t.joint1:null,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),i=this.m_prismatic1.GetJointTranslation()),this.m_ground2=t.joint2.GetBodyA(),this.m_bodyB=t.joint2.GetBodyB(),n==p.e_revoluteJoint?(this.m_revolute2=t.joint2 instanceof B?t.joint2:null,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),o=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=t.joint2 instanceof v?t.joint2:null,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),o=this.m_prismatic2.GetJointTranslation()),this.m_ratio=t.ratio,this.m_constant=i+this.m_ratio*o,this.m_impulse=0},u.prototype.InitVelocityConstraints=function(t){var e=this.m_ground1,n=this.m_ground2,i=this.m_bodyA,o=this.m_bodyB,r=0,s=0,a=0,l=0,c=a=0,u=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angularA=-1,u+=i.m_invI):(e=e.m_xf.R,s=this.m_prismatic1.m_localXAxis1,r=e.col1.x*s.x+e.col2.x*s.y,s=e.col1.y*s.x+e.col2.y*s.y,e=i.m_xf.R,a=this.m_localAnchor1.x-i.m_sweep.localCenter.x,l=this.m_localAnchor1.y-i.m_sweep.localCenter.y,c=e.col1.x*a+e.col2.x*l,l=e.col1.y*a+e.col2.y*l,a=c,a=a*s-l*r,this.m_J.linearA.Set(-r,-s),this.m_J.angularA=-a,u+=i.m_invMass+i.m_invI*a*a),this.m_revolute2?(this.m_J.angularB=-this.m_ratio,u+=this.m_ratio*this.m_ratio*o.m_invI):(e=n.m_xf.R,s=this.m_prismatic2.m_localXAxis1,r=e.col1.x*s.x+e.col2.x*s.y,s=e.col1.y*s.x+e.col2.y*s.y,e=o.m_xf.R,a=this.m_localAnchor2.x-o.m_sweep.localCenter.x,l=this.m_localAnchor2.y-o.m_sweep.localCenter.y,c=e.col1.x*a+e.col2.x*l,l=e.col1.y*a+e.col2.y*l,a=c,a=a*s-l*r,this.m_J.linearB.Set(-this.m_ratio*r,-this.m_ratio*s),this.m_J.angularB=-this.m_ratio*a,u+=this.m_ratio*this.m_ratio*(o.m_invMass+o.m_invI*a*a)),this.m_mass=u>0?1/u:0,t.warmStarting?(i.m_linearVelocity.x+=i.m_invMass*this.m_impulse*this.m_J.linearA.x,i.m_linearVelocity.y+=i.m_invMass*this.m_impulse*this.m_J.linearA.y,i.m_angularVelocity+=i.m_invI*this.m_impulse*this.m_J.angularA,o.m_linearVelocity.x+=o.m_invMass*this.m_impulse*this.m_J.linearB.x,o.m_linearVelocity.y+=o.m_invMass*this.m_impulse*this.m_J.linearB.y,o.m_angularVelocity+=o.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},u.prototype.SolveVelocityConstraints=function(){var t=this.m_bodyA,e=this.m_bodyB,n=-this.m_mass*this.m_J.Compute(t.m_linearVelocity,t.m_angularVelocity,e.m_linearVelocity,e.m_angularVelocity);this.m_impulse+=n,t.m_linearVelocity.x+=t.m_invMass*n*this.m_J.linearA.x,t.m_linearVelocity.y+=t.m_invMass*n*this.m_J.linearA.y,t.m_angularVelocity+=t.m_invI*n*this.m_J.angularA,e.m_linearVelocity.x+=e.m_invMass*n*this.m_J.linearB.x,e.m_linearVelocity.y+=e.m_invMass*n*this.m_J.linearB.y,e.m_angularVelocity+=e.m_invI*n*this.m_J.angularB},u.prototype.SolvePositionConstraints=function(){var e=this.m_bodyA,n=this.m_bodyB,i=0,o=0;return i=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),o=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation(),i=-this.m_mass*(this.m_constant-(i+this.m_ratio*o)),e.m_sweep.c.x+=e.m_invMass*i*this.m_J.linearA.x,e.m_sweep.c.y+=e.m_invMass*i*this.m_J.linearA.y,e.m_sweep.a+=e.m_invI*i*this.m_J.angularA,n.m_sweep.c.x+=n.m_invMass*i*this.m_J.linearB.x,n.m_sweep.c.y+=n.m_invMass*i*this.m_J.linearB.y,n.m_sweep.a+=n.m_invI*i*this.m_J.angularB,e.SynchronizeTransform(),n.SynchronizeTransform(),0<t.b2_linearSlop},Box2D.inherit(h,Box2D.Dynamics.Joints.b2JointDef),h.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,h.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)},h.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this),this.type=p.e_gearJoint,this.joint2=this.joint1=null,this.ratio=1},m.b2Jacobian=function(){this.linearA=new o,this.linearB=new o},m.prototype.SetZero=function(){this.linearA.SetZero(),this.angularA=0,this.linearB.SetZero(),this.angularB=0},m.prototype.Set=function(t,e,n,i){void 0===e&&(e=0),void 0===i&&(i=0),this.linearA.SetV(t),this.angularA=e,this.linearB.SetV(n),this.angularB=i},m.prototype.Compute=function(t,e,n,i){return void 0===e&&(e=0),void 0===i&&(i=0),this.linearA.x*t.x+this.linearA.y*t.y+this.angularA*e+(this.linearB.x*n.x+this.linearB.y*n.y)+this.angularB*i},p.b2Joint=function(){this.m_edgeA=new y,this.m_edgeB=new y,this.m_localCenterA=new o,this.m_localCenterB=new o},p.prototype.GetType=function(){return this.m_type},p.prototype.GetAnchorA=function(){return null},p.prototype.GetAnchorB=function(){return null},p.prototype.GetReactionForce=function(){return null},p.prototype.GetReactionTorque=function(){return 0},p.prototype.GetBodyA=function(){return this.m_bodyA},p.prototype.GetBodyB=function(){return this.m_bodyB},p.prototype.GetNext=function(){return this.m_next},p.prototype.GetUserData=function(){return this.m_userData},p.prototype.SetUserData=function(t){this.m_userData=t},p.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},p.Create=function(t){var e=null;switch(t.type){case p.e_distanceJoint:e=new s(t instanceof a?t:null);break;case p.e_mouseJoint:e=new g(t instanceof x?t:null);break;case p.e_prismaticJoint:e=new v(t instanceof b?t:null);break;case p.e_revoluteJoint:e=new B(t instanceof C?t:null);break;case p.e_pulleyJoint:e=new w(t instanceof D?t:null);break;case p.e_gearJoint:e=new u(t instanceof h?t:null);break;case p.e_lineJoint:e=new d(t instanceof _?t:null);break;case p.e_weldJoint:e=new S(t instanceof A?t:null);break;case p.e_frictionJoint:e=new l(t instanceof c?t:null)}return e},p.Destroy=function(){},p.prototype.b2Joint=function(e){t.b2Assert(e.bodyA!=e.bodyB),this.m_type=e.type,this.m_next=this.m_prev=null,this.m_bodyA=e.bodyA,this.m_bodyB=e.bodyB,this.m_collideConnected=e.collideConnected,this.m_islandFlag=!1,this.m_userData=e.userData},p.prototype.InitVelocityConstraints=function(){},p.prototype.SolveVelocityConstraints=function(){},p.prototype.FinalizeVelocityConstraints=function(){},p.prototype.SolvePositionConstraints=function(){return!1},Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0,Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1,Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2,Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3,Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4,Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5,Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6,Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7,Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8,Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9,Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0,Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1,Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2,Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3}),f.b2JointDef=function(){},f.prototype.b2JointDef=function(){this.type=p.e_unknownJoint,this.bodyB=this.bodyA=this.userData=null,this.collideConnected=!1},y.b2JointEdge=function(){},Box2D.inherit(d,Box2D.Dynamics.Joints.b2Joint),d.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,d.b2LineJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new o,this.m_localAnchor2=new o,this.m_localXAxis1=new o,this.m_localYAxis1=new o,this.m_axis=new o,this.m_perp=new o,this.m_K=new e,this.m_impulse=new o},d.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},d.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},d.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new o(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},d.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.y},d.prototype.GetJointTranslation=function(){var t=this.m_bodyA,e=this.m_bodyB,n=t.GetWorldPoint(this.m_localAnchor1),i=e.GetWorldPoint(this.m_localAnchor2);return e=i.x-n.x,n=i.y-n.y,t=t.GetWorldVector(this.m_localXAxis1),t.x*e+t.y*n},d.prototype.GetJointSpeed=function(){var t,e=this.m_bodyA,n=this.m_bodyB;t=e.m_xf.R;var i=this.m_localAnchor1.x-e.m_sweep.localCenter.x,o=this.m_localAnchor1.y-e.m_sweep.localCenter.y,r=t.col1.x*i+t.col2.x*o;o=t.col1.y*i+t.col2.y*o,i=r,t=n.m_xf.R;var s=this.m_localAnchor2.x-n.m_sweep.localCenter.x,a=this.m_localAnchor2.y-n.m_sweep.localCenter.y;r=t.col1.x*s+t.col2.x*a,a=t.col1.y*s+t.col2.y*a,s=r,t=n.m_sweep.c.x+s-(e.m_sweep.c.x+i),r=n.m_sweep.c.y+a-(e.m_sweep.c.y+o);var l=e.GetWorldVector(this.m_localXAxis1),c=e.m_linearVelocity,u=n.m_linearVelocity;return e=e.m_angularVelocity,n=n.m_angularVelocity,t*-e*l.y+r*e*l.x+(l.x*(u.x+-n*a-c.x- -e*o)+l.y*(u.y+n*s-c.y-e*i))},d.prototype.IsLimitEnabled=function(){return this.m_enableLimit},d.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t},d.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},d.prototype.GetUpperLimit=function(){return this.m_upperTranslation},d.prototype.SetLimits=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e},d.prototype.IsMotorEnabled=function(){return this.m_enableMotor},d.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t},d.prototype.SetMotorSpeed=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},d.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},d.prototype.SetMaxMotorForce=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t},d.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},d.prototype.GetMotorForce=function(){return this.m_motorImpulse},d.prototype.b2LineJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_localXAxis1.SetV(t.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_impulse.SetZero(),this.m_motorImpulse=this.m_motorMass=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=p.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},d.prototype.InitVelocityConstraints=function(e){var n,o=this.m_bodyA,r=this.m_bodyB,s=0;this.m_localCenterA.SetV(o.GetLocalCenter()),this.m_localCenterB.SetV(r.GetLocalCenter());var a=o.GetTransform();r.GetTransform(),n=o.m_xf.R;var l=this.m_localAnchor1.x-this.m_localCenterA.x,c=this.m_localAnchor1.y-this.m_localCenterA.y;s=n.col1.x*l+n.col2.x*c,c=n.col1.y*l+n.col2.y*c,l=s,n=r.m_xf.R;var u=this.m_localAnchor2.x-this.m_localCenterB.x,h=this.m_localAnchor2.y-this.m_localCenterB.y;s=n.col1.x*u+n.col2.x*h,h=n.col1.y*u+n.col2.y*h,u=s,n=r.m_sweep.c.x+u-o.m_sweep.c.x-l,s=r.m_sweep.c.y+h-o.m_sweep.c.y-c,this.m_invMassA=o.m_invMass,this.m_invMassB=r.m_invMass,this.m_invIA=o.m_invI,this.m_invIB=r.m_invI,this.m_axis.SetV(i.MulMV(a.R,this.m_localXAxis1)),this.m_a1=(n+l)*this.m_axis.y-(s+c)*this.m_axis.x,this.m_a2=u*this.m_axis.y-h*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0,this.m_perp.SetV(i.MulMV(a.R,this.m_localYAxis1)),this.m_s1=(n+l)*this.m_perp.y-(s+c)*this.m_perp.x,this.m_s2=u*this.m_perp.y-h*this.m_perp.x,a=this.m_invMassA,l=this.m_invMassB,c=this.m_invIA,u=this.m_invIB,this.m_K.col1.x=a+l+c*this.m_s1*this.m_s1+u*this.m_s2*this.m_s2,this.m_K.col1.y=c*this.m_s1*this.m_a1+u*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=a+l+c*this.m_a1*this.m_a1+u*this.m_a2*this.m_a2,this.m_enableLimit?(n=this.m_axis.x*n+this.m_axis.y*s,i.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*t.b2_linearSlop?this.m_limitState=p.e_equalLimits:n<=this.m_lowerTranslation?this.m_limitState!=p.e_atLowerLimit&&(this.m_limitState=p.e_atLowerLimit,this.m_impulse.y=0):n>=this.m_upperTranslation?this.m_limitState!=p.e_atUpperLimit&&(this.m_limitState=p.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=p.e_inactiveLimit,this.m_impulse.y=0)):this.m_limitState=p.e_inactiveLimit,0==this.m_enableMotor&&(this.m_motorImpulse=0),e.warmStarting?(this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio,e=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,n=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,s=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,a=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2,o.m_linearVelocity.x-=this.m_invMassA*e,o.m_linearVelocity.y-=this.m_invMassA*n,o.m_angularVelocity-=this.m_invIA*s,r.m_linearVelocity.x+=this.m_invMassB*e,r.m_linearVelocity.y+=this.m_invMassB*n,r.m_angularVelocity+=this.m_invIB*a):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},d.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA,n=this.m_bodyB,r=e.m_linearVelocity,s=e.m_angularVelocity,a=n.m_linearVelocity,l=n.m_angularVelocity,c=0,u=0,h=0,m=0;this.m_enableMotor&&this.m_limitState!=p.e_equalLimits&&(m=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(a.x-r.x)+this.m_axis.y*(a.y-r.y)+this.m_a2*l-this.m_a1*s)),c=this.m_motorImpulse,u=t.dt*this.m_maxMotorForce,this.m_motorImpulse=i.Clamp(this.m_motorImpulse+m,-u,u),m=this.m_motorImpulse-c,c=m*this.m_axis.x,u=m*this.m_axis.y,h=m*this.m_a1,m*=this.m_a2,r.x-=this.m_invMassA*c,r.y-=this.m_invMassA*u,s-=this.m_invIA*h,a.x+=this.m_invMassB*c,a.y+=this.m_invMassB*u,l+=this.m_invIB*m),u=this.m_perp.x*(a.x-r.x)+this.m_perp.y*(a.y-r.y)+this.m_s2*l-this.m_s1*s,this.m_enableLimit&&this.m_limitState!=p.e_inactiveLimit?(h=this.m_axis.x*(a.x-r.x)+this.m_axis.y*(a.y-r.y)+this.m_a2*l-this.m_a1*s,c=this.m_impulse.Copy(),t=this.m_K.Solve(new o,-u,-h),this.m_impulse.Add(t),this.m_limitState==p.e_atLowerLimit?this.m_impulse.y=i.Max(this.m_impulse.y,0):this.m_limitState==p.e_atUpperLimit&&(this.m_impulse.y=i.Min(this.m_impulse.y,0)),u=-u-(this.m_impulse.y-c.y)*this.m_K.col2.x,h=0,h=0!=this.m_K.col1.x?u/this.m_K.col1.x+c.x:c.x,this.m_impulse.x=h,t.x=this.m_impulse.x-c.x,t.y=this.m_impulse.y-c.y,c=t.x*this.m_perp.x+t.y*this.m_axis.x,u=t.x*this.m_perp.y+t.y*this.m_axis.y,h=t.x*this.m_s1+t.y*this.m_a1,m=t.x*this.m_s2+t.y*this.m_a2):(t=0,t=0!=this.m_K.col1.x?-u/this.m_K.col1.x:0,this.m_impulse.x+=t,c=t*this.m_perp.x,u=t*this.m_perp.y,h=t*this.m_s1,m=t*this.m_s2),r.x-=this.m_invMassA*c,r.y-=this.m_invMassA*u,s-=this.m_invIA*h,a.x+=this.m_invMassB*c,a.y+=this.m_invMassB*u,l+=this.m_invIB*m,e.m_linearVelocity.SetV(r),e.m_angularVelocity=s,n.m_linearVelocity.SetV(a),n.m_angularVelocity=l},d.prototype.SolvePositionConstraints=function(){var n,r=this.m_bodyA,s=this.m_bodyB,a=r.m_sweep.c,l=r.m_sweep.a,c=s.m_sweep.c,u=s.m_sweep.a,h=0,m=0,p=0,f=0,y=n=0,d=0;m=!1;var _=0,g=e.FromAngle(l);p=e.FromAngle(u),n=g,d=this.m_localAnchor1.x-this.m_localCenterA.x;var x=this.m_localAnchor1.y-this.m_localCenterA.y;if(h=n.col1.x*d+n.col2.x*x,x=n.col1.y*d+n.col2.y*x,d=h,n=p,p=this.m_localAnchor2.x-this.m_localCenterB.x,f=this.m_localAnchor2.y-this.m_localCenterB.y,h=n.col1.x*p+n.col2.x*f,f=n.col1.y*p+n.col2.y*f,p=h,n=c.x+p-a.x-d,h=c.y+f-a.y-x,this.m_enableLimit){this.m_axis=i.MulMV(g,this.m_localXAxis1),this.m_a1=(n+d)*this.m_axis.y-(h+x)*this.m_axis.x,this.m_a2=p*this.m_axis.y-f*this.m_axis.x;var v=this.m_axis.x*n+this.m_axis.y*h;i.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*t.b2_linearSlop?(_=i.Clamp(v,-t.b2_maxLinearCorrection,t.b2_maxLinearCorrection),y=i.Abs(v),m=!0):v<=this.m_lowerTranslation?(_=i.Clamp(v-this.m_lowerTranslation+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),y=this.m_lowerTranslation-v,m=!0):v>=this.m_upperTranslation&&(_=i.Clamp(v-this.m_upperTranslation+t.b2_linearSlop,0,t.b2_maxLinearCorrection),y=v-this.m_upperTranslation,m=!0)}return this.m_perp=i.MulMV(g,this.m_localYAxis1),this.m_s1=(n+d)*this.m_perp.y-(h+x)*this.m_perp.x,this.m_s2=p*this.m_perp.y-f*this.m_perp.x,g=new o,x=this.m_perp.x*n+this.m_perp.y*h,y=i.Max(y,i.Abs(x)),d=0,m?(m=this.m_invMassA,p=this.m_invMassB,f=this.m_invIA,n=this.m_invIB,this.m_K.col1.x=m+p+f*this.m_s1*this.m_s1+n*this.m_s2*this.m_s2,this.m_K.col1.y=f*this.m_s1*this.m_a1+n*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=m+p+f*this.m_a1*this.m_a1+n*this.m_a2*this.m_a2,this.m_K.Solve(g,-x,-_)):(m=this.m_invMassA,p=this.m_invMassB,f=this.m_invIA,n=this.m_invIB,_=m+p+f*this.m_s1*this.m_s1+n*this.m_s2*this.m_s2,m=0,m=0!=_?-x/_:0,g.x=m,g.y=0),_=g.x*this.m_perp.x+g.y*this.m_axis.x,m=g.x*this.m_perp.y+g.y*this.m_axis.y,x=g.x*this.m_s1+g.y*this.m_a1,g=g.x*this.m_s2+g.y*this.m_a2,a.x-=this.m_invMassA*_,a.y-=this.m_invMassA*m,l-=this.m_invIA*x,c.x+=this.m_invMassB*_,c.y+=this.m_invMassB*m,u+=this.m_invIB*g,r.m_sweep.a=l,s.m_sweep.a=u,r.SynchronizeTransform(),s.SynchronizeTransform(),y<=t.b2_linearSlop&&d<=t.b2_angularSlop},Box2D.inherit(_,Box2D.Dynamics.Joints.b2JointDef),_.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,_.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new o,this.localAnchorB=new o,this.localAxisA=new o},_.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this),this.type=p.e_lineJoint,this.localAxisA.Set(1,0),this.enableLimit=!1,this.upperTranslation=this.lowerTranslation=0,this.enableMotor=!1,this.motorSpeed=this.maxMotorForce=0},_.prototype.Initialize=function(t,e,n,i){this.bodyA=t,this.bodyB=e,this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(n),this.localAxisA=this.bodyA.GetLocalVector(i)},Box2D.inherit(g,Box2D.Dynamics.Joints.b2Joint),g.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,g.b2MouseJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new e,this.K1=new e,this.K2=new e,this.m_localAnchor=new o,this.m_target=new o,this.m_impulse=new o,this.m_mass=new e,this.m_C=new o},g.prototype.GetAnchorA=function(){return this.m_target},g.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)},g.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new o(t*this.m_impulse.x,t*this.m_impulse.y)},g.prototype.GetReactionTorque=function(){return 0},g.prototype.GetTarget=function(){return this.m_target},g.prototype.SetTarget=function(t){0==this.m_bodyB.IsAwake()&&this.m_bodyB.SetAwake(!0),this.m_target=t},g.prototype.GetMaxForce=function(){return this.m_maxForce},g.prototype.SetMaxForce=function(t){void 0===t&&(t=0),this.m_maxForce=t},g.prototype.GetFrequency=function(){return this.m_frequencyHz},g.prototype.SetFrequency=function(t){void 0===t&&(t=0),this.m_frequencyHz=t},g.prototype.GetDampingRatio=function(){return this.m_dampingRatio},g.prototype.SetDampingRatio=function(t){void 0===t&&(t=0),this.m_dampingRatio=t},g.prototype.b2MouseJoint=function(t){this.__super.b2Joint.call(this,t),this.m_target.SetV(t.target);var e=this.m_target.x-this.m_bodyB.m_xf.position.x,n=this.m_target.y-this.m_bodyB.m_xf.position.y,i=this.m_bodyB.m_xf.R;this.m_localAnchor.x=e*i.col1.x+n*i.col1.y,this.m_localAnchor.y=e*i.col2.x+n*i.col2.y,this.m_maxForce=t.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_gamma=this.m_beta=0},g.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyB,n=e.GetMass(),i=2*Math.PI*this.m_frequencyHz,o=n*i*i;this.m_gamma=t.dt*(2*n*this.m_dampingRatio*i+t.dt*o),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_beta=t.dt*o*this.m_gamma,o=e.m_xf.R,n=this.m_localAnchor.x-e.m_sweep.localCenter.x,i=this.m_localAnchor.y-e.m_sweep.localCenter.y;var r=o.col1.x*n+o.col2.x*i;i=o.col1.y*n+o.col2.y*i,n=r,o=e.m_invMass,r=e.m_invI,this.K1.col1.x=o,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=o,this.K2.col1.x=r*i*i,this.K2.col2.x=-r*n*i,this.K2.col1.y=-r*n*i,this.K2.col2.y=r*n*n,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.GetInverse(this.m_mass),this.m_C.x=e.m_sweep.c.x+n-this.m_target.x,this.m_C.y=e.m_sweep.c.y+i-this.m_target.y,e.m_angularVelocity*=.98,this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,e.m_linearVelocity.x+=o*this.m_impulse.x,e.m_linearVelocity.y+=o*this.m_impulse.y,e.m_angularVelocity+=r*(n*this.m_impulse.y-i*this.m_impulse.x)},g.prototype.SolveVelocityConstraints=function(t){var e,n=this.m_bodyB,i=0,o=0;e=n.m_xf.R;var r=this.m_localAnchor.x-n.m_sweep.localCenter.x,s=this.m_localAnchor.y-n.m_sweep.localCenter.y;i=e.col1.x*r+e.col2.x*s,s=e.col1.y*r+e.col2.y*s,r=i,i=n.m_linearVelocity.x+-n.m_angularVelocity*s;var a=n.m_linearVelocity.y+n.m_angularVelocity*r;e=this.m_mass,i=i+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x,o=a+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y,a=-(e.col1.x*i+e.col2.x*o),o=-(e.col1.y*i+e.col2.y*o),e=this.m_impulse.x,i=this.m_impulse.y,this.m_impulse.x+=a,this.m_impulse.y+=o,t=t.dt*this.m_maxForce,this.m_impulse.LengthSquared()>t*t&&this.m_impulse.Multiply(t/this.m_impulse.Length()),a=this.m_impulse.x-e,o=this.m_impulse.y-i,n.m_linearVelocity.x+=n.m_invMass*a,n.m_linearVelocity.y+=n.m_invMass*o,n.m_angularVelocity+=n.m_invI*(r*o-s*a)
},g.prototype.SolvePositionConstraints=function(){return!0},Box2D.inherit(x,Box2D.Dynamics.Joints.b2JointDef),x.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,x.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.target=new o},x.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this),this.type=p.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7},Box2D.inherit(v,Box2D.Dynamics.Joints.b2Joint),v.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,v.b2PrismaticJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new o,this.m_localAnchor2=new o,this.m_localXAxis1=new o,this.m_localYAxis1=new o,this.m_axis=new o,this.m_perp=new o,this.m_K=new n,this.m_impulse=new r},v.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},v.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},v.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new o(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},v.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.y},v.prototype.GetJointTranslation=function(){var t=this.m_bodyA,e=this.m_bodyB,n=t.GetWorldPoint(this.m_localAnchor1),i=e.GetWorldPoint(this.m_localAnchor2);return e=i.x-n.x,n=i.y-n.y,t=t.GetWorldVector(this.m_localXAxis1),t.x*e+t.y*n},v.prototype.GetJointSpeed=function(){var t,e=this.m_bodyA,n=this.m_bodyB;t=e.m_xf.R;var i=this.m_localAnchor1.x-e.m_sweep.localCenter.x,o=this.m_localAnchor1.y-e.m_sweep.localCenter.y,r=t.col1.x*i+t.col2.x*o;o=t.col1.y*i+t.col2.y*o,i=r,t=n.m_xf.R;var s=this.m_localAnchor2.x-n.m_sweep.localCenter.x,a=this.m_localAnchor2.y-n.m_sweep.localCenter.y;r=t.col1.x*s+t.col2.x*a,a=t.col1.y*s+t.col2.y*a,s=r,t=n.m_sweep.c.x+s-(e.m_sweep.c.x+i),r=n.m_sweep.c.y+a-(e.m_sweep.c.y+o);var l=e.GetWorldVector(this.m_localXAxis1),c=e.m_linearVelocity,u=n.m_linearVelocity;return e=e.m_angularVelocity,n=n.m_angularVelocity,t*-e*l.y+r*e*l.x+(l.x*(u.x+-n*a-c.x- -e*o)+l.y*(u.y+n*s-c.y-e*i))},v.prototype.IsLimitEnabled=function(){return this.m_enableLimit},v.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t},v.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},v.prototype.GetUpperLimit=function(){return this.m_upperTranslation},v.prototype.SetLimits=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e},v.prototype.IsMotorEnabled=function(){return this.m_enableMotor},v.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t},v.prototype.SetMotorSpeed=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},v.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},v.prototype.SetMaxMotorForce=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t},v.prototype.GetMotorForce=function(){return this.m_motorImpulse},v.prototype.b2PrismaticJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_localXAxis1.SetV(t.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=t.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=this.m_motorMass=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=p.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},v.prototype.InitVelocityConstraints=function(e){var n,o=this.m_bodyA,r=this.m_bodyB,s=0;this.m_localCenterA.SetV(o.GetLocalCenter()),this.m_localCenterB.SetV(r.GetLocalCenter());var a=o.GetTransform();r.GetTransform(),n=o.m_xf.R;var l=this.m_localAnchor1.x-this.m_localCenterA.x,c=this.m_localAnchor1.y-this.m_localCenterA.y;s=n.col1.x*l+n.col2.x*c,c=n.col1.y*l+n.col2.y*c,l=s,n=r.m_xf.R;var u=this.m_localAnchor2.x-this.m_localCenterB.x,h=this.m_localAnchor2.y-this.m_localCenterB.y;s=n.col1.x*u+n.col2.x*h,h=n.col1.y*u+n.col2.y*h,u=s,n=r.m_sweep.c.x+u-o.m_sweep.c.x-l,s=r.m_sweep.c.y+h-o.m_sweep.c.y-c,this.m_invMassA=o.m_invMass,this.m_invMassB=r.m_invMass,this.m_invIA=o.m_invI,this.m_invIB=r.m_invI,this.m_axis.SetV(i.MulMV(a.R,this.m_localXAxis1)),this.m_a1=(n+l)*this.m_axis.y-(s+c)*this.m_axis.x,this.m_a2=u*this.m_axis.y-h*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass),this.m_perp.SetV(i.MulMV(a.R,this.m_localYAxis1)),this.m_s1=(n+l)*this.m_perp.y-(s+c)*this.m_perp.x,this.m_s2=u*this.m_perp.y-h*this.m_perp.x,a=this.m_invMassA,l=this.m_invMassB,c=this.m_invIA,u=this.m_invIB,this.m_K.col1.x=a+l+c*this.m_s1*this.m_s1+u*this.m_s2*this.m_s2,this.m_K.col1.y=c*this.m_s1+u*this.m_s2,this.m_K.col1.z=c*this.m_s1*this.m_a1+u*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=c+u,this.m_K.col2.z=c*this.m_a1+u*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=a+l+c*this.m_a1*this.m_a1+u*this.m_a2*this.m_a2,this.m_enableLimit?(n=this.m_axis.x*n+this.m_axis.y*s,i.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*t.b2_linearSlop?this.m_limitState=p.e_equalLimits:n<=this.m_lowerTranslation?this.m_limitState!=p.e_atLowerLimit&&(this.m_limitState=p.e_atLowerLimit,this.m_impulse.z=0):n>=this.m_upperTranslation?this.m_limitState!=p.e_atUpperLimit&&(this.m_limitState=p.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=p.e_inactiveLimit,this.m_impulse.z=0)):this.m_limitState=p.e_inactiveLimit,0==this.m_enableMotor&&(this.m_motorImpulse=0),e.warmStarting?(this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio,e=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,n=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,s=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,a=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2,o.m_linearVelocity.x-=this.m_invMassA*e,o.m_linearVelocity.y-=this.m_invMassA*n,o.m_angularVelocity-=this.m_invIA*s,r.m_linearVelocity.x+=this.m_invMassB*e,r.m_linearVelocity.y+=this.m_invMassB*n,r.m_angularVelocity+=this.m_invIB*a):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},v.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA,n=this.m_bodyB,s=e.m_linearVelocity,a=e.m_angularVelocity,l=n.m_linearVelocity,c=n.m_angularVelocity,u=0,h=0,m=0,f=0;this.m_enableMotor&&this.m_limitState!=p.e_equalLimits&&(f=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(l.x-s.x)+this.m_axis.y*(l.y-s.y)+this.m_a2*c-this.m_a1*a)),u=this.m_motorImpulse,t=t.dt*this.m_maxMotorForce,this.m_motorImpulse=i.Clamp(this.m_motorImpulse+f,-t,t),f=this.m_motorImpulse-u,u=f*this.m_axis.x,h=f*this.m_axis.y,m=f*this.m_a1,f*=this.m_a2,s.x-=this.m_invMassA*u,s.y-=this.m_invMassA*h,a-=this.m_invIA*m,l.x+=this.m_invMassB*u,l.y+=this.m_invMassB*h,c+=this.m_invIB*f),m=this.m_perp.x*(l.x-s.x)+this.m_perp.y*(l.y-s.y)+this.m_s2*c-this.m_s1*a,h=c-a,this.m_enableLimit&&this.m_limitState!=p.e_inactiveLimit?(t=this.m_axis.x*(l.x-s.x)+this.m_axis.y*(l.y-s.y)+this.m_a2*c-this.m_a1*a,u=this.m_impulse.Copy(),t=this.m_K.Solve33(new r,-m,-h,-t),this.m_impulse.Add(t),this.m_limitState==p.e_atLowerLimit?this.m_impulse.z=i.Max(this.m_impulse.z,0):this.m_limitState==p.e_atUpperLimit&&(this.m_impulse.z=i.Min(this.m_impulse.z,0)),m=-m-(this.m_impulse.z-u.z)*this.m_K.col3.x,h=-h-(this.m_impulse.z-u.z)*this.m_K.col3.y,h=this.m_K.Solve22(new o,m,h),h.x+=u.x,h.y+=u.y,this.m_impulse.x=h.x,this.m_impulse.y=h.y,t.x=this.m_impulse.x-u.x,t.y=this.m_impulse.y-u.y,t.z=this.m_impulse.z-u.z,u=t.x*this.m_perp.x+t.z*this.m_axis.x,h=t.x*this.m_perp.y+t.z*this.m_axis.y,m=t.x*this.m_s1+t.y+t.z*this.m_a1,f=t.x*this.m_s2+t.y+t.z*this.m_a2):(t=this.m_K.Solve22(new o,-m,-h),this.m_impulse.x+=t.x,this.m_impulse.y+=t.y,u=t.x*this.m_perp.x,h=t.x*this.m_perp.y,m=t.x*this.m_s1+t.y,f=t.x*this.m_s2+t.y),s.x-=this.m_invMassA*u,s.y-=this.m_invMassA*h,a-=this.m_invIA*m,l.x+=this.m_invMassB*u,l.y+=this.m_invMassB*h,c+=this.m_invIB*f,e.m_linearVelocity.SetV(s),e.m_angularVelocity=a,n.m_linearVelocity.SetV(l),n.m_angularVelocity=c},v.prototype.SolvePositionConstraints=function(){var n,s=this.m_bodyA,a=this.m_bodyB,l=s.m_sweep.c,c=s.m_sweep.a,u=a.m_sweep.c,h=a.m_sweep.a,m=0,p=0,f=0,y=m=n=0,d=0;p=!1;var _=0,g=e.FromAngle(c),x=e.FromAngle(h);n=g,d=this.m_localAnchor1.x-this.m_localCenterA.x;var v=this.m_localAnchor1.y-this.m_localCenterA.y;if(m=n.col1.x*d+n.col2.x*v,v=n.col1.y*d+n.col2.y*v,d=m,n=x,x=this.m_localAnchor2.x-this.m_localCenterB.x,f=this.m_localAnchor2.y-this.m_localCenterB.y,m=n.col1.x*x+n.col2.x*f,f=n.col1.y*x+n.col2.y*f,x=m,n=u.x+x-l.x-d,m=u.y+f-l.y-v,this.m_enableLimit){this.m_axis=i.MulMV(g,this.m_localXAxis1),this.m_a1=(n+d)*this.m_axis.y-(m+v)*this.m_axis.x,this.m_a2=x*this.m_axis.y-f*this.m_axis.x;var b=this.m_axis.x*n+this.m_axis.y*m;i.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*t.b2_linearSlop?(_=i.Clamp(b,-t.b2_maxLinearCorrection,t.b2_maxLinearCorrection),y=i.Abs(b),p=!0):b<=this.m_lowerTranslation?(_=i.Clamp(b-this.m_lowerTranslation+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),y=this.m_lowerTranslation-b,p=!0):b>=this.m_upperTranslation&&(_=i.Clamp(b-this.m_upperTranslation+t.b2_linearSlop,0,t.b2_maxLinearCorrection),y=b-this.m_upperTranslation,p=!0)}return this.m_perp=i.MulMV(g,this.m_localYAxis1),this.m_s1=(n+d)*this.m_perp.y-(m+v)*this.m_perp.x,this.m_s2=x*this.m_perp.y-f*this.m_perp.x,g=new r,v=this.m_perp.x*n+this.m_perp.y*m,x=h-c-this.m_refAngle,y=i.Max(y,i.Abs(v)),d=i.Abs(x),p?(p=this.m_invMassA,f=this.m_invMassB,n=this.m_invIA,m=this.m_invIB,this.m_K.col1.x=p+f+n*this.m_s1*this.m_s1+m*this.m_s2*this.m_s2,this.m_K.col1.y=n*this.m_s1+m*this.m_s2,this.m_K.col1.z=n*this.m_s1*this.m_a1+m*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=n+m,this.m_K.col2.z=n*this.m_a1+m*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=p+f+n*this.m_a1*this.m_a1+m*this.m_a2*this.m_a2,this.m_K.Solve33(g,-v,-x,-_)):(p=this.m_invMassA,f=this.m_invMassB,n=this.m_invIA,m=this.m_invIB,_=n*this.m_s1+m*this.m_s2,b=n+m,this.m_K.col1.Set(p+f+n*this.m_s1*this.m_s1+m*this.m_s2*this.m_s2,_,0),this.m_K.col2.Set(_,b,0),_=this.m_K.Solve22(new o,-v,-x),g.x=_.x,g.y=_.y,g.z=0),_=g.x*this.m_perp.x+g.z*this.m_axis.x,p=g.x*this.m_perp.y+g.z*this.m_axis.y,v=g.x*this.m_s1+g.y+g.z*this.m_a1,g=g.x*this.m_s2+g.y+g.z*this.m_a2,l.x-=this.m_invMassA*_,l.y-=this.m_invMassA*p,c-=this.m_invIA*v,u.x+=this.m_invMassB*_,u.y+=this.m_invMassB*p,h+=this.m_invIB*g,s.m_sweep.a=c,a.m_sweep.a=h,s.SynchronizeTransform(),a.SynchronizeTransform(),y<=t.b2_linearSlop&&d<=t.b2_angularSlop},Box2D.inherit(b,Box2D.Dynamics.Joints.b2JointDef),b.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,b.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new o,this.localAnchorB=new o,this.localAxisA=new o},b.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this),this.type=p.e_prismaticJoint,this.localAxisA.Set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.upperTranslation=this.lowerTranslation=0,this.enableMotor=!1,this.motorSpeed=this.maxMotorForce=0},b.prototype.Initialize=function(t,e,n,i){this.bodyA=t,this.bodyB=e,this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(n),this.localAxisA=this.bodyA.GetLocalVector(i),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.inherit(w,Box2D.Dynamics.Joints.b2Joint),w.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,w.b2PulleyJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new o,this.m_groundAnchor2=new o,this.m_localAnchor1=new o,this.m_localAnchor2=new o,this.m_u1=new o,this.m_u2=new o},w.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},w.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},w.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new o(t*this.m_impulse*this.m_u2.x,t*this.m_impulse*this.m_u2.y)},w.prototype.GetReactionTorque=function(){return 0},w.prototype.GetGroundAnchorA=function(){var t=this.m_ground.m_xf.position.Copy();return t.Add(this.m_groundAnchor1),t},w.prototype.GetGroundAnchorB=function(){var t=this.m_ground.m_xf.position.Copy();return t.Add(this.m_groundAnchor2),t},w.prototype.GetLength1=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),e=t.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x);return t=t.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y),Math.sqrt(e*e+t*t)},w.prototype.GetLength2=function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),e=t.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor2.x);return t=t.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor2.y),Math.sqrt(e*e+t*t)},w.prototype.GetRatio=function(){return this.m_ratio},w.prototype.b2PulleyJoint=function(t){this.__super.b2Joint.call(this,t),this.m_ground=this.m_bodyA.m_world.m_groundBody,this.m_groundAnchor1.x=t.groundAnchorA.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=t.groundAnchorA.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=t.groundAnchorB.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=t.groundAnchorB.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_ratio=t.ratio,this.m_constant=t.lengthA+this.m_ratio*t.lengthB,this.m_maxLength1=i.Min(t.maxLengthA,this.m_constant-this.m_ratio*w.b2_minPulleyLength),this.m_maxLength2=i.Min(t.maxLengthB,(this.m_constant-w.b2_minPulleyLength)/this.m_ratio),this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0},w.prototype.InitVelocityConstraints=function(e){var n,i=this.m_bodyA,o=this.m_bodyB;n=i.m_xf.R;var r=this.m_localAnchor1.x-i.m_sweep.localCenter.x,s=this.m_localAnchor1.y-i.m_sweep.localCenter.y,a=n.col1.x*r+n.col2.x*s;s=n.col1.y*r+n.col2.y*s,r=a,n=o.m_xf.R;var l=this.m_localAnchor2.x-o.m_sweep.localCenter.x,c=this.m_localAnchor2.y-o.m_sweep.localCenter.y;a=n.col1.x*l+n.col2.x*c,c=n.col1.y*l+n.col2.y*c,l=a,n=o.m_sweep.c.x+l,a=o.m_sweep.c.y+c;var u=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,h=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(i.m_sweep.c.x+r-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),i.m_sweep.c.y+s-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y)),this.m_u2.Set(n-u,a-h),n=this.m_u1.Length(),a=this.m_u2.Length(),n>t.b2_linearSlop?this.m_u1.Multiply(1/n):this.m_u1.SetZero(),a>t.b2_linearSlop?this.m_u2.Multiply(1/a):this.m_u2.SetZero(),this.m_constant-n-this.m_ratio*a>0?(this.m_state=p.e_inactiveLimit,this.m_impulse=0):this.m_state=p.e_atUpperLimit,n<this.m_maxLength1?(this.m_limitState1=p.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=p.e_atUpperLimit,a<this.m_maxLength2?(this.m_limitState2=p.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=p.e_atUpperLimit,n=r*this.m_u1.y-s*this.m_u1.x,a=l*this.m_u2.y-c*this.m_u2.x,this.m_limitMass1=i.m_invMass+i.m_invI*n*n,this.m_limitMass2=o.m_invMass+o.m_invI*a*a,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass,e.warmStarting?(this.m_impulse*=e.dtRatio,this.m_limitImpulse1*=e.dtRatio,this.m_limitImpulse2*=e.dtRatio,e=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,n=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,a=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,u=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y,i.m_linearVelocity.x+=i.m_invMass*e,i.m_linearVelocity.y+=i.m_invMass*n,i.m_angularVelocity+=i.m_invI*(r*n-s*e),o.m_linearVelocity.x+=o.m_invMass*a,o.m_linearVelocity.y+=o.m_invMass*u,o.m_angularVelocity+=o.m_invI*(l*u-c*a)):this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0},w.prototype.SolveVelocityConstraints=function(){var t,e=this.m_bodyA,n=this.m_bodyB;t=e.m_xf.R;var o=this.m_localAnchor1.x-e.m_sweep.localCenter.x,r=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=t.col1.x*o+t.col2.x*r;r=t.col1.y*o+t.col2.y*r,o=s,t=n.m_xf.R;var a=this.m_localAnchor2.x-n.m_sweep.localCenter.x,l=this.m_localAnchor2.y-n.m_sweep.localCenter.y;s=t.col1.x*a+t.col2.x*l,l=t.col1.y*a+t.col2.y*l,a=s;var c=s=t=0,u=0;t=u=t=u=c=s=t=0,this.m_state==p.e_atUpperLimit&&(t=e.m_linearVelocity.x+-e.m_angularVelocity*r,s=e.m_linearVelocity.y+e.m_angularVelocity*o,c=n.m_linearVelocity.x+-n.m_angularVelocity*l,u=n.m_linearVelocity.y+n.m_angularVelocity*a,t=-(this.m_u1.x*t+this.m_u1.y*s)-this.m_ratio*(this.m_u2.x*c+this.m_u2.y*u),u=this.m_pulleyMass*-t,t=this.m_impulse,this.m_impulse=i.Max(0,this.m_impulse+u),u=this.m_impulse-t,t=-u*this.m_u1.x,s=-u*this.m_u1.y,c=-this.m_ratio*u*this.m_u2.x,u=-this.m_ratio*u*this.m_u2.y,e.m_linearVelocity.x+=e.m_invMass*t,e.m_linearVelocity.y+=e.m_invMass*s,e.m_angularVelocity+=e.m_invI*(o*s-r*t),n.m_linearVelocity.x+=n.m_invMass*c,n.m_linearVelocity.y+=n.m_invMass*u,n.m_angularVelocity+=n.m_invI*(a*u-l*c)),this.m_limitState1==p.e_atUpperLimit&&(t=e.m_linearVelocity.x+-e.m_angularVelocity*r,s=e.m_linearVelocity.y+e.m_angularVelocity*o,t=-(this.m_u1.x*t+this.m_u1.y*s),u=-this.m_limitMass1*t,t=this.m_limitImpulse1,this.m_limitImpulse1=i.Max(0,this.m_limitImpulse1+u),u=this.m_limitImpulse1-t,t=-u*this.m_u1.x,s=-u*this.m_u1.y,e.m_linearVelocity.x+=e.m_invMass*t,e.m_linearVelocity.y+=e.m_invMass*s,e.m_angularVelocity+=e.m_invI*(o*s-r*t)),this.m_limitState2==p.e_atUpperLimit&&(c=n.m_linearVelocity.x+-n.m_angularVelocity*l,u=n.m_linearVelocity.y+n.m_angularVelocity*a,t=-(this.m_u2.x*c+this.m_u2.y*u),u=-this.m_limitMass2*t,t=this.m_limitImpulse2,this.m_limitImpulse2=i.Max(0,this.m_limitImpulse2+u),u=this.m_limitImpulse2-t,c=-u*this.m_u2.x,u=-u*this.m_u2.y,n.m_linearVelocity.x+=n.m_invMass*c,n.m_linearVelocity.y+=n.m_invMass*u,n.m_angularVelocity+=n.m_invI*(a*u-l*c))},w.prototype.SolvePositionConstraints=function(){var e,n=this.m_bodyA,o=this.m_bodyB,r=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,s=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,a=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,l=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,c=0,u=0,h=0,m=0,f=e=0,y=0,d=0,_=f=d=e=f=e=0;return this.m_state==p.e_atUpperLimit&&(e=n.m_xf.R,c=this.m_localAnchor1.x-n.m_sweep.localCenter.x,u=this.m_localAnchor1.y-n.m_sweep.localCenter.y,f=e.col1.x*c+e.col2.x*u,u=e.col1.y*c+e.col2.y*u,c=f,e=o.m_xf.R,h=this.m_localAnchor2.x-o.m_sweep.localCenter.x,m=this.m_localAnchor2.y-o.m_sweep.localCenter.y,f=e.col1.x*h+e.col2.x*m,m=e.col1.y*h+e.col2.y*m,h=f,e=n.m_sweep.c.x+c,f=n.m_sweep.c.y+u,y=o.m_sweep.c.x+h,d=o.m_sweep.c.y+m,this.m_u1.Set(e-r,f-s),this.m_u2.Set(y-a,d-l),e=this.m_u1.Length(),f=this.m_u2.Length(),e>t.b2_linearSlop?this.m_u1.Multiply(1/e):this.m_u1.SetZero(),f>t.b2_linearSlop?this.m_u2.Multiply(1/f):this.m_u2.SetZero(),e=this.m_constant-e-this.m_ratio*f,_=i.Max(_,-e),e=i.Clamp(e+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),d=-this.m_pulleyMass*e,e=-d*this.m_u1.x,f=-d*this.m_u1.y,y=-this.m_ratio*d*this.m_u2.x,d=-this.m_ratio*d*this.m_u2.y,n.m_sweep.c.x+=n.m_invMass*e,n.m_sweep.c.y+=n.m_invMass*f,n.m_sweep.a+=n.m_invI*(c*f-u*e),o.m_sweep.c.x+=o.m_invMass*y,o.m_sweep.c.y+=o.m_invMass*d,o.m_sweep.a+=o.m_invI*(h*d-m*y),n.SynchronizeTransform(),o.SynchronizeTransform()),this.m_limitState1==p.e_atUpperLimit&&(e=n.m_xf.R,c=this.m_localAnchor1.x-n.m_sweep.localCenter.x,u=this.m_localAnchor1.y-n.m_sweep.localCenter.y,f=e.col1.x*c+e.col2.x*u,u=e.col1.y*c+e.col2.y*u,c=f,e=n.m_sweep.c.x+c,f=n.m_sweep.c.y+u,this.m_u1.Set(e-r,f-s),e=this.m_u1.Length(),e>t.b2_linearSlop?(this.m_u1.x*=1/e,this.m_u1.y*=1/e):this.m_u1.SetZero(),e=this.m_maxLength1-e,_=i.Max(_,-e),e=i.Clamp(e+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),d=-this.m_limitMass1*e,e=-d*this.m_u1.x,f=-d*this.m_u1.y,n.m_sweep.c.x+=n.m_invMass*e,n.m_sweep.c.y+=n.m_invMass*f,n.m_sweep.a+=n.m_invI*(c*f-u*e),n.SynchronizeTransform()),this.m_limitState2==p.e_atUpperLimit&&(e=o.m_xf.R,h=this.m_localAnchor2.x-o.m_sweep.localCenter.x,m=this.m_localAnchor2.y-o.m_sweep.localCenter.y,f=e.col1.x*h+e.col2.x*m,m=e.col1.y*h+e.col2.y*m,h=f,y=o.m_sweep.c.x+h,d=o.m_sweep.c.y+m,this.m_u2.Set(y-a,d-l),f=this.m_u2.Length(),f>t.b2_linearSlop?(this.m_u2.x*=1/f,this.m_u2.y*=1/f):this.m_u2.SetZero(),e=this.m_maxLength2-f,_=i.Max(_,-e),e=i.Clamp(e+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),d=-this.m_limitMass2*e,y=-d*this.m_u2.x,d=-d*this.m_u2.y,o.m_sweep.c.x+=o.m_invMass*y,o.m_sweep.c.y+=o.m_invMass*d,o.m_sweep.a+=o.m_invI*(h*d-m*y),o.SynchronizeTransform()),_<t.b2_linearSlop},Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2}),Box2D.inherit(D,Box2D.Dynamics.Joints.b2JointDef),D.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,D.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.groundAnchorA=new o,this.groundAnchorB=new o,this.localAnchorA=new o,this.localAnchorB=new o},D.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this),this.type=p.e_pulleyJoint,this.groundAnchorA.Set(-1,1),this.groundAnchorB.Set(1,1),this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0),this.maxLengthB=this.lengthB=this.maxLengthA=this.lengthA=0,this.ratio=1,this.collideConnected=!0},D.prototype.Initialize=function(t,e,n,i,o,r,s){void 0===s&&(s=0),this.bodyA=t,this.bodyB=e,this.groundAnchorA.SetV(n),this.groundAnchorB.SetV(i),this.localAnchorA=this.bodyA.GetLocalPoint(o),this.localAnchorB=this.bodyB.GetLocalPoint(r),t=o.x-n.x,n=o.y-n.y,this.lengthA=Math.sqrt(t*t+n*n),n=r.x-i.x,i=r.y-i.y,this.lengthB=Math.sqrt(n*n+i*i),this.ratio=s,s=this.lengthA+this.ratio*this.lengthB,this.maxLengthA=s-this.ratio*w.b2_minPulleyLength,this.maxLengthB=(s-w.b2_minPulleyLength)/this.ratio},Box2D.inherit(B,Box2D.Dynamics.Joints.b2Joint),B.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,B.b2RevoluteJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new e,this.K1=new e,this.K2=new e,this.K3=new e,this.impulse3=new r,this.impulse2=new o,this.reduced=new o,this.m_localAnchor1=new o,this.m_localAnchor2=new o,this.m_impulse=new r,this.m_mass=new n},B.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},B.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},B.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new o(t*this.m_impulse.x,t*this.m_impulse.y)},B.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.z},B.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},B.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},B.prototype.IsLimitEnabled=function(){return this.m_enableLimit},B.prototype.EnableLimit=function(t){this.m_enableLimit=t},B.prototype.GetLowerLimit=function(){return this.m_lowerAngle},B.prototype.GetUpperLimit=function(){return this.m_upperAngle},B.prototype.SetLimits=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.m_lowerAngle=t,this.m_upperAngle=e},B.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor},B.prototype.EnableMotor=function(t){this.m_enableMotor=t},B.prototype.SetMotorSpeed=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},B.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},B.prototype.SetMaxMotorTorque=function(t){void 0===t&&(t=0),this.m_maxMotorTorque=t},B.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque},B.prototype.b2RevoluteJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_referenceAngle=t.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=t.lowerAngle,this.m_upperAngle=t.upperAngle,this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=p.e_inactiveLimit},B.prototype.InitVelocityConstraints=function(e){var n,o=this.m_bodyA,r=this.m_bodyB,s=0;n=o.m_xf.R;var a=this.m_localAnchor1.x-o.m_sweep.localCenter.x,l=this.m_localAnchor1.y-o.m_sweep.localCenter.y;s=n.col1.x*a+n.col2.x*l,l=n.col1.y*a+n.col2.y*l,a=s,n=r.m_xf.R;var c=this.m_localAnchor2.x-r.m_sweep.localCenter.x,u=this.m_localAnchor2.y-r.m_sweep.localCenter.y;s=n.col1.x*c+n.col2.x*u,u=n.col1.y*c+n.col2.y*u,c=s,n=o.m_invMass,s=r.m_invMass;var h=o.m_invI,m=r.m_invI;if(this.m_mass.col1.x=n+s+l*l*h+u*u*m,this.m_mass.col2.x=-l*a*h-u*c*m,this.m_mass.col3.x=-l*h-u*m,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=n+s+a*a*h+c*c*m,this.m_mass.col3.y=a*h+c*m,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=h+m,this.m_motorMass=1/(h+m),0==this.m_enableMotor&&(this.m_motorImpulse=0),this.m_enableLimit){var f=r.m_sweep.a-o.m_sweep.a-this.m_referenceAngle;i.Abs(this.m_upperAngle-this.m_lowerAngle)<2*t.b2_angularSlop?this.m_limitState=p.e_equalLimits:f<=this.m_lowerAngle?(this.m_limitState!=p.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=p.e_atLowerLimit):f>=this.m_upperAngle?(this.m_limitState!=p.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=p.e_atUpperLimit):(this.m_limitState=p.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=p.e_inactiveLimit;e.warmStarting?(this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio,e=this.m_impulse.x,f=this.m_impulse.y,o.m_linearVelocity.x-=n*e,o.m_linearVelocity.y-=n*f,o.m_angularVelocity-=h*(a*f-l*e+this.m_motorImpulse+this.m_impulse.z),r.m_linearVelocity.x+=s*e,r.m_linearVelocity.y+=s*f,r.m_angularVelocity+=m*(c*f-u*e+this.m_motorImpulse+this.m_impulse.z)):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},B.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA,n=this.m_bodyB,o=0,r=o=0,s=0,a=0,l=0,c=e.m_linearVelocity,u=e.m_angularVelocity,h=n.m_linearVelocity,m=n.m_angularVelocity,f=e.m_invMass,y=n.m_invMass,d=e.m_invI,_=n.m_invI;if(this.m_enableMotor&&this.m_limitState!=p.e_equalLimits&&(r=this.m_motorMass*-(m-u-this.m_motorSpeed),s=this.m_motorImpulse,a=t.dt*this.m_maxMotorTorque,this.m_motorImpulse=i.Clamp(this.m_motorImpulse+r,-a,a),r=this.m_motorImpulse-s,u-=d*r,m+=_*r),this.m_enableLimit&&this.m_limitState!=p.e_inactiveLimit){t=e.m_xf.R,r=this.m_localAnchor1.x-e.m_sweep.localCenter.x,s=this.m_localAnchor1.y-e.m_sweep.localCenter.y,o=t.col1.x*r+t.col2.x*s,s=t.col1.y*r+t.col2.y*s,r=o,t=n.m_xf.R,a=this.m_localAnchor2.x-n.m_sweep.localCenter.x,l=this.m_localAnchor2.y-n.m_sweep.localCenter.y,o=t.col1.x*a+t.col2.x*l,l=t.col1.y*a+t.col2.y*l,a=o,t=h.x+-m*l-c.x- -u*s;var g=h.y+m*a-c.y-u*r;this.m_mass.Solve33(this.impulse3,-t,-g,-(m-u)),this.m_limitState==p.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==p.e_atLowerLimit?(o=this.m_impulse.z+this.impulse3.z,0>o&&(this.m_mass.Solve22(this.reduced,-t,-g),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)):this.m_limitState==p.e_atUpperLimit&&(o=this.m_impulse.z+this.impulse3.z,o>0&&(this.m_mass.Solve22(this.reduced,-t,-g),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)),c.x-=f*this.impulse3.x,c.y-=f*this.impulse3.y,u-=d*(r*this.impulse3.y-s*this.impulse3.x+this.impulse3.z),h.x+=y*this.impulse3.x,h.y+=y*this.impulse3.y,m+=_*(a*this.impulse3.y-l*this.impulse3.x+this.impulse3.z)}else t=e.m_xf.R,r=this.m_localAnchor1.x-e.m_sweep.localCenter.x,s=this.m_localAnchor1.y-e.m_sweep.localCenter.y,o=t.col1.x*r+t.col2.x*s,s=t.col1.y*r+t.col2.y*s,r=o,t=n.m_xf.R,a=this.m_localAnchor2.x-n.m_sweep.localCenter.x,l=this.m_localAnchor2.y-n.m_sweep.localCenter.y,o=t.col1.x*a+t.col2.x*l,l=t.col1.y*a+t.col2.y*l,a=o,this.m_mass.Solve22(this.impulse2,-(h.x+-m*l-c.x- -u*s),-(h.y+m*a-c.y-u*r)),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,c.x-=f*this.impulse2.x,c.y-=f*this.impulse2.y,u-=d*(r*this.impulse2.y-s*this.impulse2.x),h.x+=y*this.impulse2.x,h.y+=y*this.impulse2.y,m+=_*(a*this.impulse2.y-l*this.impulse2.x);e.m_linearVelocity.SetV(c),e.m_angularVelocity=u,n.m_linearVelocity.SetV(h),n.m_angularVelocity=m},B.prototype.SolvePositionConstraints=function(){var e,n=0,o=this.m_bodyA,r=this.m_bodyB,s=0,a=e=0,l=0,c=0;if(this.m_enableLimit&&this.m_limitState!=p.e_inactiveLimit){n=r.m_sweep.a-o.m_sweep.a-this.m_referenceAngle;var u=0;this.m_limitState==p.e_equalLimits?(n=i.Clamp(n-this.m_lowerAngle,-t.b2_maxAngularCorrection,t.b2_maxAngularCorrection),u=-this.m_motorMass*n,s=i.Abs(n)):this.m_limitState==p.e_atLowerLimit?(n-=this.m_lowerAngle,s=-n,n=i.Clamp(n+t.b2_angularSlop,-t.b2_maxAngularCorrection,0),u=-this.m_motorMass*n):this.m_limitState==p.e_atUpperLimit&&(s=n-=this.m_upperAngle,n=i.Clamp(n-t.b2_angularSlop,0,t.b2_maxAngularCorrection),u=-this.m_motorMass*n),o.m_sweep.a-=o.m_invI*u,r.m_sweep.a+=r.m_invI*u,o.SynchronizeTransform(),r.SynchronizeTransform()}e=o.m_xf.R,u=this.m_localAnchor1.x-o.m_sweep.localCenter.x,n=this.m_localAnchor1.y-o.m_sweep.localCenter.y,a=e.col1.x*u+e.col2.x*n,n=e.col1.y*u+e.col2.y*n,u=a,e=r.m_xf.R;var h=this.m_localAnchor2.x-r.m_sweep.localCenter.x,m=this.m_localAnchor2.y-r.m_sweep.localCenter.y;a=e.col1.x*h+e.col2.x*m,m=e.col1.y*h+e.col2.y*m,h=a,l=r.m_sweep.c.x+h-o.m_sweep.c.x-u,c=r.m_sweep.c.y+m-o.m_sweep.c.y-n;var f=l*l+c*c;e=Math.sqrt(f),a=o.m_invMass;var y=r.m_invMass,d=o.m_invI,_=r.m_invI,g=10*t.b2_linearSlop;return f>g*g&&(f=1/(a+y),l=f*-l,c=f*-c,o.m_sweep.c.x-=.5*a*l,o.m_sweep.c.y-=.5*a*c,r.m_sweep.c.x+=.5*y*l,r.m_sweep.c.y+=.5*y*c,l=r.m_sweep.c.x+h-o.m_sweep.c.x-u,c=r.m_sweep.c.y+m-o.m_sweep.c.y-n),this.K1.col1.x=a+y,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=a+y,this.K2.col1.x=d*n*n,this.K2.col2.x=-d*u*n,this.K2.col1.y=-d*u*n,this.K2.col2.y=d*u*u,this.K3.col1.x=_*m*m,this.K3.col2.x=-_*h*m,this.K3.col1.y=-_*h*m,this.K3.col2.y=_*h*h,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(B.tImpulse,-l,-c),l=B.tImpulse.x,c=B.tImpulse.y,o.m_sweep.c.x-=o.m_invMass*l,o.m_sweep.c.y-=o.m_invMass*c,o.m_sweep.a-=o.m_invI*(u*c-n*l),r.m_sweep.c.x+=r.m_invMass*l,r.m_sweep.c.y+=r.m_invMass*c,r.m_sweep.a+=r.m_invI*(h*c-m*l),o.SynchronizeTransform(),r.SynchronizeTransform(),e<=t.b2_linearSlop&&s<=t.b2_angularSlop},Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=new o}),Box2D.inherit(C,Box2D.Dynamics.Joints.b2JointDef),C.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,C.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new o,this.localAnchorB=new o},C.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this),this.type=p.e_revoluteJoint,this.localAnchorA.Set(0,0),this.localAnchorB.Set(0,0),this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0,this.enableMotor=this.enableLimit=!1},C.prototype.Initialize=function(t,e,n){this.bodyA=t,this.bodyB=e,this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(n),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.inherit(S,Box2D.Dynamics.Joints.b2Joint),S.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,S.b2WeldJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new o,this.m_localAnchorB=new o,this.m_impulse=new r,this.m_mass=new n},S.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},S.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},S.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new o(t*this.m_impulse.x,t*this.m_impulse.y)
},S.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.z},S.prototype.b2WeldJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchorA.SetV(t.localAnchorA),this.m_localAnchorB.SetV(t.localAnchorB),this.m_referenceAngle=t.referenceAngle,this.m_impulse.SetZero(),this.m_mass=new n},S.prototype.InitVelocityConstraints=function(t){var e,n=0,i=this.m_bodyA,o=this.m_bodyB;e=i.m_xf.R;var r=this.m_localAnchorA.x-i.m_sweep.localCenter.x,s=this.m_localAnchorA.y-i.m_sweep.localCenter.y;n=e.col1.x*r+e.col2.x*s,s=e.col1.y*r+e.col2.y*s,r=n,e=o.m_xf.R;var a=this.m_localAnchorB.x-o.m_sweep.localCenter.x,l=this.m_localAnchorB.y-o.m_sweep.localCenter.y;n=e.col1.x*a+e.col2.x*l,l=e.col1.y*a+e.col2.y*l,a=n,e=i.m_invMass,n=o.m_invMass;var c=i.m_invI,u=o.m_invI;this.m_mass.col1.x=e+n+s*s*c+l*l*u,this.m_mass.col2.x=-s*r*c-l*a*u,this.m_mass.col3.x=-s*c-l*u,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=e+n+r*r*c+a*a*u,this.m_mass.col3.y=r*c+a*u,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=c+u,t.warmStarting?(this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_impulse.z*=t.dtRatio,i.m_linearVelocity.x-=e*this.m_impulse.x,i.m_linearVelocity.y-=e*this.m_impulse.y,i.m_angularVelocity-=c*(r*this.m_impulse.y-s*this.m_impulse.x+this.m_impulse.z),o.m_linearVelocity.x+=n*this.m_impulse.x,o.m_linearVelocity.y+=n*this.m_impulse.y,o.m_angularVelocity+=u*(a*this.m_impulse.y-l*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()},S.prototype.SolveVelocityConstraints=function(){var t,e=0,n=this.m_bodyA,i=this.m_bodyB,o=n.m_linearVelocity,s=n.m_angularVelocity,a=i.m_linearVelocity,l=i.m_angularVelocity,c=n.m_invMass,u=i.m_invMass,h=n.m_invI,m=i.m_invI;t=n.m_xf.R;var p=this.m_localAnchorA.x-n.m_sweep.localCenter.x,f=this.m_localAnchorA.y-n.m_sweep.localCenter.y;e=t.col1.x*p+t.col2.x*f,f=t.col1.y*p+t.col2.y*f,p=e,t=i.m_xf.R;var y=this.m_localAnchorB.x-i.m_sweep.localCenter.x,d=this.m_localAnchorB.y-i.m_sweep.localCenter.y;e=t.col1.x*y+t.col2.x*d,d=t.col1.y*y+t.col2.y*d,y=e,t=a.x-l*d-o.x+s*f,e=a.y+l*y-o.y-s*p;var _=l-s,g=new r;this.m_mass.Solve33(g,-t,-e,-_),this.m_impulse.Add(g),o.x-=c*g.x,o.y-=c*g.y,s-=h*(p*g.y-f*g.x+g.z),a.x+=u*g.x,a.y+=u*g.y,l+=m*(y*g.y-d*g.x+g.z),n.m_angularVelocity=s,i.m_angularVelocity=l},S.prototype.SolvePositionConstraints=function(){var e,n=0,o=this.m_bodyA,s=this.m_bodyB;e=o.m_xf.R;var a=this.m_localAnchorA.x-o.m_sweep.localCenter.x,l=this.m_localAnchorA.y-o.m_sweep.localCenter.y;n=e.col1.x*a+e.col2.x*l,l=e.col1.y*a+e.col2.y*l,a=n,e=s.m_xf.R;var c=this.m_localAnchorB.x-s.m_sweep.localCenter.x,u=this.m_localAnchorB.y-s.m_sweep.localCenter.y;n=e.col1.x*c+e.col2.x*u,u=e.col1.y*c+e.col2.y*u,c=n,e=o.m_invMass,n=s.m_invMass;var h=o.m_invI,m=s.m_invI,p=s.m_sweep.c.x+c-o.m_sweep.c.x-a,f=s.m_sweep.c.y+u-o.m_sweep.c.y-l,y=s.m_sweep.a-o.m_sweep.a-this.m_referenceAngle,d=10*t.b2_linearSlop,_=Math.sqrt(p*p+f*f),g=i.Abs(y);return _>d&&(h*=1,m*=1),this.m_mass.col1.x=e+n+l*l*h+u*u*m,this.m_mass.col2.x=-l*a*h-u*c*m,this.m_mass.col3.x=-l*h-u*m,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=e+n+a*a*h+c*c*m,this.m_mass.col3.y=a*h+c*m,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=h+m,d=new r,this.m_mass.Solve33(d,-p,-f,-y),o.m_sweep.c.x-=e*d.x,o.m_sweep.c.y-=e*d.y,o.m_sweep.a-=h*(a*d.y-l*d.x+d.z),s.m_sweep.c.x+=n*d.x,s.m_sweep.c.y+=n*d.y,s.m_sweep.a+=m*(c*d.y-u*d.x+d.z),o.SynchronizeTransform(),s.SynchronizeTransform(),_<=t.b2_linearSlop&&g<=t.b2_angularSlop},Box2D.inherit(A,Box2D.Dynamics.Joints.b2JointDef),A.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,A.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new o,this.localAnchorB=new o},A.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this),this.type=p.e_weldJoint,this.referenceAngle=0},A.prototype.Initialize=function(t,e,n){this.bodyA=t,this.bodyB=e,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(n)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}(),function(){var t=Box2D.Dynamics.b2DebugDraw;t.b2DebugDraw=function(){this.m_xformScale=this.m_fillAlpha=this.m_alpha=this.m_lineThickness=this.m_drawScale=1;var t=this;this.m_sprite={graphics:{clear:function(){t.m_ctx.clearRect(0,0,t.m_ctx.canvas.width,t.m_ctx.canvas.height)}}}},t.prototype._color=function(t,e){return"rgba("+((16711680&t)>>16)+","+((65280&t)>>8)+","+(255&t)+","+e+")"},t.prototype.b2DebugDraw=function(){this.m_drawFlags=0},t.prototype.SetFlags=function(t){void 0===t&&(t=0),this.m_drawFlags=t},t.prototype.GetFlags=function(){return this.m_drawFlags},t.prototype.AppendFlags=function(t){void 0===t&&(t=0),this.m_drawFlags|=t},t.prototype.ClearFlags=function(t){void 0===t&&(t=0),this.m_drawFlags&=~t},t.prototype.SetSprite=function(t){this.m_ctx=t},t.prototype.GetSprite=function(){return this.m_ctx},t.prototype.SetDrawScale=function(t){void 0===t&&(t=0),this.m_drawScale=t},t.prototype.GetDrawScale=function(){return this.m_drawScale},t.prototype.SetLineThickness=function(t){void 0===t&&(t=0),this.m_lineThickness=t,this.m_ctx.strokeWidth=t},t.prototype.GetLineThickness=function(){return this.m_lineThickness},t.prototype.SetAlpha=function(t){void 0===t&&(t=0),this.m_alpha=t},t.prototype.GetAlpha=function(){return this.m_alpha},t.prototype.SetFillAlpha=function(t){void 0===t&&(t=0),this.m_fillAlpha=t},t.prototype.GetFillAlpha=function(){return this.m_fillAlpha},t.prototype.SetXFormScale=function(t){void 0===t&&(t=0),this.m_xformScale=t},t.prototype.GetXFormScale=function(){return this.m_xformScale},t.prototype.DrawPolygon=function(t,e,n){if(e){var i=this.m_ctx,o=this.m_drawScale;for(i.beginPath(),i.strokeStyle=this._color(n.color,this.m_alpha),i.moveTo(t[0].x*o,t[0].y*o),n=1;e>n;n++)i.lineTo(t[n].x*o,t[n].y*o);i.lineTo(t[0].x*o,t[0].y*o),i.closePath(),i.stroke()}},t.prototype.DrawSolidPolygon=function(t,e,n){if(e){var i=this.m_ctx,o=this.m_drawScale;for(i.beginPath(),i.strokeStyle=this._color(n.color,this.m_alpha),i.fillStyle=this._color(n.color,this.m_fillAlpha),i.moveTo(t[0].x*o,t[0].y*o),n=1;e>n;n++)i.lineTo(t[n].x*o,t[n].y*o);i.lineTo(t[0].x*o,t[0].y*o),i.closePath(),i.fill(),i.stroke()}},t.prototype.DrawCircle=function(t,e,n){if(e){var i=this.m_ctx,o=this.m_drawScale;i.beginPath(),i.strokeStyle=this._color(n.color,this.m_alpha),i.arc(t.x*o,t.y*o,e*o,0,2*Math.PI,!0),i.closePath(),i.stroke()}},t.prototype.DrawSolidCircle=function(t,e,n,i){if(e){var o=this.m_ctx,r=this.m_drawScale,s=t.x*r,a=t.y*r;o.moveTo(0,0),o.beginPath(),o.strokeStyle=this._color(i.color,this.m_alpha),o.fillStyle=this._color(i.color,this.m_fillAlpha),o.arc(s,a,e*r,0,2*Math.PI,!0),o.moveTo(s,a),o.lineTo((t.x+n.x*e)*r,(t.y+n.y*e)*r),o.closePath(),o.fill(),o.stroke()}},t.prototype.DrawSegment=function(t,e,n){var i=this.m_ctx,o=this.m_drawScale;i.strokeStyle=this._color(n.color,this.m_alpha),i.beginPath(),i.moveTo(t.x*o,t.y*o),i.lineTo(e.x*o,e.y*o),i.closePath(),i.stroke()},t.prototype.DrawTransform=function(t){var e=this.m_ctx,n=this.m_drawScale;e.beginPath(),e.strokeStyle=this._color(16711680,this.m_alpha),e.moveTo(t.position.x*n,t.position.y*n),e.lineTo((t.position.x+this.m_xformScale*t.R.col1.x)*n,(t.position.y+this.m_xformScale*t.R.col1.y)*n),e.strokeStyle=this._color(65280,this.m_alpha),e.moveTo(t.position.x*n,t.position.y*n),e.lineTo((t.position.x+this.m_xformScale*t.R.col2.x)*n,(t.position.y+this.m_xformScale*t.R.col2.y)*n),e.closePath(),e.stroke()}}();var i;for(i=0;i<Box2D.postDefs.length;++i)Box2D.postDefs[i]();delete Box2D.postDefs,function(t){t.fn.vs=function(){},t.fn._vs={},t.fn._vs.token={},t.fn._vs.draw={},t.fn._vs.stream={},t.fn._vs.chart={},t.fn._vs.phy={},t.fn._vs.decay={},t.fn._vs.flocculate={},t.fn._vs.strata={},t.fn._vs.aggregate={};var e=function(e,n){function i(t,e){var n={};for(var i in t)n[i]=t[i];for(var i in e)n[i]=e[i];return n}function o(t){if(null==t||"object"!=typeof t)return t;var e=t.constructor();for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}this.token=t.fn._vs.token,this.draw=t.fn._vs.draw,this.stream=t.fn._vs.stream,this.chart=t.fn._vs.chart,this.phy=t.fn._vs.phy,this.decay=t.fn._vs.decay,this.flocculate=t.fn._vs.flocculate,this.strata=t.fn._vs.strata,this.requestAnimFrame,this.mouse={},this.mouse.x=0,this.mouse.y=0,this.mouse.isMouseDragging=!1,this.mouse.isMouseDown=!1,this.mouse.selectedBody=null,this.dataFlow=[],this.chartPhySetup={},this.tokens=[],this.world=null,this.ctx=null;var r,s=(t(e),this),a={x:0,y:0,width:290.5,height:300.5,DOMelement:null,chart:{x:void 0,y:void 0,width:void 0,height:void 0,colorRange:d3.scale.category10(),scale:d3.scale,type:"StackedAreaChart",spacer:5,column:3,wallColor:"rgba(230,230,230,0)",label:!0,radius:10},data:{model:[{label:"Column A"},{label:"Column B"},{label:"Column C"}],strata:[[{initValue:100,label:"Strata 1 col A"}],[{initValue:20,label:"Strata 1 col B"}],[{initValue:175,label:"Strata 2 col C"}]],token:[{timestamp:1,category:1,value:1,userdata:{},callback:{}}],tokenPast:0,stream:{provider:"generator",refresh:1250,now:0}},sedimentation:{token:{size:{original:4,minimum:2},visible:!0},incoming:{strategy:1,point:[{x:50,y:0},{x:100,y:0},{x:150,y:0}],target:[{x:50,y:0},{x:100,y:0},{x:150,y:0}]},granulate:{visible:!1},flocculate:{number:1,action:"buffer",strategy:"Size",bufferSize:5,bufferTime:1e3,bufferHeight:50,bufferFrameRate:25,buffer:[]},suspension:{height:null,incomming:"top",decay:{power:1.001},refresh:200},accumulation:{height:null},aggregation:{height:0,maxData:0,invertStrata:!1}},options:{refresh:40,panel:!1,scale:30,layout:!1,canvasFirst:!0}};this.now=function(){return(new Date).getTime()},this.globalDecay=function(t){return"undefined"==typeof t?this.settings.sedimentation.suspension.decay.power:this.settings.sedimentation.suspension.decay.power=t},this.getWorld=function(){return this.world},this.chartUpdate=function(t,e){var n={cat:t,y:e};this.chart[this.settings.chart.type](s,"update",n)},this.flocculateTokens=function(t){return this.flocculate.update(s,t)},this.flocculateAll=function(){return this.flocculate.all(s)},this.addToken=function(t){return this.token.addToken(s,t)},this.selectAll=function(t,e){return this.token.selectAll(s,t,e)},this.select=function(t,e){return this.token.select(s,t,e)},this.updateAll=function(){var t=this.chart.updateAll(s,key,value);return t},this.update=function(t,e){var n=this.chart.update(s,t,e);return n},i(a,n),void 0!=n.data&&(a.data=n.data),this.settings=t.extend(!0,a,n),this.settings.DOMelement=e,"undefined"==typeof this.settings.chart.width&&(this.settings.chart.width=this.settings.width),"undefined"==typeof this.settings.chart.x&&(this.settings.chart.x=0),"undefined"==typeof this.settings.chart.y&&(this.settings.chart.y=0),"undefined"==typeof this.settings.chart.height&&(this.settings.chart.height=this.settings.height),"undefined"==typeof this.settings.stream&&(this.settings.stream={}),"undefined"==typeof this.settings.stream.now&&(this.settings.stream.now=0),"undefined"==typeof this.settings.stream.provider&&(this.settings.stream.provider="generator"),"undefined"==typeof this.settings.stream.refresh&&(this.settings.stream.refresh=1e3),"undefined"==typeof this.settings.data.tokenPast&&(this.settings.data.tokenPast=0),"undefined"==typeof this.settings.data.tokens&&(this.settings.data.tokens=[]),"undefined"!=typeof this.settings.data.strata&&0!=this.settings.data.strata.length&&("undefined"==typeof this.settings.sedimentation.aggregation&&(this.settings.sedimentation.aggregation={}),"undefined"==typeof this.settings.sedimentation.aggregation.height&&(this.settings.sedimentation.aggregation.height=this.settings.chart.height/2),"undefined"==typeof this.settings.sedimentation.aggregation.maxData&&(this.settings.sedimentation.aggregation.maxData=10)),this.init=function(){function t(t,e,n){return e.mouse.selectedToken=t,t.GetBody().GetType()!=e.phy.b2Body.b2_staticBody&&t.GetShape().TestPoint(t.GetBody().GetTransform(),n)?(e.mouse.selectedToken=t,!1):!0}function n(t,e){var n=e.getBodyAtMouse(e);if(null!=n&&"undefined"!=typeof n.m_userData&&"undefined"!=typeof n.m_userData.callback){if("function"==typeof n.m_userData.callback.mouseover){var i=e.select("ID",n.m_userData.ID);n.m_userData.callback.mouseover(i)}if("function"==typeof n.m_userData.callback.mouseout){var o,i=e.select("ID",n.m_userData.ID),r=function(){var t=i,r=e,s=n;return function(){var e=r.getBodyAtMouse(r),n=!1;n=null!=e&&"undefined"!=typeof e.m_userData&&e.m_userData.ID==t.attr("ID")?!1:!0,n&&(s.m_userData.callback.mouseout(t),clearInterval(o))}};o=window.setInterval(r(),100)}}}function i(t,e){e.mouse.isMouseDown=!0,e.handleMouseMove(t,e);var n=e.getBodyAtMouse(e);if(null!=n&&"undefined"!=typeof n.m_userData&&"undefined"!=typeof n.m_userData.callback&&"function"==typeof n.m_userData.callback.onclick){var i=e.select("ID",n.m_userData.ID);n.m_userData.callback.onclick(i)}}function o(t,e){e.mouse.isMouseDown=!1}function a(t,e){e.mouse.isMouseDown?(e.mouse.isMouseDragging=!0,e.mouse.x=t.clientX,e.mouse.y=t.clientY):(e.handleMouseMove(t,e),n("move",e))}this.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}(),this.world=new this.phy.b2World(new this.phy.b2Vec2(0,0),!0);var u=e.appendChild(document.createElement("div"));u.id="box_sediviz_"+c(),u.width=this.settings.width,u.height=this.settings.height,this.settings.DOMelement=u,r=u.appendChild(document.createElement("canvas")),r.id="canvas",r.width=this.settings.width,r.height=this.settings.height,r.style.position="absolute",this.ctx=r.getContext("2d"),this.chart[this.settings.chart.type](s,"init"),this.stream.init(s),this.flocculate.init(s),this.stream.update(s),this.token.init(s),this.strata.init(this),window.setInterval(function(){s.update(s)},s.settings.options.refresh/2),window.setInterval(function(){s.draw.update(s)},s.settings.options.refresh),window.setInterval(function(){s.decay.update(s)},s.settings.sedimentation.suspension.refresh),s.strata.update(s),this.getBodyAtMouse=function(e){var n=e.mouse.x/e.settings.options.scale,i=e.mouse.y/e.settings.options.scale,o=new e.phy.b2Vec2(n,i),r=new e.phy.b2AABB,s=.001;return r.lowerBound.Set(n-s,i-s),r.upperBound.Set(n+s,i+s),e.mouse.selectedToken=null,e.world.QueryAABB(function(n){return t(n,e,o)},r),e.mouse.selectedToken},this.handleMouseMove=function(t,e){canvasPosition=l(e.settings.DOMelement),e.mouse.x=t.clientX-(canvasPosition.offsetLeft-this.getScrollPosition()[0]),e.mouse.y=t.clientY-(canvasPosition.offsetTop-this.getScrollPosition()[1])},this.getScrollPosition=function(){return Array(document.documentElement&&document.documentElement.scrollLeft||window.pageXOffset||s.pageXOffset||document.body.scrollLeft,document.documentElement&&document.documentElement.scrollTop||window.pageYOffset||s.pageYOffset||document.body.scrollTop)},document.addEventListener("mousemove",function(t){a(t,s)}),document.addEventListener("mouseup",function(t){o(t,s)}),document.addEventListener("mousedown",function(t){i(t,s)})},this.mouse.update=function(){if(isMouseDown&&!mouseJoint){var t=getBodyAtMouse();if(t){var e=new b2MouseJointDef;e.bodyA=world.GetGroundBody(),e.bodyB=t,e.target.Set(mouseX,mouseY),e.collideConnected=!0,e.maxForce=300*t.GetMass(),mouseJoint=world.CreateJoint(e),t.SetAwake(!0)}}mouseJoint&&(isMouseDown?mouseJoint.SetTarget(new b2Vec2(mouseX,mouseY)):(world.DestroyJoint(mouseJoint),mouseJoint=null))},this.update=function(){this.world.Step(1/60,10,10),this.world.DrawDebugData(),this.world.ClearForces()};var l=function(t){for(var e=t.offsetTop,n=t.offsetLeft;t=t.offsetParent;)e+=t.offsetTop,n+=t.offsetLeft;return{offsetLeft:n,offsetTop:e}},c=function(){var t=function(){return Math.floor(65536*Math.random()).toString(16)};return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()};this.utile={},this.utile.GUID=c,this.utile.clone=o,this.settings=t.extend(this.settings,{}||{}),this.init()};t.fn.vs=function(n){if(!arguments.length)var n={};return this.each(function(){var i=t(this);if(!i.data("VisualSedimentation")){var o=new e(this,n);i.data("visualSedimentation",o)}})}}(jQuery),function(t){t.fn._vs.phy={b2Vec2:Box2D.Common.Math.b2Vec2,b2AABB:Box2D.Collision.b2AABB,b2BodyDef:Box2D.Dynamics.b2BodyDef,b2Body:Box2D.Dynamics.b2Body,b2FixtureDef:Box2D.Dynamics.b2FixtureDef,b2Fixture:Box2D.Dynamics.b2Fixture,b2World:Box2D.Dynamics.b2World,b2MassData:Box2D.Collision.Shapes.b2MassData,b2PolygonShape:Box2D.Collision.Shapes.b2PolygonShape,b2CircleShape:Box2D.Collision.Shapes.b2CircleShape,b2DebugDraw:Box2D.Dynamics.b2DebugDraw,b2MouseJointDef:Box2D.Dynamics.Joints.b2MouseJointDef,b2Shape:Box2D.Collision.Shapes.b2Shape,b2DistanceJointDef:Box2D.Dynamics.Joints.b2DistanceJointDef,b2RevoluteJointDef:Box2D.Dynamics.Joints.b2RevoluteJointDef,b2Joint:Box2D.Dynamics.Joints.b2Joint,b2PrismaticJointDef:Box2D.Dynamics.Joints.b2PrismaticJointDef,b2ContactListener:Box2D.Dynamics.b2ContactListener,b2Settings:Box2D.Common.b2Settings}}(jQuery),function(t){t.fn.vs.chart={}}(jQuery),function(t){t.fn._vs.draw={settings:{draw:{trail:1,showLayout:!1}},update:function(t){1==this.settings.draw.trail?t.ctx.clearRect(0,0,t.ctx.canvas.clientWidth,t.ctx.canvas.clientHeight):debugDrawChart(0,0,ctx.canvas.clientWidth,ctx.canvas.clientHeight,"rgba(255,255,255,"+this.settings.draw.trail+")",ctx);for(var e=t.world.GetBodyList();e;e=e.GetNext())for(var n=e.GetFixtureList();null!=n;n=n.GetNext())this.drawShape(t,n);1==this.settings.draw.showLayout&&this.debugDrawChart(chart.position.x,chart.position.y,chart.position.width,chart.position.height,"rgba(255,0,0,0.2)",ctx)},debugDrawChart:function(t,e,n,i,o,r){r.save(),r.translate(0,0),r.fillStyle=o,r.beginPath(),r.rect(t,e,n,i),r.closePath(),r.strokeStyle="#000",r.lineWidth=.5,r.stroke(),r.restore()},clippedBackgroundImage:function(t,e,n,i){t.save(),t.clip(),t.drawImage(e,n-e.height/2,i-e.width/2,e.width,e.height),t.restore()},haveTexture:function(t){var e=!1;return"undefined"!=typeof t.m_userData.texture&&"undefined"!=typeof t.m_userData.texture.img&&t.m_userData.texture.img.complete&&(e=!0),e},drawShape:function(t,e){var n=e.GetBody(),i=n.GetPosition(),o=n.GetAngle(),r=9,s=10,a=t.settings.options.scale;if(e.m_userData.x=n.GetWorldCenter().x*a,e.m_userData.y=n.GetWorldCenter().y*a,"undefined"!=typeof e)switch(e.GetType()){case 0:switch(e.m_userData){case null:t.ctx.fillStyle="rgba(255,0,0,1)";break;default:t.ctx.fillStyle=e.m_userData.fillStyle}var l=e.m_shape.m_radius;if(1==t.settings.sedimentation.token.visible){t.ctx.save(),t.ctx.translate(i.x*a,i.y*a),t.ctx.rotate(o),t.ctx.beginPath();var c=l/s*r*a;t.ctx.strokeStyle="undefined"!=typeof e.m_userData.strokeStyle?e.m_userData.strokeStyle:"rgba(0,0,0,0)",t.ctx.lineWidth="undefined"!=typeof e.m_userData.lineWidth?e.m_userData.lineWidth:0,t.ctx.arc(0,0,c,0,2*Math.PI,!0),this.haveTexture(e)&&this.clippedBackgroundImage(t.ctx,e.m_userData.texture.img,0,0),t.ctx.closePath(),1==t.settings.options.layout?(t.ctx.strokeStyle="#000",t.ctx.lineWidth=.5,t.ctx.stroke()):(this.haveTexture(e)||t.ctx.fill(),t.ctx.stroke()),t.ctx.restore()}break;case 1:switch(e.m_userData){case null:t.ctx.fillStyle="rgba(255,0,0,1)";break;default:t.ctx.fillStyle=e.m_userData.fillStyle}{e.m_shape.m_vertices[0].x*a,e.m_shape.m_vertices[0].y*a,i.x*a-e.m_shape.m_vertices[0].x*a,i.y*a-e.m_shape.m_vertices[0].y*a}t.ctx.save(),t.ctx.translate(i.x*a,i.y*a),t.ctx.rotate(o),t.ctx.beginPath(),t.ctx.strokeStyle="undefined"!=typeof e.m_userData.strokeStyle?e.m_userData.strokeStyle:e.m_userData.fillStyle,t.ctx.lineWidth="undefined"!=typeof e.m_userData.lineWidth?e.m_userData.lineWidth:0;for(var u=0;u<e.m_shape.m_vertices.length;u++){var h=e.m_shape.m_vertices;t.ctx.moveTo(h[0].x*a,h[0].y*a);for(var m=1;m<h.length;m++)t.ctx.lineTo(h[m].x*a,h[m].y*a);t.ctx.lineTo(h[0].x*a,h[0].y*a)}t.ctx.closePath(),t.ctx.fill(),1==t.settings.options.layout?(t.ctx.lineWidth=.25,t.ctx.strokeStyle="rgb(0,0,0)",t.ctx.stroke()):t.ctx.stroke(),t.ctx.restore();break;case 2:}if("undefined"!=typeof e.m_userData.callback&&"function"==typeof e.m_userData.callback.draw){var p=t.select("ID",e.m_userData.ID);e.m_userData.callback.draw(p)}}}}(jQuery),function(t){t.fn._vs.token={colorRange:function(){},init:function(t){this.colorRange=t.settings.chart.colorRange},ID:function(t){return t.settings.data.tokenPast+=1,t.settings.data.tokenPast},selectAll:function(t,e,n){var i=[],o=!1;i.flocculate=function(){var t=[];return i.forEach(function(e){q=e.flocculate(),t.push(q)}),t},i.attr=function(t,e,n){var o=[];return i.forEach(function(i){q=i.attr(t,e,n),o.push(q)}),o},i.b2dObj=function(){var t=[];return i.forEach(function(e){q=e.myobj,t.push(q)}),t},"undefined"==typeof n&&"undefined"==typeof e&&(o=!0);for(var r=t.tokens.length-1;r>=0;r--)(t.tokens[r].attr(e)==n||1==o)&&i.push(t.tokens[r]);return i},select:function(t,e,n){if(result=[],"undefined"==typeof n&&"undefined"==typeof e)return t.tokens;for(var i=t.tokens.length-1;i>=0;i--)if(t.tokens[i].attr(e)==n){result.push(t.tokens[i]);break}return"undefined"==typeof result[0]?!1:result[0]},addToken:function(t,e){var n={x:50,y:50,t:null,category:1,state:0,size:10,fillStyle:"###",strokeStyle:"rgba(0,0,0,0)",lineWidth:0,texture:void 0,shape:{type:"round"},userdata:{},callback:{},phy:{density:10,friction:0,restitution:0},targets:[],elbow:{}},i={};if(i.toString=function(){return"Token ID="+this.setting.ID},"undefined"==typeof e?(i.setting=n,i.setting.ID=this.ID(t)):(i.setting=e,"undefined"==typeof i.setting.phy&&(i.setting.phy=n.phy),"undefined"==typeof i.setting.t&&(i.setting.t=t.settings.stream.now),"undefined"==typeof i.setting.x&&(i.setting.x=t.settings.sedimentation.incoming.point[e.category].x+2*Math.random()),"undefined"==typeof i.setting.y&&(i.setting.y=t.settings.sedimentation.incoming.point[e.category].y+2*Math.random()),"undefined"==typeof i.setting.size&&(i.setting.size=t.settings.sedimentation.token.size.original),"undefined"==typeof i.setting.targets&&(i.setting.targets=[]),i.setting.ID=i.setting.ID=this.ID(t),"undefined"==typeof i.setting.state&&(i.setting.state=0),"undefined"==typeof i.setting.shape&&(i.setting.shape=n.shape)),i.myobj=this.create(t,i.setting),i.flocculate=function(){return t.tokens.indexOf(this),t.flocculate.destroyIt(t,this),this},i.attr=function(t,e,n){return"undefined"==typeof e?"undefined"!=typeof this[t]?this[t]():this.myobj.m_userData[t]:("undefined"!=typeof this[t]?this[t](e,n):this.myobj.m_userData[t]=e,this)},i.callback=function(t,e){return arguments.length?"function"==typeof this.myobj.m_userData.callback[t]?this.myobj.m_userData.callback[t](e):function(){console.log("callback undefined")}:this.myobj.m_userData.callback},i.size=function(t){if(null!=this.myobj&&this.attr("state")<2){if(!arguments.length)return this.myobj.m_shape.m_radius*this.myobj.m_userData.scale;this.myobj.m_shape.m_radius=t/this.myobj.m_userData.scale}},i.b2dObj=function(){return null!=this.myobj&&this.attr("state")<2?this.myobj:void 0},i.texture=function(t){return arguments.length?(console.log("texture",t),this.myobj.m_userData.texture={},this.myobj.m_userData.texture.img=new Image,void(this.myobj.m_userData.texture.img.src=t)):this.myobj.m_userData.texture.img.src},t.tokens.push(i),t.decay.tokens.push(i),"undefined"!=typeof this.myobj.m_userData.callback&&"function"==typeof this.myobj.m_userData.callback.suspension){var o=t.select("ID",i.setting.ID);this.myobj.m_userData.callback.suspension(o)}return i},create:function(t,e){e.scale=scale=t.settings.options.scale;var n=e.x/scale+.1*Math.random(),i=e.y/scale+.1*Math.random(),o=new Box2D.Dynamics.b2FixtureDef;o.density=.1,o.friction=0,o.restitution=0,"round"==e.shape.type?o.shape=new Box2D.Collision.Shapes.b2CircleShape(e.size/scale):"polygons"==e.shape.type?o=this.setPolygons(t,e,o):"box"==e.shape.type&&(o.shape=new Box2D.Collision.Shapes.b2PolygonShape,o.shape.SetAsBox(e.shape.width/scale,e.shape.height/scale));var r=new Box2D.Dynamics.b2BodyDef;if(r.type=Box2D.Dynamics.b2Body.b2_dynamicBody,r.position.x=e.x/scale,r.position.y=e.y/scale,this.myobj=t.world.CreateBody(r).CreateFixture(o),"undefined"!=typeof e.texture&&(e.texture.img=new Image,e.texture.img.src=e.texture.src),"undefined"!=typeof e.impulse&&this.applyImpulse(this.myobj,e.impulse.angle,e.impulse.power),"undefined"==typeof e.fillStyle&&(e.fillStyle=this.colorRange(e.category)),"undefined"==typeof e.lineWidth&&(e.lineWidth=0),"undefined"==typeof e.type&&(e.type="token"),"undefined"==typeof e.callback&&(e.callback={}),this.myobj.m_userData=e,this.myobj.attr=this.attr,this.myobj.m_userData.mouse={},this.myobj.m_userData.mouse.over=!1,this.myobj.m_userData.mouse.down=!1,this.myobj.m_userData.mouse.dragging=!1,this.myobj.m_userData.mouse.statebefore=!1,this.myobj.m_userData.state=1,0==e.targets.length&&"CircleLayout"==t.settings.chart.type&&(e.targets[0]={x:t.settings.sedimentation.incoming.target[e.category].x,y:t.settings.sedimentation.incoming.target[e.category].y}),e.targets.length>0){var s=new t.phy.b2MouseJointDef;s.bodyA=t.world.GetGroundBody(),s.bodyB=this.myobj.GetBody(),s.target.Set(n,i),s.collideConnected=!0,s.maxForce=50*this.myobj.GetBody().GetMass(),mouseJoint=t.world.CreateJoint(s),mouseJoint.SetTarget(new t.phy.b2Vec2(e.targets[0].x/scale,e.targets[0].y/scale))}return this.myobj},applyImpulse:function(t,e,n){var i=t.GetBody();i.ApplyImpulse(new Box2D.Common.Math.b2Vec2(Math.cos(e*(Math.PI/180))*n,Math.sin(e*(Math.PI/180))*n),i.GetWorldCenter())},setPolygons:function(t,e,n){n.shape=new Box2D.Collision.Shapes.b2PolygonShape,null==e.shape.points&&(e.shape.points=[{x:-1,y:-1},{x:1,y:-1},{x:-1,y:-1},{x:1,y:-1}]);for(var i=0;i<e.shape.points.length;i++){var o=new Box2D.Common.Math.b2Vec2;o.Set(e.shape.points[i].x/scale,e.shape.points[i].y/scale),e.shape.points[i]=o}return n.shape.SetAsArray(e.shape.points,e.shape.points.length),n},createDataBarBall:function(t,e,n,i,o){var r=new Box2D.Dynamics.b2FixtureDef;r.density=10,r.friction=.5,r.restitution=.2,r.shape=new Box2D.Collision.Shapes.b2CircleShape(i/t.settings.options.scale);var s=new Box2D.Dynamics.b2BodyDef;s.type=Box2D.Dynamics.b2Body.b2_dynamicBody,s.position.x=e/t.settings.options.scale,s.position.y=n/t.settings.options.scale;var a=t.world.CreateBody(s).CreateFixture(r);return a.m_userData={type:"BarChartBall",familyID:"family",fillColor:this.colorRange(o)},a},createBox:function(t,e,n,i,o,r,s,a){"undefined"==typeof a&&(a=!0);var l=new b2FixtureDef;a||(l.density=100),l.friction=.6,l.restitution=.3;var c=new b2BodyDef;c.type=b2Body.b2_staticBody,c.angle=r,l.shape=new b2PolygonShape,l.shape.SetAsBox(i/scale,o/scale),c.position.Set(e/scale,n/scale);var u=t.CreateBody(c).CreateFixture(l);return u.m_userData={type:"Wall",fillColor:s},console.log(u.m_userData),u},createBoxPie:function(t,e,n,i,o,r,s,a){var l=new b2BodyDef;l.type=Box2D.Dynamics.b2Body.b2_dynamicBody;var c=new Box2D.Dynamics.b2FixtureDef;c.shape=new b2PolygonShape,c.shape.SetAsBox(o/scale,r/scale),c.density=1e6,c.friction=.5,c.restitution=.2,l.position.Set(n/scale,i/scale),l.angle=0;var u=t.CreateBody(l).CreateFixture(c);return u.m_userData={type:"Wall",fillColor:a},u},createBox0D:function(t,e,n,i,o,r){"undefined"==typeof r&&(r=!0);var s=new b2BoxDef;s.restitution=-.6,s.friction=.3,r||(s.density=.01),s.extents.Set(i,o);var a=new b2BodyDef;return a.AddShape(s),a.position.Set(e,n),t.CreateBody(a)},createHiddenBox:function(t,e,n,i,o,r){"undefined"==typeof r&&(r=!0);var s=new b2BoxDef;s.restitution=.6,s.friction=.3,r||(s.density=1),s.extents.Set(i,o);var a=new b2BodyDef;a.AddShape(s),a.position.Set(e,n);var l=t.CreateBody(a);return l.m_shapeList.visibility="hidden",console.log(l),l},createBigBall:function(t,e,n){var i=new Box2D.Dynamics.b2FixtureDef;i.density=1e6,i.friction=.5,i.restitution=.2,i.shape=new Box2D.Collision.Shapes.b2CircleShape(20/30);var o=new Box2D.Dynamics.b2BodyDef;o.type=Box2D.Dynamics.b2Body.b2_dynamicBody,o.position.x=e,o.position.y=n;var r=t.CreateBody(o).CreateFixture(i);return r},createPieBox:function(e,n,i,o,r,s,a,l){l=t.extend(!0,{density:1e7,friction:1,restitution:.2,linearDamping:0,angularDamping:0,gravityScale:0,type:b2Body.b2_dynamicBody},l);var c=new b2BodyDef,u=new b2FixtureDef;u.density=l.density,u.friction=l.friction,u.restitution=l.restitution,u.shape=new b2PolygonShape,u.shape.SetAsBox(o/scale,r/scale),c.position.Set(n/scale,i/scale),c.linearDamping=l.linearDamping,c.angularDamping=l.angularDamping,c.angle=s,c.type=l.type;var h=e.CreateBody(c),m=h.CreateFixture(u);return m.m_userData={type:"box",familyID:null,fillColor:a},h},createDataBallTarget:function(t,e,n,i,o,r,s){var a=i/scale+.1*Math.random(),l=o/scale+.1*Math.random(),c=new Box2D.Dynamics.b2FixtureDef;c.density=.1,c.friction=0,c.restitution=0,c.shape=new Box2D.Collision.Shapes.b2CircleShape(r/scale);var u=new Box2D.Dynamics.b2BodyDef;u.type=Box2D.Dynamics.b2Body.b2_dynamicBody,u.position.x=a,u.position.y=l;var h=t.CreateBody(u).CreateFixture(c),m=new b2MouseJointDef;return m.bodyA=t.GetGroundBody(),m.bodyB=h.GetBody(),m.target.Set(a,l),m.collideConnected=!0,m.maxForce=50*h.GetBody().GetMass(),mouseJoint=t.CreateJoint(m),mouseJoint.SetTarget(new b2Vec2(e/scale,n/scale)),h.m_userData={type:"PieBall",familyID:s,fillColor:colorScale(s)},categorys[s].value+=1,categorys[s].joins.push(mouseJoint),h},createDataBallPie:function(t,e,n,i,o,r){console.log(e);var s=categorys[r].incomingPoint.x/scale+2*Math.random()/scale,a=categorys[r].incomingPoint.y/scale,l=new Box2D.Dynamics.b2FixtureDef;l.density=.1,l.friction=0,l.restitution=0,l.shape=new Box2D.Collision.Shapes.b2CircleShape(o/scale);var c=new Box2D.Dynamics.b2BodyDef;c.type=Box2D.Dynamics.b2Body.b2_dynamicBody,c.position.x=s,c.position.y=a;var u=t.CreateBody(c);u.m_userData={type:"PieBall",familyID:r,fillColor:categorys[r].color},listBodies.push(u);var h=u.CreateFixture(l),m=new b2MouseJointDef;return m.bodyA=t.GetGroundBody(),m.bodyB=h.GetBody(),m.target.Set(s,a),m.collideConnected=!0,m.maxForce=100*h.GetBody().GetMass(),mouseJoint=t.CreateJoint(m),mouseJoint.SetTarget(new b2Vec2(e.position.x/scale,e.position.y/scale)),h.m_userData={type:"PieBall",familyID:r,fillColor:colorScale(r)},categorys[r].value+=1,h},createDataBall:function(t,e,n,i){var o=new Box2D.Dynamics.b2FixtureDef;o.density=1,o.friction=.5,o.restitution=.2,o.shape=new Box2D.Collision.Shapes.b2CircleShape(i/t.settings.options.scale);var r=new Box2D.Dynamics.b2BodyDef;r.type=Box2D.Dynamics.b2Body.b2_dynamicBody,r.position.x=e,r.position.y=n;var s=t.world.CreateBody(r).CreateFixture(o);return s.m_userData={type:"PieBall",familyID:"family",fillColor:"rgb(200,0,0)"},s}}}(jQuery),function(t){t.fn._vs.stream={i:null,buffer:[],speed:1e4/6,strategy:null,type:null,init:function(t){this.speed=t.settings.data.stream.refresh,type=t.settings.data.stream.provider},push:function(t){console.log(t);for(var e=t.length-1;e>=0;e--)buffer.push(t)},update:function(t){if("generator"==type)for(var e=0;e<t.settings.data.model.length;e++)t.dataFlow[e]=setInterval(function(t,e){return function(){e.settings.data.stream.now++;var n=e.chart[e.settings.chart.type](e,"token",t);e.addToken(n)}}(e,t),this.speed);else"tokens"==type&&(t.dataFlow[0]=setInterval(function(t,e){return function(){e.settings.data.stream.now++;for(var t=0;t<e.settings.data.tokens.length;t++)e.settings.data.tokens[t].t==e.settings.data.stream.now&&e.addToken(e.settings.data.tokens[t])}}(e,t),this.speed))},generator:function(){},test:function(t){t.tokens.push(t.token.createDataBarBall(t,t.settings.sedimentation.incoming[i].x+2*Math.random(),t.settings.sedimentation.incoming[i].y+1*Math.random(),t.settings.sedimentation.token.size,i))},setSpeed:function(t,e){speedFlow=e;for(var n=0;n<categorys.length;n++)window.clearInterval(dataFlow[n]);window.clearInterval(decayFlow),dataFlow(categorys)}}}(jQuery),function(t){t.fn._vs.decay={tokens:[],update:function(t){var e=(t.settings.sedimentation.suspension.height,t.settings.height,t.settings.sedimentation.token.size/4,t.settings.sedimentation.suspension.decay.power),n=(t.settings.options.scale,t.settings.sedimentation.token.size.minimum);if(null==e)var e=0;for(var i=0;i<this.tokens.length;i++){var o=this.tokens[i].attr("size");0!=e&&this.tokens[i].attr("size",o/e),n>=o&&null!=t.settings.sedimentation.flocculate.strategy&&(t.flocculate.destroyIt(t,this.tokens[i]),t.strata.update(t))}}}}(jQuery),function(t){t.fn._vs.flocculate={buffer:[],init:function(t){for(var e=0;e<t.settings.data.model.length;e++)this.buffer[e]=[]},addtobuffer:function(t,e){c=e.attr("category"),bufferSize=t.settings.sedimentation.flocculate.bufferSize,this.buffer[c].push(e),t.decay.tokens.splice(t.decay.tokens.indexOf(e),1),e.attr("callback","bufferFlocculation",e),this.buffer[c].length>bufferSize&&this.update(t,c,bufferSize)
},destroyIt:function(t,e){e.attr("callback","flocculation",e),e.attr("state",2);var n=t.world.DestroyBody(e.myobj.GetBody());return n},update:function(t,e,n){if(1==t.settings.sedimentation.flocculate.number)for(;this.buffer[e].length>n;){var i=this.buffer[e].shift();this.destroyIt(t,i)}else for(;this.buffer[e].length>t.settings.sedimentation.flocculate.number;){var i=this.buffer[e].shift();this.destroyIt(t,i)}},disapear:function(t,e){window.setInterval(function(){e.update(self)},self.settings.options.refresh/2)},all:function(t){for(var e=t.decay.tokens-1;e>=0;e--)this.update(t,e,t.tokens.length)},strategy:function(){flocullateBuffer.length>0&&("Size"==chart.flocullate.strategy&&flocullateBuffer.length>=chart.flocullate.bufferSize?flocullateByArray(flocullateBuffer):"Time"==chart.flocullate.strategy||"Height"==chart.flocullate.strategy)}}}(jQuery),function(t){t.fn._vs.aggregate={defaultSettings:{},strata_layers:function(t,e,n,i){function o(t,e){return{x:e,y:Math.max(0,t)}}{var r=d3.scale.linear().domain([1,n-2]).range([Math.PI/2,2*Math.PI-Math.PI/2]);d3.scale.pow().exponent(10).domain([0,n]).range([0,1])}return d3.range(e).map(function(e){var s=5*Math.random();return d3.range(n).map(function(n){if("sin"==t.settings.sedimentation.aggregation.strataType){if(1==e)return 20;var o=5+5*s*Math.sin(r(n))+50*e;return 0>o?-o:o}return"log"==t.settings.sedimentation.aggregation.strataType?e+1:("undefined"==typeof i&&(i=0),t.settings.data.strata[i][e].value)}).map(o)})},init:function(t){if("undefined"!=typeof t.settings.data.strata&&0!=t.settings.data.strata.length&&0!=t.settings.data.strata[0].length){var e=t.token.colorRange;if("StackedAreaChart"==t.settings.chart.type){var n=t.settings.chart.width/t.settings.data.model.length,i=t.settings.sedimentation.aggregation.height,o=d3.select("#"+t.settings.DOMelement.id).append("div").attr("class","vis").style("z-index",10).append("svg").attr("width",t.settings.width).attr("height",t.settings.height).append("g").attr("transform","translate("+t.settings.chart.x+","+t.settings.chart.y+")"),r=o.selectAll("g.gcol").data(t.settings.data.strata,function(t){return[t]}).enter().append("g").attr("transform",function(e,i){return"translate("+i*n+", "+(t.settings.chart.height-t.settings.sedimentation.aggregation.height)+")"}).attr("class",function(t,e){return"gcol col_"+e}),s=t.settings.data.strata.map(function(t){return{value:t[0].value}}),a=(t.settings.data.strata[0].length,20);smx=a-1,smy=0;var l=0,c=d3.svg.area().x(function(e){return t.settings.chart.spacer+e.x*(n-2*t.settings.chart.spacer)/smx}).y0(function(t){return i-t.y0*l}).y1(function(t){return i-(t.y+t.y0)*l}),u=r.selectAll("gpath").data(function(e,n){var i=d3.layout.stack().offset("expand")(t.aggregate.strata_layers(t,e.length,a,n));return smy=d3.max(i,function(t){return d3.max(t,function(t){return t.y0+t.y})}),i.map(function(t){t.map(function(t){return t.col=n,t})}),i}).enter().append("g").attr("class","gpath");u.append("path").attr("d",function(e){return l=t.settings.chart.height-t.chart.getPosition(t)[e[0].col].y,c(e)}).style("fill",function(n,i){return null!=t.settings.data.strata[n[0].col][i].texture?"url(#RectanglePattern_"+n[0].col+"_"+i+")":d3.rgb(e(n[0].col)).darker(t.settings.data.strata[n[0].col].length/2-(i+1)/2)}).attr("class",function(){return"layer"}).attr("class",function(t,e){return"col_"+t[0].col+" layer_"+e});for(var h=n/1,m=h,p=0;p<t.settings.data.strata.length;p++)for(var f=0;f<t.settings.data.strata[p].length;f++)if(null!=t.settings.data.strata[p][f].texture){var y=o.append("pattern").attr("id","RectanglePattern_"+p+"_"+f).attr("height",m).attr("width",h).attr("patternTransform","translate(0, 0) scale("+t.settings.data.strata[p][f].texture.size+", "+t.settings.data.strata[p][f].texture.size+") rotate(0)").attr("patternUnits","userSpaceOnUse");y.append("image").attr("x",0).attr("y",0).attr("height",m).attr("width",h).attr("xlink:href",function(){return t.settings.data.strata[p][f].texture.url})}}else if("CircleLayout"==t.settings.chart.type){var d=d3.select("#"+t.settings.DOMelement.id).append("div").attr("class","vis").attr("width",t.settings.width).attr("height",t.settings.height).append("svg").attr("width",t.settings.width).attr("height",t.settings.height);if("undefined"!=typeof t.settings.chart.treeLayout)for(var _=0;_<t.settings.data.model.length;_++){var s=t.settings.data.strata[_],e=function(){return t.token.colorRange(_)};t.aggregate.create_pie_chart(t,s,d,s[0].value,e,(_+.5)*t.settings.chart.width/t.settings.data.model.length+t.settings.chart.x,t.settings.chart.y+t.settings.chart.height/6)}else{var s=t.settings.data.strata.map(function(t){return{value:t[0].value}});console.log(t.settings.data.strata,s);var e=t.token.colorRange;t.aggregate.create_pie_chart(t,s,d,t.settings.chart.radius,e,t.settings.chart.x+t.settings.chart.width/2,t.settings.chart.y+t.settings.chart.height/2)}}}},create_pie_chart:function(t,e,n,i,o,r,s){{var a=t.settings.width/t.settings.data.model.length,l=t.settings.sedimentation.aggregation.height;d3.scale.linear().domain([0,t.settings.data.strata.length-1]).range([0,t.settings.width]),d3.scale.linear().domain([0,d3.max(e,function(t){return t.value})]).rangeRound([0,l]),t.settings.width,t.settings.height,t.settings.sedimentation.aggregation.height}labelr=i+30,donut=d3.layout.pie().sort(null),arc=d3.svg.arc().innerRadius(0).outerRadius(i);var c=Math.random();n.append("g.arcs_"+c).attr("class","arcs_"+c);{var u=n.selectAll(".arcs").data(donut(e.map(function(t){return t.value}))).enter().append("svg:g").attr("transform","translate("+r+","+s+")"),h=0;d3.svg.area().x(function(e){return t.settings.chart.spacer+e.x*(a-2*t.settings.chart.spacer)/smx}).y0(function(t){return l-t.y0*h}).y1(function(t){return l-(t.y+t.y0)*h}),u.append("path").attr("fill",function(t,e){return o(e)}).attr("d",function(t){return arc(t)}).each(function(t){this._current=t})}},update:function(t){if("undefined"!=typeof t.settings.data.strata&&0!=t.settings.data.strata.length&&0!=t.settings.data.strata[0].length){var e=t.settings.chart.width/t.settings.data.model.length,n=t.settings.sedimentation.aggregation.height,i=(d3.scale.linear().domain([0,t.settings.data.strata.length-1]).range([0,t.settings.width]),t.settings.data.strata.map(function(t){return{value:t[0].value}}),t.settings.data.strata.map(function(t){for(var e=0,n=0;e<t.length;e++)n+=t[e].value;return n})),o=d3.scale.linear().domain([0,d3.max(i)]).range([0,t.settings.sedimentation.aggregation.height]),r=(t.settings.data.strata[0].length,20);smx=r-1,smy=0;var s=0,a=d3.svg.area().x(function(n){return t.settings.chart.spacer+n.x*(e-2*t.settings.chart.spacer)/smx}).y0(function(t){return n-t.y0*s}).y1(function(t){return n-(t.y+t.y0)*s}),l=d3.select("svg"),c=l.selectAll(".gcol");c.data(t.settings.data.strata,function(t){return[t]});var u=c.selectAll(".gpath").data(function(e,n){var i=d3.layout.stack().offset("expand")(t.aggregate.strata_layers(t,e.length,r,n));return smy=d3.max(i,function(t){return d3.max(t,function(t){return t.y0+t.y})}),i.map(function(t){t.map(function(t){return t.col=n,t})}),i});u.select("path").transition().duration(100).attr("d",function(e,r){return t.chartUpdate(r,-o(i[r])-(n-t.settings.chart.height)),s=t.settings.chart.height-t.chart.getPosition(t)[e[0].col].y,a(e)})}}}}(jQuery),function($){$.fn._vs.strata={stratas:[],init:function(_this){function fstrata(){for(var t=Array(),e=0;e<mySettings.data.model.length;e++)t.push(fstratum(e));return t}function fstratum(t){for(var e=Array(NB_STRATA),n=0;n<e.length;n++)e[n]=Array();if("undefined"!=typeof _this)for(var i=_this.selectAll("category",s).attr("state").filter(function(t){return 2==t?t:void 0}).length,o=0;o<i.length;o++)for(var r=i[o],n=0;n<e.length;n++)r<_this.settings.stream.now-2*n&&r>=_this.settings.stream.now-2*(n+1)&&e[e.length-n-1].push(r);for(var a=Array(),l=0;NB_STRATA>l;l++){var c=e[l].length;!function(e){a.push({value:function(){return e},label:"Strata "+l,category:t})}(c)}return a}if("StackedAreaChart"!=_this.settings.chart.type)return void _this.strata.create_strata(_this);if(settings=_this.settings,"function"!=typeof settings.data.strata&&("undefined"==typeof settings.data.strata||0==settings.data.strata.length)){for(var i=0;i<settings.data.model.length;i++){var defaultStrata={label:settings.data.model[i].label+"_"+i,category:i,value:function(){return 0}};_this.strata.stratas[i]=[defaultStrata]}return void _this.strata.create_strata(_this)}if("function"!=typeof settings.data.strata){if("undefined"!=typeof settings.data.strata[0]&&"undefined"!=typeof settings.data.strata[0][0].value){for(var NB_STRATA=settings.data.strata[0].length,i=0;i<settings.data.model.length;i++){_this.strata.stratas[i]=[];for(var n=0;NB_STRATA>n;n++)!function(a,b){var t=null;"undefined"!=typeof settings.data.strata[a]&&"undefined"!=typeof settings.data.strata[a][b]&&"undefined"!=typeof settings.data.strata[a][b].texture&&(t=settings.data.strata[a][b].texture);var defaultStrata={};defaultStrata={label:settings.data.model[i].label+"_"+a,category:a,texture:t,value:function(){return(r=eval("f="+settings.data.strata[a][b].value))()}},_this.strata.stratas[a].push(defaultStrata)}(i,n)}return void _this.strata.create_strata(_this)}if("undefined"!=typeof settings.data.strata[0]&&"undefined"!=typeof settings.data.strata[0][0]){for(var c=0;c<settings.data.model.length;c++){var defaultStrata={label:settings.data.model[c].label+"_"+c,category:i,value:function(t,e){return t.selectAll("category",e)?settings.data.strata[e][0].initValue+t.selectAll("category",e).attr("state").filter(function(t){return 2==t?t:void 0}).length:settings.data.strata[e][0].initValue}};_this.strata.stratas[c]=[defaultStrata]}return void _this.strata.create_strata(_this)}if(0==settings.data.strata[0].length){for(var i=0;i<settings.data.model.length;i++){var defaultStrata={label:settings.data.model[i].label+"_"+i,category:i,value:function(t,e){return t.selectAll("category",e)?t.selectAll("category",e).attr("state").filter(function(t){return 2==t?t:void 0}).length:0}};_this.strata.stratas[i]=[defaultStrata]}return void _this.strata.create_strata(_this)}var NB_STRATA=settings.data.strata[0].length;return settings.data.strata_param=settings.data.strata,_this.settings.data.strata=function(){return fstrata()},_this.strata.stratas=_this.settings.data.strata(),void _this.strata.create_strata(_this)}if("function"==typeof settings.data.strata||settings.data.strata[0].length>0||_this.strata.stratas.length>0){if("function"==typeof settings.data.strata||settings.data.strata[0].length>0&&"object"==typeof settings.data.strata[0])if("function"==typeof settings.data.strata)_this.strata.stratas=settings.data.strata();else if("function"==typeof settings.data.strata[0].value)for(var i=0;i<settings.data.model.length;i++){var defaultStrata={label:settings.data.model[i].label+"_"+i,category:i,initValue:settings.data.model[i].value,value:function(){return settings.data.strata[i]}};_this.strata.stratas[i]=[defaultStrata]}else for(var i=0;i<settings.data.model.length;i++){var defaultStrata={label:settings.data.model[i].label+"_"+i,category:i,initValue:settings.data.model[i].value,value:function(t,e){return"undefined"==typeof t.selectAll("category",e).length?this.initValue:t.selectAll("category",e)?this.initValue+t.selectAll("category",e).attr("state").filter(function(t){return 2==t?t:void 0}).length:0}};_this.strata.stratas[i]=[defaultStrata]}_this.strata.create_strata(_this)}},selectAll:function(t,e,n){if(result=[],result.attr=function(t,e,n){var i=[];return result.forEach(function(o){q=o.attr(t,e,n),i.push(q)}),i},"undefined"==typeof n&&"undefined"==typeof e)return this.stratas;for(var i=t.strata.stratas.length-1;i>=0;i--)if(t.strata.stratas[i].attr(e)==n){result.push(t.strata.stratas[i]);break}return"undefined"==typeof result[0]?!1:result[0]},add:function(t,e){var n=function(){};return n.myobj=e,n.attr=function(t,e,n){return"undefined"==typeof e?"undefined"!=typeof this[t]?this[t]():this.myobj[t]:("undefined"!=typeof this[t]?this[t](e,n):this.myobj[t]=e,this)},n},remove:function(){},strata_layers:function(t,e,n,i){function o(t,e){return{x:e,y:Math.max(0,t)}}{var r=d3.scale.linear().domain([1,n-2]).range([Math.PI/2,2*Math.PI-Math.PI/2]);d3.scale.pow().exponent(10).domain([0,n]).range([0,1])}return d3.range(e).map(function(e){var s=5*Math.random();return d3.range(n).map(function(n){if("sin"==t.settings.sedimentation.aggregation.strataType){if(1==e)return 20;var o=5+5*s*Math.sin(r(n))+50*e;return 0>o?-o:o}return"log"==t.settings.sedimentation.aggregation.strataType?e+1:("undefined"==typeof i&&(i=0),t.strata.stratas[i][e].value(t,i))}).map(o)})},create_strata:function(t){if("StackedAreaChart"==t.settings.chart.type){var e=t.settings.chart.width/t.settings.data.model.length,n=t.settings.sedimentation.aggregation.height,i=t.token.colorRange;if("undefined"!=typeof t.settings.options.canvasFirst&&0==t.settings.options.canvasFirst)var o=d3.select("#"+t.settings.DOMelement.id).insert("div",":first-child").style("position","absolute").attr("class","vis").style("z-index",10).append("svg").attr("width",t.settings.width).attr("height",t.settings.height).append("g").attr("transform","translate("+t.settings.chart.x+","+t.settings.chart.y+")");else var o=d3.select("#"+t.settings.DOMelement.id).append("div").attr("class","vis").style("z-index",10).append("svg").attr("width",t.settings.width).attr("height",t.settings.height).append("g").attr("transform","translate("+t.settings.chart.x+","+t.settings.chart.y+")");var r=(t.strata.stratas[0].length,20);smx=r-1,smy=0;var s=t.strata.stratas.map(function(e,n){for(var i=0,o=0;i<e.length;i++)o+=e[i].value(t,n);return o}),a=d3.scale.linear().domain([0,Math.max(d3.max(s),t.settings.sedimentation.aggregation.maxData)]).range([0,t.settings.sedimentation.aggregation.height]),l=o.selectAll("g.gcol").data(t.strata.stratas,function(t){return[t]}).enter().append("g").attr("transform",function(n,i){var o=t.settings.sedimentation.aggregation.height;return t.settings.sedimentation.aggregation.invertStrata&&(o=2*t.settings.sedimentation.aggregation.height-a(s[i])),"translate("+i*e+", "+(t.settings.chart.height-o)+")"}).attr("class",function(t,e){return"gcol col_"+e}),c=l.selectAll(".gpath").data(function(e,n){var i=d3.layout.stack().offset("expand")(t.strata.strata_layers(t,e.length,r,n));return smy=d3.max(i,function(t){return d3.max(t,function(t){return t.y0+t.y})}),i.map(function(t){t.map(function(t){return t.col=n,t})}),i}).enter().append("g").attr("class","gpath"),u=d3.svg.area().x(function(n){return t.settings.chart.spacer+n.x*(e-2*t.settings.chart.spacer)/smx}).y0(function(t){return n-t.y0*t.offshit}).y1(function(t){return n-(t.y+t.y0)*t.offshit}),h=c.append("path").attr("d",function(e,i){return t.chartUpdate(i,-a(s[i])-(n-t.settings.chart.height)),hh=0,e.map(function(t){return t.offshit=hh,t}),u(e)});h.style("fill",function(e,n){return null!=t.strata.stratas[e[0].col][n].texture?"url(#RectanglePattern_"+e[0].col+"_"+n+")":d3.rgb(i(e[0].col)).darker(t.strata.stratas[e[0].col].length/2-(n+1)/2)}).attr("class",function(t,e){return"gcol col_"+t[0].col+" layer_"+e});var m=e/1,p=m;if("undefined"!=typeof t.settings.data.strata)for(var f=0;f<t.settings.data.strata.length;f++)for(var y=0;y<t.settings.data.strata[f].length;y++)if(null!=t.settings.data.strata[f][y].texture){var d=o.append("pattern").attr("id","RectanglePattern_"+f+"_"+y).attr("height",p).attr("width",m).attr("patternTransform","translate(0, 0) scale("+t.settings.data.strata[f][y].texture.size+", "+t.settings.data.strata[f][y].texture.size+") rotate(0)").attr("patternUnits","userSpaceOnUse");d.append("image").attr("x",0).attr("y",0).attr("height",p).attr("width",m).attr("xlink:href",function(){return t.settings.data.strata[f][y].texture.url})}}else if("CircleLayout"==t.settings.chart.type){var _=d3.select("#"+t.settings.DOMelement.id).append("div").attr("class","vis").attr("width",t.settings.width).attr("height",t.settings.height).append("svg").attr("width",t.settings.width).attr("height",t.settings.height);if("undefined"!=typeof t.settings.chart.treeLayout)for(var g=0;g<t.settings.data.model.length;g++){var x=t.settings.data.strata[g],i=function(){return t.token.colorRange(g)};t.strata.create_pie_chart(t,x,_,x[0].value,i,(g+.5)*t.settings.chart.width/t.settings.data.model.length+t.settings.chart.x,t.settings.chart.y+t.settings.chart.height/6)}else{var x=t.settings.data.strata.map(function(t){return{value:t[0].value}}),i=t.token.colorRange;t.strata.create_pie_chart(t,x,_,t.settings.chart.radius,i,t.settings.chart.x+t.settings.chart.width/2,t.settings.chart.y+t.settings.chart.height/2)}}},create_pie_chart:function(t,e,n,i,o,r,s){{var a=t.settings.width/t.settings.data.model.length,l=t.settings.sedimentation.aggregation.height;d3.scale.linear().domain([0,t.settings.data.strata.length-1]).range([0,t.settings.width]),d3.scale.linear().domain([0,d3.max(e,function(t){return t.value})]).rangeRound([0,l]),t.settings.width,t.settings.height,t.settings.sedimentation.aggregation.height}labelr=i+30,donut=d3.layout.pie().sort(null),arc=d3.svg.arc().innerRadius(0).outerRadius(i);var c=Math.random();n.append("g.arcs_"+c).attr("class","arcs_"+c);{var u=n.selectAll(".arcs").data(donut(e.map(function(t){return t.value}))).enter().append("svg:g").attr("transform","translate("+r+","+s+")"),h=0;d3.svg.area().x(function(e){return t.settings.chart.spacer+e.x*(a-2*t.settings.chart.spacer)/smx}).y0(function(t){return l-t.y0*h}).y1(function(t){return l-(t.y+t.y0)*h}),u.append("path").attr("fill",function(t,e){return o(e)}).attr("d",function(t){return arc(t)}).each(function(t){this._current=t})}},update:function(t){if("undefined"!=typeof t.strata.stratas&&0!=t.strata.stratas.length){"function"==typeof settings.data.strata&&(t.strata.stratas=settings.data.strata());var e=(t.strata.stratas[0].length,20);smx=e-1,smy=0;var n=t.settings.chart.width/t.settings.data.model.length,i=t.settings.sedimentation.aggregation.height,o=(t.token.colorRange,d3.svg.area().x(function(e){return t.settings.chart.spacer+e.x*(n-2*t.settings.chart.spacer)/smx}).y0(function(t){return i-t.y0*t.offshit}).y1(function(t){return i-(t.y+t.y0)*t.offshit})),r=t.strata.stratas.map(function(e,n){for(var i=0,o=0;i<e.length;i++)o+=e[i].value(t,n);return o}),s=d3.scale.linear().domain([0,Math.max(d3.max(r),t.settings.sedimentation.aggregation.maxData)]).range([0,t.settings.sedimentation.aggregation.height]),a=d3.select("#"+t.settings.DOMelement.id),l=a.selectAll("g.gcol");t.settings.sedimentation.aggregation.invertStrata&&l.transition().duration(100).attr("transform",function(e,i){var o=t.settings.sedimentation.aggregation.height;return o=2*t.settings.sedimentation.aggregation.height-s(r[i]),"translate("+i*n+", "+(t.settings.chart.height-(2*t.settings.sedimentation.aggregation.height-s(r[i])))+")"});{l.selectAll("path").data(function(n,i){var o=d3.layout.stack().offset("expand")(t.strata.strata_layers(t,n.length,e,i));return smy=d3.max(o,function(t){return d3.max(t,function(t){return t.y0+t.y})}),o.map(function(t){t.map(function(t){return t.col=i,t})}),o})}if("StackedAreaChart"==t.settings.chart.type){a.selectAll("path").transition().duration(100).attr("d",function(e,n){return t.settings.sedimentation.aggregation.invertStrata?(t.chartUpdate(n,-2*i+t.settings.chart.height),hh=s(r[e[0].col])):(t.chartUpdate(n,-s(r[n])-(i-t.settings.chart.height)),hh=t.settings.chart.height-t.chart.getPosition(t)[e[0].col].y),e.map(function(t){return t.offshit=hh,t}),o(e)})}}}}}(jQuery),function(t){t.fn._vs.chart.StackedAreaChart=function(t,e,n){if(this.init=function(t){gravity=new t.phy.b2Vec2(.001,10),t.world.m_gravity=gravity,t.chartPhySetup={grounds:[],wall:[]},this.setupChartPhysics(t)},this.setupChartPhysics=function(t){for(var e=t.settings.chart.spacer,n=t.settings.chart.width/t.settings.data.model.length,i=e,o=t.settings.chart.height/2+t.settings.chart.y,r=(t.settings.chart.height-t.settings.sedimentation.aggregation.height,0),s=0;s<t.settings.data.model.length;s++){if(t.settings.data.model[s].value=0,"undefined"!=typeof t.settings.data.strata&&"undefined"!=typeof t.settings.data.strata[s])for(var a=0;a<t.settings.data.strata[s].length;a++)t.settings.data.model[s].value+=t.settings.data.strata[s][a].value;r+=t.settings.data.model[s].value}for(var s=0;s<t.settings.data.model.length+1;s++){var l=t.settings.chart.x+s*n;t.chartPhySetup.wall[s]=this.createMyChartBox(t,l,o,i,t.settings.chart.height/2,"wall",t.settings.chart.wallColor),s<t.settings.data.model.length&&(t.settings.sedimentation.incoming.point[s]={x:l+n/2,y:t.settings.y}),s<t.settings.data.model.length&&(t.chartPhySetup.grounds[s]=this.createMyChartBox(t,l+n/2,t.settings.chart.height+t.settings.chart.y+t.settings.sedimentation.aggregation.height,n/2,t.settings.chart.height,"lift","rgba(250,250,250,0)"),this.update(t,{cat:s,y:t.settings.chart.height}))}},this.token=function(t,e){var n=e,i={x:t.settings.sedimentation.incoming.point[n].x+2*Math.random(),y:t.settings.sedimentation.incoming.point[n].y+1*Math.random(),t:t.now(),size:t.settings.sedimentation.token.size.original,category:n,lineWidth:0};return i},this.createMyChartBox=function(t,e,n,i,o,r,s){var a=t.settings.options.scale,l=new t.phy.b2FixtureDef;l.density=1,l.friction=.5,l.restitution=.2;var c=new t.phy.b2BodyDef;c.type=t.phy.b2Body.b2_staticBody,l.shape=new t.phy.b2PolygonShape,l.shape.SetAsBox(i/a,o/a),c.position.Set(e/a,n/a);var u=t.world.CreateBody(c).CreateFixture(l);return u.m_userData={type:r,fillStyle:s,w:i,h:o,x:e,y:n},u},this.update=function(t,e){if(null!=t.chartPhySetup.grounds[e.cat]){var n=t.chartPhySetup.grounds[e.cat].GetBody(),i=n.GetWorldCenter();i.y=(e.y+t.settings.chart.height+t.settings.chart.y+t.settings.sedimentation.aggregation.height)/t.settings.options.scale,n.SetPosition(i)}},this.getPositionOld=function(t){for(var e=[],n=0;n<t.chartPhySetup.grounds.length;n++)myElement=t.chartPhySetup.grounds[n],myBody=myElement.GetBody(),e.push({x:myBody.GetWorldCenter().x*t.settings.options.scale,y:myBody.GetWorldCenter().y*t.settings.options.scale,a:myBody.GetAngle(),w:myElement.m_userData.w,h:myElement.m_userData.h,r:myElement.m_userData.r});return e},this.getPosition=function(t){for(var e=[],n=0;n<t.chartPhySetup.grounds.length;n++)myElement=t.chartPhySetup.grounds[n],myBody=myElement.GetBody(),e.push({x:myBody.GetWorldCenter().x*t.settings.options.scale,y:myBody.GetWorldCenter().y*t.settings.options.scale-t.settings.chart.height-t.settings.chart.y,a:myBody.GetAngle(),w:myElement.m_userData.w,h:myElement.m_userData.h,r:myElement.m_userData.r});return e},void 0!=typeof e){var i=this[e](t,n);if(void 0!=typeof i)return i}}}(jQuery),function(t){t.fn._vs.chart.CircleLayout=function(t,e,n){function i(t,e,n,i){j=t*Math.PI/180;var o=Math.cos(j)*e+n,r=Math.sin(j)*e+i,s={x:o,y:r};return s}function o(e,n,i,o){var r=t.settings.options.scale,s=new t.phy.b2FixtureDef;s.density=1,s.friction=.5,s.restitution=.2;var a=new t.phy.b2BodyDef;s.shape=new t.phy.b2CircleShape(i/r),a.position.Set(e/r,n/r);var l=t.world.CreateBody(a).CreateFixture(s);return l.m_userData={type:"wall",familyID:null,fillStyle:o,strokeStyle:o,r:i},l}function r(e,n,i,o){console.log("CreatMyBubblePivot",e,n,i,o);var r=t.settings.options.scale,s=new t.phy.b2FixtureDef,a=d3.scale.category10();s.density=1e4,s.friction=0,s.restitution=0;var l=new t.phy.b2BodyDef;s.shape=new t.phy.b2CircleShape(i*r),l.position.Set(e/r,n/r);var c=t.world.CreateBody(l),u=c.CreateFixture(s);return console.log(o,a(o)),u.m_userData={type:"BubblePivot",familyID:o,fillStyle:t.settings.chart.wallColor},console.log(o,u),u.m_shape.m_radius=t.settings.data.model[o].value/r,u}var s,l,t,u=[],h=0;if(this.init=function(t){console.log("Circle Layout Init"),this._this=t,gravity=new t.phy.b2Vec2(0,0),t.world.m_gravity=gravity,t.chartPhySetup={grounds:[],wall:[]},this.treeLayout=t.settings.chart.treeLayout;for(var e=0;e<t.settings.data.model.length;e++)t.settings.data.strata[e][0].value=t.settings.data.strata[e][0].initValue;for(var e=0;e<t.settings.data.model.length;e++){t.settings.data.model[e].value=0;for(var n=0;n<t.settings.data.strata[e].length;n++)t.settings.data.model[e].value+=t.settings.data.strata[e][n].value;u.push(t.settings.data.model[e].value),h+=t.settings.data.model[e].value}this.treeLayout?(console.log("ici"),this.setupBubbleChartPhysics(t)):this.setupPieChartPhysics(t)},this.setupPieChartPhysics=function(t){console.log("w",t.settings.width);var e=t.settings.chart.radius;s=t.settings.chart.width/2+t.settings.chart.x,l=t.settings.chart.height/2+t.settings.chart.y;for(var n=(o(s,l,e,t.settings.chart.wallColor),0);n<t.settings.data.model.length;n++)t.settings.sedimentation.incoming.target[n]={x:s,y:l};var r=t.settings.chart.spacer,m=0;if(console.log("tdv",h),0==h){for(var n=0;n<t.settings.data.length;n++)u[n]=1;h=u.length}for(var n=0;n<u.length;n++)v=u[n],a2=(v/2+m)/h*360-90,m+=v,a=m/h*360-90,c=i(a2,5*e,s,l),console.log(c),t.settings.sedimentation.incoming.point[n]=c,t.chartPhySetup.grounds[n]=this.createBox(t,s,l,r,e,a,e,"wall",t.settings.chart.wallColor);console.log("w",t.settings.chart.width)},this.update=function(t,e){console.log("update");e.r-=90;var n=(e.r+90)*(Math.PI/180),o=i(e.r,t.settings.chart.radius,t.settings.chart.width/2+t.settings.chart.x,t.settings.chart.height/2+t.settings.chart.y);if(null!=t.chartPhySetup.grounds[e.cat]){var r=t.chartPhySetup.grounds[e.cat].GetBody(),s=r.GetWorldCenter(),a=r.GetAngle();s.y=o.y/t.settings.options.scale,s.x=o.x/t.settings.options.scale,a=n,r.SetPosition(s),r.SetAngle(a)}},this.token=function(t,e){var n=e,i={x:t.settings.sedimentation.incoming.point[n].x+2*Math.random(),y:t.settings.sedimentation.incoming.point[n].y+1*Math.random(),t:t.now(),size:t.settings.sedimentation.token.size.original,category:n,phy:{density:10,friction:0,restitution:0},targets:[{x:t.settings.sedimentation.incoming.target[n].x,y:t.settings.sedimentation.incoming.target[n].y}]};return i},this.createBox=function(t,e,n,o,r,s,a,l,c){var u=t.settings.options.scale,h=new t.phy.b2FixtureDef,m=i(s,a,e,n);h.density=1,h.friction=.5,h.restitution=.2;var p=new t.phy.b2BodyDef,f=(s+90)*(Math.PI/180);p.angle=f,p.type=t.phy.b2Body.b2_staticBody,h.shape=new t.phy.b2PolygonShape,h.shape.SetAsBox(o/u,r/u),p.position.Set(m.x/u,m.y/u);var y=t.world.CreateBody(p).CreateFixture(h);return y.m_userData={type:l,fillStyle:c,w:o,h:r,r:a},y},this.getPosition=function(t){for(var e=[],n=0;n<t.chartPhySetup.grounds.length;n++)myElement=t.chartPhySetup.grounds[n],myBody=myElement.GetBody(),e.push({x:myBody.GetWorldCenter().x*t.settings.options.scale,y:myBody.GetWorldCenter().y*t.settings.options.scale,a:myBody.GetAngle(),w:myElement.m_userData.w,h:myElement.m_userData.h,r:myElement.m_userData.r});return e},this.setupBubbleChartPhysics=function(t){console.log("setupBubbleChartPhysics");for(var e=(t.settings.chart.width/t.settings.data.model.length,t.settings.chart.spacer),n=(t.settings.chart.height/2+t.settings.y+e,0),i=0,s=t.settings.chart.column,a=0;a<t.settings.data.model.length;a++)i=t.settings.chart.x+a%s*e+e/2,n=t.settings.chart.y+Math.floor(a/s)*e+e/2,t.settings.sedimentation.incoming.target[a]={x:i,y:n},o[a]=r(i,n,t.settings.chart.spacer,a),t.settings.data.model[a].incomingPoint={x:i,y:n}},this.getPivotPosition=function(e){if("undefined"!=typeof e)return this.pivot;for(var n=[],i=0;i<t.settings.data.model.length;i++)n.push(t.settings.data.model[i]);return n},void 0!=typeof e){var m=this[e](t,n);if(void 0!=typeof m)return m}}}(jQuery);