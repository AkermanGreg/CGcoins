var fabric,MenuScript,CoolText;(function(n,t){function gt(n){var t=n.length,r=i.type(n);return i.isWindow(n)?!1:n.nodeType===1&&t?!0:r==="array"||r!=="function"&&(t===0||typeof t=="number"&&t>0&&t-1 in n)}function te(n){var t=ni[n]={};return i.each(n.match(s)||[],function(n,i){t[i]=!0}),t}function ur(n,r,u,f){if(i.acceptData(n)){var h,o,c=i.expando,l=n.nodeType,s=l?i.cache:n,e=l?n[c]:n[c]&&c;if(e&&s[e]&&(f||s[e].data)||u!==t||typeof r!="string")return e||(e=l?n[c]=b.pop()||i.guid++:c),s[e]||(s[e]=l?{}:{toJSON:i.noop}),(typeof r=="object"||typeof r=="function")&&(f?s[e]=i.extend(s[e],r):s[e].data=i.extend(s[e].data,r)),o=s[e],f||(o.data||(o.data={}),o=o.data),u!==t&&(o[i.camelCase(r)]=u),typeof r=="string"?(h=o[r],h==null&&(h=o[i.camelCase(r)])):h=o,h}}function fr(n,t,r){if(i.acceptData(n)){var f,o,s=n.nodeType,u=s?i.cache:n,e=s?n[i.expando]:i.expando;if(u[e]){if(t&&(f=r?u[e]:u[e].data,f)){for(i.isArray(t)?t=t.concat(i.map(t,i.camelCase)):(t in f)?t=[t]:(t=i.camelCase(t),t=t in f?[t]:t.split(" ")),o=t.length;o--;)delete f[t[o]];if(r?!ti(f):!i.isEmptyObject(f))return}(r||(delete u[e].data,ti(u[e])))&&(s?i.cleanData([n],!0):i.support.deleteExpando||u!=u.window?delete u[e]:u[e]=null)}}}function er(n,r,u){if(u===t&&n.nodeType===1){var f="data-"+r.replace(rr,"-$1").toLowerCase();if(u=n.getAttribute(f),typeof u=="string"){try{u=u==="true"?!0:u==="false"?!1:u==="null"?null:+u+""===u?+u:ir.test(u)?i.parseJSON(u):u}catch(e){}i.data(n,r,u)}else u=t}return u}function ti(n){for(var t in n)if((t!=="data"||!i.isEmptyObject(n[t]))&&t!=="toJSON")return!1;return!0}function ct(){return!0}function g(){return!1}function cr(){try{return r.activeElement}catch(n){}}function ar(n,t){do n=n[t];while(n&&n.nodeType!==1);return n}function fi(n,t,r){if(i.isFunction(t))return i.grep(n,function(n,i){return!!t.call(n,i,n)!==r});if(t.nodeType)return i.grep(n,function(n){return n===t!==r});if(typeof t=="string"){if(oe.test(t))return i.filter(t,n,r);t=i.filter(t,n)}return i.grep(n,function(n){return i.inArray(n,t)>=0!==r})}function vr(n){var i=yr.split("|"),t=n.createDocumentFragment();if(t.createElement)while(i.length)t.createElement(i.pop());return t}function gr(n,t){return i.nodeName(n,"table")&&i.nodeName(t.nodeType===1?t:t.firstChild,"tr")?n.getElementsByTagName("tbody")[0]||n.appendChild(n.ownerDocument.createElement("tbody")):n}function nu(n){return n.type=(i.find.attr(n,"type")!==null)+"/"+n.type,n}function tu(n){var t=ye.exec(n.type);return t?n.type=t[1]:n.removeAttribute("type"),n}function hi(n,t){for(var u,r=0;(u=n[r])!=null;r++)i._data(u,"globalEval",!t||i._data(t[r],"globalEval"))}function iu(n,t){if(t.nodeType===1&&i.hasData(n)){var u,f,o,s=i._data(n),r=i._data(t,s),e=s.events;if(e){delete r.handle;r.events={};for(u in e)for(f=0,o=e[u].length;f<o;f++)i.event.add(t,u,e[u][f])}r.data&&(r.data=i.extend({},r.data))}}function be(n,t){var r,f,u;if(t.nodeType===1){if(r=t.nodeName.toLowerCase(),!i.support.noCloneEvent&&t[i.expando]){u=i._data(t);for(f in u.events)i.removeEvent(t,f,u.handle);t.removeAttribute(i.expando)}r==="script"&&t.text!==n.text?(nu(t).text=n.text,tu(t)):r==="object"?(t.parentNode&&(t.outerHTML=n.outerHTML),i.support.html5Clone&&n.innerHTML&&!i.trim(t.innerHTML)&&(t.innerHTML=n.innerHTML)):r==="input"&&oi.test(n.type)?(t.defaultChecked=t.checked=n.checked,t.value!==n.value&&(t.value=n.value)):r==="option"?t.defaultSelected=t.selected=n.defaultSelected:(r==="input"||r==="textarea")&&(t.defaultValue=n.defaultValue)}}function u(n,r){var s,e,h=0,f=typeof n.getElementsByTagName!==o?n.getElementsByTagName(r||"*"):typeof n.querySelectorAll!==o?n.querySelectorAll(r||"*"):t;if(!f)for(f=[],s=n.childNodes||n;(e=s[h])!=null;h++)!r||i.nodeName(e,r)?f.push(e):i.merge(f,u(e,r));return r===t||r&&i.nodeName(n,r)?i.merge([n],f):f}function ke(n){oi.test(n.type)&&(n.defaultChecked=n.checked)}function ou(n,t){if(t in n)return t;for(var r=t.charAt(0).toUpperCase()+t.slice(1),u=t,i=eu.length;i--;)if(t=eu[i]+r,t in n)return t;return u}function ut(n,t){return n=t||n,i.css(n,"display")==="none"||!i.contains(n.ownerDocument,n)}function su(n,t){for(var f,r,o,e=[],u=0,s=n.length;u<s;u++)(r=n[u],r.style)&&(e[u]=i._data(r,"olddisplay"),f=r.style.display,t?(e[u]||f!=="none"||(r.style.display=""),r.style.display===""&&ut(r)&&(e[u]=i._data(r,"olddisplay",au(r.nodeName)))):e[u]||(o=ut(r),(f&&f!=="none"||!o)&&i._data(r,"olddisplay",o?f:i.css(r,"display"))));for(u=0;u<s;u++)(r=n[u],r.style)&&(t&&r.style.display!=="none"&&r.style.display!==""||(r.style.display=t?e[u]||"":"none"));return n}function hu(n,t,i){var r=to.exec(t);return r?Math.max(0,r[1]-(i||0))+(r[2]||"px"):t}function cu(n,t,r,u,f){for(var e=r===(u?"border":"content")?4:t==="width"?1:0,o=0;e<4;e+=2)r==="margin"&&(o+=i.css(n,r+p[e],!0,f)),u?(r==="content"&&(o-=i.css(n,"padding"+p[e],!0,f)),r!=="margin"&&(o-=i.css(n,"border"+p[e]+"Width",!0,f))):(o+=i.css(n,"padding"+p[e],!0,f),r!=="padding"&&(o+=i.css(n,"border"+p[e]+"Width",!0,f)));return o}function lu(n,t,r){var e=!0,u=t==="width"?n.offsetWidth:n.offsetHeight,f=v(n),o=i.support.boxSizing&&i.css(n,"boxSizing",!1,f)==="border-box";if(u<=0||u==null){if(u=y(n,t,f),(u<0||u==null)&&(u=n.style[t]),lt.test(u))return u;e=o&&(i.support.boxSizingReliable||u===n.style[t]);u=parseFloat(u)||0}return u+cu(n,t,r||(o?"border":"content"),e,f)+"px"}function au(n){var u=r,t=uu[n];return t||(t=vu(n,u),t!=="none"&&t||(rt=(rt||i("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(u.documentElement),u=(rt[0].contentWindow||rt[0].contentDocument).document,u.write("<!doctype html><html><body>"),u.close(),t=vu(n,u),rt.detach()),uu[n]=t),t}function vu(n,t){var r=i(t.createElement(n)).appendTo(t.body),u=i.css(r[0],"display");return r.remove(),u}function li(n,t,r,u){var f;if(i.isArray(t))i.each(t,function(t,i){r||fo.test(n)?u(n,i):li(n+"["+(typeof i=="object"?t:"")+"]",i,r,u)});else if(r||i.type(t)!=="object")u(n,t);else for(f in t)li(n+"["+f+"]",t[f],r,u)}function gu(n){return function(t,r){typeof t!="string"&&(r=t,t="*");var u,f=0,e=t.toLowerCase().match(s)||[];if(i.isFunction(r))while(u=e[f++])u[0]==="+"?(u=u.slice(1)||"*",(n[u]=n[u]||[]).unshift(r)):(n[u]=n[u]||[]).push(r)}}function nf(n,t,r,u){function e(s){var h;return f[s]=!0,i.each(n[s]||[],function(n,i){var s=i(t,r,u);if(typeof s!="string"||o||f[s]){if(o)return!(h=s)}else return t.dataTypes.unshift(s),e(s),!1}),h}var f={},o=n===yi;return e(t.dataTypes[0])||!f["*"]&&e("*")}function pi(n,r){var f,u,e=i.ajaxSettings.flatOptions||{};for(u in r)r[u]!==t&&((e[u]?n:f||(f={}))[u]=r[u]);return f&&i.extend(!0,n,f),n}function ao(n,i,r){for(var s,o,f,e,h=n.contents,u=n.dataTypes;u[0]==="*";)u.shift(),o===t&&(o=n.mimeType||i.getResponseHeader("Content-Type"));if(o)for(e in h)if(h[e]&&h[e].test(o)){u.unshift(e);break}if(u[0]in r)f=u[0];else{for(e in r){if(!u[0]||n.converters[e+" "+u[0]]){f=e;break}s||(s=e)}f=f||s}if(f)return f!==u[0]&&u.unshift(f),r[f]}function vo(n,t,i,r){var h,u,f,s,e,o={},c=n.dataTypes.slice();if(c[1])for(f in n.converters)o[f.toLowerCase()]=n.converters[f];for(u=c.shift();u;)if(n.responseFields[u]&&(i[n.responseFields[u]]=t),!e&&r&&n.dataFilter&&(t=n.dataFilter(t,n.dataType)),e=u,u=c.shift(),u)if(u==="*")u=e;else if(e!=="*"&&e!==u){if(f=o[e+" "+u]||o["* "+u],!f)for(h in o)if(s=h.split(" "),s[1]===u&&(f=o[e+" "+s[0]]||o["* "+s[0]],f)){f===!0?f=o[h]:o[h]!==!0&&(u=s[0],c.unshift(s[1]));break}if(f!==!0)if(f&&n.throws)t=f(t);else try{t=f(t)}catch(l){return{state:"parsererror",error:f?l:"No conversion from "+e+" to "+u}}}return{state:"success",data:t}}function rf(){try{return new n.XMLHttpRequest}catch(t){}}function yo(){try{return new n.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function ff(){return setTimeout(function(){it=t}),it=i.now()}function ef(n,t,i){for(var u,f=(ft[t]||[]).concat(ft["*"]),r=0,e=f.length;r<e;r++)if(u=f[r].call(i,t,n))return u}function of(n,t,r){var e,o,s=0,l=pt.length,f=i.Deferred().always(function(){delete c.elem}),c=function(){if(o)return!1;for(var s=it||ff(),t=Math.max(0,u.startTime+u.duration-s),h=t/u.duration||0,i=1-h,r=0,e=u.tweens.length;r<e;r++)u.tweens[r].run(i);return f.notifyWith(n,[u,i,t]),i<1&&e?t:(f.resolveWith(n,[u]),!1)},u=f.promise({elem:n,props:i.extend({},t),opts:i.extend(!0,{specialEasing:{}},r),originalProperties:t,originalOptions:r,startTime:it||ff(),duration:r.duration,tweens:[],createTween:function(t,r){var f=i.Tween(n,u.opts,t,r,u.opts.specialEasing[t]||u.opts.easing);return u.tweens.push(f),f},stop:function(t){var i=0,r=t?u.tweens.length:0;if(o)return this;for(o=!0;i<r;i++)u.tweens[i].run(1);return t?f.resolveWith(n,[u,t]):f.rejectWith(n,[u,t]),this}}),h=u.props;for(bo(h,u.opts.specialEasing);s<l;s++)if(e=pt[s].call(u,n,h,u.opts),e)return e;return i.map(h,ef,u),i.isFunction(u.opts.start)&&u.opts.start.call(n,u),i.fx.timer(i.extend(c,{elem:n,anim:u,queue:u.opts.queue})),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always)}function bo(n,t){var r,f,e,u,o;for(r in n)if(f=i.camelCase(r),e=t[f],u=n[r],i.isArray(u)&&(e=u[1],u=n[r]=u[0]),r!==f&&(n[f]=u,delete n[r]),o=i.cssHooks[f],o&&"expand"in o){u=o.expand(u);delete n[f];for(r in u)r in n||(n[r]=u[r],t[r]=e)}else t[f]=e}function ko(n,t,r){var u,a,v,c,e,y,s=this,l={},o=n.style,h=n.nodeType&&ut(n),f=i._data(n,"fxshow");r.queue||(e=i._queueHooks(n,"fx"),e.unqueued==null&&(e.unqueued=0,y=e.empty.fire,e.empty.fire=function(){e.unqueued||y()}),e.unqueued++,s.always(function(){s.always(function(){e.unqueued--;i.queue(n,"fx").length||e.empty.fire()})}));n.nodeType===1&&("height"in t||"width"in t)&&(r.overflow=[o.overflow,o.overflowX,o.overflowY],i.css(n,"display")==="inline"&&i.css(n,"float")==="none"&&(i.support.inlineBlockNeedsLayout&&au(n.nodeName)!=="inline"?o.zoom=1:o.display="inline-block"));r.overflow&&(o.overflow="hidden",i.support.shrinkWrapBlocks||s.always(function(){o.overflow=r.overflow[0];o.overflowX=r.overflow[1];o.overflowY=r.overflow[2]}));for(u in t)if(a=t[u],po.exec(a)){if(delete t[u],v=v||a==="toggle",a===(h?"hide":"show"))continue;l[u]=f&&f[u]||i.style(n,u)}if(!i.isEmptyObject(l)){f?"hidden"in f&&(h=f.hidden):f=i._data(n,"fxshow",{});v&&(f.hidden=!h);h?i(n).show():s.done(function(){i(n).hide()});s.done(function(){var t;i._removeData(n,"fxshow");for(t in l)i.style(n,t,l[t])});for(u in l)c=ef(h?f[u]:0,u,s),u in f||(f[u]=c.start,h&&(c.end=c.start,c.start=u==="width"||u==="height"?1:0))}}function f(n,t,i,r,u){return new f.prototype.init(n,t,i,r,u)}function wt(n,t){var r,i={height:n},u=0;for(t=t?1:0;u<4;u+=2-t)r=p[u],i["margin"+r]=i["padding"+r]=n;return t&&(i.opacity=i.width=n),i}function sf(n){return i.isWindow(n)?n:n.nodeType===9?n.defaultView||n.parentWindow:!1}var et,bi,o=typeof t,hf=n.location,r=n.document,ki=r.documentElement,cf=n.jQuery,lf=n.$,ot={},b=[],bt="1.10.2",di=b.concat,kt=b.push,l=b.slice,gi=b.indexOf,af=ot.toString,k=ot.hasOwnProperty,dt=bt.trim,i=function(n,t){return new i.fn.init(n,t,bi)},st=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,s=/\S+/g,vf=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,yf=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,nr=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,pf=/^[\],:{}\s]*$/,wf=/(?:^|:|,)(?:\s*\[)+/g,bf=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,kf=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,df=/^-ms-/,gf=/-([\da-z])/gi,ne=function(n,t){return t.toUpperCase()},h=function(n){(r.addEventListener||n.type==="load"||r.readyState==="complete")&&(tr(),i.ready())},tr=function(){r.addEventListener?(r.removeEventListener("DOMContentLoaded",h,!1),n.removeEventListener("load",h,!1)):(r.detachEvent("onreadystatechange",h),n.detachEvent("onload",h))},ni,ir,rr,wi,at,nt,tt,tf,vt;i.fn=i.prototype={jquery:bt,constructor:i,init:function(n,u,f){var e,o;if(!n)return this;if(typeof n=="string"){if(e=n.charAt(0)==="<"&&n.charAt(n.length-1)===">"&&n.length>=3?[null,n,null]:yf.exec(n),e&&(e[1]||!u)){if(e[1]){if(u=u instanceof i?u[0]:u,i.merge(this,i.parseHTML(e[1],u&&u.nodeType?u.ownerDocument||u:r,!0)),nr.test(e[1])&&i.isPlainObject(u))for(e in u)i.isFunction(this[e])?this[e](u[e]):this.attr(e,u[e]);return this}if(o=r.getElementById(e[2]),o&&o.parentNode){if(o.id!==e[2])return f.find(n);this.length=1;this[0]=o}return this.context=r,this.selector=n,this}return!u||u.jquery?(u||f).find(n):this.constructor(u).find(n)}return n.nodeType?(this.context=this[0]=n,this.length=1,this):i.isFunction(n)?f.ready(n):(n.selector!==t&&(this.selector=n.selector,this.context=n.context),i.makeArray(n,this))},selector:"",length:0,toArray:function(){return l.call(this)},get:function(n){return n==null?this.toArray():n<0?this[this.length+n]:this[n]},pushStack:function(n){var t=i.merge(this.constructor(),n);return t.prevObject=this,t.context=this.context,t},each:function(n,t){return i.each(this,n,t)},ready:function(n){return i.ready.promise().done(n),this},slice:function(){return this.pushStack(l.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(n){var i=this.length,t=+n+(n<0?i:0);return this.pushStack(t>=0&&t<i?[this[t]]:[])},map:function(n){return this.pushStack(i.map(this,function(t,i){return n.call(t,i,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:kt,sort:[].sort,splice:[].splice};i.fn.init.prototype=i.fn;i.extend=i.fn.extend=function(){var u,o,r,e,s,h,n=arguments[0]||{},f=1,l=arguments.length,c=!1;for(typeof n=="boolean"&&(c=n,n=arguments[1]||{},f=2),typeof n=="object"||i.isFunction(n)||(n={}),l===f&&(n=this,--f);f<l;f++)if((s=arguments[f])!=null)for(e in s)(u=n[e],r=s[e],n!==r)&&(c&&r&&(i.isPlainObject(r)||(o=i.isArray(r)))?(o?(o=!1,h=u&&i.isArray(u)?u:[]):h=u&&i.isPlainObject(u)?u:{},n[e]=i.extend(c,h,r)):r!==t&&(n[e]=r));return n};i.extend({expando:"jQuery"+(bt+Math.random()).replace(/\D/g,""),noConflict:function(t){return n.$===i&&(n.$=lf),t&&n.jQuery===i&&(n.jQuery=cf),i},isReady:!1,readyWait:1,holdReady:function(n){n?i.readyWait++:i.ready(!0)},ready:function(n){if(n===!0?!--i.readyWait:!i.isReady){if(!r.body)return setTimeout(i.ready);(i.isReady=!0,n!==!0&&--i.readyWait>0)||(et.resolveWith(r,[i]),i.fn.trigger&&i(r).trigger("ready").off("ready"))}},isFunction:function(n){return i.type(n)==="function"},isArray:Array.isArray||function(n){return i.type(n)==="array"},isWindow:function(n){return n!=null&&n==n.window},isNumeric:function(n){return!isNaN(parseFloat(n))&&isFinite(n)},type:function(n){return n==null?String(n):typeof n=="object"||typeof n=="function"?ot[af.call(n)]||"object":typeof n},isPlainObject:function(n){var r;if(!n||i.type(n)!=="object"||n.nodeType||i.isWindow(n))return!1;try{if(n.constructor&&!k.call(n,"constructor")&&!k.call(n.constructor.prototype,"isPrototypeOf"))return!1}catch(u){return!1}if(i.support.ownLast)for(r in n)return k.call(n,r);for(r in n);return r===t||k.call(n,r)},isEmptyObject:function(n){for(var t in n)return!1;return!0},error:function(n){throw new Error(n);},parseHTML:function(n,t,u){if(!n||typeof n!="string")return null;typeof t=="boolean"&&(u=t,t=!1);t=t||r;var f=nr.exec(n),e=!u&&[];return f?[t.createElement(f[1])]:(f=i.buildFragment([n],t,e),e&&i(e).remove(),i.merge([],f.childNodes))},parseJSON:function(t){if(n.JSON&&n.JSON.parse)return n.JSON.parse(t);if(t===null)return t;if(typeof t=="string"&&(t=i.trim(t),t&&pf.test(t.replace(bf,"@").replace(kf,"]").replace(wf,""))))return new Function("return "+t)();i.error("Invalid JSON: "+t)},parseXML:function(r){var u,f;if(!r||typeof r!="string")return null;try{n.DOMParser?(f=new DOMParser,u=f.parseFromString(r,"text/xml")):(u=new ActiveXObject("Microsoft.XMLDOM"),u.async="false",u.loadXML(r))}catch(e){u=t}return u&&u.documentElement&&!u.getElementsByTagName("parsererror").length||i.error("Invalid XML: "+r),u},noop:function(){},globalEval:function(t){t&&i.trim(t)&&(n.execScript||function(t){n.eval.call(n,t)})(t)},camelCase:function(n){return n.replace(df,"ms-").replace(gf,ne)},nodeName:function(n,t){return n.nodeName&&n.nodeName.toLowerCase()===t.toLowerCase()},each:function(n,t,i){var u,r=0,f=n.length,e=gt(n);if(i){if(e){for(;r<f;r++)if(u=t.apply(n[r],i),u===!1)break}else for(r in n)if(u=t.apply(n[r],i),u===!1)break}else if(e){for(;r<f;r++)if(u=t.call(n[r],r,n[r]),u===!1)break}else for(r in n)if(u=t.call(n[r],r,n[r]),u===!1)break;return n},trim:dt&&!dt.call("﻿ ")?function(n){return n==null?"":dt.call(n)}:function(n){return n==null?"":(n+"").replace(vf,"")},makeArray:function(n,t){var r=t||[];return n!=null&&(gt(Object(n))?i.merge(r,typeof n=="string"?[n]:n):kt.call(r,n)),r},inArray:function(n,t,i){var r;if(t){if(gi)return gi.call(t,n,i);for(r=t.length,i=i?i<0?Math.max(0,r+i):i:0;i<r;i++)if(i in t&&t[i]===n)return i}return-1},merge:function(n,i){var f=i.length,u=n.length,r=0;if(typeof f=="number")for(;r<f;r++)n[u++]=i[r];else while(i[r]!==t)n[u++]=i[r++];return n.length=u,n},grep:function(n,t,i){var u,f=[],r=0,e=n.length;for(i=!!i;r<e;r++)u=!!t(n[r],r),i!==u&&f.push(n[r]);return f},map:function(n,t,i){var u,r=0,e=n.length,o=gt(n),f=[];if(o)for(;r<e;r++)u=t(n[r],r,i),u!=null&&(f[f.length]=u);else for(r in n)u=t(n[r],r,i),u!=null&&(f[f.length]=u);return di.apply([],f)},guid:1,proxy:function(n,r){var f,u,e;return(typeof r=="string"&&(e=n[r],r=n,n=e),!i.isFunction(n))?t:(f=l.call(arguments,2),u=function(){return n.apply(r||this,f.concat(l.call(arguments)))},u.guid=n.guid=n.guid||i.guid++,u)},access:function(n,r,u,f,e,o,s){var h=0,l=n.length,c=u==null;if(i.type(u)==="object"){e=!0;for(h in u)i.access(n,r,h,u[h],!0,o,s)}else if(f!==t&&(e=!0,i.isFunction(f)||(s=!0),c&&(s?(r.call(n,f),r=null):(c=r,r=function(n,t,r){return c.call(i(n),r)})),r))for(;h<l;h++)r(n[h],u,s?f:f.call(n[h],h,r(n[h],u)));return e?n:c?r.call(n):l?r(n[0],u):o},now:function(){return(new Date).getTime()},swap:function(n,t,i,r){var f,u,e={};for(u in t)e[u]=n.style[u],n.style[u]=t[u];f=i.apply(n,r||[]);for(u in t)n.style[u]=e[u];return f}});i.ready.promise=function(t){if(!et)if(et=i.Deferred(),r.readyState==="complete")setTimeout(i.ready);else if(r.addEventListener)r.addEventListener("DOMContentLoaded",h,!1),n.addEventListener("load",h,!1);else{r.attachEvent("onreadystatechange",h);n.attachEvent("onload",h);var u=!1;try{u=n.frameElement==null&&r.documentElement}catch(e){}u&&u.doScroll&&function f(){if(!i.isReady){try{u.doScroll("left")}catch(n){return setTimeout(f,50)}tr();i.ready()}}()}return et.promise(t)};i.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(n,t){ot["[object "+t+"]"]=t.toLowerCase()});bi=i(r),function(n,t){function u(n,t,i,r){var p,u,f,l,w,a,k,c,g,d;if((t?t.ownerDocument||t:y)!==s&&nt(t),t=t||s,i=i||[],!n||typeof n!="string")return i;if((l=t.nodeType)!==1&&l!==9)return[];if(v&&!r){if(p=or.exec(n))if(f=p[1]){if(l===9)if(u=t.getElementById(f),u&&u.parentNode){if(u.id===f)return i.push(u),i}else return i;else if(t.ownerDocument&&(u=t.ownerDocument.getElementById(f))&&ot(t,u)&&u.id===f)return i.push(u),i}else{if(p[2])return b.apply(i,t.getElementsByTagName(n)),i;if((f=p[3])&&e.getElementsByClassName&&t.getElementsByClassName)return b.apply(i,t.getElementsByClassName(f)),i}if(e.qsa&&(!h||!h.test(n))){if(c=k=o,g=t,d=l===9&&n,l===1&&t.nodeName.toLowerCase()!=="object"){for(a=pt(n),(k=t.getAttribute("id"))?c=k.replace(cr,"\\$&"):t.setAttribute("id",c),c="[id='"+c+"'] ",w=a.length;w--;)a[w]=c+wt(a[w]);g=ti.test(n)&&t.parentNode||t;d=a.join(",")}if(d)try{return b.apply(i,g.querySelectorAll(d)),i}catch(tt){}finally{k||t.removeAttribute("id")}}}return pr(n.replace(vt,"$1"),t,i,r)}function ri(){function n(i,u){return t.push(i+=" ")>r.cacheLength&&delete n[t.shift()],n[i]=u}var t=[];return n}function c(n){return n[o]=!0,n}function l(n){var t=s.createElement("div");try{return!!n(t)}catch(i){return!1}finally{t.parentNode&&t.parentNode.removeChild(t);t=null}}function ui(n,t){for(var u=n.split("|"),i=n.length;i--;)r.attrHandle[u[i]]=t}function bi(n,t){var i=t&&n,r=i&&n.nodeType===1&&t.nodeType===1&&(~t.sourceIndex||vi)-(~n.sourceIndex||vi);if(r)return r;if(i)while(i=i.nextSibling)if(i===t)return-1;return n?1:-1}function lr(n){return function(t){var i=t.nodeName.toLowerCase();return i==="input"&&t.type===n}}function ar(n){return function(t){var i=t.nodeName.toLowerCase();return(i==="input"||i==="button")&&t.type===n}}function rt(n){return c(function(t){return t=+t,c(function(i,r){for(var u,f=n([],i.length,t),e=f.length;e--;)i[u=f[e]]&&(i[u]=!(r[u]=i[u]))})})}function ki(){}function pt(n,t){var e,f,s,o,i,h,c,l=li[n+" "];if(l)return t?0:l.slice(0);for(i=n,h=[],c=r.preFilter;i;){(!e||(f=ir.exec(i)))&&(f&&(i=i.slice(f[0].length)||i),h.push(s=[]));e=!1;(f=rr.exec(i))&&(e=f.shift(),s.push({value:e,type:f[0].replace(vt," ")}),i=i.slice(e.length));for(o in r.filter)(f=yt[o].exec(i))&&(!c[o]||(f=c[o](f)))&&(e=f.shift(),s.push({value:e,type:o,matches:f}),i=i.slice(e.length));if(!e)break}return t?i.length:i?u.error(n):li(n,h).slice(0)}function wt(n){for(var t=0,r=n.length,i="";t<r;t++)i+=n[t].value;return i}function fi(n,t,i){var r=t.dir,u=i&&r==="parentNode",f=di++;return t.first?function(t,i,f){while(t=t[r])if(t.nodeType===1||u)return n(t,i,f)}:function(t,i,e){var h,s,c,l=p+" "+f;if(e){while(t=t[r])if((t.nodeType===1||u)&&n(t,i,e))return!0}else while(t=t[r])if(t.nodeType===1||u)if(c=t[o]||(t[o]={}),(s=c[r])&&s[0]===l){if((h=s[1])===!0||h===ht)return h===!0}else if(s=c[r]=[l],s[1]=n(t,i,e)||ht,s[1]===!0)return!0}}function ei(n){return n.length>1?function(t,i,r){for(var u=n.length;u--;)if(!n[u](t,i,r))return!1;return!0}:n[0]}function bt(n,t,i,r,u){for(var e,o=[],f=0,s=n.length,h=t!=null;f<s;f++)(e=n[f])&&(!i||i(e,r,u))&&(o.push(e),h&&t.push(f));return o}function oi(n,t,i,r,u,f){return r&&!r[o]&&(r=oi(r)),u&&!u[o]&&(u=oi(u,f)),c(function(f,e,o,s){var l,c,a,p=[],y=[],w=e.length,k=f||yr(t||"*",o.nodeType?[o]:o,[]),v=n&&(f||!t)?bt(k,p,n,o,s):k,h=i?u||(f?n:w||r)?[]:e:v;if(i&&i(v,h,o,s),r)for(l=bt(h,y),r(l,[],o,s),c=l.length;c--;)(a=l[c])&&(h[y[c]]=!(v[y[c]]=a));if(f){if(u||n){if(u){for(l=[],c=h.length;c--;)(a=h[c])&&l.push(v[c]=a);u(null,h=[],l,s)}for(c=h.length;c--;)(a=h[c])&&(l=u?it.call(f,a):p[c])>-1&&(f[l]=!(e[l]=a))}}else h=bt(h===e?h.splice(w,h.length):h),u?u(null,e,h,s):b.apply(e,h)})}function si(n){for(var s,u,i,e=n.length,h=r.relative[n[0].type],c=h||r.relative[" "],t=h?1:0,l=fi(function(n){return n===s},c,!0),a=fi(function(n){return it.call(s,n)>-1},c,!0),f=[function(n,t,i){return!h&&(i||t!==lt)||((s=t).nodeType?l(n,t,i):a(n,t,i))}];t<e;t++)if(u=r.relative[n[t].type])f=[fi(ei(f),u)];else{if(u=r.filter[n[t].type].apply(null,n[t].matches),u[o]){for(i=++t;i<e;i++)if(r.relative[n[i].type])break;return oi(t>1&&ei(f),t>1&&wt(n.slice(0,t-1).concat({value:n[t-2].type===" "?"*":""})).replace(vt,"$1"),u,t<i&&si(n.slice(t,i)),i<e&&si(n=n.slice(i)),i<e&&wt(n))}f.push(u)}return ei(f)}function vr(n,t){var f=0,i=t.length>0,e=n.length>0,o=function(o,h,c,l,a){var y,g,k,w=[],d=0,v="0",nt=o&&[],tt=a!=null,it=lt,ut=o||e&&r.find.TAG("*",a&&h.parentNode||h),rt=p+=it==null?1:Math.random()||.1;for(tt&&(lt=h!==s&&h,ht=f);(y=ut[v])!=null;v++){if(e&&y){for(g=0;k=n[g++];)if(k(y,h,c)){l.push(y);break}tt&&(p=rt,ht=++f)}i&&((y=!k&&y)&&d--,o&&nt.push(y))}if(d+=v,i&&v!==d){for(g=0;k=t[g++];)k(nt,w,h,c);if(o){if(d>0)while(v--)nt[v]||w[v]||(w[v]=nr.call(l));w=bt(w)}b.apply(l,w);tt&&!o&&w.length>0&&d+t.length>1&&u.uniqueSort(l)}return tt&&(p=rt,lt=it),nt};return i?c(o):o}function yr(n,t,i){for(var r=0,f=t.length;r<f;r++)u(n,t[r],i);return i}function pr(n,t,i,u){var s,f,o,c,l,h=pt(n);if(!u&&h.length===1){if(f=h[0]=h[0].slice(0),f.length>2&&(o=f[0]).type==="ID"&&e.getById&&t.nodeType===9&&v&&r.relative[f[1].type]){if(t=(r.find.ID(o.matches[0].replace(k,d),t)||[])[0],!t)return i;n=n.slice(f.shift().value.length)}for(s=yt.needsContext.test(n)?0:f.length;s--;){if(o=f[s],r.relative[c=o.type])break;if((l=r.find[c])&&(u=l(o.matches[0].replace(k,d),ti.test(f[0].type)&&t.parentNode||t))){if(f.splice(s,1),n=u.length&&wt(f),!n)return b.apply(i,u),i;break}}}return kt(n,h)(u,t,!v,i,ti.test(n)),i}var ut,e,ht,r,ct,hi,kt,lt,g,nt,s,a,v,h,tt,at,ot,o="sizzle"+-new Date,y=n.document,p=0,di=0,ci=ri(),li=ri(),ai=ri(),ft=!1,dt=function(n,t){return n===t?(ft=!0,0):0},st=typeof t,vi=-2147483648,gi={}.hasOwnProperty,w=[],nr=w.pop,tr=w.push,b=w.push,yi=w.slice,it=w.indexOf||function(n){for(var t=0,i=this.length;t<i;t++)if(this[t]===n)return t;return-1},gt="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",f="[\\x20\\t\\r\\n\\f]",et="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",pi=et.replace("w","w#"),wi="\\["+f+"*("+et+")"+f+"*(?:([*^$|!~]?=)"+f+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+pi+")|)|)"+f+"*\\]",ni=":("+et+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+wi.replace(3,8)+")*)|.*)\\)|)",vt=new RegExp("^"+f+"+|((?:^|[^\\\\])(?:\\\\.)*)"+f+"+$","g"),ir=new RegExp("^"+f+"*,"+f+"*"),rr=new RegExp("^"+f+"*([>+~]|"+f+")"+f+"*"),ti=new RegExp(f+"*[+~]"),ur=new RegExp("="+f+"*([^\\]'\"]*)"+f+"*\\]","g"),fr=new RegExp(ni),er=new RegExp("^"+pi+"$"),yt={ID:new RegExp("^#("+et+")"),CLASS:new RegExp("^\\.("+et+")"),TAG:new RegExp("^("+et.replace("w","w*")+")"),ATTR:new RegExp("^"+wi),PSEUDO:new RegExp("^"+ni),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+f+"*(even|odd|(([+-]|)(\\d*)n|)"+f+"*(?:([+-]|)"+f+"*(\\d+)|))"+f+"*\\)|)","i"),bool:new RegExp("^(?:"+gt+")$","i"),needsContext:new RegExp("^"+f+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+f+"*((?:-\\d)?\\d*)"+f+"*\\)|)(?=[^-]|$)","i")},ii=/^[^{]+\{\s*\[native \w/,or=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,sr=/^(?:input|select|textarea|button)$/i,hr=/^h\d$/i,cr=/'|\\/g,k=new RegExp("\\\\([\\da-f]{1,6}"+f+"?|("+f+")|.)","ig"),d=function(n,t,i){var r="0x"+t-65536;return r!==r||i?t:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,r&1023|56320)};try{b.apply(w=yi.call(y.childNodes),y.childNodes);w[y.childNodes.length].nodeType}catch(wr){b={apply:w.length?function(n,t){tr.apply(n,yi.call(t))}:function(n,t){for(var i=n.length,r=0;n[i++]=t[r++];);n.length=i-1}}}hi=u.isXML=function(n){var t=n&&(n.ownerDocument||n).documentElement;return t?t.nodeName!=="HTML":!1};e=u.support={};nt=u.setDocument=function(n){var t=n?n.ownerDocument||n:y,i=t.defaultView;return t===s||t.nodeType!==9||!t.documentElement?s:(s=t,a=t.documentElement,v=!hi(t),i&&i.attachEvent&&i!==i.top&&i.attachEvent("onbeforeunload",function(){nt()}),e.attributes=l(function(n){return n.className="i",!n.getAttribute("className")}),e.getElementsByTagName=l(function(n){return n.appendChild(t.createComment("")),!n.getElementsByTagName("*").length}),e.getElementsByClassName=l(function(n){return n.innerHTML="<div class='a'><\/div><div class='a i'><\/div>",n.firstChild.className="i",n.getElementsByClassName("i").length===2}),e.getById=l(function(n){return a.appendChild(n).id=o,!t.getElementsByName||!t.getElementsByName(o).length}),e.getById?(r.find.ID=function(n,t){if(typeof t.getElementById!==st&&v){var i=t.getElementById(n);return i&&i.parentNode?[i]:[]}},r.filter.ID=function(n){var t=n.replace(k,d);return function(n){return n.getAttribute("id")===t}}):(delete r.find.ID,r.filter.ID=function(n){var t=n.replace(k,d);return function(n){var i=typeof n.getAttributeNode!==st&&n.getAttributeNode("id");return i&&i.value===t}}),r.find.TAG=e.getElementsByTagName?function(n,t){if(typeof t.getElementsByTagName!==st)return t.getElementsByTagName(n)}:function(n,t){var i,r=[],f=0,u=t.getElementsByTagName(n);if(n==="*"){while(i=u[f++])i.nodeType===1&&r.push(i);return r}return u},r.find.CLASS=e.getElementsByClassName&&function(n,t){if(typeof t.getElementsByClassName!==st&&v)return t.getElementsByClassName(n)},tt=[],h=[],(e.qsa=ii.test(t.querySelectorAll))&&(l(function(n){n.innerHTML="<select><option selected=''><\/option><\/select>";n.querySelectorAll("[selected]").length||h.push("\\["+f+"*(?:value|"+gt+")");n.querySelectorAll(":checked").length||h.push(":checked")}),l(function(n){var i=t.createElement("input");i.setAttribute("type","hidden");n.appendChild(i).setAttribute("t","");n.querySelectorAll("[t^='']").length&&h.push("[*^$]="+f+"*(?:''|\"\")");n.querySelectorAll(":enabled").length||h.push(":enabled",":disabled");n.querySelectorAll("*,:x");h.push(",.*:")})),(e.matchesSelector=ii.test(at=a.webkitMatchesSelector||a.mozMatchesSelector||a.oMatchesSelector||a.msMatchesSelector))&&l(function(n){e.disconnectedMatch=at.call(n,"div");at.call(n,"[s!='']:x");tt.push("!=",ni)}),h=h.length&&new RegExp(h.join("|")),tt=tt.length&&new RegExp(tt.join("|")),ot=ii.test(a.contains)||a.compareDocumentPosition?function(n,t){var r=n.nodeType===9?n.documentElement:n,i=t&&t.parentNode;return n===i||!!(i&&i.nodeType===1&&(r.contains?r.contains(i):n.compareDocumentPosition&&n.compareDocumentPosition(i)&16))}:function(n,t){if(t)while(t=t.parentNode)if(t===n)return!0;return!1},dt=a.compareDocumentPosition?function(n,i){if(n===i)return ft=!0,0;var r=i.compareDocumentPosition&&n.compareDocumentPosition&&n.compareDocumentPosition(i);return r?r&1||!e.sortDetached&&i.compareDocumentPosition(n)===r?n===t||ot(y,n)?-1:i===t||ot(y,i)?1:g?it.call(g,n)-it.call(g,i):0:r&4?-1:1:n.compareDocumentPosition?-1:1}:function(n,i){var r,u=0,o=n.parentNode,s=i.parentNode,f=[n],e=[i];if(n===i)return ft=!0,0;if(o&&s){if(o===s)return bi(n,i)}else return n===t?-1:i===t?1:o?-1:s?1:g?it.call(g,n)-it.call(g,i):0;for(r=n;r=r.parentNode;)f.unshift(r);for(r=i;r=r.parentNode;)e.unshift(r);while(f[u]===e[u])u++;return u?bi(f[u],e[u]):f[u]===y?-1:e[u]===y?1:0},t)};u.matches=function(n,t){return u(n,null,null,t)};u.matchesSelector=function(n,t){if((n.ownerDocument||n)!==s&&nt(n),t=t.replace(ur,"='$1']"),e.matchesSelector&&v&&(!tt||!tt.test(t))&&(!h||!h.test(t)))try{var i=at.call(n,t);if(i||e.disconnectedMatch||n.document&&n.document.nodeType!==11)return i}catch(r){}return u(t,s,null,[n]).length>0};u.contains=function(n,t){return(n.ownerDocument||n)!==s&&nt(n),ot(n,t)};u.attr=function(n,i){(n.ownerDocument||n)!==s&&nt(n);var f=r.attrHandle[i.toLowerCase()],u=f&&gi.call(r.attrHandle,i.toLowerCase())?f(n,i,!v):t;return u===t?e.attributes||!v?n.getAttribute(i):(u=n.getAttributeNode(i))&&u.specified?u.value:null:u};u.error=function(n){throw new Error("Syntax error, unrecognized expression: "+n);};u.uniqueSort=function(n){var r,u=[],t=0,i=0;if(ft=!e.detectDuplicates,g=!e.sortStable&&n.slice(0),n.sort(dt),ft){while(r=n[i++])r===n[i]&&(t=u.push(i));while(t--)n.splice(u[t],1)}return n};ct=u.getText=function(n){var r,i="",u=0,t=n.nodeType;if(t){if(t===1||t===9||t===11){if(typeof n.textContent=="string")return n.textContent;for(n=n.firstChild;n;n=n.nextSibling)i+=ct(n)}else if(t===3||t===4)return n.nodeValue}else for(;r=n[u];u++)i+=ct(r);return i};r=u.selectors={cacheLength:50,createPseudo:c,match:yt,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(n){return n[1]=n[1].replace(k,d),n[3]=(n[4]||n[5]||"").replace(k,d),n[2]==="~="&&(n[3]=" "+n[3]+" "),n.slice(0,4)},CHILD:function(n){return n[1]=n[1].toLowerCase(),n[1].slice(0,3)==="nth"?(n[3]||u.error(n[0]),n[4]=+(n[4]?n[5]+(n[6]||1):2*(n[3]==="even"||n[3]==="odd")),n[5]=+(n[7]+n[8]||n[3]==="odd")):n[3]&&u.error(n[0]),n},PSEUDO:function(n){var r,i=!n[5]&&n[2];return yt.CHILD.test(n[0])?null:(n[3]&&n[4]!==t?n[2]=n[4]:i&&fr.test(i)&&(r=pt(i,!0))&&(r=i.indexOf(")",i.length-r)-i.length)&&(n[0]=n[0].slice(0,r),n[2]=i.slice(0,r)),n.slice(0,3))}},filter:{TAG:function(n){var t=n.replace(k,d).toLowerCase();return n==="*"?function(){return!0}:function(n){return n.nodeName&&n.nodeName.toLowerCase()===t}},CLASS:function(n){var t=ci[n+" "];return t||(t=new RegExp("(^|"+f+")"+n+"("+f+"|$)"))&&ci(n,function(n){return t.test(typeof n.className=="string"&&n.className||typeof n.getAttribute!==st&&n.getAttribute("class")||"")})},ATTR:function(n,t,i){return function(r){var f=u.attr(r,n);return f==null?t==="!=":t?(f+="",t==="="?f===i:t==="!="?f!==i:t==="^="?i&&f.indexOf(i)===0:t==="*="?i&&f.indexOf(i)>-1:t==="$="?i&&f.slice(-i.length)===i:t==="~="?(" "+f+" ").indexOf(i)>-1:t==="|="?f===i||f.slice(0,i.length+1)===i+"-":!1):!0}},CHILD:function(n,t,i,r,u){var s=n.slice(0,3)!=="nth",e=n.slice(-4)!=="last",f=t==="of-type";return r===1&&u===0?function(n){return!!n.parentNode}:function(t,i,h){var a,k,c,l,v,w,b=s!==e?"nextSibling":"previousSibling",y=t.parentNode,g=f&&t.nodeName.toLowerCase(),d=!h&&!f;if(y){if(s){while(b){for(c=t;c=c[b];)if(f?c.nodeName.toLowerCase()===g:c.nodeType===1)return!1;w=b=n==="only"&&!w&&"nextSibling"}return!0}if(w=[e?y.firstChild:y.lastChild],e&&d){for(k=y[o]||(y[o]={}),a=k[n]||[],v=a[0]===p&&a[1],l=a[0]===p&&a[2],c=v&&y.childNodes[v];c=++v&&c&&c[b]||(l=v=0)||w.pop();)if(c.nodeType===1&&++l&&c===t){k[n]=[p,v,l];break}}else if(d&&(a=(t[o]||(t[o]={}))[n])&&a[0]===p)l=a[1];else while(c=++v&&c&&c[b]||(l=v=0)||w.pop())if((f?c.nodeName.toLowerCase()===g:c.nodeType===1)&&++l&&(d&&((c[o]||(c[o]={}))[n]=[p,l]),c===t))break;return l-=u,l===r||l%r==0&&l/r>=0}}},PSEUDO:function(n,t){var f,i=r.pseudos[n]||r.setFilters[n.toLowerCase()]||u.error("unsupported pseudo: "+n);return i[o]?i(t):i.length>1?(f=[n,n,"",t],r.setFilters.hasOwnProperty(n.toLowerCase())?c(function(n,r){for(var u,f=i(n,t),e=f.length;e--;)u=it.call(n,f[e]),n[u]=!(r[u]=f[e])}):function(n){return i(n,0,f)}):i}},pseudos:{not:c(function(n){var i=[],r=[],t=kt(n.replace(vt,"$1"));return t[o]?c(function(n,i,r,u){for(var e,o=t(n,null,u,[]),f=n.length;f--;)(e=o[f])&&(n[f]=!(i[f]=e))}):function(n,u,f){return i[0]=n,t(i,null,f,r),!r.pop()}}),has:c(function(n){return function(t){return u(n,t).length>0}}),contains:c(function(n){return function(t){return(t.textContent||t.innerText||ct(t)).indexOf(n)>-1}}),lang:c(function(n){return er.test(n||"")||u.error("unsupported lang: "+n),n=n.replace(k,d).toLowerCase(),function(t){var i;do if(i=v?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return i=i.toLowerCase(),i===n||i.indexOf(n+"-")===0;while((t=t.parentNode)&&t.nodeType===1);return!1}}),target:function(t){var i=n.location&&n.location.hash;return i&&i.slice(1)===t.id},root:function(n){return n===a},focus:function(n){return n===s.activeElement&&(!s.hasFocus||s.hasFocus())&&!!(n.type||n.href||~n.tabIndex)},enabled:function(n){return n.disabled===!1},disabled:function(n){return n.disabled===!0},checked:function(n){var t=n.nodeName.toLowerCase();return t==="input"&&!!n.checked||t==="option"&&!!n.selected},selected:function(n){return n.parentNode&&n.parentNode.selectedIndex,n.selected===!0},empty:function(n){for(n=n.firstChild;n;n=n.nextSibling)if(n.nodeName>"@"||n.nodeType===3||n.nodeType===4)return!1;return!0},parent:function(n){return!r.pseudos.empty(n)},header:function(n){return hr.test(n.nodeName)},input:function(n){return sr.test(n.nodeName)},button:function(n){var t=n.nodeName.toLowerCase();return t==="input"&&n.type==="button"||t==="button"},text:function(n){var t;return n.nodeName.toLowerCase()==="input"&&n.type==="text"&&((t=n.getAttribute("type"))==null||t.toLowerCase()===n.type)},first:rt(function(){return[0]}),last:rt(function(n,t){return[t-1]}),eq:rt(function(n,t,i){return[i<0?i+t:i]}),even:rt(function(n,t){for(var i=0;i<t;i+=2)n.push(i);return n}),odd:rt(function(n,t){for(var i=1;i<t;i+=2)n.push(i);return n}),lt:rt(function(n,t,i){for(var r=i<0?i+t:i;--r>=0;)n.push(r);return n}),gt:rt(function(n,t,i){for(var r=i<0?i+t:i;++r<t;)n.push(r);return n})}};r.pseudos.nth=r.pseudos.eq;for(ut in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[ut]=lr(ut);for(ut in{submit:!0,reset:!0})r.pseudos[ut]=ar(ut);ki.prototype=r.filters=r.pseudos;r.setFilters=new ki;kt=u.compile=function(n,t){var r,u=[],f=[],i=ai[n+" "];if(!i){for(t||(t=pt(n)),r=t.length;r--;)i=si(t[r]),i[o]?u.push(i):f.push(i);i=ai(n,vr(f,u))}return i};e.sortStable=o.split("").sort(dt).join("")===o;e.detectDuplicates=ft;nt();e.sortDetached=l(function(n){return n.compareDocumentPosition(s.createElement("div"))&1});l(function(n){return n.innerHTML="<a href='#'><\/a>",n.firstChild.getAttribute("href")==="#"})||ui("type|href|height|width",function(n,t,i){if(!i)return n.getAttribute(t,t.toLowerCase()==="type"?1:2)});e.attributes&&l(function(n){return n.innerHTML="<input/>",n.firstChild.setAttribute("value",""),n.firstChild.getAttribute("value")===""})||ui("value",function(n,t,i){if(!i&&n.nodeName.toLowerCase()==="input")return n.defaultValue});l(function(n){return n.getAttribute("disabled")==null})||ui(gt,function(n,t,i){var r;if(!i)return(r=n.getAttributeNode(t))&&r.specified?r.value:n[t]===!0?t.toLowerCase():null});i.find=u;i.expr=u.selectors;i.expr[":"]=i.expr.pseudos;i.unique=u.uniqueSort;i.text=u.getText;i.isXMLDoc=u.isXML;i.contains=u.contains}(n);ni={};i.Callbacks=function(n){n=typeof n=="string"?ni[n]||te(n):i.extend({},n);var s,f,c,e,o,l,r=[],u=!n.once&&[],a=function(t){for(f=n.memory&&t,c=!0,o=l||0,l=0,e=r.length,s=!0;r&&o<e;o++)if(r[o].apply(t[0],t[1])===!1&&n.stopOnFalse){f=!1;break}s=!1;r&&(u?u.length&&a(u.shift()):f?r=[]:h.disable())},h={add:function(){if(r){var t=r.length;(function u(t){i.each(t,function(t,f){var e=i.type(f);e==="function"?n.unique&&h.has(f)||r.push(f):f&&f.length&&e!=="string"&&u(f)})})(arguments);s?e=r.length:f&&(l=t,a(f))}return this},remove:function(){return r&&i.each(arguments,function(n,t){for(var u;(u=i.inArray(t,r,u))>-1;)r.splice(u,1),s&&(u<=e&&e--,u<=o&&o--)}),this},has:function(n){return n?i.inArray(n,r)>-1:!!(r&&r.length)},empty:function(){return r=[],e=0,this},disable:function(){return r=u=f=t,this},disabled:function(){return!r},lock:function(){return u=t,f||h.disable(),this},locked:function(){return!u},fireWith:function(n,t){return r&&(!c||u)&&(t=t||[],t=[n,t.slice?t.slice():t],s?u.push(t):a(t)),this},fire:function(){return h.fireWith(this,arguments),this},fired:function(){return!!c}};return h};i.extend({Deferred:function(n){var u=[["resolve","done",i.Callbacks("once memory"),"resolved"],["reject","fail",i.Callbacks("once memory"),"rejected"],["notify","progress",i.Callbacks("memory")]],f="pending",r={state:function(){return f},always:function(){return t.done(arguments).fail(arguments),this},then:function(){var n=arguments;return i.Deferred(function(f){i.each(u,function(u,e){var s=e[0],o=i.isFunction(n[u])&&n[u];t[e[1]](function(){var n=o&&o.apply(this,arguments);n&&i.isFunction(n.promise)?n.promise().done(f.resolve).fail(f.reject).progress(f.notify):f[s+"With"](this===r?f.promise():this,o?[n]:arguments)})});n=null}).promise()},promise:function(n){return n!=null?i.extend(n,r):r}},t={};return r.pipe=r.then,i.each(u,function(n,i){var e=i[2],o=i[3];r[i[1]]=e.add;o&&e.add(function(){f=o},u[n^1][2].disable,u[2][2].lock);t[i[0]]=function(){return t[i[0]+"With"](this===t?r:this,arguments),this};t[i[0]+"With"]=e.fireWith}),r.promise(t),n&&n.call(t,t),t},when:function(n){var t=0,u=l.call(arguments),r=u.length,e=r!==1||n&&i.isFunction(n.promise)?r:0,f=e===1?n:i.Deferred(),h=function(n,t,i){return function(r){t[n]=this;i[n]=arguments.length>1?l.call(arguments):r;i===o?f.notifyWith(t,i):--e||f.resolveWith(t,i)}},o,c,s;if(r>1)for(o=new Array(r),c=new Array(r),s=new Array(r);t<r;t++)u[t]&&i.isFunction(u[t].promise)?u[t].promise().done(h(t,s,u)).fail(f.reject).progress(h(t,c,o)):--e;return e||f.resolveWith(s,u),f.promise()}});i.support=function(t){var a,e,f,h,c,l,v,y,s,u=r.createElement("div");if(u.setAttribute("className","t"),u.innerHTML="  <link/><table><\/table><a href='/a'>a<\/a><input type='checkbox'/>",a=u.getElementsByTagName("*")||[],e=u.getElementsByTagName("a")[0],!e||!e.style||!a.length)return t;h=r.createElement("select");l=h.appendChild(r.createElement("option"));f=u.getElementsByTagName("input")[0];e.style.cssText="top:1px;float:left;opacity:.5";t.getSetAttribute=u.className!=="t";t.leadingWhitespace=u.firstChild.nodeType===3;t.tbody=!u.getElementsByTagName("tbody").length;t.htmlSerialize=!!u.getElementsByTagName("link").length;t.style=/top/.test(e.getAttribute("style"));t.hrefNormalized=e.getAttribute("href")==="/a";t.opacity=/^0.5/.test(e.style.opacity);t.cssFloat=!!e.style.cssFloat;t.checkOn=!!f.value;t.optSelected=l.selected;t.enctype=!!r.createElement("form").enctype;t.html5Clone=r.createElement("nav").cloneNode(!0).outerHTML!=="<:nav><\/:nav>";t.inlineBlockNeedsLayout=!1;t.shrinkWrapBlocks=!1;t.pixelPosition=!1;t.deleteExpando=!0;t.noCloneEvent=!0;t.reliableMarginRight=!0;t.boxSizingReliable=!0;f.checked=!0;t.noCloneChecked=f.cloneNode(!0).checked;h.disabled=!0;t.optDisabled=!l.disabled;try{delete u.test}catch(p){t.deleteExpando=!1}f=r.createElement("input");f.setAttribute("value","");t.input=f.getAttribute("value")==="";f.value="t";f.setAttribute("type","radio");t.radioValue=f.value==="t";f.setAttribute("checked","t");f.setAttribute("name","t");c=r.createDocumentFragment();c.appendChild(f);t.appendChecked=f.checked;t.checkClone=c.cloneNode(!0).cloneNode(!0).lastChild.checked;u.attachEvent&&(u.attachEvent("onclick",function(){t.noCloneEvent=!1}),u.cloneNode(!0).click());for(s in{submit:!0,change:!0,focusin:!0})u.setAttribute(v="on"+s,"t"),t[s+"Bubbles"]=v in n||u.attributes[v].expando===!1;u.style.backgroundClip="content-box";u.cloneNode(!0).style.backgroundClip="";t.clearCloneStyle=u.style.backgroundClip==="content-box";for(s in i(t))break;return t.ownLast=s!=="0",i(function(){var h,e,f,c="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",s=r.getElementsByTagName("body")[0];s&&(h=r.createElement("div"),h.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",s.appendChild(h).appendChild(u),u.innerHTML="<table><tr><td><\/td><td>t<\/td><\/tr><\/table>",f=u.getElementsByTagName("td"),f[0].style.cssText="padding:0;margin:0;border:0;display:none",y=f[0].offsetHeight===0,f[0].style.display="",f[1].style.display="none",t.reliableHiddenOffsets=y&&f[0].offsetHeight===0,u.innerHTML="",u.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",i.swap(s,s.style.zoom!=null?{zoom:1}:{},function(){t.boxSizing=u.offsetWidth===4}),n.getComputedStyle&&(t.pixelPosition=(n.getComputedStyle(u,null)||{}).top!=="1%",t.boxSizingReliable=(n.getComputedStyle(u,null)||{width:"4px"}).width==="4px",e=u.appendChild(r.createElement("div")),e.style.cssText=u.style.cssText=c,e.style.marginRight=e.style.width="0",u.style.width="1px",t.reliableMarginRight=!parseFloat((n.getComputedStyle(e,null)||{}).marginRight)),typeof u.style.zoom!==o&&(u.innerHTML="",u.style.cssText=c+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=u.offsetWidth===3,u.style.display="block",u.innerHTML="<div><\/div>",u.firstChild.style.width="5px",t.shrinkWrapBlocks=u.offsetWidth!==3,t.inlineBlockNeedsLayout&&(s.style.zoom=1)),s.removeChild(h),h=u=f=e=null)}),a=h=c=l=e=f=null,t}({});ir=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/;rr=/([A-Z])/g;i.extend({cache:{},noData:{applet:!0,embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(n){return n=n.nodeType?i.cache[n[i.expando]]:n[i.expando],!!n&&!ti(n)},data:function(n,t,i){return ur(n,t,i)},removeData:function(n,t){return fr(n,t)},_data:function(n,t,i){return ur(n,t,i,!0)},_removeData:function(n,t){return fr(n,t,!0)},acceptData:function(n){if(n.nodeType&&n.nodeType!==1&&n.nodeType!==9)return!1;var t=n.nodeName&&i.noData[n.nodeName.toLowerCase()];return!t||t!==!0&&n.getAttribute("classid")===t}});i.fn.extend({data:function(n,r){var e,f,o=null,s=0,u=this[0];if(n===t){if(this.length&&(o=i.data(u),u.nodeType===1&&!i._data(u,"parsedAttrs"))){for(e=u.attributes;s<e.length;s++)f=e[s].name,f.indexOf("data-")===0&&(f=i.camelCase(f.slice(5)),er(u,f,o[f]));i._data(u,"parsedAttrs",!0)}return o}return typeof n=="object"?this.each(function(){i.data(this,n)}):arguments.length>1?this.each(function(){i.data(this,n,r)}):u?er(u,n,i.data(u,n)):null},removeData:function(n){return this.each(function(){i.removeData(this,n)})}});i.extend({queue:function(n,t,r){var u;if(n)return t=(t||"fx")+"queue",u=i._data(n,t),r&&(!u||i.isArray(r)?u=i._data(n,t,i.makeArray(r)):u.push(r)),u||[]},dequeue:function(n,t){t=t||"fx";var r=i.queue(n,t),e=r.length,u=r.shift(),f=i._queueHooks(n,t),o=function(){i.dequeue(n,t)};u==="inprogress"&&(u=r.shift(),e--);u&&(t==="fx"&&r.unshift("inprogress"),delete f.stop,u.call(n,o,f));!e&&f&&f.empty.fire()},_queueHooks:function(n,t){var r=t+"queueHooks";return i._data(n,r)||i._data(n,r,{empty:i.Callbacks("once memory").add(function(){i._removeData(n,t+"queue");i._removeData(n,r)})})}});i.fn.extend({queue:function(n,r){var u=2;return(typeof n!="string"&&(r=n,n="fx",u--),arguments.length<u)?i.queue(this[0],n):r===t?this:this.each(function(){var t=i.queue(this,n,r);i._queueHooks(this,n);n==="fx"&&t[0]!=="inprogress"&&i.dequeue(this,n)})},dequeue:function(n){return this.each(function(){i.dequeue(this,n)})},delay:function(n,t){return n=i.fx?i.fx.speeds[n]||n:n,t=t||"fx",this.queue(t,function(t,i){var r=setTimeout(t,n);i.stop=function(){clearTimeout(r)}})},clearQueue:function(n){return this.queue(n||"fx",[])},promise:function(n,r){var u,e=1,o=i.Deferred(),f=this,s=this.length,h=function(){--e||o.resolveWith(f,[f])};for(typeof n!="string"&&(r=n,n=t),n=n||"fx";s--;)u=i._data(f[s],n+"queueHooks"),u&&u.empty&&(e++,u.empty.add(h));return h(),o.promise(r)}});var d,or,ii=/[\t\r\n\f]/g,ie=/\r/g,re=/^(?:input|select|textarea|button|object)$/i,ue=/^(?:a|area)$/i,ri=/^(?:checked|selected)$/i,a=i.support.getSetAttribute,ht=i.support.input;i.fn.extend({attr:function(n,t){return i.access(this,i.attr,n,t,arguments.length>1)},removeAttr:function(n){return this.each(function(){i.removeAttr(this,n)})},prop:function(n,t){return i.access(this,i.prop,n,t,arguments.length>1)},removeProp:function(n){return n=i.propFix[n]||n,this.each(function(){try{this[n]=t;delete this[n]}catch(i){}})},addClass:function(n){var e,t,r,u,o,f=0,h=this.length,c=typeof n=="string"&&n;if(i.isFunction(n))return this.each(function(t){i(this).addClass(n.call(this,t,this.className))});if(c)for(e=(n||"").match(s)||[];f<h;f++)if(t=this[f],r=t.nodeType===1&&(t.className?(" "+t.className+" ").replace(ii," "):" "),r){for(o=0;u=e[o++];)r.indexOf(" "+u+" ")<0&&(r+=u+" ");t.className=i.trim(r)}return this},removeClass:function(n){var e,r,t,u,o,f=0,h=this.length,c=arguments.length===0||typeof n=="string"&&n;if(i.isFunction(n))return this.each(function(t){i(this).removeClass(n.call(this,t,this.className))});if(c)for(e=(n||"").match(s)||[];f<h;f++)if(r=this[f],t=r.nodeType===1&&(r.className?(" "+r.className+" ").replace(ii," "):""),t){for(o=0;u=e[o++];)while(t.indexOf(" "+u+" ")>=0)t=t.replace(" "+u+" "," ");r.className=n?i.trim(t):""}return this},toggleClass:function(n,t){var r=typeof n;return typeof t=="boolean"&&r==="string"?t?this.addClass(n):this.removeClass(n):i.isFunction(n)?this.each(function(r){i(this).toggleClass(n.call(this,r,this.className,t),t)}):this.each(function(){if(r==="string")for(var t,f=0,u=i(this),e=n.match(s)||[];t=e[f++];)u.hasClass(t)?u.removeClass(t):u.addClass(t);else(r===o||r==="boolean")&&(this.className&&i._data(this,"__className__",this.className),this.className=this.className||n===!1?"":i._data(this,"__className__")||"")})},hasClass:function(n){for(var i=" "+n+" ",t=0,r=this.length;t<r;t++)if(this[t].nodeType===1&&(" "+this[t].className+" ").replace(ii," ").indexOf(i)>=0)return!0;return!1},val:function(n){var u,r,e,f=this[0];return arguments.length?(e=i.isFunction(n),this.each(function(u){var f;this.nodeType===1&&(f=e?n.call(this,u,i(this).val()):n,f==null?f="":typeof f=="number"?f+="":i.isArray(f)&&(f=i.map(f,function(n){return n==null?"":n+""})),r=i.valHooks[this.type]||i.valHooks[this.nodeName.toLowerCase()],r&&"set"in r&&r.set(this,f,"value")!==t||(this.value=f))})):f?(r=i.valHooks[f.type]||i.valHooks[f.nodeName.toLowerCase()],r&&"get"in r&&(u=r.get(f,"value"))!==t)?u:(u=f.value,typeof u=="string"?u.replace(ie,""):u==null?"":u):void 0}});i.extend({valHooks:{option:{get:function(n){var t=i.find.attr(n,"value");return t!=null?t:n.text}},select:{get:function(n){for(var e,t,o=n.options,r=n.selectedIndex,u=n.type==="select-one"||r<0,s=u?null:[],h=u?r+1:o.length,f=r<0?h:u?r:0;f<h;f++)if(t=o[f],(t.selected||f===r)&&(i.support.optDisabled?!t.disabled:t.getAttribute("disabled")===null)&&(!t.parentNode.disabled||!i.nodeName(t.parentNode,"optgroup"))){if(e=i(t).val(),u)return e;s.push(e)}return s},set:function(n,t){for(var u,r,f=n.options,e=i.makeArray(t),o=f.length;o--;)r=f[o],(r.selected=i.inArray(i(r).val(),e)>=0)&&(u=!0);return u||(n.selectedIndex=-1),e}}},attr:function(n,r,u){var f,e,s=n.nodeType;if(n&&s!==3&&s!==8&&s!==2){if(typeof n.getAttribute===o)return i.prop(n,r,u);if(s===1&&i.isXMLDoc(n)||(r=r.toLowerCase(),f=i.attrHooks[r]||(i.expr.match.bool.test(r)?or:d)),u!==t)if(u===null)i.removeAttr(n,r);else return f&&"set"in f&&(e=f.set(n,u,r))!==t?e:(n.setAttribute(r,u+""),u);else return f&&"get"in f&&(e=f.get(n,r))!==null?e:(e=i.find.attr(n,r),e==null?t:e)}},removeAttr:function(n,t){var r,u,e=0,f=t&&t.match(s);if(f&&n.nodeType===1)while(r=f[e++])u=i.propFix[r]||r,i.expr.match.bool.test(r)?ht&&a||!ri.test(r)?n[u]=!1:n[i.camelCase("default-"+r)]=n[u]=!1:i.attr(n,r,""),n.removeAttribute(a?r:u)},attrHooks:{type:{set:function(n,t){if(!i.support.radioValue&&t==="radio"&&i.nodeName(n,"input")){var r=n.value;return n.setAttribute("type",t),r&&(n.value=r),t}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(n,r,u){var e,f,s,o=n.nodeType;if(n&&o!==3&&o!==8&&o!==2)return s=o!==1||!i.isXMLDoc(n),s&&(r=i.propFix[r]||r,f=i.propHooks[r]),u!==t?f&&"set"in f&&(e=f.set(n,u,r))!==t?e:n[r]=u:f&&"get"in f&&(e=f.get(n,r))!==null?e:n[r]},propHooks:{tabIndex:{get:function(n){var t=i.find.attr(n,"tabindex");return t?parseInt(t,10):re.test(n.nodeName)||ue.test(n.nodeName)&&n.href?0:-1}}}});or={set:function(n,t,r){return t===!1?i.removeAttr(n,r):ht&&a||!ri.test(r)?n.setAttribute(!a&&i.propFix[r]||r,r):n[i.camelCase("default-"+r)]=n[r]=!0,r}};i.each(i.expr.match.bool.source.match(/\w+/g),function(n,r){var u=i.expr.attrHandle[r]||i.find.attr;i.expr.attrHandle[r]=ht&&a||!ri.test(r)?function(n,r,f){var e=i.expr.attrHandle[r],o=f?t:(i.expr.attrHandle[r]=t)!=u(n,r,f)?r.toLowerCase():null;return i.expr.attrHandle[r]=e,o}:function(n,r,u){return u?t:n[i.camelCase("default-"+r)]?r.toLowerCase():null}});ht&&a||(i.attrHooks.value={set:function(n,t,r){if(i.nodeName(n,"input"))n.defaultValue=t;else return d&&d.set(n,t,r)}});a||(d={set:function(n,i,r){var u=n.getAttributeNode(r);return u||n.setAttributeNode(u=n.ownerDocument.createAttribute(r)),u.value=i+="",r==="value"||i===n.getAttribute(r)?i:t}},i.expr.attrHandle.id=i.expr.attrHandle.name=i.expr.attrHandle.coords=function(n,i,r){var u;return r?t:(u=n.getAttributeNode(i))&&u.value!==""?u.value:null},i.valHooks.button={get:function(n,i){var r=n.getAttributeNode(i);return r&&r.specified?r.value:t},set:d.set},i.attrHooks.contenteditable={set:function(n,t,i){d.set(n,t===""?!1:t,i)}},i.each(["width","height"],function(n,t){i.attrHooks[t]={set:function(n,i){if(i==="")return n.setAttribute(t,"auto"),i}}}));i.support.hrefNormalized||i.each(["href","src"],function(n,t){i.propHooks[t]={get:function(n){return n.getAttribute(t,4)}}});i.support.style||(i.attrHooks.style={get:function(n){return n.style.cssText||t},set:function(n,t){return n.style.cssText=t+""}});i.support.optSelected||(i.propHooks.selected={get:function(n){var t=n.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}});i.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){i.propFix[this.toLowerCase()]=this});i.support.enctype||(i.propFix.enctype="encoding");i.each(["radio","checkbox"],function(){i.valHooks[this]={set:function(n,t){if(i.isArray(t))return n.checked=i.inArray(i(n).val(),t)>=0}};i.support.checkOn||(i.valHooks[this].get=function(n){return n.getAttribute("value")===null?"on":n.value})});var ui=/^(?:input|select|textarea)$/i,fe=/^key/,ee=/^(?:mouse|contextmenu)|click/,sr=/^(?:focusinfocus|focusoutblur)$/,hr=/^([^.]*)(?:\.(.+)|)$/;i.event={global:{},add:function(n,r,u,f,e){var b,p,k,w,c,l,a,v,h,d,g,y=i._data(n);if(y){for(u.handler&&(w=u,u=w.handler,e=w.selector),u.guid||(u.guid=i.guid++),(p=y.events)||(p=y.events={}),(l=y.handle)||(l=y.handle=function(n){return typeof i!==o&&(!n||i.event.triggered!==n.type)?i.event.dispatch.apply(l.elem,arguments):t},l.elem=n),r=(r||"").match(s)||[""],k=r.length;k--;)(b=hr.exec(r[k])||[],h=g=b[1],d=(b[2]||"").split(".").sort(),h)&&(c=i.event.special[h]||{},h=(e?c.delegateType:c.bindType)||h,c=i.event.special[h]||{},a=i.extend({type:h,origType:g,data:f,handler:u,guid:u.guid,selector:e,needsContext:e&&i.expr.match.needsContext.test(e),namespace:d.join(".")},w),(v=p[h])||(v=p[h]=[],v.delegateCount=0,c.setup&&c.setup.call(n,f,d,l)!==!1||(n.addEventListener?n.addEventListener(h,l,!1):n.attachEvent&&n.attachEvent("on"+h,l))),c.add&&(c.add.call(n,a),a.handler.guid||(a.handler.guid=u.guid)),e?v.splice(v.delegateCount++,0,a):v.push(a),i.event.global[h]=!0);n=null}},remove:function(n,t,r,u,f){var y,o,h,b,p,a,c,l,e,w,k,v=i.hasData(n)&&i._data(n);if(v&&(a=v.events)){for(t=(t||"").match(s)||[""],p=t.length;p--;){if(h=hr.exec(t[p])||[],e=k=h[1],w=(h[2]||"").split(".").sort(),!e){for(e in a)i.event.remove(n,e+t[p],r,u,!0);continue}for(c=i.event.special[e]||{},e=(u?c.delegateType:c.bindType)||e,l=a[e]||[],h=h[2]&&new RegExp("(^|\\.)"+w.join("\\.(?:.*\\.|)")+"(\\.|$)"),b=y=l.length;y--;)o=l[y],(f||k===o.origType)&&(!r||r.guid===o.guid)&&(!h||h.test(o.namespace))&&(!u||u===o.selector||u==="**"&&o.selector)&&(l.splice(y,1),o.selector&&l.delegateCount--,c.remove&&c.remove.call(n,o));b&&!l.length&&(c.teardown&&c.teardown.call(n,w,v.handle)!==!1||i.removeEvent(n,e,v.handle),delete a[e])}i.isEmptyObject(a)&&(delete v.handle,i._removeData(n,"events"))}},trigger:function(u,f,e,o){var a,v,s,w,l,c,b,p=[e||r],h=k.call(u,"type")?u.type:u,y=k.call(u,"namespace")?u.namespace.split("."):[];if((s=c=e=e||r,e.nodeType!==3&&e.nodeType!==8)&&!sr.test(h+i.event.triggered)&&(h.indexOf(".")>=0&&(y=h.split("."),h=y.shift(),y.sort()),v=h.indexOf(":")<0&&"on"+h,u=u[i.expando]?u:new i.Event(h,typeof u=="object"&&u),u.isTrigger=o?2:3,u.namespace=y.join("."),u.namespace_re=u.namespace?new RegExp("(^|\\.)"+y.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,u.result=t,u.target||(u.target=e),f=f==null?[u]:i.makeArray(f,[u]),l=i.event.special[h]||{},o||!l.trigger||l.trigger.apply(e,f)!==!1)){if(!o&&!l.noBubble&&!i.isWindow(e)){for(w=l.delegateType||h,sr.test(w+h)||(s=s.parentNode);s;s=s.parentNode)p.push(s),c=s;c===(e.ownerDocument||r)&&p.push(c.defaultView||c.parentWindow||n)}for(b=0;(s=p[b++])&&!u.isPropagationStopped();)u.type=b>1?w:l.bindType||h,a=(i._data(s,"events")||{})[u.type]&&i._data(s,"handle"),a&&a.apply(s,f),a=v&&s[v],a&&i.acceptData(s)&&a.apply&&a.apply(s,f)===!1&&u.preventDefault();if(u.type=h,!o&&!u.isDefaultPrevented()&&(!l._default||l._default.apply(p.pop(),f)===!1)&&i.acceptData(e)&&v&&e[h]&&!i.isWindow(e)){c=e[v];c&&(e[v]=null);i.event.triggered=h;try{e[h]()}catch(d){}i.event.triggered=t;c&&(e[v]=c)}return u.result}},dispatch:function(n){n=i.event.fix(n);var o,e,r,u,s,h=[],c=l.call(arguments),a=(i._data(this,"events")||{})[n.type]||[],f=i.event.special[n.type]||{};if(c[0]=n,n.delegateTarget=this,!f.preDispatch||f.preDispatch.call(this,n)!==!1){for(h=i.event.handlers.call(this,n,a),o=0;(u=h[o++])&&!n.isPropagationStopped();)for(n.currentTarget=u.elem,s=0;(r=u.handlers[s++])&&!n.isImmediatePropagationStopped();)(!n.namespace_re||n.namespace_re.test(r.namespace))&&(n.handleObj=r,n.data=r.data,e=((i.event.special[r.origType]||{}).handle||r.handler).apply(u.elem,c),e!==t&&(n.result=e)===!1&&(n.preventDefault(),n.stopPropagation()));return f.postDispatch&&f.postDispatch.call(this,n),n.result}},handlers:function(n,r){var e,o,f,s,c=[],h=r.delegateCount,u=n.target;if(h&&u.nodeType&&(!n.button||n.type!=="click"))for(;u!=this;u=u.parentNode||this)if(u.nodeType===1&&(u.disabled!==!0||n.type!=="click")){for(f=[],s=0;s<h;s++)o=r[s],e=o.selector+" ",f[e]===t&&(f[e]=o.needsContext?i(e,this).index(u)>=0:i.find(e,this,null,[u]).length),f[e]&&f.push(o);f.length&&c.push({elem:u,handlers:f})}return h<r.length&&c.push({elem:this,handlers:r.slice(h)}),c},fix:function(n){if(n[i.expando])return n;var e,o,s,u=n.type,f=n,t=this.fixHooks[u];for(t||(this.fixHooks[u]=t=ee.test(u)?this.mouseHooks:fe.test(u)?this.keyHooks:{}),s=t.props?this.props.concat(t.props):this.props,n=new i.Event(f),e=s.length;e--;)o=s[e],n[o]=f[o];return n.target||(n.target=f.srcElement||r),n.target.nodeType===3&&(n.target=n.target.parentNode),n.metaKey=!!n.metaKey,t.filter?t.filter(n,f):n},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(n,t){return n.which==null&&(n.which=t.charCode!=null?t.charCode:t.keyCode),n}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(n,i){var u,o,f,e=i.button,s=i.fromElement;return n.pageX==null&&i.clientX!=null&&(o=n.target.ownerDocument||r,f=o.documentElement,u=o.body,n.pageX=i.clientX+(f&&f.scrollLeft||u&&u.scrollLeft||0)-(f&&f.clientLeft||u&&u.clientLeft||0),n.pageY=i.clientY+(f&&f.scrollTop||u&&u.scrollTop||0)-(f&&f.clientTop||u&&u.clientTop||0)),!n.relatedTarget&&s&&(n.relatedTarget=s===n.target?i.toElement:s),n.which||e===t||(n.which=e&1?1:e&2?3:e&4?2:0),n}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==cr()&&this.focus)try{return this.focus(),!1}catch(n){}},delegateType:"focusin"},blur:{trigger:function(){if(this===cr()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if(i.nodeName(this,"input")&&this.type==="checkbox"&&this.click)return this.click(),!1},_default:function(n){return i.nodeName(n.target,"a")}},beforeunload:{postDispatch:function(n){n.result!==t&&(n.originalEvent.returnValue=n.result)}}},simulate:function(n,t,r,u){var f=i.extend(new i.Event,r,{type:n,isSimulated:!0,originalEvent:{}});u?i.event.trigger(f,null,t):i.event.dispatch.call(t,f);f.isDefaultPrevented()&&r.preventDefault()}};i.removeEvent=r.removeEventListener?function(n,t,i){n.removeEventListener&&n.removeEventListener(t,i,!1)}:function(n,t,i){var r="on"+t;n.detachEvent&&(typeof n[r]===o&&(n[r]=null),n.detachEvent(r,i))};i.Event=function(n,t){if(!(this instanceof i.Event))return new i.Event(n,t);n&&n.type?(this.originalEvent=n,this.type=n.type,this.isDefaultPrevented=n.defaultPrevented||n.returnValue===!1||n.getPreventDefault&&n.getPreventDefault()?ct:g):this.type=n;t&&i.extend(this,t);this.timeStamp=n&&n.timeStamp||i.now();this[i.expando]=!0};i.Event.prototype={isDefaultPrevented:g,isPropagationStopped:g,isImmediatePropagationStopped:g,preventDefault:function(){var n=this.originalEvent;(this.isDefaultPrevented=ct,n)&&(n.preventDefault?n.preventDefault():n.returnValue=!1)},stopPropagation:function(){var n=this.originalEvent;(this.isPropagationStopped=ct,n)&&(n.stopPropagation&&n.stopPropagation(),n.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=ct;this.stopPropagation()}};i.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(n,t){i.event.special[n]={delegateType:t,bindType:t,handle:function(n){var u,f=this,r=n.relatedTarget,e=n.handleObj;return r&&(r===f||i.contains(f,r))||(n.type=e.origType,u=e.handler.apply(this,arguments),n.type=t),u}}});i.support.submitBubbles||(i.event.special.submit={setup:function(){if(i.nodeName(this,"form"))return!1;i.event.add(this,"click._submit keypress._submit",function(n){var u=n.target,r=i.nodeName(u,"input")||i.nodeName(u,"button")?u.form:t;r&&!i._data(r,"submitBubbles")&&(i.event.add(r,"submit._submit",function(n){n._submit_bubble=!0}),i._data(r,"submitBubbles",!0))})},postDispatch:function(n){n._submit_bubble&&(delete n._submit_bubble,this.parentNode&&!n.isTrigger&&i.event.simulate("submit",this.parentNode,n,!0))},teardown:function(){if(i.nodeName(this,"form"))return!1;i.event.remove(this,"._submit")}});i.support.changeBubbles||(i.event.special.change={setup:function(){if(ui.test(this.nodeName))return(this.type==="checkbox"||this.type==="radio")&&(i.event.add(this,"propertychange._change",function(n){n.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),i.event.add(this,"click._change",function(n){this._just_changed&&!n.isTrigger&&(this._just_changed=!1);i.event.simulate("change",this,n,!0)})),!1;i.event.add(this,"beforeactivate._change",function(n){var t=n.target;ui.test(t.nodeName)&&!i._data(t,"changeBubbles")&&(i.event.add(t,"change._change",function(n){!this.parentNode||n.isSimulated||n.isTrigger||i.event.simulate("change",this.parentNode,n,!0)}),i._data(t,"changeBubbles",!0))})},handle:function(n){var t=n.target;if(this!==t||n.isSimulated||n.isTrigger||t.type!=="radio"&&t.type!=="checkbox")return n.handleObj.handler.apply(this,arguments)},teardown:function(){return i.event.remove(this,"._change"),!ui.test(this.nodeName)}});i.support.focusinBubbles||i.each({focus:"focusin",blur:"focusout"},function(n,t){var u=0,f=function(n){i.event.simulate(t,n.target,i.event.fix(n),!0)};i.event.special[t]={setup:function(){u++==0&&r.addEventListener(n,f,!0)},teardown:function(){--u==0&&r.removeEventListener(n,f,!0)}}});i.fn.extend({on:function(n,r,u,f,e){var s,o;if(typeof n=="object"){typeof r!="string"&&(u=u||r,r=t);for(s in n)this.on(s,r,u,n[s],e);return this}if(u==null&&f==null?(f=r,u=r=t):f==null&&(typeof r=="string"?(f=u,u=t):(f=u,u=r,r=t)),f===!1)f=g;else if(!f)return this;return e===1&&(o=f,f=function(n){return i().off(n),o.apply(this,arguments)},f.guid=o.guid||(o.guid=i.guid++)),this.each(function(){i.event.add(this,n,f,u,r)})},one:function(n,t,i,r){return this.on(n,t,i,r,1)},off:function(n,r,u){var f,e;if(n&&n.preventDefault&&n.handleObj)return f=n.handleObj,i(n.delegateTarget).off(f.namespace?f.origType+"."+f.namespace:f.origType,f.selector,f.handler),this;if(typeof n=="object"){for(e in n)this.off(e,r,n[e]);return this}return(r===!1||typeof r=="function")&&(u=r,r=t),u===!1&&(u=g),this.each(function(){i.event.remove(this,n,u,r)})},trigger:function(n,t){return this.each(function(){i.event.trigger(n,t,this)})},triggerHandler:function(n,t){var r=this[0];if(r)return i.event.trigger(n,t,r,!0)}});var oe=/^.[^:#\[\.,]*$/,se=/^(?:parents|prev(?:Until|All))/,lr=i.expr.match.needsContext,he={children:!0,contents:!0,next:!0,prev:!0};i.fn.extend({find:function(n){var t,r=[],u=this,f=u.length;if(typeof n!="string")return this.pushStack(i(n).filter(function(){for(t=0;t<f;t++)if(i.contains(u[t],this))return!0}));for(t=0;t<f;t++)i.find(n,u[t],r);return r=this.pushStack(f>1?i.unique(r):r),r.selector=this.selector?this.selector+" "+n:n,r},has:function(n){var t,r=i(n,this),u=r.length;return this.filter(function(){for(t=0;t<u;t++)if(i.contains(this,r[t]))return!0})},not:function(n){return this.pushStack(fi(this,n||[],!0))},filter:function(n){return this.pushStack(fi(this,n||[],!1))},is:function(n){return!!fi(this,typeof n=="string"&&lr.test(n)?i(n):n||[],!1).length},closest:function(n,t){for(var r,f=0,o=this.length,u=[],e=lr.test(n)||typeof n!="string"?i(n,t||this.context):0;f<o;f++)for(r=this[f];r&&r!==t;r=r.parentNode)if(r.nodeType<11&&(e?e.index(r)>-1:r.nodeType===1&&i.find.matchesSelector(r,n))){r=u.push(r);break}return this.pushStack(u.length>1?i.unique(u):u)},index:function(n){return n?typeof n=="string"?i.inArray(this[0],i(n)):i.inArray(n.jquery?n[0]:n,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(n,t){var r=typeof n=="string"?i(n,t):i.makeArray(n&&n.nodeType?[n]:n),u=i.merge(this.get(),r);return this.pushStack(i.unique(u))},addBack:function(n){return this.add(n==null?this.prevObject:this.prevObject.filter(n))}});i.each({parent:function(n){var t=n.parentNode;return t&&t.nodeType!==11?t:null},parents:function(n){return i.dir(n,"parentNode")},parentsUntil:function(n,t,r){return i.dir(n,"parentNode",r)},next:function(n){return ar(n,"nextSibling")},prev:function(n){return ar(n,"previousSibling")},nextAll:function(n){return i.dir(n,"nextSibling")},prevAll:function(n){return i.dir(n,"previousSibling")},nextUntil:function(n,t,r){return i.dir(n,"nextSibling",r)},prevUntil:function(n,t,r){return i.dir(n,"previousSibling",r)},siblings:function(n){return i.sibling((n.parentNode||{}).firstChild,n)},children:function(n){return i.sibling(n.firstChild)},contents:function(n){return i.nodeName(n,"iframe")?n.contentDocument||n.contentWindow.document:i.merge([],n.childNodes)}},function(n,t){i.fn[n]=function(r,u){var f=i.map(this,t,r);return n.slice(-5)!=="Until"&&(u=r),u&&typeof u=="string"&&(f=i.filter(u,f)),this.length>1&&(he[n]||(f=i.unique(f)),se.test(n)&&(f=f.reverse())),this.pushStack(f)}});i.extend({filter:function(n,t,r){var u=t[0];return r&&(n=":not("+n+")"),t.length===1&&u.nodeType===1?i.find.matchesSelector(u,n)?[u]:[]:i.find.matches(n,i.grep(t,function(n){return n.nodeType===1}))},dir:function(n,r,u){for(var e=[],f=n[r];f&&f.nodeType!==9&&(u===t||f.nodeType!==1||!i(f).is(u));)f.nodeType===1&&e.push(f),f=f[r];return e},sibling:function(n,t){for(var i=[];n;n=n.nextSibling)n.nodeType===1&&n!==t&&i.push(n);return i}});var yr="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",ce=/ jQuery\d+="(?:null|\d+)"/g,pr=new RegExp("<(?:"+yr+")[\\s/>]","i"),ei=/^\s+/,wr=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,br=/<([\w:]+)/,kr=/<tbody/i,le=/<|&#?\w+;/,ae=/<(?:script|style|link)/i,oi=/^(?:checkbox|radio)$/i,ve=/checked\s*(?:[^=]|=\s*.checked.)/i,dr=/^$|\/(?:java|ecma)script/i,ye=/^true\/(.*)/,pe=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,e={option:[1,"<select multiple='multiple'>","<\/select>"],legend:[1,"<fieldset>","<\/fieldset>"],area:[1,"<map>","<\/map>"],param:[1,"<object>","<\/object>"],thead:[1,"<table>","<\/table>"],tr:[2,"<table><tbody>","<\/tbody><\/table>"],col:[2,"<table><tbody><\/tbody><colgroup>","<\/colgroup><\/table>"],td:[3,"<table><tbody><tr>","<\/tr><\/tbody><\/table>"],_default:i.support.htmlSerialize?[0,"",""]:[1,"X<div>","<\/div>"]},we=vr(r),si=we.appendChild(r.createElement("div"));e.optgroup=e.option;e.tbody=e.tfoot=e.colgroup=e.caption=e.thead;e.th=e.td;i.fn.extend({text:function(n){return i.access(this,function(n){return n===t?i.text(this):this.empty().append((this[0]&&this[0].ownerDocument||r).createTextNode(n))},null,n,arguments.length)},append:function(){return this.domManip(arguments,function(n){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var t=gr(this,n);t.appendChild(n)}})},prepend:function(){return this.domManip(arguments,function(n){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var t=gr(this,n);t.insertBefore(n,t.firstChild)}})},before:function(){return this.domManip(arguments,function(n){this.parentNode&&this.parentNode.insertBefore(n,this)})},after:function(){return this.domManip(arguments,function(n){this.parentNode&&this.parentNode.insertBefore(n,this.nextSibling)})},remove:function(n,t){for(var r,e=n?i.filter(n,this):this,f=0;(r=e[f])!=null;f++)t||r.nodeType!==1||i.cleanData(u(r)),r.parentNode&&(t&&i.contains(r.ownerDocument,r)&&hi(u(r,"script")),r.parentNode.removeChild(r));return this},empty:function(){for(var n,t=0;(n=this[t])!=null;t++){for(n.nodeType===1&&i.cleanData(u(n,!1));n.firstChild;)n.removeChild(n.firstChild);n.options&&i.nodeName(n,"select")&&(n.options.length=0)}return this},clone:function(n,t){return n=n==null?!1:n,t=t==null?n:t,this.map(function(){return i.clone(this,n,t)})},html:function(n){return i.access(this,function(n){var r=this[0]||{},f=0,o=this.length;if(n===t)return r.nodeType===1?r.innerHTML.replace(ce,""):t;if(typeof n=="string"&&!ae.test(n)&&(i.support.htmlSerialize||!pr.test(n))&&(i.support.leadingWhitespace||!ei.test(n))&&!e[(br.exec(n)||["",""])[1].toLowerCase()]){n=n.replace(wr,"<$1><\/$2>");try{for(;f<o;f++)r=this[f]||{},r.nodeType===1&&(i.cleanData(u(r,!1)),r.innerHTML=n);r=0}catch(s){}}r&&this.empty().append(n)},null,n,arguments.length)},replaceWith:function(){var t=i.map(this,function(n){return[n.nextSibling,n.parentNode]}),n=0;return this.domManip(arguments,function(r){var u=t[n++],f=t[n++];f&&(u&&u.parentNode!==f&&(u=this.nextSibling),i(this).remove(),f.insertBefore(r,u))},!0),n?this:this.remove()},detach:function(n){return this.remove(n,!0)},domManip:function(n,t,r){n=di.apply([],n);var h,f,c,o,v,s,e=0,l=this.length,p=this,w=l-1,a=n[0],y=i.isFunction(a);if(y||!(l<=1||typeof a!="string"||i.support.checkClone||!ve.test(a)))return this.each(function(i){var u=p.eq(i);y&&(n[0]=a.call(this,i,u.html()));u.domManip(n,t,r)});if(l&&(s=i.buildFragment(n,this[0].ownerDocument,!1,!r&&this),h=s.firstChild,s.childNodes.length===1&&(s=h),h)){for(o=i.map(u(s,"script"),nu),c=o.length;e<l;e++)f=s,e!==w&&(f=i.clone(f,!0,!0),c&&i.merge(o,u(f,"script"))),t.call(this[e],f,e);if(c)for(v=o[o.length-1].ownerDocument,i.map(o,tu),e=0;e<c;e++)f=o[e],dr.test(f.type||"")&&!i._data(f,"globalEval")&&i.contains(v,f)&&(f.src?i._evalUrl(f.src):i.globalEval((f.text||f.textContent||f.innerHTML||"").replace(pe,"")));s=h=null}return this}});i.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(n,t){i.fn[n]=function(n){for(var u,r=0,f=[],e=i(n),o=e.length-1;r<=o;r++)u=r===o?this:this.clone(!0),i(e[r])[t](u),kt.apply(f,u.get());return this.pushStack(f)}});i.extend({clone:function(n,t,r){var f,h,o,e,s,c=i.contains(n.ownerDocument,n);if(i.support.html5Clone||i.isXMLDoc(n)||!pr.test("<"+n.nodeName+">")?o=n.cloneNode(!0):(si.innerHTML=n.outerHTML,si.removeChild(o=si.firstChild)),(!i.support.noCloneEvent||!i.support.noCloneChecked)&&(n.nodeType===1||n.nodeType===11)&&!i.isXMLDoc(n))for(f=u(o),s=u(n),e=0;(h=s[e])!=null;++e)f[e]&&be(h,f[e]);if(t)if(r)for(s=s||u(n),f=f||u(o),e=0;(h=s[e])!=null;e++)iu(h,f[e]);else iu(n,o);return f=u(o,"script"),f.length>0&&hi(f,!c&&u(n,"script")),f=s=h=null,o},buildFragment:function(n,t,r,f){for(var h,o,w,s,y,p,l,b=n.length,a=vr(t),c=[],v=0;v<b;v++)if(o=n[v],o||o===0)if(i.type(o)==="object")i.merge(c,o.nodeType?[o]:o);else if(le.test(o)){for(s=s||a.appendChild(t.createElement("div")),y=(br.exec(o)||["",""])[1].toLowerCase(),l=e[y]||e._default,s.innerHTML=l[1]+o.replace(wr,"<$1><\/$2>")+l[2],h=l[0];h--;)s=s.lastChild;if(!i.support.leadingWhitespace&&ei.test(o)&&c.push(t.createTextNode(ei.exec(o)[0])),!i.support.tbody)for(o=y==="table"&&!kr.test(o)?s.firstChild:l[1]==="<table>"&&!kr.test(o)?s:0,h=o&&o.childNodes.length;h--;)i.nodeName(p=o.childNodes[h],"tbody")&&!p.childNodes.length&&o.removeChild(p);for(i.merge(c,s.childNodes),s.textContent="";s.firstChild;)s.removeChild(s.firstChild);s=a.lastChild}else c.push(t.createTextNode(o));for(s&&a.removeChild(s),i.support.appendChecked||i.grep(u(c,"input"),ke),v=0;o=c[v++];)if((!f||i.inArray(o,f)===-1)&&(w=i.contains(o.ownerDocument,o),s=u(a.appendChild(o),"script"),w&&hi(s),r))for(h=0;o=s[h++];)dr.test(o.type||"")&&r.push(o);return s=null,a},cleanData:function(n,t){for(var r,e,u,f,c=0,s=i.expando,h=i.cache,l=i.support.deleteExpando,a=i.event.special;(r=n[c])!=null;c++)if((t||i.acceptData(r))&&(u=r[s],f=u&&h[u],f)){if(f.events)for(e in f.events)a[e]?i.event.remove(r,e):i.removeEvent(r,e,f.handle);h[u]&&(delete h[u],l?delete r[s]:typeof r.removeAttribute!==o?r.removeAttribute(s):r[s]=null,b.push(u))}},_evalUrl:function(n){return i.ajax({url:n,type:"GET",dataType:"script",async:!1,global:!1,throws:!0})}});i.fn.extend({wrapAll:function(n){if(i.isFunction(n))return this.each(function(t){i(this).wrapAll(n.call(this,t))});if(this[0]){var t=i(n,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]);t.map(function(){for(var n=this;n.firstChild&&n.firstChild.nodeType===1;)n=n.firstChild;return n}).append(this)}return this},wrapInner:function(n){return i.isFunction(n)?this.each(function(t){i(this).wrapInner(n.call(this,t))}):this.each(function(){var t=i(this),r=t.contents();r.length?r.wrapAll(n):t.append(n)})},wrap:function(n){var t=i.isFunction(n);return this.each(function(r){i(this).wrapAll(t?n.call(this,r):n)})},unwrap:function(){return this.parent().each(function(){i.nodeName(this,"body")||i(this).replaceWith(this.childNodes)}).end()}});var rt,v,y,ci=/alpha\([^)]*\)/i,de=/opacity\s*=\s*([^)]*)/,ge=/^(top|right|bottom|left)$/,no=/^(none|table(?!-c[ea]).+)/,ru=/^margin/,to=new RegExp("^("+st+")(.*)$","i"),lt=new RegExp("^("+st+")(?!px)[a-z%]+$","i"),io=new RegExp("^([+-])=("+st+")","i"),uu={BODY:"block"},ro={position:"absolute",visibility:"hidden",display:"block"},fu={letterSpacing:0,fontWeight:400},p=["Top","Right","Bottom","Left"],eu=["Webkit","O","Moz","ms"];i.fn.extend({css:function(n,r){return i.access(this,function(n,r,u){var e,o,s={},f=0;if(i.isArray(r)){for(o=v(n),e=r.length;f<e;f++)s[r[f]]=i.css(n,r[f],!1,o);return s}return u!==t?i.style(n,r,u):i.css(n,r)},n,r,arguments.length>1)},show:function(){return su(this,!0)},hide:function(){return su(this)},toggle:function(n){return typeof n=="boolean"?n?this.show():this.hide():this.each(function(){ut(this)?i(this).show():i(this).hide()})}});i.extend({cssHooks:{opacity:{get:function(n,t){if(t){var i=y(n,"opacity");return i===""?"1":i}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:i.support.cssFloat?"cssFloat":"styleFloat"},style:function(n,r,u,f){if(n&&n.nodeType!==3&&n.nodeType!==8&&n.style){var o,s,e,h=i.camelCase(r),c=n.style;if(r=i.cssProps[h]||(i.cssProps[h]=ou(c,h)),e=i.cssHooks[r]||i.cssHooks[h],u!==t){if(s=typeof u,s==="string"&&(o=io.exec(u))&&(u=(o[1]+1)*o[2]+parseFloat(i.css(n,r)),s="number"),u==null||s==="number"&&isNaN(u))return;if(s!=="number"||i.cssNumber[h]||(u+="px"),i.support.clearCloneStyle||u!==""||r.indexOf("background")!==0||(c[r]="inherit"),!e||!("set"in e)||(u=e.set(n,u,f))!==t)try{c[r]=u}catch(l){}}else return e&&"get"in e&&(o=e.get(n,!1,f))!==t?o:c[r]}},css:function(n,r,u,f){var h,e,o,s=i.camelCase(r);return(r=i.cssProps[s]||(i.cssProps[s]=ou(n.style,s)),o=i.cssHooks[r]||i.cssHooks[s],o&&"get"in o&&(e=o.get(n,!0,u)),e===t&&(e=y(n,r,f)),e==="normal"&&r in fu&&(e=fu[r]),u===""||u)?(h=parseFloat(e),u===!0||i.isNumeric(h)?h||0:e):e}});n.getComputedStyle?(v=function(t){return n.getComputedStyle(t,null)},y=function(n,r,u){var s,h,c,o=u||v(n),e=o?o.getPropertyValue(r)||o[r]:t,f=n.style;return o&&(e!==""||i.contains(n.ownerDocument,n)||(e=i.style(n,r)),lt.test(e)&&ru.test(r)&&(s=f.width,h=f.minWidth,c=f.maxWidth,f.minWidth=f.maxWidth=f.width=e,e=o.width,f.width=s,f.minWidth=h,f.maxWidth=c)),e}):r.documentElement.currentStyle&&(v=function(n){return n.currentStyle},y=function(n,i,r){var s,e,o,h=r||v(n),u=h?h[i]:t,f=n.style;return u==null&&f&&f[i]&&(u=f[i]),lt.test(u)&&!ge.test(i)&&(s=f.left,e=n.runtimeStyle,o=e&&e.left,o&&(e.left=n.currentStyle.left),f.left=i==="fontSize"?"1em":u,u=f.pixelLeft+"px",f.left=s,o&&(e.left=o)),u===""?"auto":u});i.each(["height","width"],function(n,t){i.cssHooks[t]={get:function(n,r,u){if(r)return n.offsetWidth===0&&no.test(i.css(n,"display"))?i.swap(n,ro,function(){return lu(n,t,u)}):lu(n,t,u)},set:function(n,r,u){var f=u&&v(n);return hu(n,r,u?cu(n,t,u,i.support.boxSizing&&i.css(n,"boxSizing",!1,f)==="border-box",f):0)}}});i.support.opacity||(i.cssHooks.opacity={get:function(n,t){return de.test((t&&n.currentStyle?n.currentStyle.filter:n.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(n,t){var r=n.style,u=n.currentStyle,e=i.isNumeric(t)?"alpha(opacity="+t*100+")":"",f=u&&u.filter||r.filter||"";(r.zoom=1,(t>=1||t==="")&&i.trim(f.replace(ci,""))===""&&r.removeAttribute&&(r.removeAttribute("filter"),t===""||u&&!u.filter))||(r.filter=ci.test(f)?f.replace(ci,e):f+" "+e)}});i(function(){i.support.reliableMarginRight||(i.cssHooks.marginRight={get:function(n,t){if(t)return i.swap(n,{display:"inline-block"},y,[n,"marginRight"])}});!i.support.pixelPosition&&i.fn.position&&i.each(["top","left"],function(n,t){i.cssHooks[t]={get:function(n,r){if(r)return r=y(n,t),lt.test(r)?i(n).position()[t]+"px":r}}})});i.expr&&i.expr.filters&&(i.expr.filters.hidden=function(n){return n.offsetWidth<=0&&n.offsetHeight<=0||!i.support.reliableHiddenOffsets&&(n.style&&n.style.display||i.css(n,"display"))==="none"},i.expr.filters.visible=function(n){return!i.expr.filters.hidden(n)});i.each({margin:"",padding:"",border:"Width"},function(n,t){i.cssHooks[n+t]={expand:function(i){for(var r=0,f={},u=typeof i=="string"?i.split(" "):[i];r<4;r++)f[n+p[r]+t]=u[r]||u[r-2]||u[0];return f}};ru.test(n)||(i.cssHooks[n+t].set=hu)});var uo=/%20/g,fo=/\[\]$/,yu=/\r?\n/g,eo=/^(?:submit|button|image|reset|file)$/i,oo=/^(?:input|select|textarea|keygen)/i;i.fn.extend({serialize:function(){return i.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var n=i.prop(this,"elements");return n?i.makeArray(n):this}).filter(function(){var n=this.type;return this.name&&!i(this).is(":disabled")&&oo.test(this.nodeName)&&!eo.test(n)&&(this.checked||!oi.test(n))}).map(function(n,t){var r=i(this).val();return r==null?null:i.isArray(r)?i.map(r,function(n){return{name:t.name,value:n.replace(yu,"\r\n")}}):{name:t.name,value:r.replace(yu,"\r\n")}}).get()}});i.param=function(n,r){var u,f=[],e=function(n,t){t=i.isFunction(t)?t():t==null?"":t;f[f.length]=encodeURIComponent(n)+"="+encodeURIComponent(t)};if(r===t&&(r=i.ajaxSettings&&i.ajaxSettings.traditional),i.isArray(n)||n.jquery&&!i.isPlainObject(n))i.each(n,function(){e(this.name,this.value)});else for(u in n)li(u,n[u],r,e);return f.join("&").replace(uo,"+")};i.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(n,t){i.fn[t]=function(n,i){return arguments.length>0?this.on(t,null,n,i):this.trigger(t)}});i.fn.extend({hover:function(n,t){return this.mouseenter(n).mouseleave(t||n)},bind:function(n,t,i){return this.on(n,null,t,i)},unbind:function(n,t){return this.off(n,null,t)},delegate:function(n,t,i,r){return this.on(t,n,i,r)},undelegate:function(n,t,i){return arguments.length===1?this.off(n,"**"):this.off(t,n||"**",i)}});var w,c,ai=i.now(),vi=/\?/,so=/#.*$/,pu=/([?&])_=[^&]*/,ho=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,co=/^(?:GET|HEAD)$/,lo=/^\/\//,wu=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,bu=i.fn.load,ku={},yi={},du="*/".concat("*");try{c=hf.href}catch(go){c=r.createElement("a");c.href="";c=c.href}w=wu.exec(c.toLowerCase())||[];i.fn.load=function(n,r,u){if(typeof n!="string"&&bu)return bu.apply(this,arguments);var f,s,h,e=this,o=n.indexOf(" ");return o>=0&&(f=n.slice(o,n.length),n=n.slice(0,o)),i.isFunction(r)?(u=r,r=t):r&&typeof r=="object"&&(h="POST"),e.length>0&&i.ajax({url:n,type:h,dataType:"html",data:r}).done(function(n){s=arguments;e.html(f?i("<div>").append(i.parseHTML(n)).find(f):n)}).complete(u&&function(n,t){e.each(u,s||[n.responseText,t,n])}),this};i.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(n,t){i.fn[t]=function(n){return this.on(t,n)}});i.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:c,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(w[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":du,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":i.parseJSON,"text xml":i.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(n,t){return t?pi(pi(n,i.ajaxSettings),t):pi(i.ajaxSettings,n)},ajaxPrefilter:gu(ku),ajaxTransport:gu(yi),ajax:function(n,r){function k(n,r,s,c){var a,rt,k,p,w,l=r;o!==2&&(o=2,g&&clearTimeout(g),v=t,d=c||"",f.readyState=n>0?4:0,a=n>=200&&n<300||n===304,s&&(p=ao(u,f,s)),p=vo(u,p,f,a),a?(u.ifModified&&(w=f.getResponseHeader("Last-Modified"),w&&(i.lastModified[e]=w),w=f.getResponseHeader("etag"),w&&(i.etag[e]=w)),n===204||u.type==="HEAD"?l="nocontent":n===304?l="notmodified":(l=p.state,rt=p.data,k=p.error,a=!k)):(k=l,(n||!l)&&(l="error",n<0&&(n=0))),f.status=n,f.statusText=(r||l)+"",a?tt.resolveWith(h,[rt,l,f]):tt.rejectWith(h,[f,l,k]),f.statusCode(b),b=t,y&&nt.trigger(a?"ajaxSuccess":"ajaxError",[f,u,a?rt:k]),it.fireWith(h,[f,l]),y&&(nt.trigger("ajaxComplete",[f,u]),--i.active||i.event.trigger("ajaxStop")))}typeof n=="object"&&(r=n,n=t);r=r||{};var l,a,e,d,g,y,v,p,u=i.ajaxSetup({},r),h=u.context||u,nt=u.context&&(h.nodeType||h.jquery)?i(h):i.event,tt=i.Deferred(),it=i.Callbacks("once memory"),b=u.statusCode||{},rt={},ut={},o=0,ft="canceled",f={readyState:0,getResponseHeader:function(n){var t;if(o===2){if(!p)for(p={};t=ho.exec(d);)p[t[1].toLowerCase()]=t[2];t=p[n.toLowerCase()]}return t==null?null:t},getAllResponseHeaders:function(){return o===2?d:null},setRequestHeader:function(n,t){var i=n.toLowerCase();return o||(n=ut[i]=ut[i]||n,rt[n]=t),this},overrideMimeType:function(n){return o||(u.mimeType=n),this},statusCode:function(n){var t;if(n)if(o<2)for(t in n)b[t]=[b[t],n[t]];else f.always(n[f.status]);return this},abort:function(n){var t=n||ft;return v&&v.abort(t),k(0,t),this}};if(tt.promise(f).complete=it.add,f.success=f.done,f.error=f.fail,u.url=((n||u.url||c)+"").replace(so,"").replace(lo,w[1]+"//"),u.type=r.method||r.type||u.method||u.type,u.dataTypes=i.trim(u.dataType||"*").toLowerCase().match(s)||[""],u.crossDomain==null&&(l=wu.exec(u.url.toLowerCase()),u.crossDomain=!!(l&&(l[1]!==w[1]||l[2]!==w[2]||(l[3]||(l[1]==="http:"?"80":"443"))!==(w[3]||(w[1]==="http:"?"80":"443"))))),u.data&&u.processData&&typeof u.data!="string"&&(u.data=i.param(u.data,u.traditional)),nf(ku,u,r,f),o===2)return f;y=u.global;y&&i.active++==0&&i.event.trigger("ajaxStart");u.type=u.type.toUpperCase();u.hasContent=!co.test(u.type);e=u.url;u.hasContent||(u.data&&(e=u.url+=(vi.test(e)?"&":"?")+u.data,delete u.data),u.cache===!1&&(u.url=pu.test(e)?e.replace(pu,"$1_="+ai++):e+(vi.test(e)?"&":"?")+"_="+ai++));u.ifModified&&(i.lastModified[e]&&f.setRequestHeader("If-Modified-Since",i.lastModified[e]),i.etag[e]&&f.setRequestHeader("If-None-Match",i.etag[e]));(u.data&&u.hasContent&&u.contentType!==!1||r.contentType)&&f.setRequestHeader("Content-Type",u.contentType);f.setRequestHeader("Accept",u.dataTypes[0]&&u.accepts[u.dataTypes[0]]?u.accepts[u.dataTypes[0]]+(u.dataTypes[0]!=="*"?", "+du+"; q=0.01":""):u.accepts["*"]);for(a in u.headers)f.setRequestHeader(a,u.headers[a]);if(u.beforeSend&&(u.beforeSend.call(h,f,u)===!1||o===2))return f.abort();ft="abort";for(a in{success:1,error:1,complete:1})f[a](u[a]);if(v=nf(yi,u,r,f),v){f.readyState=1;y&&nt.trigger("ajaxSend",[f,u]);u.async&&u.timeout>0&&(g=setTimeout(function(){f.abort("timeout")},u.timeout));try{o=1;v.send(rt,k)}catch(et){if(o<2)k(-1,et);else throw et;}}else k(-1,"No Transport");return f},getJSON:function(n,t,r){return i.get(n,t,r,"json")},getScript:function(n,r){return i.get(n,t,r,"script")}});i.each(["get","post"],function(n,r){i[r]=function(n,u,f,e){return i.isFunction(u)&&(e=e||f,f=u,u=t),i.ajax({url:n,type:r,dataType:e,data:u,success:f})}});i.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(n){return i.globalEval(n),n}}});i.ajaxPrefilter("script",function(n){n.cache===t&&(n.cache=!1);n.crossDomain&&(n.type="GET",n.global=!1)});i.ajaxTransport("script",function(n){if(n.crossDomain){var u,f=r.head||i("head")[0]||r.documentElement;return{send:function(t,i){u=r.createElement("script");u.async=!0;n.scriptCharset&&(u.charset=n.scriptCharset);u.src=n.url;u.onload=u.onreadystatechange=function(n,t){(t||!u.readyState||/loaded|complete/.test(u.readyState))&&(u.onload=u.onreadystatechange=null,u.parentNode&&u.parentNode.removeChild(u),u=null,t||i(200,"success"))};f.insertBefore(u,f.firstChild)},abort:function(){if(u)u.onload(t,!0)}}}});wi=[];at=/(=)\?(?=&|$)|\?\?/;i.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var n=wi.pop()||i.expando+"_"+ai++;return this[n]=!0,n}});i.ajaxPrefilter("json jsonp",function(r,u,f){var e,s,o,h=r.jsonp!==!1&&(at.test(r.url)?"url":typeof r.data=="string"&&!(r.contentType||"").indexOf("application/x-www-form-urlencoded")&&at.test(r.data)&&"data");if(h||r.dataTypes[0]==="jsonp")return e=r.jsonpCallback=i.isFunction(r.jsonpCallback)?r.jsonpCallback():r.jsonpCallback,h?r[h]=r[h].replace(at,"$1"+e):r.jsonp!==!1&&(r.url+=(vi.test(r.url)?"&":"?")+r.jsonp+"="+e),r.converters["script json"]=function(){return o||i.error(e+" was not called"),o[0]},r.dataTypes[0]="json",s=n[e],n[e]=function(){o=arguments},f.always(function(){n[e]=s;r[e]&&(r.jsonpCallback=u.jsonpCallback,wi.push(e));o&&i.isFunction(s)&&s(o[0]);o=s=t}),"script"});tf=0;vt=n.ActiveXObject&&function(){for(var n in nt)nt[n](t,!0)};i.ajaxSettings.xhr=n.ActiveXObject?function(){return!this.isLocal&&rf()||yo()}:rf;tt=i.ajaxSettings.xhr();i.support.cors=!!tt&&"withCredentials"in tt;tt=i.support.ajax=!!tt;tt&&i.ajaxTransport(function(r){if(!r.crossDomain||i.support.cors){var u;return{send:function(f,e){var h,s,o=r.xhr();if(r.username?o.open(r.type,r.url,r.async,r.username,r.password):o.open(r.type,r.url,r.async),r.xhrFields)for(s in r.xhrFields)o[s]=r.xhrFields[s];r.mimeType&&o.overrideMimeType&&o.overrideMimeType(r.mimeType);r.crossDomain||f["X-Requested-With"]||(f["X-Requested-With"]="XMLHttpRequest");try{for(s in f)o.setRequestHeader(s,f[s])}catch(c){}o.send(r.hasContent&&r.data||null);u=function(n,f){var s,a,l,c;try{if(u&&(f||o.readyState===4))if(u=t,h&&(o.onreadystatechange=i.noop,vt&&delete nt[h]),f)o.readyState!==4&&o.abort();else{c={};s=o.status;a=o.getAllResponseHeaders();typeof o.responseText=="string"&&(c.text=o.responseText);try{l=o.statusText}catch(y){l=""}s||!r.isLocal||r.crossDomain?s===1223&&(s=204):s=c.text?200:404}}catch(v){f||e(-1,v)}c&&e(s,l,c,a)};r.async?o.readyState===4?setTimeout(u):(h=++tf,vt&&(nt||(nt={},i(n).unload(vt)),nt[h]=u),o.onreadystatechange=u):u()},abort:function(){u&&u(t,!0)}}}});var it,yt,po=/^(?:toggle|show|hide)$/,uf=new RegExp("^(?:([+-])=|)("+st+")([a-z%]*)$","i"),wo=/queueHooks$/,pt=[ko],ft={"*":[function(n,t){var f=this.createTween(n,t),s=f.cur(),u=uf.exec(t),e=u&&u[3]||(i.cssNumber[n]?"":"px"),r=(i.cssNumber[n]||e!=="px"&&+s)&&uf.exec(i.css(f.elem,n)),o=1,h=20;if(r&&r[3]!==e){e=e||r[3];u=u||[];r=+s||1;do o=o||".5",r=r/o,i.style(f.elem,n,r+e);while(o!==(o=f.cur()/s)&&o!==1&&--h)}return u&&(r=f.start=+r||+s||0,f.unit=e,f.end=u[1]?r+(u[1]+1)*u[2]:+u[2]),f}]};i.Animation=i.extend(of,{tweener:function(n,t){i.isFunction(n)?(t=n,n=["*"]):n=n.split(" ");for(var r,u=0,f=n.length;u<f;u++)r=n[u],ft[r]=ft[r]||[],ft[r].unshift(t)},prefilter:function(n,t){t?pt.unshift(n):pt.push(n)}});i.Tween=f;f.prototype={constructor:f,init:function(n,t,r,u,f,e){this.elem=n;this.prop=r;this.easing=f||"swing";this.options=t;this.start=this.now=this.cur();this.end=u;this.unit=e||(i.cssNumber[r]?"":"px")},cur:function(){var n=f.propHooks[this.prop];return n&&n.get?n.get(this):f.propHooks._default.get(this)},run:function(n){var t,r=f.propHooks[this.prop];return this.pos=this.options.duration?t=i.easing[this.easing](n,this.options.duration*n,0,1,this.options.duration):t=n,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),r&&r.set?r.set(this):f.propHooks._default.set(this),this}};f.prototype.init.prototype=f.prototype;f.propHooks={_default:{get:function(n){var t;return n.elem[n.prop]!=null&&(!n.elem.style||n.elem.style[n.prop]==null)?n.elem[n.prop]:(t=i.css(n.elem,n.prop,""),!t||t==="auto"?0:t)},set:function(n){i.fx.step[n.prop]?i.fx.step[n.prop](n):n.elem.style&&(n.elem.style[i.cssProps[n.prop]]!=null||i.cssHooks[n.prop])?i.style(n.elem,n.prop,n.now+n.unit):n.elem[n.prop]=n.now}}};f.propHooks.scrollTop=f.propHooks.scrollLeft={set:function(n){n.elem.nodeType&&n.elem.parentNode&&(n.elem[n.prop]=n.now)}};i.each(["toggle","show","hide"],function(n,t){var r=i.fn[t];i.fn[t]=function(n,i,u){return n==null||typeof n=="boolean"?r.apply(this,arguments):this.animate(wt(t,!0),n,i,u)}});i.fn.extend({fadeTo:function(n,t,i,r){return this.filter(ut).css("opacity",0).show().end().animate({opacity:t},n,i,r)},animate:function(n,t,r,u){var o=i.isEmptyObject(n),e=i.speed(t,r,u),f=function(){var t=of(this,i.extend({},n),e);(o||i._data(this,"finish"))&&t.stop(!0)};return f.finish=f,o||e.queue===!1?this.each(f):this.queue(e.queue,f)},stop:function(n,r,u){var f=function(n){var t=n.stop;delete n.stop;t(u)};return typeof n!="string"&&(u=r,r=n,n=t),r&&n!==!1&&this.queue(n||"fx",[]),this.each(function(){var o=!0,t=n!=null&&n+"queueHooks",e=i.timers,r=i._data(this);if(t)r[t]&&r[t].stop&&f(r[t]);else for(t in r)r[t]&&r[t].stop&&wo.test(t)&&f(r[t]);for(t=e.length;t--;)e[t].elem===this&&(n==null||e[t].queue===n)&&(e[t].anim.stop(u),o=!1,e.splice(t,1));(o||!u)&&i.dequeue(this,n)})},finish:function(n){return n!==!1&&(n=n||"fx"),this.each(function(){var t,f=i._data(this),r=f[n+"queue"],e=f[n+"queueHooks"],u=i.timers,o=r?r.length:0;for(f.finish=!0,i.queue(this,n,[]),e&&e.stop&&e.stop.call(this,!0),t=u.length;t--;)u[t].elem===this&&u[t].queue===n&&(u[t].anim.stop(!0),u.splice(t,1));for(t=0;t<o;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete f.finish})}});i.each({slideDown:wt("show"),slideUp:wt("hide"),slideToggle:wt("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(n,t){i.fn[n]=function(n,i,r){return this.animate(t,n,i,r)}});i.speed=function(n,t,r){var u=n&&typeof n=="object"?i.extend({},n):{complete:r||!r&&t||i.isFunction(n)&&n,duration:n,easing:r&&t||t&&!i.isFunction(t)&&t};return u.duration=i.fx.off?0:typeof u.duration=="number"?u.duration:u.duration in i.fx.speeds?i.fx.speeds[u.duration]:i.fx.speeds._default,(u.queue==null||u.queue===!0)&&(u.queue="fx"),u.old=u.complete,u.complete=function(){i.isFunction(u.old)&&u.old.call(this);u.queue&&i.dequeue(this,u.queue)},u};i.easing={linear:function(n){return n},swing:function(n){return.5-Math.cos(n*Math.PI)/2}};i.timers=[];i.fx=f.prototype.init;i.fx.tick=function(){var u,n=i.timers,r=0;for(it=i.now();r<n.length;r++)u=n[r],u()||n[r]!==u||n.splice(r--,1);n.length||i.fx.stop();it=t};i.fx.timer=function(n){n()&&i.timers.push(n)&&i.fx.start()};i.fx.interval=13;i.fx.start=function(){yt||(yt=setInterval(i.fx.tick,i.fx.interval))};i.fx.stop=function(){clearInterval(yt);yt=null};i.fx.speeds={slow:600,fast:200,_default:400};i.fx.step={};i.expr&&i.expr.filters&&(i.expr.filters.animated=function(n){return i.grep(i.timers,function(t){return n===t.elem}).length});i.fn.offset=function(n){if(arguments.length)return n===t?this:this.each(function(t){i.offset.setOffset(this,n,t)});var r,e,f={top:0,left:0},u=this[0],s=u&&u.ownerDocument;if(s)return(r=s.documentElement,!i.contains(r,u))?f:(typeof u.getBoundingClientRect!==o&&(f=u.getBoundingClientRect()),e=sf(s),{top:f.top+(e.pageYOffset||r.scrollTop)-(r.clientTop||0),left:f.left+(e.pageXOffset||r.scrollLeft)-(r.clientLeft||0)})};i.offset={setOffset:function(n,t,r){var f=i.css(n,"position");f==="static"&&(n.style.position="relative");var e=i(n),o=e.offset(),l=i.css(n,"top"),a=i.css(n,"left"),v=(f==="absolute"||f==="fixed")&&i.inArray("auto",[l,a])>-1,u={},s={},h,c;v?(s=e.position(),h=s.top,c=s.left):(h=parseFloat(l)||0,c=parseFloat(a)||0);i.isFunction(t)&&(t=t.call(n,r,o));t.top!=null&&(u.top=t.top-o.top+h);t.left!=null&&(u.left=t.left-o.left+c);"using"in t?t.using.call(n,u):e.css(u)}};i.fn.extend({position:function(){if(this[0]){var n,r,t={top:0,left:0},u=this[0];return i.css(u,"position")==="fixed"?r=u.getBoundingClientRect():(n=this.offsetParent(),r=this.offset(),i.nodeName(n[0],"html")||(t=n.offset()),t.top+=i.css(n[0],"borderTopWidth",!0),t.left+=i.css(n[0],"borderLeftWidth",!0)),{top:r.top-t.top-i.css(u,"marginTop",!0),left:r.left-t.left-i.css(u,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var n=this.offsetParent||ki;n&&!i.nodeName(n,"html")&&i.css(n,"position")==="static";)n=n.offsetParent;return n||ki})}});i.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(n,r){var u=/Y/.test(r);i.fn[n]=function(f){return i.access(this,function(n,f,e){var o=sf(n);if(e===t)return o?r in o?o[r]:o.document.documentElement[f]:n[f];o?o.scrollTo(u?i(o).scrollLeft():e,u?e:i(o).scrollTop()):n[f]=e},n,f,arguments.length,null)}});i.each({Height:"height",Width:"width"},function(n,r){i.each({padding:"inner"+n,content:r,"":"outer"+n},function(u,f){i.fn[f]=function(f,e){var o=arguments.length&&(u||typeof f!="boolean"),s=u||(f===!0||e===!0?"margin":"border");return i.access(this,function(r,u,f){var e;return i.isWindow(r)?r.document.documentElement["client"+n]:r.nodeType===9?(e=r.documentElement,Math.max(r.body["scroll"+n],e["scroll"+n],r.body["offset"+n],e["offset"+n],e["client"+n])):f===t?i.css(r,u,s):i.style(r,u,f,s)},r,o?f:t,o,null)}})});i.fn.size=function(){return this.length};i.fn.andSelf=i.fn.addBack;typeof module=="object"&&module&&typeof module.exports=="object"?module.exports=i:(n.jQuery=n.$=i,typeof define=="function"&&define.amd&&define("jquery",[],function(){return i}))})(window),function(n){function f(f){var c=".smartmenus_mouse",h,s;u||f?u&&f&&(n(document).unbind(c),u=!1):(h=!0,s=null,n(document).bind(r([["mousemove",function(r){var u={x:r.pageX,y:r.pageY,timeStamp:(new Date).getTime()},e,o,f;s&&(e=Math.abs(s.x-u.x),o=Math.abs(s.y-u.y),(e>0||o>0)&&e<=2&&o<=2&&u.timeStamp-s.timeStamp<=300&&(i=!0,h&&(f=n(r.target).closest("a"),f.is("a")&&n.each(t,function(){if(n.contains(this.$root[0],f[0]))return this.itemEnter({currentTarget:f[0]}),!1}),h=!1)));s=u}],[o()?"touchstart":"pointerover pointermove pointerout MSPointerOver MSPointerMove MSPointerOut",function(n){e(n.originalEvent)&&(i=!1)}]],c)),u=!0)}function e(n){return!/^(4|mouse)$/.test(n.pointerType)}function o(){return"ontouchstart"in window}function r(t,i){i||(i="");var r={};return n.each(t,function(n,t){r[t[0].split(" ").join(i+" ")+i]=t[1]}),r}var t=[],s=!!window.createPopup,i=!1,u=!1;n.SmartMenus=function(t,i){this.$root=n(t);this.opts=i;this.rootId="";this.$subArrow=null;this.subMenus=[];this.activatedItems=[];this.visibleSubMenus=[];this.showTimeout=0;this.hideTimeout=0;this.scrollTimeout=0;this.clickActivated=!1;this.zIndexInc=0;this.$firstLink=null;this.$firstSub=null;this.disabled=!1;this.$disableOverlay=null;this.isTouchScrolling=!1;this.init()};n.extend(n.SmartMenus,{hideAll:function(){n.each(t,function(){this.menuHideAll()})},destroy:function(){while(t.length)t[0].destroy();f(!0)},prototype:{init:function(i){var e=this,u;if(i||(t.push(this),this.rootId=((new Date).getTime()+Math.random()+"").replace(/\D/g,""),this.$root.hasClass("sm-rtl")&&(this.opts.rightToLeftSubMenus=!0),u=".smartmenus",this.$root.data("smartmenus",this).attr("data-smartmenus-id",this.rootId).dataSM("level",1).bind(r([["mouseover focusin",n.proxy(this.rootOver,this)],["mouseout focusout",n.proxy(this.rootOut,this)]],u)).delegate("a",r([["mouseenter",n.proxy(this.itemEnter,this)],["mouseleave",n.proxy(this.itemLeave,this)],["mousedown",n.proxy(this.itemDown,this)],["focus",n.proxy(this.itemFocus,this)],["blur",n.proxy(this.itemBlur,this)],["click",n.proxy(this.itemClick,this)],["touchend",n.proxy(this.itemTouchEnd,this)]],u)),u+=this.rootId,this.opts.hideOnClick&&n(document).bind(r([["touchstart",n.proxy(this.docTouchStart,this)],["touchmove",n.proxy(this.docTouchMove,this)],["touchend",n.proxy(this.docTouchEnd,this)],["click",n.proxy(this.docClick,this)]],u)),n(window).bind(r([["resize orientationchange",n.proxy(this.winResize,this)]],u)),this.opts.subIndicators&&(this.$subArrow=n("<span/>").addClass("sub-arrow"),this.opts.subIndicatorsText&&this.$subArrow.html(this.opts.subIndicatorsText)),f()),this.$firstSub=this.$root.find("ul").each(function(){e.menuInit(n(this))}).eq(0),this.$firstLink=this.$root.find("a").eq(0),this.opts.markCurrentItem){var o=/(index|default)\.[^#\?\/]*/i,s=window.location.href.replace(o,""),h=s.replace(/#.*/,"");this.$root.find("a").each(function(){var t=this.href.replace(o,""),i=n(this);(t==s||t==h)&&(i.addClass("current"),e.opts.markCurrentTree&&i.parent().parentsUntil("[data-smartmenus-id]","li").children("a").addClass("current"))})}},destroy:function(){var i,r;this.menuHideAll();i=".smartmenus";this.$root.removeData("smartmenus").removeAttr("data-smartmenus-id").removeDataSM("level").unbind(i).undelegate(i);i+=this.rootId;n(document).unbind(i);n(window).unbind(i);this.opts.subIndicators&&(this.$subArrow=null);r=this;n.each(this.subMenus,function(){this.hasClass("mega-menu")&&this.find("ul").removeDataSM("in-mega");this.dataSM("shown-before")&&((r.opts.subMenusMinWidth||r.opts.subMenusMaxWidth)&&this.css({width:"",minWidth:"",maxWidth:""}).removeClass("sm-nowrap"),this.dataSM("scroll-arrows")&&this.dataSM("scroll-arrows").remove(),this.css({zIndex:"",top:"",left:"",marginLeft:"",marginTop:"",display:""}));r.opts.subIndicators&&this.dataSM("parent-a").removeClass("has-submenu").children("span.sub-arrow").remove();this.removeDataSM("shown-before").removeDataSM("ie-shim").removeDataSM("scroll-arrows").removeDataSM("parent-a").removeDataSM("level").removeDataSM("beforefirstshowfired").parent().removeDataSM("sub")});this.opts.markCurrentItem&&this.$root.find("a.current").removeClass("current");this.$root=null;this.$firstLink=null;this.$firstSub=null;this.$disableOverlay&&(this.$disableOverlay.remove(),this.$disableOverlay=null);t.splice(n.inArray(this,t),1)},disable:function(t){if(!this.disabled){if(this.menuHideAll(),!t&&!this.opts.isPopup&&this.$root.is(":visible")){var i=this.$root.offset();this.$disableOverlay=n('<div class="sm-jquery-disable-overlay"/>').css({position:"absolute",top:i.top,left:i.left,width:this.$root.outerWidth(),height:this.$root.outerHeight(),zIndex:this.getStartZIndex(!0),opacity:0}).appendTo(document.body)}this.disabled=!0}},docClick:function(t){if(this.isTouchScrolling){this.isTouchScrolling=!1;return}(this.visibleSubMenus.length&&!n.contains(this.$root[0],t.target)||n(t.target).is("a"))&&this.menuHideAll()},docTouchEnd:function(){if(this.lastTouch){if(this.visibleSubMenus.length&&(this.lastTouch.x2===undefined||this.lastTouch.x1==this.lastTouch.x2)&&(this.lastTouch.y2===undefined||this.lastTouch.y1==this.lastTouch.y2)&&(!this.lastTouch.target||!n.contains(this.$root[0],this.lastTouch.target))){this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=0);var t=this;this.hideTimeout=setTimeout(function(){t.menuHideAll()},350)}this.lastTouch=null}},docTouchMove:function(n){if(this.lastTouch){var t=n.originalEvent.touches[0];this.lastTouch.x2=t.pageX;this.lastTouch.y2=t.pageY}},docTouchStart:function(n){var t=n.originalEvent.touches[0];this.lastTouch={x1:t.pageX,y1:t.pageY,target:t.target}},enable:function(){this.disabled&&(this.$disableOverlay&&(this.$disableOverlay.remove(),this.$disableOverlay=null),this.disabled=!1)},getClosestMenu:function(t){for(var i=n(t).closest("ul");i.dataSM("in-mega");)i=i.parent().closest("ul");return i[0]||null},getHeight:function(n){return this.getOffset(n,!0)},getOffset:function(n,t){var u,i,r;return n.css("display")=="none"&&(u={position:n[0].style.position,visibility:n[0].style.visibility},n.css({position:"absolute",visibility:"hidden"}).show()),i=n[0].getBoundingClientRect&&n[0].getBoundingClientRect(),r=i&&(t?i.height||i.bottom-i.top:i.width||i.right-i.left),r||r===0||(r=t?n[0].offsetHeight:n[0].offsetWidth),u&&n.hide().css(u),r},getStartZIndex:function(n){var t=parseInt(this[n?"$root":"$firstSub"].css("z-index"));return!n&&isNaN(t)&&(t=parseInt(this.$root.css("z-index"))),isNaN(t)?1:t},getTouchPoint:function(n){return n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0]||n},getViewport:function(n){var i=n?"Height":"Width",t=document.documentElement["client"+i],r=window["inner"+i];return r&&(t=Math.min(t,r)),t},getViewportHeight:function(){return this.getViewport(!0)},getViewportWidth:function(){return this.getViewport()},getWidth:function(n){return this.getOffset(n)},handleEvents:function(){return!this.disabled&&this.isCSSOn()},handleItemEvents:function(n){return this.handleEvents()&&!this.isLinkInMegaMenu(n)},isCollapsible:function(){return this.$firstSub.css("position")=="static"},isCSSOn:function(){return this.$firstLink.css("display")=="block"},isFixed:function(){var t=this.$root.css("position")=="fixed";return t||this.$root.parentsUntil("body").each(function(){if(n(this).css("position")=="fixed")return t=!0,!1}),t},isLinkInMegaMenu:function(n){return!n.parent().parent().dataSM("level")},isTouchMode:function(){return!i||this.isCollapsible()},itemActivate:function(t){var f=t.parent(),r=f.parent(),i=r.dataSM("level"),e,u;(i>1&&(!this.activatedItems[i-2]||this.activatedItems[i-2][0]!=r.dataSM("parent-a")[0])&&(e=this,n(r.parentsUntil("[data-smartmenus-id]","ul").get().reverse()).add(r).each(function(){e.itemActivate(n(this).dataSM("parent-a"))})),this.visibleSubMenus.length>i&&this.menuHideSubMenus(!this.activatedItems[i-1]||this.activatedItems[i-1][0]!=t[0]?i-1:i),this.activatedItems[i-1]=t,this.visibleSubMenus[i-1]=r,this.$root.triggerHandler("activate.smapi",t[0])!==!1)&&(u=f.dataSM("sub"),u&&(this.isTouchMode()||!this.opts.showOnClick||this.clickActivated)&&this.menuShow(u))},itemBlur:function(t){var i=n(t.currentTarget);this.handleItemEvents(i)&&this.$root.triggerHandler("blur.smapi",i[0])},itemClick:function(t){var i,r;if(this.isTouchScrolling)return this.isTouchScrolling=!1,t.stopPropagation(),!1;if(i=n(t.currentTarget),this.handleItemEvents(i)){if(i.removeDataSM("mousedown"),this.$root.triggerHandler("click.smapi",i[0])===!1)return!1;if(r=i.parent().dataSM("sub"),this.isTouchMode()){if(i.dataSM("href")&&i.attr("href",i.dataSM("href")).removeDataSM("href"),r&&(!r.dataSM("shown-before")||!r.is(":visible"))&&(this.itemActivate(i),r.is(":visible")))return!1}else if(this.opts.showOnClick&&i.parent().parent().dataSM("level")==1&&r)return this.clickActivated=!0,this.menuShow(r),!1;return i.hasClass("disabled")?!1:this.$root.triggerHandler("select.smapi",i[0])===!1?!1:void 0}},itemDown:function(t){var i=n(t.currentTarget);this.handleItemEvents(i)&&i.dataSM("mousedown",!0)},itemEnter:function(t){var i=n(t.currentTarget),r;this.handleItemEvents(i)&&(this.isTouchMode()||(this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=0),r=this,this.showTimeout=setTimeout(function(){r.itemActivate(i)},this.opts.showOnClick&&i.parent().parent().dataSM("level")==1?1:this.opts.showTimeout)),this.$root.triggerHandler("mouseenter.smapi",i[0]))},itemFocus:function(t){var i=n(t.currentTarget);this.handleItemEvents(i)&&(this.isTouchMode()&&i.dataSM("mousedown")||this.activatedItems.length&&this.activatedItems[this.activatedItems.length-1][0]==i[0]||this.itemActivate(i),this.$root.triggerHandler("focus.smapi",i[0]))},itemLeave:function(t){var i=n(t.currentTarget);this.handleItemEvents(i)&&(this.isTouchMode()||(i[0].blur&&i[0].blur(),this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=0)),i.removeDataSM("mousedown"),this.$root.triggerHandler("mouseleave.smapi",i[0]))},itemTouchEnd:function(t){var i=n(t.currentTarget),r;this.handleItemEvents(i)&&(r=i.parent().dataSM("sub"),i.attr("href").charAt(0)==="#"||!r||r.dataSM("shown-before")&&r.is(":visible")||(i.dataSM("href",i.attr("href")),i.attr("href","#")))},menuFixLayout:function(n){n.dataSM("shown-before")||n.hide().dataSM("shown-before",!0)},menuHide:function(n){var t,i;this.$root.triggerHandler("beforehide.smapi",n[0])!==!1&&(n.stop(!0,!0),n.is(":visible")&&(t=function(){n.css("z-index","")},this.isCollapsible()?this.opts.collapsibleHideFunction?this.opts.collapsibleHideFunction.call(this,n,t):n.hide(this.opts.collapsibleHideDuration,t):this.opts.hideFunction?this.opts.hideFunction.call(this,n,t):n.hide(this.opts.hideDuration,t),n.dataSM("ie-shim")&&n.dataSM("ie-shim").remove(),n.dataSM("scroll")&&(this.menuScrollStop(n),n.css({"touch-action":"","-ms-touch-action":""}).unbind(".smartmenus_scroll").removeDataSM("scroll").dataSM("scroll-arrows").hide()),n.dataSM("parent-a").removeClass("highlighted"),i=n.dataSM("level"),this.activatedItems.splice(i-1,1),this.visibleSubMenus.splice(i-1,1),this.$root.triggerHandler("hide.smapi",n[0])))},menuHideAll:function(){this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=0);this.menuHideSubMenus();this.opts.isPopup&&(this.$root.stop(!0,!0),this.$root.is(":visible")&&(this.opts.hideFunction?this.opts.hideFunction.call(this,this.$root):this.$root.hide(this.opts.hideDuration),this.$root.dataSM("ie-shim")&&this.$root.dataSM("ie-shim").remove()));this.activatedItems=[];this.visibleSubMenus=[];this.clickActivated=!1;this.zIndexInc=0},menuHideSubMenus:function(n){n||(n=0);for(var t=this.visibleSubMenus.length-1;t>n;t--)this.menuHide(this.visibleSubMenus[t])},menuIframeShim:function(t){s&&this.opts.overlapControlsInIE&&!t.dataSM("ie-shim")&&t.dataSM("ie-shim",n("<iframe/>").attr({src:"javascript:0",tabindex:-9}).css({position:"absolute",top:"auto",left:"0",opacity:0,border:"0"}))},menuInit:function(n){if(!n.dataSM("in-mega")){this.subMenus.push(n);n.hasClass("mega-menu")&&n.find("ul").dataSM("in-mega",!0);for(var t=2,i=n[0];(i=i.parentNode.parentNode)!=this.$root[0];)t++;n.dataSM("parent-a",n.prevAll("a").eq(-1)).dataSM("level",t).parent().dataSM("sub",n);this.opts.subIndicators&&n.dataSM("parent-a").addClass("has-submenu")[this.opts.subIndicatorsPos](this.$subArrow.clone())}},menuPosition:function(t){var k=t.dataSM("parent-a"),nt=t.parent().parent(),tt=t.dataSM("level"),e=this.getWidth(t),i=this.getHeight(t),it=k.offset(),ft=it.left,et=it.top,d=this.getWidth(k),y=this.getHeight(k),rt=n(window),w=rt.scrollLeft(),l=rt.scrollTop(),ut=this.getViewportWidth(),a=this.getViewportHeight(),s=nt.hasClass("sm")&&!nt.hasClass("sm-vertical"),v=tt==2?this.opts.mainMenuSubOffsetX:this.opts.subMenusSubOffsetX,b=tt==2?this.opts.mainMenuSubOffsetY:this.opts.subMenusSubOffsetY,u,h,p,c,f,g;s?(u=this.opts.rightToLeftSubMenus?d-e-v:v,h=this.opts.bottomToTopSubMenus?-i-b:y+b):(u=this.opts.rightToLeftSubMenus?v-e:d-v,h=this.opts.bottomToTopSubMenus?y-b-i:b);this.opts.keepInViewport&&!this.isCollapsible()&&(p=ft+u,c=et+h,this.opts.rightToLeftSubMenus&&p<w?u=s?w-p+u:d-v:!this.opts.rightToLeftSubMenus&&p+e>w+ut&&(u=s?w+ut-e-p+u:v-e),s||(i<a&&c+i>l+a?h+=l+a-i-c:(i>=a||c<l)&&(h+=l-c)),(s&&(c+i>l+a+.49||c<l)||!s&&i>a+.49)&&(f=this,t.dataSM("scroll-arrows")||t.dataSM("scroll-arrows",n([n('<span class="scroll-up"><span class="scroll-up-arrow"><\/span><\/span>')[0],n('<span class="scroll-down"><span class="scroll-down-arrow"><\/span><\/span>')[0]]).bind({mouseenter:function(){t.dataSM("scroll").up=n(this).hasClass("scroll-up");f.menuScroll(t)},mouseleave:function(n){f.menuScrollStop(t);f.menuScrollOut(t,n)},"mousewheel DOMMouseScroll":function(n){n.preventDefault()}}).insertAfter(t)),g=".smartmenus_scroll",t.dataSM("scroll",{step:1,itemH:y,subH:i,arrowDownH:this.getHeight(t.dataSM("scroll-arrows").eq(1))}).bind(r([["mouseover",function(n){f.menuScrollOver(t,n)}],["mouseout",function(n){f.menuScrollOut(t,n)}],["mousewheel DOMMouseScroll",function(n){f.menuScrollMousewheel(t,n)}]],g)).dataSM("scroll-arrows").css({top:"auto",left:"0",marginLeft:u+(parseInt(t.css("border-left-width"))||0),width:e-(parseInt(t.css("border-left-width"))||0)-(parseInt(t.css("border-right-width"))||0),zIndex:t.css("z-index")}).eq(s&&this.opts.bottomToTopSubMenus?0:1).show(),this.isFixed()&&t.css({"touch-action":"none","-ms-touch-action":"none"}).bind(r([[o()?"touchstart touchmove touchend":"pointerdown pointermove pointerup MSPointerDown MSPointerMove MSPointerUp",function(n){f.menuScrollTouch(t,n)}]],g))));t.css({top:"auto",left:"0",marginLeft:u,marginTop:h-y});this.menuIframeShim(t);t.dataSM("ie-shim")&&t.dataSM("ie-shim").css({zIndex:t.css("z-index"),width:e,height:i,marginLeft:u,marginTop:h-y})},menuScroll:function(n,t,r){var u=n.dataSM("scroll"),c=n.dataSM("scroll-arrows"),e=parseFloat(n.css("margin-top")),o=u.up?u.upEnd:u.downEnd,f,h,s,l;if(!t&&u.velocity){if(u.velocity*=.9,f=u.velocity,f<.5){this.menuScrollStop(n);return}}else f=r||(t||!this.opts.scrollAccelerate?this.opts.scrollStep:Math.floor(u.step));h=n.dataSM("level");this.visibleSubMenus.length>h&&this.menuHideSubMenus(h-1);s=u.up&&o<=e||!u.up&&o>=e?e:Math.abs(o-e)>f?e+(u.up?f:-f):o;n.add(n.dataSM("ie-shim")).css("margin-top",s);i&&(u.up&&s>u.downEnd||!u.up&&s<u.upEnd)&&c.eq(u.up?1:0).show();s==o?(i&&c.eq(u.up?0:1).hide(),this.menuScrollStop(n)):t||(this.opts.scrollAccelerate&&u.step<this.opts.scrollStep&&(u.step+=.5),l=this,this.scrollTimeout=setTimeout(function(){l.menuScroll(n)},this.opts.scrollInterval))},menuScrollMousewheel:function(n,t){if(this.getClosestMenu(t.target)==n[0]){t=t.originalEvent;var i=(t.wheelDelta||-t.detail)>0;n.dataSM("scroll-arrows").eq(i?0:1).is(":visible")&&(n.dataSM("scroll").up=i,this.menuScroll(n,!0))}t.preventDefault()},menuScrollOut:function(t,r){i&&(/^scroll-(up|down)/.test((r.relatedTarget||"").className)||(t[0]==r.relatedTarget||n.contains(t[0],r.relatedTarget))&&this.getClosestMenu(r.relatedTarget)==t[0]||t.dataSM("scroll-arrows").css("visibility","hidden"))},menuScrollOver:function(n,t){if(i&&!/^scroll-(up|down)/.test(t.target.className)&&this.getClosestMenu(t.target)==n[0]){this.menuScrollRefreshData(n);var r=n.dataSM("scroll");n.dataSM("scroll-arrows").eq(0).css("margin-top",r.upEnd).end().eq(1).css("margin-top",r.downEnd+r.subH-r.arrowDownH).end().css("visibility","visible")}},menuScrollRefreshData:function(t){var i=t.dataSM("scroll"),u=n(window),r=u.scrollTop()-t.dataSM("parent-a").offset().top-i.itemH;n.extend(i,{upEnd:r,downEnd:r+this.getViewportHeight()-i.subH})},menuScrollStop:function(t){if(this.scrollTimeout)return clearTimeout(this.scrollTimeout),this.scrollTimeout=0,n.extend(t.dataSM("scroll"),{step:1,velocity:0}),!0},menuScrollTouch:function(t,i){var u,r,f;i=i.originalEvent;e(i)&&(u=this.getTouchPoint(i),this.getClosestMenu(u.target)==t[0]&&(r=t.dataSM("scroll"),/(start|down)$/i.test(i.type)?(this.menuScrollStop(t)?(i.preventDefault(),this.isTouchScrolling=!0):this.isTouchScrolling=!1,this.menuScrollRefreshData(t),n.extend(r,{touchY:u.pageY,touchTimestamp:i.timeStamp,velocity:0})):/move$/i.test(i.type)?(f=r.touchY,f!==undefined&&f!=u.pageY&&(this.isTouchScrolling=!0,n.extend(r,{up:f<u.pageY,touchY:u.pageY,touchTimestamp:i.timeStamp,velocity:r.velocity+Math.abs(u.pageY-f)*.5}),this.menuScroll(t,!0,Math.abs(r.touchY-f))),i.preventDefault()):r.touchY!==undefined&&(i.timeStamp-r.touchTimestamp<120&&r.velocity>0&&(r.velocity*=.5,this.menuScrollStop(t),this.menuScroll(t),i.preventDefault()),delete r.touchY)))},menuShow:function(n){var i,t;(n.dataSM("beforefirstshowfired")||(n.dataSM("beforefirstshowfired",!0),this.$root.triggerHandler("beforefirstshow.smapi",n[0])!==!1))&&this.$root.triggerHandler("beforeshow.smapi",n[0])!==!1&&(this.menuFixLayout(n),n.stop(!0,!0),n.is(":visible")||(n.css("z-index",this.zIndexInc=(this.zIndexInc||this.getStartZIndex())+1),(this.opts.keepHighlighted||this.isCollapsible())&&n.dataSM("parent-a").addClass("highlighted"),(this.opts.subMenusMinWidth||this.opts.subMenusMaxWidth)&&(n.css({width:"auto",minWidth:"",maxWidth:""}).addClass("sm-nowrap"),this.opts.subMenusMinWidth&&n.css("min-width",this.opts.subMenusMinWidth),this.opts.subMenusMaxWidth&&(i=this.getWidth(n),n.css("max-width",this.opts.subMenusMaxWidth),i>this.getWidth(n)&&n.removeClass("sm-nowrap").css("width",this.opts.subMenusMaxWidth))),this.menuPosition(n),n.dataSM("ie-shim")&&n.dataSM("ie-shim").insertBefore(n),t=function(){n.css("overflow","")},this.isCollapsible()?this.opts.collapsibleShowFunction?this.opts.collapsibleShowFunction.call(this,n,t):n.show(this.opts.collapsibleShowDuration,t):this.opts.showFunction?this.opts.showFunction.call(this,n,t):n.show(this.opts.showDuration,t),this.visibleSubMenus[n.dataSM("level")-1]=n,this.$root.triggerHandler("show.smapi",n[0])))},popupHide:function(n){this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=0);var t=this;this.hideTimeout=setTimeout(function(){t.menuHideAll()},n?1:this.opts.hideTimeout)},popupShow:function(n,t){if(!this.opts.isPopup){alert('SmartMenus jQuery Error:\n\nIf you want to show this menu via the "popupShow" method, set the isPopup:true option.');return}if(this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=0),this.menuFixLayout(this.$root),this.$root.stop(!0,!0),!this.$root.is(":visible")){this.$root.css({left:n,top:t});this.menuIframeShim(this.$root);this.$root.dataSM("ie-shim")&&this.$root.dataSM("ie-shim").css({zIndex:this.$root.css("z-index"),width:this.getWidth(this.$root),height:this.getHeight(this.$root),left:n,top:t}).insertBefore(this.$root);var r=this,i=function(){r.$root.css("overflow","")};this.opts.showFunction?this.opts.showFunction.call(this,this.$root,i):this.$root.show(this.opts.showDuration,i);this.visibleSubMenus[0]=this.$root}},refresh:function(){this.menuHideAll();this.$root.find("ul").each(function(){var t=n(this);t.dataSM("scroll-arrows")&&t.dataSM("scroll-arrows").remove()}).removeDataSM("in-mega").removeDataSM("shown-before").removeDataSM("ie-shim").removeDataSM("scroll-arrows").removeDataSM("parent-a").removeDataSM("level").removeDataSM("beforefirstshowfired");this.$root.find("a.has-submenu").removeClass("has-submenu").parent().removeDataSM("sub");this.opts.subIndicators&&this.$root.find("span.sub-arrow").remove();this.opts.markCurrentItem&&this.$root.find("a.current").removeClass("current");this.subMenus=[];this.init(!0)},rootOut:function(n){if(this.handleEvents()&&!this.isTouchMode()&&n.target!=this.$root[0]&&(this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=0),!this.opts.showOnClick||!this.opts.hideOnClick)){var t=this;this.hideTimeout=setTimeout(function(){t.menuHideAll()},this.opts.hideTimeout)}},rootOver:function(n){this.handleEvents()&&!this.isTouchMode()&&n.target!=this.$root[0]&&this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=0)},winResize:function(n){if(!this.handleEvents()){if(this.$disableOverlay){var t=this.$root.offset();this.$disableOverlay.css({top:t.top,left:t.left,width:this.$root.outerWidth(),height:this.$root.outerHeight()})}return}this.isCollapsible()||"onorientationchange"in window&&n.type!="orientationchange"||(this.activatedItems.length&&this.activatedItems[this.activatedItems.length-1][0].blur(),this.menuHideAll())}}});n.fn.dataSM=function(n,t){return t?this.data(n+"_smartmenus",t):this.data(n+"_smartmenus")};n.fn.removeDataSM=function(n){return this.removeData(n+"_smartmenus")};n.fn.smartmenus=function(t){var i,r,u;return typeof t=="string"?(i=arguments,r=t,Array.prototype.shift.call(i),this.each(function(){var t=n(this).data("smartmenus");t&&t[r]&&t[r].apply(t,i)})):(u=n.extend({},n.fn.smartmenus.defaults,t),this.each(function(){new n.SmartMenus(this,u)}))};n.fn.smartmenus.defaults={isPopup:!1,mainMenuSubOffsetX:0,mainMenuSubOffsetY:0,subMenusSubOffsetX:0,subMenusSubOffsetY:0,subMenusMinWidth:"10em",subMenusMaxWidth:"20em",subIndicators:!0,subIndicatorsPos:"prepend",subIndicatorsText:"+",scrollStep:30,scrollInterval:30,scrollAccelerate:!0,showTimeout:250,hideTimeout:500,showDuration:0,showFunction:null,hideDuration:0,hideFunction:function(n,t){n.fadeOut(200,t)},collapsibleShowDuration:0,collapsibleShowFunction:function(n,t){n.slideDown(200,t)},collapsibleHideDuration:0,collapsibleHideFunction:function(n,t){n.slideUp(200,t)},showOnClick:!1,hideOnClick:!0,keepInViewport:!0,keepHighlighted:!0,markCurrentItem:!1,markCurrentTree:!0,rightToLeftSubMenus:!1,bottomToTopSubMenus:!1,overlapControlsInIE:!0}}(jQuery),function(n){function r(n){return!isNaN(parseFloat(n))}function t(){for(var n=0;n<arguments.length;n++)if(r(arguments[n]))return Number(parseFloat(arguments[n]));return}function i(t,i){var f=n(i||this).attr("class"),r=new RegExp("(\\b"+t+")(\\S*)").exec(f),u={"true":!0,True:!0,"false":!1,False:!1};return r&&r.length>=3&&u[r[3]]!==undefined&&(r[3]=u[r[3]]),r?r.length>=3?r[2]:null:undefined}n.fn.spinbox=function(u){if(u&&typeof u=="String"&&u==="destroy")return this.unbind(".spinbox").removeClass(u.spinboxClass).removeClass(u.upClass).removeClass(u.downClass).removeClass(u.upHoverClass).removeClass(u.downHoverClass).removeData("spinboxMin").removeData("spinboxMax").removeData("spinboxReset").removeData("spinboxStep").removeData("spinboxBigStep");var f;return u=n.extend({},n.fn.spinbox.defaults,u),this.each(function(){var e=n(this),s=i("spinboxMin",this),h=i("spinboxMax",this),c=i("spinboxStep",this),l=i("spinboxBigStep",this),a=i("spinboxReset",this),o=i("spinboxScale",this);s===f&&(s=t(e.attr("min"),u.min));h===f&&(h=t(e.attr("max"),u.max));c||(c=t(e.attr("step"),u.step));l||(l=t(e.attr("bigStep"),u.bigStep));a===f&&(a=t(u.reset,e.val(),s,h));o===f&&(o=e.data("spinboxScale"));o=o||r(o)?o:u.scale;o===!0&&(o=(c.toString().split(".")[1]||"").length);e.data("spinboxMin",s);e.data("spinboxMax",h);e.data("spinboxStep",c);e.data("spinboxBigStep",l);e.data("spinboxReset",a);e.data("spinboxScale",o)}),this.each(function(){function i(i,e,o){var s=n(this);if(!u.ignore||!s.is(u.ignore)){e=t(e,s.data("spinboxStep"),1);o=o||(f?-1:1);var l=s.val(),h=t(l,s.data("spinboxReset"),0),a=t(s.data("spinboxMin")),v=t(s.data("spinboxMax")),c=[h,e,a,v,o,l,u];o>0?h=u.increment.apply(this,c):o<0&&(h=u.decrement.apply(this,c));r(s.data("spinboxScale"))&&u.round&&(h=u.round(h,s.data("spinboxScale")));r(a)&&(h=Math.max(h,a));r(v)&&(h=Math.min(h,v));c=[h,e,a,v,o,l,u];h!=l&&s.triggerHandler("beforeSpin",c)!==!1&&(s.val(h),u.change&&s.trigger("change",c),s.triggerHandler("spin",c))}}function l(t,r){o(t);u.preAutoValue=n(t).val();u.isCurrentlyAutorepeating=!0;s=window.setTimeout(function(){i.apply(t,[r]);h=window.setInterval(function(){i.apply(t,[r])},u.repeat)},u.delay)}function o(t){window.clearTimeout(s);window.clearInterval(h);var i=n(t).val();u.isCurrentlyAutorepeating&&u.preAutoValue!=i&&c.trigger("change");u.isCurrentlyAutorepeating=!1}var e,f,s,h,c=n(this);c.bind("mousemove.spinbox",function(t){var i=n(this),r=i.offset(),o=i.height()/2,s=t.pageX>r.left+i.width()-u.buttonWidth;e=s&&t.pageY<=r.top+o;f=s&&t.pageY>r.top+o;i.toggleClass(u.upHoverClass,e).toggleClass(u.downHoverClass,f)}).bind("mouseout.spinbox",function(){u.mouseDown=!1;o(this);n(this).removeClass([u.upClass,u.downClass,u.upHoverClass,u.downHoverClass].join(" "));e=f=null}).bind("mousedown.spinbox",function(t){u.mouseDown=!0;(e||f)&&(n(this).toggleClass(u.upClass,e).toggleClass(u.downClass,f),l(this,t),i.apply(this,[t]))}).bind("mouseup.spinbox",function(){u.mouseDown=!1;o(this);n(this).removeClass(u.upClass).removeClass(u.downClass)}).bind("keydown.spinbox",function(t){if(!u.keys||n.grep(u.keys,function(n){return n===t.keyCode||n instanceof RegExp&&n.test(String.fromCharCode(t.keyCode))}).length){var e=n(this),r={up:38,down:40,pageUp:33,pageDown:34},f=e.data("spinboxBigStep"),o=t.shiftKey?f:e.data("spinboxStep");switch(t.keyCode){case r.up:i.apply(this,[t,o,1]);break;case r.down:i.apply(this,[t,o,-1]);break;case r.pageUp:i.apply(this,[t,f,1]);break;case r.pageDown:i.apply(this,[t,f,-1])}}else return!0}).bind("change.spinbox",function(n){i.apply(this,[n,0])}).addClass(u.spinboxClass);u.mousewheel&&n(this).bind("mousewheel.spinbox DOMMouseScroll.spinbox",function(t){var r=t.shiftKey?n(this).data("spinboxBigStep"):n(this).data("spinboxStep");return t.detail<0||t.wheelDelta>=120?i.apply(this,[t,r,1]):(t.detail>0||t.wheelDelta<=-120)&&i.apply(this,[t,r,-1]),!1});i.apply(this,[n.Event(),0])})};n.fn.spinbox.defaults={min:0,max:null,step:1,bigStep:10,keys:[/[0-9]/,9,13,8,46,33,34,37,38,39,40,109,188,190],ignore:"[readonly],[disabled]",spinboxClass:"spinbox-active",upClass:"spinbox-up",downClass:"spinbox-down",upHoverClass:"spinbox-up-hover",downHoverClass:"spinbox-down-hover",mousewheel:!1,change:!0,increment:function(n,t){return n+t},decrement:function(n,t){return n-t},reset:null,delay:500,repeat:100,buttonWidth:20,scale:!0,round:function(n,t){return Math.round(n*Math.pow(10,t))/Math.pow(10,t)}}}(jQuery);jQuery&&function(n){function p(t,i){var r=n('<span class="cooltext-setting cooltext-color minicolors" />'),u=n.minicolors.defaultSettings;t.data("minicolors-initialized")||(i=n.extend(!0,{},u,i),r.addClass("minicolors-theme-"+i.theme).addClass("minicolors-swatch-position-"+i.swatchPosition).toggleClass("minicolors-swatch-left",i.swatchPosition==="left").toggleClass("minicolors-with-opacity",i.opacity),i.position!==undefined&&n.each(i.position.split(" "),function(){r.addClass("minicolors-position-"+this)}),t.addClass("minicolors-input").data("minicolors-initialized",!0).data("minicolors-settings",i).prop("size",7).prop("maxlength",7).wrap(r).after('<span class="minicolors-panel minicolors-slider-'+i.control+'"><span class="minicolors-slider"><span class="minicolors-picker"><\/span><\/span><span class="minicolors-opacity-slider"><span class="minicolors-picker"><\/span><\/span><span class="minicolors-grid"><span class="minicolors-grid-inner"><\/span><span class="minicolors-picker"><span><\/span><\/span><\/span><span class="minicolors-recently-used-panel"><span class="minicolors-recently-used-swatch" id="recentlyUsedColors0"><span><\/span><\/span><span class="minicolors-recently-used-swatch" id="recentlyUsedColors1"><span><\/span><\/span><span class="minicolors-recently-used-swatch" id="recentlyUsedColors2"><span><\/span><\/span><span class="minicolors-recently-used-swatch" id="recentlyUsedColors3"><span><\/span><\/span><span class="minicolors-recently-used-swatch" id="recentlyUsedColors4"><span><\/span><\/span><span class="minicolors-recently-used-swatch" id="recentlyUsedColors5"><span><\/span><\/span><span class="minicolors-recently-used-swatch" id="recentlyUsedColors6"><span><\/span><\/span><\/span><\/span>'),t.parent().find(".minicolors-panel").on("selectstart",function(){return!1}).end(),i.swatchPosition==="left"?t.before('<span class="minicolors-swatch"><span><\/span><\/span>'):t.after('<span class="minicolors-swatch"><span><\/span><\/span>'),i.textfield||t.addClass("minicolors-hidden"),i.inline&&t.parent().addClass("minicolors-inline"),f(t,!1,!0),it())}function h(n){var t=n.parent();n.removeData("minicolors-initialized").removeData("minicolors-settings").removeProp("size").prop("maxlength",null).removeClass("minicolors-input");t.before(n).remove()}function c(n){f(n)}function o(n){var t=n.parent(),u=t.find(".minicolors-panel"),i=n.data("minicolors-settings");(tt(t),n.data("show-color",n.val()),!n.data("minicolors-initialized")||n.prop("disabled")||t.hasClass("minicolors-inline")||t.hasClass("minicolors-focus"))||(r(),t.addClass("minicolors-focus"),u.stop(!0,!0).fadeIn(i.showSpeed,function(){i.show&&i.show.call(n.get(0))}))}function r(){n(".minicolors-input").each(function(){var i=n(this),t=i.data("minicolors-settings"),r=i.parent();t.inline||r.find(".minicolors-panel").fadeOut(t.hideSpeed,function(){r.hasClass("minicolors-focus")&&t.hide&&t.hide.call(i.get(0));r.removeClass("minicolors-focus")})})}function l(n,t,i){var s=n.parents(".minicolors").find(".minicolors-input"),h=s.data("minicolors-settings"),c=n.find("[class$=-picker]"),v=n.offset().left,y=n.offset().top,u=Math.round(t.pageX-v),r=Math.round(t.pageY-y),p=i?h.animationSpeed:0,e,o,l,f;t.originalEvent.changedTouches&&(u=t.originalEvent.changedTouches[0].pageX-v,r=t.originalEvent.changedTouches[0].pageY-y);u<0&&(u=0);r<0&&(r=0);u>n.width()&&(u=n.width());r>n.height()&&(r=n.height());n.parent().is(".minicolors-slider-wheel")&&c.parent().is(".minicolors-grid")&&(e=75-u,o=75-r,l=Math.sqrt(e*e+o*o),f=Math.atan2(o,e),f<0&&(f+=Math.PI*2),l>75&&(l=75,u=75-75*Math.cos(f),r=75-75*Math.sin(f)),u=Math.round(u),r=Math.round(r));n.is(".minicolors-grid")?c.stop(!0).animate({top:r+"px",left:u+"px"},p,h.animationEasing,function(){a(s,n)}):c.stop(!0).animate({top:r+"px"},p,h.animationEasing,function(){a(s,n)})}function a(n,r){function nt(n,t){var i,r;return!n.length||!t?null:(i=n.offset().left,r=n.offset().top,{x:i-t.offset().left+n.outerWidth()/2,y:r-t.offset().top+n.outerHeight()/2})}var u,f,s,p,w,b,y,l=n.val(),k=n.attr("data-opacity"),a=n.parent(),d=n.data("minicolors-settings"),ot=a.find(".minicolors-panel"),it=a.find(".minicolors-swatch"),o=a.find(".minicolors-grid"),c=a.find(".minicolors-slider"),tt=a.find(".minicolors-opacity-slider"),rt=o.find("[class$=-picker]"),ut=c.find("[class$=-picker]"),ft=tt.find("[class$=-picker]"),h=nt(rt,o),g=nt(ut,c),et=nt(ft,tt);if(r.is(".minicolors-grid, .minicolors-slider")){switch(d.control){case"wheel":p=o.width()/2-h.x;w=o.height()/2-h.y;b=Math.sqrt(p*p+w*w);y=Math.atan2(w,p);y<0&&(y+=Math.PI*2);b>75&&(b=75,h.x=69-75*Math.cos(y),h.y=69-75*Math.sin(y));f=t(b/.75,0,100);u=t(y*180/Math.PI,0,360);s=t(100-Math.floor(g.y*(100/c.height())),0,100);l=i({h:u,s:f,b:s});c.css("backgroundColor",i({h:u,s:f,b:100}));break;case"saturation":u=t(parseInt(h.x*(360/o.width())),0,360);f=t(100-Math.floor(g.y*(100/c.height())),0,100);s=t(100-Math.floor(h.y*(100/o.height())),0,100);l=i({h:u,s:f,b:s});c.css("backgroundColor",i({h:u,s:100,b:s}));a.find(".minicolors-grid-inner").css("opacity",f/100);break;case"brightness":u=t(parseInt(h.x*(360/o.width())),0,360);f=t(100-Math.floor(h.y*(100/o.height())),0,100);s=t(100-Math.floor(g.y*(100/c.height())),0,100);l=i({h:u,s:f,b:s});c.css("backgroundColor",i({h:u,s:f,b:100}));a.find(".minicolors-grid-inner").css("opacity",1-s/100);break;default:u=t(360-parseInt(g.y*(360/c.height())),0,360);f=t(Math.floor(h.x*(100/o.width())),0,100);s=t(100-Math.floor(h.y*(100/o.height())),0,100);l=i({h:u,s:f,b:s});o.css("backgroundColor",i({h:u,s:100,b:100}))}n.val(e(l,d.letterCase))}r.is(".minicolors-opacity-slider")&&(k=d.opacity?parseFloat(1-et.y/tt.height()).toFixed(2):1,d.opacity&&n.attr("data-opacity",k));it.find("SPAN").css({backgroundColor:l,opacity:k});v(n,l,k)}function f(n,r,f){var l,o,y,a,s,nt,tt,p=n.parent(),w=n.data("minicolors-settings"),it=p.find(".minicolors-swatch"),h=p.find(".minicolors-grid"),c=p.find(".minicolors-slider"),b=p.find(".minicolors-opacity-slider"),k=h.find("[class$=-picker]"),d=c.find("[class$=-picker]"),rt=b.find("[class$=-picker]");l=e(u(n.val(),!0),w.letterCase);l||(l=e(u(w.defaultValue,!0)));o=g(l);r||n.val(l);w.opacity&&(y=n.attr("data-opacity")===""?1:t(parseFloat(n.attr("data-opacity")).toFixed(2),0,1),isNaN(y)&&(y=1),n.attr("data-opacity",y),it.find("SPAN").css("opacity",y),s=t(b.height()-b.height()*y,0,b.height()),rt.css("top",s+"px"));it.find("SPAN").css("backgroundColor",l);switch(w.control){case"wheel":nt=t(Math.ceil(o.s*.75),0,h.height()/2);tt=o.h*Math.PI/180;a=t(75-Math.cos(tt)*nt,0,h.width());s=t(75-Math.sin(tt)*nt,0,h.height());k.css({top:s+"px",left:a+"px"});s=150-o.b/(100/h.height());l===""&&(s=0);d.css("top",s+"px");c.css("backgroundColor",i({h:o.h,s:o.s,b:100}));break;case"saturation":a=t(5*o.h/12,0,150);s=t(h.height()-Math.ceil(o.b/(100/h.height())),0,h.height());k.css({top:s+"px",left:a+"px"});s=t(c.height()-o.s*(c.height()/100),0,c.height());d.css("top",s+"px");c.css("backgroundColor",i({h:o.h,s:100,b:o.b}));p.find(".minicolors-grid-inner").css("opacity",o.s/100);break;case"brightness":a=t(5*o.h/12,0,150);s=t(h.height()-Math.ceil(o.s/(100/h.height())),0,h.height());k.css({top:s+"px",left:a+"px"});s=t(c.height()-o.b*(c.height()/100),0,c.height());d.css("top",s+"px");c.css("backgroundColor",i({h:o.h,s:o.s,b:100}));p.find(".minicolors-grid-inner").css("opacity",1-o.b/100);break;default:a=t(Math.ceil(o.s/(100/h.width())),0,h.width());s=t(h.height()-Math.ceil(o.b/(100/h.height())),0,h.height());k.css({top:s+"px",left:a+"px"});s=t(c.height()-o.h/(360/c.height()),0,c.height());d.css("top",s+"px");h.css("backgroundColor",i({h:o.h,s:100,b:100}))}f||v(n,l,y)}function v(n,t,i){var r=n.data("minicolors-settings");t+i!==n.data("minicolors-lastChange")&&(n.data("minicolors-lastChange",t+i),r.change&&(r.changeDelay?(clearTimeout(n.data("minicolors-changeTimeout")),n.data("minicolors-changeTimeout",setTimeout(function(){r.change.call(n.get(0),t,i)},r.changeDelay))):r.change.call(n.get(0),t,i)))}function w(t){var f=u(n(t).val(),!0),i=s(f),r=n(t).attr("data-opacity");return i?(r!==undefined&&n.extend(i,{a:parseFloat(r)}),i):null}function b(t,i){var e=u(n(t).val(),!0),r=s(e),f=n(t).attr("data-opacity");return r?(f===undefined&&(f=1),i?"rgba("+r.r+", "+r.g+", "+r.b+", "+parseFloat(f)+")":"rgb("+r.r+", "+r.g+", "+r.b+")"):null}function e(n,t){return t==="uppercase"?n.toUpperCase():n.toLowerCase()}function u(n,t){return(n=n.replace(/[^A-F0-9]/ig,""),n.length!==3&&n.length!==6)?"":(n.length===3&&t&&(n=n[0]+n[0]+n[1]+n[1]+n[2]+n[2]),"#"+n)}function t(n,t,i){return n<t&&(n=t),n>i&&(n=i),n}function k(n){var t={},u=Math.round(n.h),o=Math.round(n.s*255/100),e=Math.round(n.b*255/100);if(o===0)t.r=t.g=t.b=e;else{var i=e,r=(255-o)*e/255,f=(i-r)*(u%60)/60;u===360&&(u=0);u<60?(t.r=i,t.b=r,t.g=r+f):u<120?(t.g=i,t.b=r,t.r=i-f):u<180?(t.g=i,t.r=r,t.b=r+f):u<240?(t.b=i,t.r=r,t.g=i-f):u<300?(t.b=i,t.g=r,t.r=r+f):u<360?(t.r=i,t.g=r,t.b=i-f):(t.r=0,t.g=0,t.b=0)}return{r:Math.round(t.r),g:Math.round(t.g),b:Math.round(t.b)}}function d(t){var i=[t.r.toString(16),t.g.toString(16),t.b.toString(16)];return n.each(i,function(n,t){t.length===1&&(i[n]="0"+t)}),"#"+i.join("")}function i(n){return d(k(n))}function g(n){var t=nt(s(n));return t.s===0&&(t.h=360),t}function nt(n){var t={h:0,s:0,b:0},u=Math.min(n.r,n.g,n.b),i=Math.max(n.r,n.g,n.b),r=i-u;return t.b=i,t.s=i!==0?255*r/i:0,t.h=t.s!==0?n.r===i?(n.g-n.b)/r:n.g===i?2+(n.b-n.r)/r:4+(n.r-n.g)/r:-1,t.h*=60,t.h<0&&(t.h+=360),t.s*=100/255,t.b*=100/255,t}function s(n){return n=parseInt(n.indexOf("#")>-1?n.substring(1):n,16),{r:n>>16,g:(n&65280)>>8,b:n&255}}function y(n){var i,t;if(typeof Storage!="undefined"&&localStorage){for(i=localStorage.recentlyUsedColors.split(","),t=6;t>=0;t--)if(i[t]==n)return;for(t=6;t>0;t--)i[t]=i[t-1];i[0]=n;localStorage.recentlyUsedColors=i}}function tt(n){var i,t,r;if(typeof Storage!="undefined"&&localStorage)for(i=localStorage.recentlyUsedColors.split(","),t=0;t<=6;t++)r=i[t],n.find("#recentlyUsedColors"+t).find("SPAN").css("backgroundColor",r)}function it(){typeof Storage!="undefined"&&localStorage&&localStorage.recentlyUsedColors==undefined&&(localStorage.recentlyUsedColors=["#FC0F3E","#F9A148","#85DB30","#1F95EF","#CABEDD","#594C47","#002F47"])}n.minicolors={defaultSettings:{animationSpeed:100,animationEasing:"swing",changeDelay:2,control:"hue",defaultValue:"",hide:null,hideSpeed:100,inline:!1,letterCase:"uppercase",opacity:!1,position:"default",show:null,showSpeed:100,swatchPosition:"left",textfield:!0,theme:"default"}};n.extend(n.fn,{minicolors:function(t,i){switch(t){case"destroy":return n(this).each(function(){h(n(this))}),n(this);case"hide":return r(),n(this);case"opacity":return i===undefined?n(this).attr("data-opacity"):(n(this).each(function(){c(n(this).attr("data-opacity",i))}),n(this));case"rgbObject":return w(n(this),t==="rgbaObject");case"rgbString":case"rgbaString":return b(n(this),t==="rgbaString");case"settings":return i===undefined?n(this).data("minicolors-settings"):(n(this).each(function(){var t=n(this).data("minicolors-settings")||{};h(n(this));n(this).minicolors(n.extend(!0,t,i))}),n(this));case"show":return o(n(this).eq(0)),n(this);case"value":return i===undefined?n(this).val():(n(this).each(function(){c(n(this).val(i))}),n(this));case"create":default:return t!=="create"&&(i=t),n(this).each(function(){p(n(this),i)}),n(this)}}});n(document).on("mousedown.minicolors touchstart.minicolors",function(t){n(t.target).parents().add(t.target).hasClass("minicolors")||r()}).on("mousedown.minicolors touchstart.minicolors",".minicolors-grid, .minicolors-slider, .minicolors-opacity-slider",function(t){var i=n(this);t.preventDefault();n(document).data("minicolors-target",i);l(i,t,!0)}).on("mousemove.minicolors touchmove.minicolors",function(t){var i=n(document).data("minicolors-target");i&&l(i,t)}).on("mouseup.minicolors touchend.minicolors",function(){n(this).removeData("minicolors-target")}).on("mousedown.minicolors touchstart.minicolors",".minicolors-swatch",function(t){t.preventDefault();var i=n(this).parent().find(".minicolors-input"),u=i.parent();u.hasClass("minicolors-focus")?r(i):o(i)}).on("mousedown.minicolors touchstart.minicolors",".minicolors-recently-used-swatch",function(t){if(typeof Storage!="undefined"&&localStorage){var i=n(this).parent().parent().parent().find(".minicolors-input"),u=localStorage.recentlyUsedColors.split(","),e=u[t.target.parentNode.id[t.target.parentNode.id.length-1]];i.val(e);f(i,!0)}r()}).on("focus.minicolors",".minicolors-input",function(){var t=n(this);t.data("minicolors-initialized")&&o(t)}).on("blur.minicolors",".minicolors-input",function(){var t=n(this),i=t.data("minicolors-settings");t.data("minicolors-initialized")&&(t.val(u(t.val(),!0)),t.val()===""&&t.val(u(i.defaultValue,!0)),t.val(e(t.val(),i.letterCase)),t.data("show-color")!=t.val()&&y(t.val()))}).on("keydown.minicolors",".minicolors-input",function(t){var i=n(this);if(i.data("minicolors-initialized"))switch(t.keyCode){case 9:r();break;case 13:case 27:r();i.blur()}}).on("keyup.minicolors",".minicolors-input",function(){var t=n(this);t.data("minicolors-initialized")&&f(t,!0)}).on("paste.minicolors",".minicolors-input",function(){var t=n(this);t.data("minicolors-initialized")&&(setTimeout(function(){f(t,!0)},1),t.data("show-color")!=t.val()&&y(t.val()))})}(jQuery),function(n){function i(n,t){var r=n.data("ddslick"),e=n.find(".dd-selected"),h=e.siblings(".dd-selected-value"),l=n.find(".dd-options"),a=e.siblings(".dd-pointer"),s=n.find(".dd-option").eq(t),c=s.closest("li"),f=r.settings,i=r.settings.data[t];n.find(".dd-option").removeClass("dd-option-selected");s.addClass("dd-option-selected");r.selectedIndex=t;r.selectedItem=c;r.selectedData=i;f.showSelectedHTML?e.html((i.imageSrc?'<img class="dd-selected-image'+(f.imagePosition=="right"?" dd-image-right":"")+'" src="'+i.imageSrc+'" />':"")+(i.text?'<label class="dd-selected-text">'+i.text+"<\/label>":"")+(i.description?'<small class="dd-selected-description dd-desc'+(f.truncateDescription?" dd-selected-description-truncated":"")+'" >'+i.description+"<\/small>":"")):e.html(i.text);h.val(i.value);r.original.val(i.value);n.data("ddslick",r);u(n);o(n);typeof f.onSelected=="function"&&f.onSelected.call(this,r)}function r(t){var r=t.find(".dd-select"),i=r.siblings(".dd-options"),u=r.find(".dd-pointer"),f=i.is(":visible");n(".dd-click-off-close").not(i).slideUp(50);n(".dd-pointer").removeClass("dd-pointer-up");f?(i.slideUp("fast"),u.removeClass("dd-pointer-up")):(i.slideDown("fast"),u.addClass("dd-pointer-up"));s(t)}function u(n){n.find(".dd-options").slideUp(50);n.find(".dd-pointer").removeClass("dd-pointer-up").removeClass("dd-pointer-up")}function o(n){var t=n.find(".dd-select").css("height"),i=n.find(".dd-selected-description"),r=n.find(".dd-selected-image");i.length<=0&&r.length>0&&n.find(".dd-selected-text").css("lineHeight",t)}function s(t){t.find(".dd-option").each(function(){var i=n(this),f=i.css("height"),r=i.find(".dd-option-description"),u=t.find(".dd-option-image");r.length<=0&&u.length>0&&i.find(".dd-option-text").css("lineHeight","30px")})}n.fn.ddslick=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exists.");else return t.init.apply(this,arguments)};var t={},f={data:[],keepJSONItemsOnTop:!1,width:200,height:null,background:"#eee",selectText:"",defaultSelectedIndex:null,truncateDescription:!0,imagePosition:"left",showSelectedHTML:!0,clickOffToClose:!0,onSelected:function(){},sourceId:null},e='<div class="dd-select"><input class="dd-selected-value" type="hidden" name="';ddSelectHtml2='" /><a class="dd-selected"><\/a><span class="dd-pointer dd-pointer-down"><\/span><\/div>';ddOptionsHtml='<ul class="dd-options"><\/ul>';t.init=function(t){var t=n.extend({},f,t);return this.each(function(){var u=n(this),a=u.data("ddslick"),v,h,s,f,o,c,l;if(!a){f=[];v=t.data;u.find("option").each(function(){var t=n(this),i=t.data();f.push({text:n.trim(t.text()),value:t.val(),selected:t.is(":selected"),description:i.description,imageSrc:i.imagesrc})});t.keepJSONItemsOnTop?n.merge(t.data,f):t.data=n.merge(f,t.data);h=u;s=n('<div id="'+u.attr("id")+'"><\/div>');u.replaceWith(s);u=s;u.addClass("dd-container").append(e+u.attr("id")+ddSelectHtml2).append(ddOptionsHtml);f=u.find(".dd-select");o=u.find(".dd-options");o.css({width:t.width});f.css({width:t.width});u.css({width:t.width});t.height!=null&&o.css({height:t.height,overflow:"auto"});n.each(t.data,function(n,i){i.selected&&(t.defaultSelectedIndex=n);o.append('<li><a class="dd-option">'+(i.value?' <input class="dd-option-value" type="hidden" value="'+i.value+'" />':"")+(i.imageSrc?' <img class="dd-option-image'+(t.imagePosition=="right"?" dd-image-right":"")+'" src="'+i.imageSrc+'" />':"")+(i.text?' <label class="dd-option-text">'+i.text+"<\/label>":"")+(i.description?' <small class="dd-option-description dd-desc">'+i.description+"<\/small>":"")+"<\/a><\/li>")});c={settings:t,original:h,selectedIndex:-1,selectedItem:null,selectedData:null};u.data("ddslick",c);t.selectText.length>0&&t.defaultSelectedIndex==null?u.find(".dd-selected").html(t.selectText):(l=t.defaultSelectedIndex!=null&&t.defaultSelectedIndex>=0&&t.defaultSelectedIndex<t.data.length?t.defaultSelectedIndex:0,i(u,l));u.find(".dd-select").on("click.ddslick",function(){r(u)});u.find(".dd-option").on("click.ddslick",function(){i(u,n(this).closest("li").index())});if(t.clickOffToClose){o.addClass("dd-click-off-close");u.on("click.ddslick",function(n){n.stopPropagation()});n("body").on("click",function(){n(".dd-click-off-close").slideUp(50).siblings(".dd-select").find(".dd-pointer").removeClass("dd-pointer-up")})}}})};t.select=function(t){return this.each(function(){t.index&&i(n(this),t.index)})};t.open=function(){return this.each(function(){var t=n(this),i=t.data("ddslick");i&&r(t)})};t.close=function(){return this.each(function(){var t=n(this),i=t.data("ddslick");i&&u(t)})};t.destroy=function(){return this.each(function(){var t=n(this),i=t.data("ddslick"),r;i&&(r=i.original,t.removeData("ddslick").unbind(".ddslick").replaceWith(r))})}}(jQuery);fabric=fabric||{version:"1.4.11"};typeof exports!="undefined"&&(exports.fabric=fabric);typeof document!="undefined"&&typeof window!="undefined"?(fabric.document=document,fabric.window=window):(fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head><\/head><body><\/body><\/html>"),fabric.window=fabric.document.createWindow());fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement;fabric.isLikelyNode=typeof Buffer!="undefined"&&typeof window=="undefined";fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width"];fabric.DPI=96,function(){function n(n,t){this.__eventListeners[n]&&(t?fabric.util.removeFromArray(this.__eventListeners[n],t):this.__eventListeners[n].length=0)}function t(n,t){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var i in n)this.on(i,n[i]);else this.__eventListeners[n]||(this.__eventListeners[n]=[]),this.__eventListeners[n].push(t);return this}function i(t,i){if(this.__eventListeners){if(arguments.length===0)this.__eventListeners={};else if(arguments.length===1&&typeof arguments[0]=="object")for(var r in t)n.call(this,r,t[r]);else n.call(this,t,i);return this}}function r(n,t){var i,r,u;if(this.__eventListeners&&(i=this.__eventListeners[n],i)){for(r=0,u=i.length;r<u;r++)i[r].call(this,t||{});return this}}fabric.Observable={observe:t,stopObserving:i,fire:r,on:t,off:i,trigger:r}}();fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var n=0,t=arguments.length;n<t;n++)this._onObjectAdded(arguments[n]);return this.renderOnAddRemove&&this.renderAll(),this},insertAt:function(n,t,i){var r=this.getObjects();return i?r[t]=n:r.splice(t,0,n),this._onObjectAdded(n),this.renderOnAddRemove&&this.renderAll(),this},remove:function(){for(var i=this.getObjects(),t,n=0,r=arguments.length;n<r;n++)t=i.indexOf(arguments[n]),t!==-1&&(i.splice(t,1),this._onObjectRemoved(arguments[n]));return this.renderOnAddRemove&&this.renderAll(),this},forEachObject:function(n,t){for(var i=this.getObjects(),r=i.length;r--;)n.call(t,i[r],r,i);return this},getObjects:function(n){return typeof n=="undefined"?this._objects:this._objects.filter(function(t){return t.type===n})},item:function(n){return this.getObjects()[n]},isEmpty:function(){return this.getObjects().length===0},size:function(){return this.getObjects().length},contains:function(n){return this.getObjects().indexOf(n)>-1},complexity:function(){return this.getObjects().reduce(function(n,t){return n+(t.complexity?t.complexity():0)},0)}},function(n){var i=Math.sqrt,r=Math.atan2,t=Math.PI/180;fabric.util={removeFromArray:function(n,t){var i=n.indexOf(t);return i!==-1&&n.splice(i,1),n},getRandomInt:function(n,t){return Math.floor(Math.random()*(t-n+1))+n},degreesToRadians:function(n){return n*t},radiansToDegrees:function(n){return n/t},rotatePoint:function(n,t,i){var r=Math.sin(i),u=Math.cos(i),f,e;return n.subtractEquals(t),f=n.x*u-n.y*r,e=n.x*r+n.y*u,new fabric.Point(f,e).addEquals(t)},transformPoint:function(n,t,i){return i?new fabric.Point(t[0]*n.x+t[1]*n.y,t[2]*n.x+t[3]*n.y):new fabric.Point(t[0]*n.x+t[1]*n.y+t[4],t[2]*n.x+t[3]*n.y+t[5])},invertTransform:function(n){var t=n.slice(),i=1/(n[0]*n[3]-n[1]*n[2]),r;return t=[i*n[3],-i*n[1],-i*n[2],i*n[0],0,0],r=fabric.util.transformPoint({x:n[4],y:n[5]},t),t[4]=-r.x,t[5]=-r.y,t},toFixed:function(n,t){return parseFloat(Number(n).toFixed(t))},parseUnit:function(n){var i=/\D{0,2}$/.exec(n),t=parseFloat(n);switch(i[0]){case"mm":return t*fabric.DPI/25.4;case"cm":return t*fabric.DPI/2.54;case"in":return t*fabric.DPI;case"pt":return t*fabric.DPI/72;case"pc":return t*fabric.DPI/6;default:return t}},falseFunction:function(){return!1},getKlass:function(n,t){return n=fabric.util.string.camelize(n.charAt(0).toUpperCase()+n.slice(1)),fabric.util.resolveNamespace(t)[n]},resolveNamespace:function(t){var i;if(!t)return fabric;var u=t.split("."),f=u.length,r=n||fabric.window;for(i=0;i<f;++i)r=r[u[i]];return r},loadImage:function(n,t,i,r){if(!n){t&&t.call(i,n);return}var u=fabric.util.createImage();u.onload=function(){t&&t.call(i,u);u=u.onload=u.onerror=null};u.onerror=function(){fabric.log("Error loading "+u.src);t&&t.call(i,null,!0);u=u.onload=u.onerror=null};n.indexOf("data")!==0&&typeof r!="undefined"&&(u.crossOrigin=r);u.src=n},enlivenObjects:function(n,t,i,r){function f(){++o===e&&t&&t(u)}n=n||[];var u=[],o=0,e=n.length;if(!e){t&&t(u);return}n.forEach(function(n,t){if(!n||!n.type){f();return}var e=fabric.util.getKlass(n.type,i);e.async?e.fromObject(n,function(i,e){e||(u[t]=i,r&&r(n,u[t]));f()}):(u[t]=e.fromObject(n),r&&r(n,u[t]),f())})},groupSVGElements:function(n,t,i){var r;return r=new fabric.PathGroup(n,t),typeof i!="undefined"&&r.setSourcePath(i),r},populateWithProperties:function(n,t,i){if(i&&Object.prototype.toString.call(i)==="[object Array]")for(var r=0,u=i.length;r<u;r++)i[r]in n&&(t[i[r]]=n[i[r]])},drawDashedLine:function(n,t,u,f,e,o){var s=f-t,h=e-u,c=i(s*s+h*h),a=r(h,s),v=o.length,y=0,l=!0;for(n.save(),n.translate(t,u),n.moveTo(0,0),n.rotate(a),t=0;c>t;)t+=o[y++%v],t>c&&(t=c),n[l?"lineTo":"moveTo"](t,0),l=!l;n.restore()},createCanvasElement:function(n){return n||(n=fabric.document.createElement("canvas")),n.getContext||typeof G_vmlCanvasManager=="undefined"||G_vmlCanvasManager.initElement(n),n},createImage:function(){return fabric.isLikelyNode?new(require("canvas").Image):fabric.document.createElement("img")},createAccessors:function(n){for(var t=n.prototype,r=t.stateProperties.length;r--;){var i=t.stateProperties[r],u=i.charAt(0).toUpperCase()+i.slice(1),f="set"+u,e="get"+u;t[e]||(t[e]=function(n){return new Function('return this.get("'+n+'")')}(i));t[f]||(t[f]=function(n){return new Function("value",'return this.set("'+n+'", value)')}(i))}},clipContext:function(n,t){t.save();t.beginPath();n.clipTo(t);t.clip()},multiplyTransformMatrices:function(n,t){for(var u,e,f,o=[[n[0],n[2],n[4]],[n[1],n[3],n[5]],[0,0,1]],s=[[t[0],t[2],t[4]],[t[1],t[3],t[5]],[0,0,1]],i=[],r=0;r<3;r++)for(i[r]=[],u=0;u<3;u++){for(e=0,f=0;f<3;f++)e+=o[r][f]*s[f][u];i[r][u]=e}return[i[0][0],i[1][0],i[0][1],i[1][1],i[0][2],i[1][2]]},getFunctionBody:function(n){return(String(n).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(n,t,i,r){var u,f,e,o,s;for(r>0&&(t>r?t-=r:t=0,i>r?i-=r:i=0),u=!0,f=n.getImageData(t,i,r*2||1,r*2||1),e=3,o=f.data.length;e<o;e+=4)if(s=f.data[e],u=s<=0,u===!1)break;return f=null,u}}}(typeof exports!="undefined"?exports:this),function(){function u(n,u,e,o,s,h,c){var rt=i.call(arguments),et,p;if(t[rt])return t[rt];var nt=Math.PI,st=c*(nt/180),w=Math.sin(st),b=Math.cos(st),ht=0,ct=0;e=Math.abs(e);o=Math.abs(o);var l=-b*n-w*u,a=-b*u+w*n,tt=e*e,it=o*o,lt=a*a,at=l*l,ut=4*tt*it-tt*lt-it*at,ft=0;ut<0?(et=Math.sqrt(1-.25*ut/(tt*it)),e*=et,o*=et):ft=(s===h?-.5:.5)*Math.sqrt(ut/(tt*lt+it*at));var k=ft*e*a/o,d=-ft*o*l/e,pt=b*k-w*d+n/2,wt=w*k+b*d+u/2,ot=r(1,0,(l-k)/e,(a-d)/o),v=r((l-k)/e,(a-d)/o,(-l-k)/e,(-a-d)/o);h===0&&v>0?v-=2*nt:h===1&&v<0&&(v+=2*nt);var vt=Math.ceil(Math.abs(v/(nt*.5))),g=[],y=v/vt,bt=8/3*Math.sin(y/4)*Math.sin(y/4)/Math.sin(y/2),yt=ot+y;for(p=0;p<vt;p++)g[p]=f(ot,yt,b,w,e,o,pt,wt,bt,ht,ct),ht=g[p][4],ct=g[p][5],ot+=y,yt+=y;return t[rt]=g,g}function f(t,r,u,f,e,o,s,h,c,l,a){var v=i.call(arguments);if(n[v])return n[v];var w=Math.cos(t),b=Math.sin(t),y=Math.cos(r),p=Math.sin(r),k=u*e*y-f*o*p+s,d=f*e*y+u*o*p+h,g=l+c*(-u*e*b-f*o*w),nt=a+c*(-f*e*b+u*o*w),tt=k+c*(u*e*p+f*o*y),it=d+c*(f*e*p-u*o*y);return n[v]=[g,nt,tt,it,k,d],n[v]}function r(n,t,i,r){var u=Math.atan2(t,n),f=Math.atan2(r,i);return f>=u?f-u:2*Math.PI-(u-f)}var t={},n={},i=Array.prototype.join;fabric.util.drawArc=function(n,t,i,r){for(var s=r[0],h=r[1],c=r[2],l=r[3],a=r[4],v=r[5],y=r[6],e=[[],[],[],[]],o=u(v-t,y-i,s,h,l,a,c),f=0;f<o.length;f++)e[f][0]=o[f][0]+t,e[f][1]=o[f][1]+i,e[f][2]=o[f][2]+t,e[f][3]=o[f][3]+i,e[f][4]=o[f][4]+t,e[f][5]=o[f][5]+i,n.bezierCurveTo.apply(n,e[f])}}(),function(){function i(n,i){for(var u=t.call(arguments,2),f=[],r=0,e=n.length;r<e;r++)f[r]=u.length?n[r][i].apply(n[r],u):n[r][i].call(n[r]);return f}function r(t,i){return n(t,i,function(n,t){return n>=t})}function u(t,i){return n(t,i,function(n,t){return n<t})}function n(n,t,i){if(n&&n.length!==0){var r=n.length-1,u=t?n[r][t]:n[r];if(t)while(r--)i(n[r][t],u)&&(u=n[r][t]);else while(r--)i(n[r],u)&&(u=n[r]);return u}}var t=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(n){var u,r,t,i;if(this===void 0||this===null)throw new TypeError;if((u=Object(this),r=u.length>>>0,r===0)||(t=0,arguments.length>0&&(t=Number(arguments[1]),t!==t?t=0:t!==0&&t!==Number.POSITIVE_INFINITY&&t!==Number.NEGATIVE_INFINITY&&(t=(t>0||-1)*Math.floor(Math.abs(t)))),t>=r))return-1;for(i=t>=0?t:Math.max(r-Math.abs(t),0);i<r;i++)if(i in u&&u[i]===n)return i;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(n,t){for(var i=0,r=this.length>>>0;i<r;i++)i in this&&n.call(t,this[i],i,this)});Array.prototype.map||(Array.prototype.map=function(n,t){for(var r=[],i=0,u=this.length>>>0;i<u;i++)i in this&&(r[i]=n.call(t,this[i],i,this));return r});Array.prototype.every||(Array.prototype.every=function(n,t){for(var i=0,r=this.length>>>0;i<r;i++)if(i in this&&!n.call(t,this[i],i,this))return!1;return!0});Array.prototype.some||(Array.prototype.some=function(n,t){for(var i=0,r=this.length>>>0;i<r;i++)if(i in this&&n.call(t,this[i],i,this))return!0;return!1});Array.prototype.filter||(Array.prototype.filter=function(n,t){for(var u=[],r,i=0,f=this.length>>>0;i<f;i++)i in this&&(r=this[i],n.call(t,r,i,this)&&u.push(r));return u});Array.prototype.reduce||(Array.prototype.reduce=function(n){var r=this.length>>>0,t=0,i;if(arguments.length>1)i=arguments[1];else do{if(t in this){i=this[t++];break}if(++t>=r)throw new TypeError;}while(1);for(;t<r;t++)t in this&&(i=n.call(null,i,this[t],t,this));return i});fabric.util.array={invoke:i,min:u,max:r}}(),function(){function n(n,t){for(var i in t)n[i]=t[i];return n}function t(t){return n({},t)}fabric.util.object={extend:n,clone:t}}(),function(){function n(n){return n.replace(/-+(.)?/g,function(n,t){return t?t.toUpperCase():""})}function t(n,t){return n.charAt(0).toUpperCase()+(t?n.slice(1):n.slice(1).toLowerCase())}function i(n){return n.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")});fabric.util.string={camelize:n,capitalize:t,escapeXml:i}}(),function(){var t=Array.prototype.slice,i=Function.prototype.apply,n=function(){};Function.prototype.bind||(Function.prototype.bind=function(r){var f=this,e=t.call(arguments,1),u;return u=e.length?function(){return i.call(f,this instanceof n?this:r,e.concat(t.call(arguments)))}:function(){return i.call(f,this instanceof n?this:r,arguments)},n.prototype=this.prototype,u.prototype=new n,u})}(),function(){function t(){}function f(t){var i=this.constructor.superclass.prototype[t];return arguments.length>1?i.apply(this,n.call(arguments,1)):i.call(this)}function e(){function r(){this.initialize.apply(this,arguments)}var e=null,o=n.call(arguments,0),s,h;for(typeof o[0]=="function"&&(e=o.shift()),r.superclass=e,r.subclasses=[],e&&(t.prototype=e.prototype,r.prototype=new t,e.subclasses.push(r)),s=0,h=o.length;s<h;s++)u(r,o[s],e);return r.prototype.initialize||(r.prototype.initialize=i),r.prototype.constructor=r,r.prototype.callSuper=f,r}var n=Array.prototype.slice,i=function(){},r=function(){for(var n in{toString:1})if(n==="toString")return!1;return!0}(),u=function(n,t,i){for(var u in t)n.prototype[u]=u in n.prototype&&typeof n.prototype[u]=="function"&&(t[u]+"").indexOf("callSuper")>-1?function(n){return function(){var u=this.constructor.superclass,r;return this.constructor.superclass=i,r=t[n].apply(this,arguments),this.constructor.superclass=u,n!=="initialize"?r:void 0}}(u):t[u],r&&(t.toString!==Object.prototype.toString&&(n.prototype.toString=t.toString),t.valueOf!==Object.prototype.valueOf&&(n.prototype.valueOf=t.valueOf))};fabric.util.createClass=e}(),function(){function i(n){for(var i=Array.prototype.slice.call(arguments,1),r,u=i.length,t=0;t<u;t++)if(r=typeof n[i[t]],!/^(?:function|object|unknown)$/.test(r))return!1;return!0}function a(n,t){return{handler:t,wrappedHandler:v(n,t)}}function v(n,t){return function(i){t.call(h(n),i||fabric.window.event)}}function y(t,i){return function(r){var f,u,e;if(n[t]&&n[t][i])for(f=n[t][i],u=0,e=f.length;u<e;u++)f[u].call(this,r||fabric.window.event)}}function b(n,t){n||(n=fabric.window.event);var r=n.target||(typeof n.srcElement!==e?n.srcElement:null),i=fabric.util.getScrollLeftTop(r,t);return{x:o(n)+i.left,y:s(n)+i.top}}function l(n,t,i){var r=n.type==="touchend"?"changedTouches":"touches";return n[r]&&n[r][0]?n[r][0][t]-(n[r][0][t]-n[r][0][i])||n[i]:n[i]}var e="unknown",h,c,r=function(){var n=0;return function(t){return t.__uniqueID||(t.__uniqueID="uniqueID__"+n++)}}(),o,s;(function(){var n={};h=function(t){return n[t]};c=function(t,i){n[t]=i}})();var p=i(fabric.document.documentElement,"addEventListener","removeEventListener")&&i(fabric.window,"addEventListener","removeEventListener"),w=i(fabric.document.documentElement,"attachEvent","detachEvent")&&i(fabric.window,"attachEvent","detachEvent"),t={},n={},u,f;p?(u=function(n,t,i){n.addEventListener(t,i,!1)},f=function(n,t,i){n.removeEventListener(t,i,!1)}):w?(u=function(n,i,u){var f=r(n),e;c(f,n);t[f]||(t[f]={});t[f][i]||(t[f][i]=[]);e=a(f,u);t[f][i].push(e);n.attachEvent("on"+i,e.wrappedHandler)},f=function(n,i,u){var f=r(n),o,e,s;if(t[f]&&t[f][i])for(e=0,s=t[f][i].length;e<s;e++)o=t[f][i][e],o&&o.handler===u&&(n.detachEvent("on"+i,o.wrappedHandler),t[f][i][e]=null)}):(u=function(t,i,u){var f=r(t),e;n[f]||(n[f]={});n[f][i]||(n[f][i]=[],e=t["on"+i],e&&n[f][i].push(e),t["on"+i]=y(f,i));n[f][i].push(u)},f=function(t,i,u){var o=r(t),e,f,s;if(n[o]&&n[o][i])for(e=n[o][i],f=0,s=e.length;f<s;f++)e[f]===u&&e.splice(f,1)});fabric.util.addListener=u;fabric.util.removeListener=f;o=function(n){return typeof n.clientX!==e?n.clientX:0};s=function(n){return typeof n.clientY!==e?n.clientY:0};fabric.isTouchSupported&&(o=function(n){return l(n,"pageX","clientX")},s=function(n){return l(n,"pageY","clientY")});fabric.util.getPointer=b;fabric.util.object.extend(fabric.util,fabric.Observable)}(),function(){function r(t,i){var u=t.style,r,f;if(!u)return t;if(typeof i=="string")return t.style.cssText+=";"+i,i.indexOf("opacity")>-1?n(t,i.match(/opacity:\s*(\d?\.?\d*)/)[1]):t;for(r in i)r==="opacity"?n(t,i[r]):(f=r==="float"||r==="cssFloat"?typeof u.styleFloat=="undefined"?"cssFloat":"styleFloat":r,u[f]=i[r]);return t}var t=fabric.document.createElement("div"),u=typeof t.style.opacity=="string",f=typeof t.style.filter=="string",i=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,n=function(n){return n};u?n=function(n,t){return n.style.opacity=t,n}:f&&(n=function(n,t){var r=n.style;return n.currentStyle&&!n.currentStyle.hasLayout&&(r.zoom=1),i.test(r.filter)?(t=t>=.9999?"":"alpha(opacity="+t*100+")",r.filter=r.filter.replace(i,t)):r.filter+=" alpha(opacity="+t*100+")",n});fabric.util.setStyle=r}(),function(){function f(n){return typeof n=="string"?fabric.document.getElementById(n):n}function r(n,t){var r=fabric.document.createElement(n);for(var i in t)i==="class"?r.className=t[i]:i==="for"?r.htmlFor=t[i]:r.setAttribute(i,t[i]);return r}function e(n,t){n&&(" "+n.className+" ").indexOf(" "+t+" ")===-1&&(n.className+=(n.className?" ":"")+t)}function o(n,t,i){return typeof t=="string"&&(t=r(t,i)),n.parentNode&&n.parentNode.replaceChild(t,n),t.appendChild(n),t}function s(n,t){for(var u,i=0,r=0,e=fabric.document.documentElement,o=fabric.document.body||{scrollLeft:0,scrollTop:0},f=n;n&&n.parentNode&&!u;)n=n.parentNode,n!==fabric.document&&fabric.util.getElementStyle(n,"position")==="fixed"&&(u=n),n!==fabric.document&&f!==t&&fabric.util.getElementStyle(n,"position")==="absolute"?(i=0,r=0):n===fabric.document?(i=o.scrollLeft||e.scrollLeft||0,r=o.scrollTop||e.scrollTop||0):(i+=n.scrollLeft||0,r+=n.scrollTop||0);return{left:i,top:r}}function h(n){var i,o=n&&n.ownerDocument,r={left:0,top:0},u={left:0,top:0},f,s={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"},e;if(!o)return{left:0,top:0};for(e in s)u[s[e]]+=parseInt(t(n,e),10)||0;return i=o.documentElement,typeof n.getBoundingClientRect!="undefined"&&(r=n.getBoundingClientRect()),f=fabric.util.getScrollLeftTop(n,null),{left:r.left+f.left-(i.clientLeft||0)+u.left,top:r.top+f.top-(i.clientTop||0)+u.top}}var u=Array.prototype.slice,i,n=function(n){return u.call(n,0)},t;try{i=n(fabric.document.childNodes)instanceof Array}catch(c){}i||(n=function(n){for(var i=new Array(n.length),t=n.length;t--;)i[t]=n[t];return i});t=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(n,t){return fabric.document.defaultView.getComputedStyle(n,null)[t]}:function(n,t){var i=n.style[t];return!i&&n.currentStyle&&(i=n.currentStyle[t]),i},function(){function i(n){return typeof n.onselectstart!="undefined"&&(n.onselectstart=fabric.util.falseFunction),t?n.style[t]="none":typeof n.unselectable=="string"&&(n.unselectable="on"),n}function r(n){return typeof n.onselectstart!="undefined"&&(n.onselectstart=null),t?n.style[t]="":typeof n.unselectable=="string"&&(n.unselectable=""),n}var n=fabric.document.documentElement.style,t="userSelect"in n?"userSelect":"MozUserSelect"in n?"MozUserSelect":"WebkitUserSelect"in n?"WebkitUserSelect":"KhtmlUserSelect"in n?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=i;fabric.util.makeElementSelectable=r}(),function(){function n(n,t){var u=fabric.document.getElementsByTagName("head")[0],i=fabric.document.createElement("script"),r=!0;i.onload=i.onreadystatechange=function(n){if(r){if(typeof this.readyState=="string"&&this.readyState!=="loaded"&&this.readyState!=="complete")return;r=!1;t(n||fabric.window.event);i=i.onload=i.onreadystatechange=null}};i.src=n;u.appendChild(i)}fabric.util.getScript=n}();fabric.util.getById=f;fabric.util.toArray=n;fabric.util.makeElement=r;fabric.util.addClass=e;fabric.util.wrapElement=o;fabric.util.getScrollLeftTop=s;fabric.util.getElementOffset=h;fabric.util.getElementStyle=t}(),function(){function n(n,t){return n+(/\?/.test(n)?"&":"?")+t}function i(){}function r(r,u){u||(u={});var e=u.method?u.method.toUpperCase():"GET",s=u.onComplete||function(){},f=t(),o;return f.onreadystatechange=function(){f.readyState===4&&(s(f),f.onreadystatechange=i)},e==="GET"&&(o=null,typeof u.parameters=="string"&&(r=n(r,u.parameters))),f.open(e,r,!0),(e==="POST"||e==="PUT")&&f.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),f.send(o),f}var t=function(){for(var i,n=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],t=n.length;t--;)try{if(i=n[t](),i)return n[t]}catch(r){}}();fabric.util.request=r}();fabric.log=function(){};fabric.warn=function(){};typeof console!="undefined"&&["log","warn"].forEach(function(n){typeof console[n]!="undefined"&&console[n].apply&&(fabric[n]=function(){return console[n].apply(console,arguments)})}),function(){function t(t){n(function(i){t||(t={});var u=i||+new Date,f=t.duration||500,e=u+f,r,s=t.onChange||function(){},h=t.abort||function(){return!1},c=t.easing||function(n,t,i,r){return-i*Math.cos(n/r*(Math.PI/2))+i+t},o="startValue"in t?t.startValue:0,l="endValue"in t?t.endValue:100,a=t.byValue||l-o;t.onStart&&t.onStart(),function v(i){r=i||+new Date;var l=r>e?f:r-u;if(h()){t.onComplete&&t.onComplete();return}if(s(c(l,o,a,f)),r>e){t.onComplete&&t.onComplete();return}n(v)}(u)})}function n(){return i.apply(fabric.window,arguments)}var i=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(n){fabric.window.setTimeout(n,1e3/60)};fabric.util.animate=t;fabric.util.requestAnimFrame=n}(),function(){function n(n,t,i,r){return n<Math.abs(t)?(n=t,r=i/4):r=i/(2*Math.PI)*Math.asin(t/n),{a:n,c:t,p:i,s:r}}function i(n,t,i){return n.a*Math.pow(2,10*(t-=1))*Math.sin((t*i-n.s)*2*Math.PI/n.p)}function u(n,t,i,r){return i*((n=n/r-1)*n*n+1)+t}function f(n,t,i,r){return(n/=r/2,n<1)?i/2*n*n*n+t:i/2*((n-=2)*n*n+2)+t}function e(n,t,i,r){return i*(n/=r)*n*n*n+t}function o(n,t,i,r){return-i*((n=n/r-1)*n*n*n-1)+t}function s(n,t,i,r){return(n/=r/2,n<1)?i/2*n*n*n*n+t:-i/2*((n-=2)*n*n*n-2)+t}function h(n,t,i,r){return i*(n/=r)*n*n*n*n+t}function c(n,t,i,r){return i*((n=n/r-1)*n*n*n*n+1)+t}function l(n,t,i,r){return(n/=r/2,n<1)?i/2*n*n*n*n*n+t:i/2*((n-=2)*n*n*n*n+2)+t}function a(n,t,i,r){return-i*Math.cos(n/r*(Math.PI/2))+i+t}function v(n,t,i,r){return i*Math.sin(n/r*(Math.PI/2))+t}function y(n,t,i,r){return-i/2*(Math.cos(Math.PI*n/r)-1)+t}function p(n,t,i,r){return n===0?t:i*Math.pow(2,10*(n/r-1))+t}function w(n,t,i,r){return n===r?t+i:i*(-Math.pow(2,-10*n/r)+1)+t}function b(n,t,i,r){return n===0?t:n===r?t+i:(n/=r/2,n<1)?i/2*Math.pow(2,10*(n-1))+t:i/2*(-Math.pow(2,-10*--n)+2)+t}function k(n,t,i,r){return-i*(Math.sqrt(1-(n/=r)*n)-1)+t}function d(n,t,i,r){return i*Math.sqrt(1-(n=n/r-1)*n)+t}function g(n,t,i,r){return(n/=r/2,n<1)?-i/2*(Math.sqrt(1-n*n)-1)+t:i/2*(Math.sqrt(1-(n-=2)*n)+1)+t}function nt(t,r,u,f){var e=0,s=u,o;return t===0?r:(t/=f,t===1)?r+u:(e||(e=f*.3),o=n(s,u,e,1.70158),-i(o,t,f)+r)}function tt(t,i,r,u){var e=0,o=r,f;return t===0?i:(t/=u,t===1)?i+r:(e||(e=u*.3),f=n(o,r,e,1.70158),f.a*Math.pow(2,-10*t)*Math.sin((t*u-f.s)*2*Math.PI/f.p)+f.c+i)}function it(t,r,u,f){var o=0,s=u,e;return t===0?r:(t/=f/2,t===2)?r+u:(o||(o=f*.3*1.5),e=n(s,u,o,1.70158),t<1)?-.5*i(e,t,f)+r:e.a*Math.pow(2,-10*(t-=1))*Math.sin((t*f-e.s)*2*Math.PI/e.p)*.5+e.c+r}function rt(n,t,i,r,u){return u===undefined&&(u=1.70158),i*(n/=r)*n*((u+1)*n-u)+t}function ut(n,t,i,r,u){return u===undefined&&(u=1.70158),i*((n=n/r-1)*n*((u+1)*n+u)+1)+t}function ft(n,t,i,r,u){return(u===undefined&&(u=1.70158),n/=r/2,n<1)?i/2*n*n*(((u*=1.525)+1)*n-u)+t:i/2*((n-=2)*n*(((u*=1.525)+1)*n+u)+2)+t}function r(n,i,r,u){return r-t(u-n,0,r,u)+i}function t(n,t,i,r){return(n/=r)<1/2.75?i*7.5625*n*n+t:n<2/2.75?i*(7.5625*(n-=1.5/2.75)*n+.75)+t:n<2.5/2.75?i*(7.5625*(n-=2.25/2.75)*n+.9375)+t:i*(7.5625*(n-=2.625/2.75)*n+.984375)+t}function et(n,i,u,f){return n<f/2?r(n*2,0,u,f)*.5+i:t(n*2-f,0,u,f)*.5+u*.5+i}fabric.util.ease={easeInQuad:function(n,t,i,r){return i*(n/=r)*n+t},easeOutQuad:function(n,t,i,r){return-i*(n/=r)*(n-2)+t},easeInOutQuad:function(n,t,i,r){return(n/=r/2,n<1)?i/2*n*n+t:-i/2*(--n*(n-2)-1)+t},easeInCubic:function(n,t,i,r){return i*(n/=r)*n*n+t},easeOutCubic:u,easeInOutCubic:f,easeInQuart:e,easeOutQuart:o,easeInOutQuart:s,easeInQuint:h,easeOutQuint:c,easeInOutQuint:l,easeInSine:a,easeOutSine:v,easeInOutSine:y,easeInExpo:p,easeOutExpo:w,easeInOutExpo:b,easeInCirc:k,easeOutCirc:d,easeInOutCirc:g,easeInElastic:nt,easeOutElastic:tt,easeInOutElastic:it,easeInBack:rt,easeOutBack:ut,easeInOutBack:ft,easeInBounce:r,easeOutBounce:t,easeInOutBounce:et}}(),function(n){"use strict";function u(n){return n in s?s[n]:n}function f(n,i,u){var e=Object.prototype.toString.call(i)==="[object Array]",f;return(n==="fill"||n==="stroke")&&i==="none"?i="":n==="fillRule"?i=i==="evenodd"?"destination-over":i:n==="strokeDashArray"?i=i.replace(/,/g," ").split(/\s+/).map(function(n){return parseInt(n)}):n==="transformMatrix"?i=u&&u.transformMatrix?p(u.transformMatrix,t.parseTransformAttribute(i)):t.parseTransformAttribute(i):n==="visible"?(i=i==="none"||i==="hidden"?!1:!0,u&&u.visible===!1&&(i=!1)):n==="originX"?i=i==="start"?"left":i==="end"?"right":"center":f=e?i.map(r):r(i),!e&&isNaN(f)?i:f}function w(n){var i,r;for(i in o)n[i]&&typeof n[o[i]]!="undefined"&&n[i].indexOf("url(")!==0&&(r=new t.Color(n[i]),n[i]=r.setAlpha(y(r.getAlpha()*n[o[i]],2)).toRgba());return n}function h(n,t){var i=n.match(/(normal|italic)?\s*(normal|small-caps)?\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\s*(\d+)px(?:\/(normal|[\d\.]+))?\s+(.*)/);if(i){var f=i[1],r=i[3],e=i[4],u=i[5],o=i[6];f&&(t.fontStyle=f);r&&(t.fontWeight=isNaN(parseFloat(r))?r:parseFloat(r));e&&(t.fontSize=parseFloat(e));o&&(t.fontFamily=o);u&&(t.lineHeight=u==="normal"?1:u)}}function b(n,t){var i,r;n.replace(/;$/,"").split(";").forEach(function(n){var e=n.split(":");i=u(e[0].trim().toLowerCase());r=f(i,e[1].trim());i==="font"?h(r,t):t[i]=r})}function k(n,t){var i,r;for(var e in n)typeof n[e]!="undefined"&&(i=u(e.toLowerCase()),r=f(i,n[e]),i==="font"?h(r,t):t[i]=r)}function d(n){var u={},i,r;for(i in t.cssRules)if(g(n,i.split(" ")))for(r in t.cssRules[i])u[r]=t.cssRules[i][r];return u}function g(n,t){var i,r=!0;return i=c(n,t.pop()),i&&t.length&&(r=nt(n,t)),i&&r&&t.length===0}function nt(n,t){for(var i,r=!0;n.parentNode&&n.parentNode.nodeType===1&&t.length;)r&&(i=t.pop()),n=n.parentNode,r=c(n,i);return t.length===0}function c(n,t){var e=n.nodeName,r=n.getAttribute("class"),f=n.getAttribute("id"),i,u;if(i=new RegExp("^"+e,"i"),t=t.replace(i,""),f&&t.length&&(i=new RegExp("#"+f+"(?![a-zA-Z\\-]+)","i"),t=t.replace(i,"")),r&&t.length)for(r=r.split(" "),u=r.length;u--;)i=new RegExp("\\."+r[u]+"(?![a-zA-Z\\-]+)","i"),t=t.replace(i,"");return t.length===0}function tt(n){for(var e=n.getElementsByTagName("use"),t;e.length;){for(var i=e[0],h=i.getAttribute("xlink:href").substr(1),c=i.getAttribute("x")||0,l=i.getAttribute("y")||0,r=n.getElementById(h).cloneNode(!0),u=(i.getAttribute("transform")||"")+" translate("+c+", "+l+")",o,f=0,s=i.attributes,a=s.length;f<a;f++)(t=s.item(f),t.nodeName!=="x"&&t.nodeName!=="y"&&t.nodeName!=="xlink:href")&&(t.nodeName==="transform"?u=u+" "+t.nodeValue:r.setAttribute(t.nodeName,t.nodeValue));r.setAttribute("transform",u);r.removeAttribute("id");o=i.parentNode;o.replaceChild(r,i)}}function it(n,t){if(t[3]=t[0]=t[0]>t[3]?t[3]:t[0],t[0]!==1||t[3]!==1||t[4]!==0||t[5]!==0){for(var i=n.ownerDocument.createElement("g");n.firstChild!=null;)i.appendChild(n.firstChild);i.setAttribute("transform","matrix("+t[0]+" "+t[1]+" "+t[2]+" "+t[3]+" "+t[4]+" "+t[5]+")");n.appendChild(i)}}function rt(n){var i=n.objects,r=n.options;return i=i.map(function(n){return t[a(n.type)].fromObject(n)}),{objects:i,options:r}}function l(n,t,i){t[i]&&t[i].toSVG&&n.push('<pattern x="0" y="0" id="',i,'Pattern" ','width="',t[i].source.width,'" height="',t[i].source.height,'" patternUnits="userSpaceOnUse">','<image x="0" y="0" ','width="',t[i].source.width,'" height="',t[i].source.height,'" xlink:href="',t[i].source.src,'"><\/image><\/pattern>')}var t=n.fabric||(n.fabric={}),i=t.util.object.extend,a=t.util.string.capitalize,v=t.util.object.clone,y=t.util.toFixed,r=t.util.parseUnit,p=t.util.multiplyTransformMatrices,s={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"originX"},o={stroke:"strokeOpacity",fill:"fillOpacity"},e;t.parseTransformAttribute=function(){function f(n,t){var i=t[0];n[0]=Math.cos(i);n[1]=Math.sin(i);n[2]=-Math.sin(i);n[3]=Math.cos(i)}function e(n,t){var i=t[0],r=t.length===2?t[1]:t[0];n[0]=i;n[3]=r}function o(n,t){n[2]=t[0]}function s(n,t){n[1]=t[0]}function h(n,t){n[4]=t[0];t.length===2&&(n[5]=t[1])}var u=[1,0,0,1,0,0],n="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",i="(?:\\s+,?\\s*|,\\s*)",c="(?:(skewX)\\s*\\(\\s*("+n+")\\s*\\))",l="(?:(skewY)\\s*\\(\\s*("+n+")\\s*\\))",a="(?:(rotate)\\s*\\(\\s*("+n+")(?:"+i+"("+n+")"+i+"("+n+"))?\\s*\\))",v="(?:(scale)\\s*\\(\\s*("+n+")(?:"+i+"("+n+"))?\\s*\\))",y="(?:(translate)\\s*\\(\\s*("+n+")(?:"+i+"("+n+"))?\\s*\\))",p="(?:(matrix)\\s*\\(\\s*("+n+")"+i+"("+n+")"+i+"("+n+")"+i+"("+n+")"+i+"("+n+")"+i+"("+n+")\\s*\\))",r="(?:"+p+"|"+y+"|"+v+"|"+a+"|"+c+"|"+l+")",w="(?:"+r+"(?:"+i+r+")*)",b="^\\s*(?:"+w+"?)\\s*$",k=new RegExp(b),d=new RegExp(r,"g");return function(n){var i=u.concat(),c=[],l;if(!n||n&&!k.test(n))return i;for(n.replace(d,function(n){var a=new RegExp(r).exec(n).filter(function(n){return n!==""&&n!=null}),v=a[1],l=a.slice(2).map(parseFloat);switch(v){case"translate":h(i,l);break;case"rotate":l[0]=t.util.degreesToRadians(l[0]);f(i,l);break;case"scale":e(i,l);break;case"skewX":o(i,l);break;case"skewY":s(i,l);break;case"matrix":i=l}c.push(i.concat());i=u.concat()}),l=c[0];c.length>1;)c.shift(),l=t.util.multiplyTransformMatrices(l,c[0]);return l}}();t.parseSVGDocument=function(){function f(n,t){while(n&&(n=n.parentNode))if(t.test(n.nodeName))return!0;return!1}var i=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/,n="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",u=new RegExp("^\\s*("+n+"+)\\s*,?\\s*("+n+"+)\\s*,?\\s*("+n+"+)\\s*,?\\s*("+n+"+)\\s*$");return function(n,e,o){var nt,h,d,a,rt,y,g;if(n){nt=new Date;tt(n);var s=n.getAttribute("viewBox"),c=r(n.getAttribute("width")),l=r(n.getAttribute("height")),p,w;if(s&&(s=s.match(u))){var ut=parseFloat(s[1]),ft=parseFloat(s[2]),b=1,k=1;p=parseFloat(s[3]);w=parseFloat(s[4]);c&&c!==p&&(b=c/p);l&&l!==w&&(k=l/w);it(n,[b,0,0,k,b*-ut,k*-ft])}if(h=t.util.toArray(n.getElementsByTagName("*")),h.length===0&&t.isLikelyNode){for(h=n.selectNodes('//*[name(.)!="svg"]'),d=[],a=0,rt=h.length;a<rt;a++)d[a]=h[a];h=d}if(y=h.filter(function(n){return i.test(n.tagName)&&!f(n,/^(?:pattern|defs)$/)}),!y||y&&!y.length){e&&e([],{});return}g={width:c?c:p,height:l?l:w,widthAttr:c,heightAttr:l};t.gradientDefs=t.getGradientDefs(n);t.cssRules=t.getCSSRules(n);t.parseElements(y,function(n){t.documentParsingTime=new Date-nt;e&&e(n,g)},v(g),o)}}}();e={has:function(n,t){t(!1)},get:function(){},set:function(){}};i(t,{getGradientDefs:function(n){var o=n.getElementsByTagName("linearGradient"),s=n.getElementsByTagName("radialGradient"),t,i,u=0,r,h,f=[],e={},c={},l;for(f.length=o.length+s.length,i=o.length;i--;)f[u++]=o[i];for(i=s.length;i--;)f[u++]=s[i];while(u--)t=f[u],h=t.getAttribute("xlink:href"),r=t.getAttribute("id"),h&&(c[r]=h.substr(1)),e[r]=t;for(r in c)for(l=e[c[r]].cloneNode(!0),t=e[r];l.firstChild;)t.appendChild(l.firstChild);return e},parseAttributes:function(n,r){var e,o,s;if(n)return o={},n.parentNode&&/^symbol|[g|a]$/i.test(n.parentNode.nodeName)&&(o=t.parseAttributes(n.parentNode,r)),s=r.reduce(function(t,i){return e=n.getAttribute(i),e&&(i=u(i),e=f(i,e,o),t[i]=e),t},{}),s=i(s,i(d(n),t.parseStyleAttribute(n))),w(i(o,s))},parseElements:function(n,i,r,u){new t.ElementsParser(n,i,r,u).parse()},parseStyleAttribute:function(n){var t={},i=n.getAttribute("style");return i?(typeof i=="string"?b(i,t):k(i,t),t):t},parsePointsAttribute:function(n){if(!n)return null;n=n.replace(/,/g," ").trim();n=n.split(/\s+/);for(var i=[],t=0,r=n.length;t<r;t+=2)i.push({x:parseFloat(n[t]),y:parseFloat(n[t+1])});return i},getCSSRules:function(n){for(var r,e=n.getElementsByTagName("style"),o={},i,s=0,h=e.length;s<h;s++)r=e[0].textContent,r=r.replace(/\/\*[\s\S]*?\*\//g,""),i=r.match(/[^{]*\{[\s\S]*?\}/g),i=i.map(function(n){return n.trim()}),i.forEach(function(n){for(var e=n.match(/([\s\S]*?)\s*\{([^}]*)\}/),s={},l=e[2].trim(),h=l.replace(/;$/,"").split(/\s*;\s*/),i=0,a=h.length;i<a;i++){var r=h[i].split(/\s*:\s*/),c=u(r[0]),v=f(c,r[1],r[0]);s[c]=v}n=e[1];n.split(",").forEach(function(n){o[n.trim()]=t.util.object.clone(s)})});return o},loadSVGFromURL:function(n,i,r){function u(u){var f=u.responseXML;(f&&!f.documentElement&&t.window.ActiveXObject&&u.responseText&&(f=new ActiveXObject("Microsoft.XMLDOM"),f.async="false",f.loadXML(u.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),f&&f.documentElement)&&t.parseSVGDocument(f.documentElement,function(r,u){e.set(n,{objects:t.util.array.invoke(r,"toObject"),options:u});i(r,u)},r)}n=n.replace(/^\n\s*/,"").trim();e.has(n,function(r){r?e.get(n,function(n){var t=rt(n);i(t.objects,t.options)}):new t.util.request(n,{method:"get",onComplete:u})})},loadSVGFromString:function(n,i,r){var u,f;n=n.trim();typeof DOMParser!="undefined"?(f=new DOMParser,f&&f.parseFromString&&(u=f.parseFromString(n,"text/xml"))):t.window.ActiveXObject&&(u=new ActiveXObject("Microsoft.XMLDOM"),u.async="false",u.loadXML(n.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));t.parseSVGDocument(u.documentElement,function(n,t){i(n,t)},r)},createSVGFontFacesMarkup:function(n){for(var i="",t=0,r=n.length;t<r;t++)n[t].type==="text"&&n[t].path&&(i+=["@font-face {","font-family: ",n[t].fontFamily,"; ","src: url('",n[t].path,"')","}"].join(""));return i&&(i=['<style type="text/css">',"<![CDATA[",i,"]\]>","<\/style>"].join("")),i},createSVGRefElementsMarkup:function(n){var t=[];return l(t,n,"backgroundColor"),l(t,n,"overlayColor"),t.join("")}})}(typeof exports!="undefined"?exports:this);fabric.ElementsParser=function(n,t,i,r){this.elements=n;this.callback=t;this.options=i;this.reviver=r};fabric.ElementsParser.prototype.parse=function(){this.instances=new Array(this.elements.length);this.numElements=this.elements.length;this.createObjects()};fabric.ElementsParser.prototype.createObjects=function(){for(var n=0,t=this.elements.length;n<t;n++)(function(n,t){setTimeout(function(){n.createObject(n.elements[t],t)},0)})(this,n)};fabric.ElementsParser.prototype.createObject=function(n,t){var i=fabric[fabric.util.string.capitalize(n.tagName)];if(i&&i.fromElement)try{this._createObject(i,n,t)}catch(r){fabric.log(r)}else this.checkIfDone()};fabric.ElementsParser.prototype._createObject=function(n,t,i){if(n.async)n.fromElement(t,this.createCallback(i,t),this.options);else{var r=n.fromElement(t,this.options);this.resolveGradient(r,"fill");this.resolveGradient(r,"stroke");this.reviver&&this.reviver(t,r);this.instances[i]=r;this.checkIfDone()}};fabric.ElementsParser.prototype.createCallback=function(n,t){var i=this;return function(r){i.resolveGradient(r,"fill");i.resolveGradient(r,"stroke");i.reviver&&i.reviver(t,r);i.instances[n]=r;i.checkIfDone()}};fabric.ElementsParser.prototype.resolveGradient=function(n,t){var i=n.get(t),r;/^url\(/.test(i)&&(r=i.slice(5,i.length-1),fabric.gradientDefs[r]&&n.set(t,fabric.Gradient.fromElement(fabric.gradientDefs[r],n)))};fabric.ElementsParser.prototype.checkIfDone=function(){--this.numElements==0&&(this.instances=this.instances.filter(function(n){return n!=null}),this.callback(this.instances))},function(n){"use strict";function t(n,t){this.x=n;this.y=t}var i=n.fabric||(n.fabric={});if(i.Point){i.warn("fabric.Point is already defined");return}i.Point=t;t.prototype={constructor:t,add:function(n){return new t(this.x+n.x,this.y+n.y)},addEquals:function(n){return this.x+=n.x,this.y+=n.y,this},scalarAdd:function(n){return new t(this.x+n,this.y+n)},scalarAddEquals:function(n){return this.x+=n,this.y+=n,this},subtract:function(n){return new t(this.x-n.x,this.y-n.y)},subtractEquals:function(n){return this.x-=n.x,this.y-=n.y,this},scalarSubtract:function(n){return new t(this.x-n,this.y-n)},scalarSubtractEquals:function(n){return this.x-=n,this.y-=n,this},multiply:function(n){return new t(this.x*n,this.y*n)},multiplyEquals:function(n){return this.x*=n,this.y*=n,this},divide:function(n){return new t(this.x/n,this.y/n)},divideEquals:function(n){return this.x/=n,this.y/=n,this},eq:function(n){return this.x===n.x&&this.y===n.y},lt:function(n){return this.x<n.x&&this.y<n.y},lte:function(n){return this.x<=n.x&&this.y<=n.y},gt:function(n){return this.x>n.x&&this.y>n.y},gte:function(n){return this.x>=n.x&&this.y>=n.y},lerp:function(n,i){return new t(this.x+(n.x-this.x)*i,this.y+(n.y-this.y)*i)},distanceFrom:function(n){var t=this.x-n.x,i=this.y-n.y;return Math.sqrt(t*t+i*i)},midPointFrom:function(n){return new t(this.x+(n.x-this.x)/2,this.y+(n.y-this.y)/2)},min:function(n){return new t(Math.min(this.x,n.x),Math.min(this.y,n.y))},max:function(n){return new t(Math.max(this.x,n.x),Math.max(this.y,n.y))},toString:function(){return this.x+","+this.y},setXY:function(n,t){this.x=n;this.y=t},setFromPoint:function(n){this.x=n.x;this.y=n.y},swap:function(n){var t=this.x,i=this.y;this.x=n.x;this.y=n.y;n.x=t;n.y=i}}}(typeof exports!="undefined"?exports:this),function(n){"use strict";function t(n){this.status=n;this.points=[]}var i=n.fabric||(n.fabric={});if(i.Intersection){i.warn("fabric.Intersection is already defined");return}i.Intersection=t;i.Intersection.prototype={appendPoint:function(n){this.points.push(n)},appendPoints:function(n){this.points=this.points.concat(n)}};i.Intersection.intersectLineLine=function(n,r,u,f){var e,c=(f.x-u.x)*(n.y-u.y)-(f.y-u.y)*(n.x-u.x),l=(r.x-n.x)*(n.y-u.y)-(r.y-n.y)*(n.x-u.x),s=(f.y-u.y)*(r.x-n.x)-(f.x-u.x)*(r.y-n.y),o,h;return s!==0?(o=c/s,h=l/s,0<=o&&o<=1&&0<=h&&h<=1?(e=new t("Intersection"),e.points.push(new i.Point(n.x+o*(r.x-n.x),n.y+o*(r.y-n.y)))):e=new t):e=c===0||l===0?new t("Coincident"):new t("Parallel"),e};i.Intersection.intersectLinePolygon=function(n,i,r){for(var u=new t,e=r.length,f=0;f<e;f++){var o=r[f],s=r[(f+1)%e],h=t.intersectLineLine(n,i,o,s);u.appendPoints(h.points)}return u.points.length>0&&(u.status="Intersection"),u};i.Intersection.intersectPolygonPolygon=function(n,i){for(var r=new t,f=n.length,u=0;u<f;u++){var e=n[u],o=n[(u+1)%f],s=t.intersectLinePolygon(e,o,i);r.appendPoints(s.points)}return r.points.length>0&&(r.status="Intersection"),r};i.Intersection.intersectPolygonRectangle=function(n,r,u){var e=r.min(u),o=r.max(u),s=new i.Point(o.x,e.y),h=new i.Point(e.x,o.y),c=t.intersectLinePolygon(e,s,n),l=t.intersectLinePolygon(s,o,n),a=t.intersectLinePolygon(o,h,n),v=t.intersectLinePolygon(h,e,n),f=new t;return f.appendPoints(c.points),f.appendPoints(l.points),f.appendPoints(a.points),f.appendPoints(v.points),f.points.length>0&&(f.status="Intersection"),f}}(typeof exports!="undefined"?exports:this),function(n){"use strict";function t(n){n?this._tryParsingColor(n):this.setSource([0,0,0,1])}function r(n,t,i){return(i<0&&(i+=1),i>1&&(i-=1),i<1/6)?n+(t-n)*6*i:i<1/2?t:i<2/3?n+(t-n)*(2/3-i)*6:n}var i=n.fabric||(n.fabric={});if(i.Color){i.warn("fabric.Color is already defined.");return}i.Color=t;i.Color.prototype={_tryParsingColor:function(n){var i;if(n in t.colorNameMap&&(n=t.colorNameMap[n]),n==="transparent"){this.setSource([255,255,255,0]);return}i=t.sourceFromHex(n);i||(i=t.sourceFromRgb(n));i||(i=t.sourceFromHsl(n));i&&this.setSource(i)},_rgbToHsl:function(n,t,r){var f,s,h,u,e,o;if(n/=255,t/=255,r/=255,u=i.util.array.max([n,t,r]),e=i.util.array.min([n,t,r]),h=(u+e)/2,u===e)f=s=0;else{o=u-e;s=h>.5?o/(2-u-e):o/(u+e);switch(u){case n:f=(t-r)/o+(t<r?6:0);break;case t:f=(r-n)/o+2;break;case r:f=(n-t)/o+4}f/=6}return[Math.round(f*360),Math.round(s*100),Math.round(h*100)]},getSource:function(){return this._source},setSource:function(n){this._source=n},toRgb:function(){var n=this.getSource();return"rgb("+n[0]+","+n[1]+","+n[2]+")"},toRgba:function(){var n=this.getSource();return"rgba("+n[0]+","+n[1]+","+n[2]+","+n[3]+")"},toHsl:function(){var n=this.getSource(),t=this._rgbToHsl(n[0],n[1],n[2]);return"hsl("+t[0]+","+t[1]+"%,"+t[2]+"%)"},toHsla:function(){var n=this.getSource(),t=this._rgbToHsl(n[0],n[1],n[2]);return"hsla("+t[0]+","+t[1]+"%,"+t[2]+"%,"+n[3]+")"},toHex:function(){var r=this.getSource(),n,t,i;return n=r[0].toString(16),n=n.length===1?"0"+n:n,t=r[1].toString(16),t=t.length===1?"0"+t:t,i=r[2].toString(16),i=i.length===1?"0"+i:i,n.toUpperCase()+t.toUpperCase()+i.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(n){var t=this.getSource();return t[3]=n,this.setSource(t),this},toGrayscale:function(){var n=this.getSource(),t=parseInt((n[0]*.3+n[1]*.59+n[2]*.11).toFixed(0),10),i=n[3];return this.setSource([t,t,t,i]),this},toBlackWhite:function(n){var i=this.getSource(),t=(i[0]*.3+i[1]*.59+i[2]*.11).toFixed(0),r=i[3];return n=n||127,t=Number(t)<Number(n)?0:255,this.setSource([t,t,t,r]),this},overlayWith:function(n){var i;n instanceof t||(n=new t(n));var r=[],f=this.getAlpha(),u=.5,e=this.getSource(),o=n.getSource();for(i=0;i<3;i++)r.push(Math.round(e[i]*(1-u)+o[i]*u));return r[3]=f,this.setSource(r),this}};i.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/;i.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/;i.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i;i.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"};i.Color.fromRgb=function(n){return t.fromSource(t.sourceFromRgb(n))};i.Color.sourceFromRgb=function(n){var i=n.match(t.reRGBa);if(i){var r=parseInt(i[1],10)/(/%$/.test(i[1])?100:1)*(/%$/.test(i[1])?255:1),u=parseInt(i[2],10)/(/%$/.test(i[2])?100:1)*(/%$/.test(i[2])?255:1),f=parseInt(i[3],10)/(/%$/.test(i[3])?100:1)*(/%$/.test(i[3])?255:1);return[parseInt(r,10),parseInt(u,10),parseInt(f,10),i[4]?parseFloat(i[4]):1]}};i.Color.fromRgba=t.fromRgb;i.Color.fromHsl=function(n){return t.fromSource(t.sourceFromHsl(n))};i.Color.sourceFromHsl=function(n){var i=n.match(t.reHSLa),f,o;if(i){var s=(parseFloat(i[1])%360+360)%360/360,e=parseFloat(i[2])/(/%$/.test(i[2])?100:1),u=parseFloat(i[3])/(/%$/.test(i[3])?100:1),h,c,l;return e===0?h=c=l=u:(f=u<=.5?u*(e+1):u+e-u*e,o=u*2-f,h=r(o,f,s+1/3),c=r(o,f,s),l=r(o,f,s-1/3)),[Math.round(h*255),Math.round(c*255),Math.round(l*255),i[4]?parseFloat(i[4]):1]}};i.Color.fromHsla=t.fromHsl;i.Color.fromHex=function(n){return t.fromSource(t.sourceFromHex(n))};i.Color.sourceFromHex=function(n){if(n.match(t.reHex)){var i=n.slice(n.indexOf("#")+1),r=i.length===3,u=r?i.charAt(0)+i.charAt(0):i.substring(0,2),f=r?i.charAt(1)+i.charAt(1):i.substring(2,4),e=r?i.charAt(2)+i.charAt(2):i.substring(4,6);return[parseInt(u,16),parseInt(f,16),parseInt(e,16),1]}};i.Color.fromSource=function(n){var i=new t;return i.setSource(n),i}}(typeof exports!="undefined"?exports:this),function(){function t(n){var e=n.getAttribute("style"),u=n.getAttribute("offset"),i,o,t,r,f;if(u=parseFloat(u)/(/%$/.test(u)?100:1),e)for(r=e.split(/\s*;\s*/),r[r.length-1]===""&&r.pop(),f=r.length;f--;){var s=r[f].split(/\s*:\s*/),h=s[0].trim(),c=s[1].trim();h==="stop-color"?i=c:h==="stop-opacity"&&(t=c)}return i||(i=n.getAttribute("stop-color")||"rgb(0,0,0)"),t||(t=n.getAttribute("stop-opacity")),i=new fabric.Color(i),o=i.getAlpha(),t=isNaN(parseFloat(t))?1:parseFloat(t),t*=o,{offset:u,color:i.toRgb(),opacity:t}}function i(n){return{x1:n.getAttribute("x1")||0,y1:n.getAttribute("y1")||0,x2:n.getAttribute("x2")||"100%",y2:n.getAttribute("y2")||0}}function r(n){return{x1:n.getAttribute("fx")||n.getAttribute("cx")||"50%",y1:n.getAttribute("fy")||n.getAttribute("cy")||"50%",r1:0,x2:n.getAttribute("cx")||"50%",y2:n.getAttribute("cy")||"50%",r2:n.getAttribute("r")||"50%"}}function n(n,t){var i,r;for(i in t)typeof t[i]=="string"&&/^\d+%$/.test(t[i])&&(r=parseFloat(t[i],10),i==="x1"||i==="x2"||i==="r2"?t[i]=fabric.util.toFixed(n.width*r/100,2)+n.left:(i==="y1"||i==="y2")&&(t[i]=fabric.util.toFixed(n.height*r/100,2)+n.top))}function u(n,t){for(var i in t)i==="x1"||i==="x2"||i==="r2"?t[i]=fabric.util.toFixed((t[i]-n.fill.origX)/n.width*100,2)+"%":(i==="y1"||i==="y2")&&(t[i]=fabric.util.toFixed((t[i]-n.fill.origY)/n.height*100,2)+"%")}fabric.Gradient=fabric.util.createClass({origX:0,origY:0,initialize:function(n){n||(n={});var t={};this.id=fabric.Object.__uid++;this.type=n.type||"linear";t={x1:n.coords.x1||0,y1:n.coords.y1||0,x2:n.coords.x2||0,y2:n.coords.y2||0};this.type==="radial"&&(t.r1=n.coords.r1||0,t.r2=n.coords.r2||0);this.coords=t;this.gradientUnits=n.gradientUnits||"objectBoundingBox";this.colorStops=n.colorStops.slice();n.gradientTransform&&(this.gradientTransform=n.gradientTransform);this.origX=n.left||this.origX;this.origY=n.top||this.origY},addColorStop:function(n){var t,i;for(t in n)i=new fabric.Color(n[t]),this.colorStops.push({offset:t,color:i.toRgb(),opacity:i.getAlpha()});return this},toObject:function(){return{type:this.type,coords:this.coords,gradientUnits:this.gradientUnits,colorStops:this.colorStops}},toSVG:function(n,t){var i=fabric.util.object.clone(this.coords),f,e,r;for(this.colorStops.sort(function(n,t){return n.offset-t.offset}),t&&this.gradientUnits==="userSpaceOnUse"?(i.x1+=n.width/2,i.y1+=n.height/2,i.x2+=n.width/2,i.y2+=n.height/2):this.gradientUnits==="objectBoundingBox"&&u(n,i),e='id="SVGID_'+this.id+'" gradientUnits="'+this.gradientUnits+'"',this.gradientTransform&&(e+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" '),this.type==="linear"?f=["<linearGradient ",e,' x1="',i.x1,'" y1="',i.y1,'" x2="',i.x2,'" y2="',i.y2,'">\n']:this.type==="radial"&&(f=["<radialGradient ",e,' cx="',i.x2,'" cy="',i.y2,'" r="',i.r2,'" fx="',i.x1,'" fy="',i.y1,'">\n']),r=0;r<this.colorStops.length;r++)f.push("<stop ",'offset="',this.colorStops[r].offset*100+"%",'" style="stop-color:',this.colorStops[r].color,this.colorStops[r].opacity!=null?";stop-opacity: "+this.colorStops[r].opacity:";",'"/>\n');return f.push(this.type==="linear"?"<\/linearGradient>\n":"<\/radialGradient>\n"),f.join("")},toLive:function(n){var i,t,u;if(this.type){for(this.type==="linear"?i=n.createLinearGradient(this.coords.x1,this.coords.y1,this.coords.x2,this.coords.y2):this.type==="radial"&&(i=n.createRadialGradient(this.coords.x1,this.coords.y1,this.coords.r1,this.coords.x2,this.coords.y2,this.coords.r2)),t=0,u=this.colorStops.length;t<u;t++){var r=this.colorStops[t].color,f=this.colorStops[t].opacity,e=this.colorStops[t].offset;typeof f!="undefined"&&(r=new fabric.Color(r).setAlpha(f).toRgba());i.addColorStop(parseFloat(e),r)}return i}}});fabric.util.object.extend(fabric.Gradient,{fromElement:function(u,f){var c=u.getElementsByTagName("stop"),o=u.nodeName==="linearGradient"?"linear":"radial",v=u.getAttribute("gradientUnits")||"objectBoundingBox",l=u.getAttribute("gradientTransform"),a=[],e={},s,h;for(o==="linear"?e=i(u):o==="radial"&&(e=r(u)),s=c.length;s--;)a.push(t(c[s]));return n(f,e),h=new fabric.Gradient({type:o,coords:e,gradientUnits:v,colorStops:a}),l&&(h.gradientTransform=fabric.parseTransformAttribute(l)),h},forObject:function(t,i){return i||(i={}),n(t,i),new fabric.Gradient(i)}})}();fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(n){if(n||(n={}),this.id=fabric.Object.__uid++,n.source)if(typeof n.source=="string")if(typeof fabric.util.getFunctionBody(n.source)!="undefined")this.source=new Function(fabric.util.getFunctionBody(n.source));else{var t=this;this.source=fabric.util.createImage();fabric.util.loadImage(n.source,function(n){t.source=n})}else this.source=n.source;n.repeat&&(this.repeat=n.repeat);n.offsetX&&(this.offsetX=n.offsetX);n.offsetY&&(this.offsetY=n.offsetY)},toObject:function(){var n;return typeof this.source=="function"?n=String(this.source):typeof this.source.src=="string"&&(n=this.source.src),{source:n,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(n){var t=typeof this.source=="function"?this.source():this.source,r=t.width/n.getWidth(),u=t.height/n.getHeight(),i="";return t.src?i=t.src:t.toDataURL&&(i=t.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+this.offsetX+'" y="'+this.offsetY+'" width="'+r+'" height="'+u+'"><image x="0" y="0" width="'+t.width+'" height="'+t.height+'" xlink:href="'+i+'"><\/image><\/pattern>'},toLive:function(n){var t=typeof this.source=="function"?this.source():this.source;return t?typeof t.src!="undefined"&&(!t.complete||t.naturalWidth===0||t.naturalHeight===0)?"":n.createPattern(t,this.repeat):""}}),function(n){"use strict";var t=n.fabric||(n.fabric={});if(t.Shadow){t.warn("fabric.Shadow is already defined.");return}t.Shadow=t.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(n){typeof n=="string"&&(n=this._parseShadow(n));for(var i in n)this[i]=n[i];this.id=t.Object.__uid++},_parseShadow:function(n){var r=n.trim(),i=t.Shadow.reOffsetsAndBlur.exec(r)||[],u=r.replace(t.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:u.trim(),offsetX:parseInt(i[1],10)||0,offsetY:parseInt(i[2],10)||0,blur:parseInt(i[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(n){var t="SourceAlpha";return n&&(n.fill===this.color||n.stroke===this.color)&&(t="SourceGraphic"),'<filter id="SVGID_'+this.id+'" y="-40%" height="180%"><feGaussianBlur in="'+t+'" stdDeviation="'+(this.blur?this.blur/3:0)+'"><\/feGaussianBlur><feOffset dx="'+this.offsetX+'" dy="'+this.offsetY+'"><\/feOffset><feMerge><feMergeNode><\/feMergeNode><feMergeNode in="SourceGraphic"><\/feMergeNode><\/feMerge><\/filter>'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY};var n={},i=t.Shadow.prototype;return this.color!==i.color&&(n.color=this.color),this.blur!==i.blur&&(n.blur=this.blur),this.offsetX!==i.offsetX&&(n.offsetX=this.offsetX),this.offsetY!==i.offsetY&&(n.offsetY=this.offsetY),n}});t.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/}(typeof exports!="undefined"?exports:this),function(){"use strict";if(fabric.StaticCanvas){fabric.warn("fabric.StaticCanvas is already defined.");return}var n=fabric.util.object.extend,r=fabric.util.getElementOffset,t=fabric.util.removeFromArray,i=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(n,t){t||(t={});this._initStatic(n,t);fabric.StaticCanvas.activeInstance=this},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:[1,0,0,1,0,0],onBeforeScaleRotate:function(){},_initStatic:function(n,t){this._objects=[];this._createLowerCanvas(n);this._initOptions(t);this._setImageSmoothing();t.overlayImage&&this.setOverlayImage(t.overlayImage,this.renderAll.bind(this));t.backgroundImage&&this.setBackgroundImage(t.backgroundImage,this.renderAll.bind(this));t.backgroundColor&&this.setBackgroundColor(t.backgroundColor,this.renderAll.bind(this));t.overlayColor&&this.setOverlayColor(t.overlayColor,this.renderAll.bind(this));this.calcOffset()},calcOffset:function(){return this._offset=r(this.lowerCanvasEl),this},setOverlayImage:function(n,t,i){return this.__setBgOverlayImage("overlayImage",n,t,i)},setBackgroundImage:function(n,t,i){return this.__setBgOverlayImage("backgroundImage",n,t,i)},setOverlayColor:function(n,t){return this.__setBgOverlayColor("overlayColor",n,t)},setBackgroundColor:function(n,t){return this.__setBgOverlayColor("backgroundColor",n,t)},_setImageSmoothing:function(){var n=this.getContext();n.imageSmoothingEnabled=this.imageSmoothingEnabled;n.webkitImageSmoothingEnabled=this.imageSmoothingEnabled;n.mozImageSmoothingEnabled=this.imageSmoothingEnabled;n.msImageSmoothingEnabled=this.imageSmoothingEnabled;n.oImageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(n,t,i,r){return typeof t=="string"?fabric.util.loadImage(t,function(t){this[n]=new fabric.Image(t,r);i&&i()},this):(this[n]=t,i&&i()),this},__setBgOverlayColor:function(n,t,i){if(t&&t.source){var r=this;fabric.util.loadImage(t.source,function(u){r[n]=new fabric.Pattern({source:u,repeat:t.repeat,offsetX:t.offsetX,offsetY:t.offsetY});i&&i()})}else this[n]=t,i&&i();return this},_createCanvasElement:function(){var n=fabric.document.createElement("canvas");if(n.style||(n.style={}),!n)throw i;return this._initCanvasElement(n),n},_initCanvasElement:function(n){if(fabric.util.createCanvasElement(n),typeof n.getContext=="undefined")throw i;},_initOptions:function(n){for(var t in n)this[t]=n[t];(this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0,this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0,this.lowerCanvasEl.style)&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(n){this.lowerCanvasEl=fabric.util.getById(n)||this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);fabric.util.addClass(this.lowerCanvasEl,"lower-canvas");this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl);this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(n,t){return this.setDimensions({width:n},t)},setHeight:function(n,t){return this.setDimensions({height:n},t)},setDimensions:function(n,t){var r,i;t=t||{};for(i in n)r=n[i],t.cssOnly||(this._setBackstoreDimension(i,n[i]),r+="px"),t.backstoreOnly||this._setCssDimension(i,r);return t.cssOnly||this.renderAll(),this.calcOffset(),this},_setBackstoreDimension:function(n,t){return this.lowerCanvasEl[n]=t,this.upperCanvasEl&&(this.upperCanvasEl[n]=t),this.cacheCanvasEl&&(this.cacheCanvasEl[n]=t),this[n]=t,this},_setCssDimension:function(n,t){return this.lowerCanvasEl.style[n]=t,this.upperCanvasEl&&(this.upperCanvasEl.style[n]=t),this.wrapperEl&&(this.wrapperEl.style[n]=t),this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(n){this.viewportTransform=n;this.renderAll();for(var t=0,i=this._objects.length;t<i;t++)this._objects[t].setCoords();return this},zoomToPoint:function(n,t){var u=n,r,i,f;for(n=fabric.util.transformPoint(n,fabric.util.invertTransform(this.viewportTransform)),this.viewportTransform[0]=t,this.viewportTransform[3]=t,r=fabric.util.transformPoint(n,this.viewportTransform),this.viewportTransform[4]+=u.x-r.x,this.viewportTransform[5]+=u.y-r.y,this.renderAll(),i=0,f=this._objects.length;i<f;i++)this._objects[i].setCoords();return this},setZoom:function(n){return this.zoomToPoint(new fabric.Point(0,0),n),this},absolutePan:function(n){this.viewportTransform[4]=-n.x;this.viewportTransform[5]=-n.y;this.renderAll();for(var t=0,i=this._objects.length;t<i;t++)this._objects[t].setCoords();return this},relativePan:function(n){return this.absolutePan(new fabric.Point(-n.x-this.viewportTransform[4],-n.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(n,t){if(t){n.save();var i=this.viewportTransform;n.transform(i[0],i[1],i[2],i[3],i[4],i[5]);t.render(n);n.restore();this.controlsAboveOverlay||t._renderControls(n)}},_onObjectAdded:function(n){this.stateful&&n.setupState();n.canvas=this;n.setCoords();this.fire("object:added",{target:n});n.fire("added")},_onObjectRemoved:function(n){this.getActiveObject()===n&&(this.fire("before:selection:cleared",{target:n}),this._discardActiveObject(),this.fire("selection:cleared"));this.fire("object:removed",{target:n});n.fire("removed")},clearContext:function(n){return n.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.discardActiveGroup&&this.discardActiveGroup(),this.discardActiveObject&&this.discardActiveObject(),this.clearContext(this.contextContainer),this.contextTop&&this.clearContext(this.contextTop),this.fire("canvas:cleared"),this.renderAll(),this},renderAll:function(n){var t=this[n===!0&&this.interactive?"contextTop":"contextContainer"],i=this.getActiveGroup();return this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop),n||this.clearContext(t),this.fire("before:render"),this.clipTo&&fabric.util.clipContext(this,t),this._renderBackground(t),this._renderObjects(t,i),this._renderActiveGroup(t,i),this.clipTo&&t.restore(),this._renderOverlay(t),this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),this.fire("after:render"),this},_renderObjects:function(n,t){var i,r;if(t)for(i=0,r=this._objects.length;i<r;++i)this._objects[i]&&!t.contains(this._objects[i])&&this._draw(n,this._objects[i]);else for(i=0,r=this._objects.length;i<r;++i)this._draw(n,this._objects[i])},_renderActiveGroup:function(n,t){if(t){var i=[];this.forEachObject(function(n){t.contains(n)&&i.push(n)});t._set("objects",i);this._draw(n,t)}},_renderBackground:function(n){this.backgroundColor&&(n.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(n):this.backgroundColor,n.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height));this.backgroundImage&&this._draw(n,this.backgroundImage)},_renderOverlay:function(n){this.overlayColor&&(n.fillStyle=this.overlayColor.toLive?this.overlayColor.toLive(n):this.overlayColor,n.fillRect(this.overlayColor.offsetX||0,this.overlayColor.offsetY||0,this.width,this.height));this.overlayImage&&this._draw(n,this.overlayImage)},renderTop:function(){var n=this.contextTop||this.contextContainer,t;return this.clearContext(n),this.selection&&this._groupSelector&&this._drawSelection(),t=this.getActiveGroup(),t&&t.render(n),this._renderOverlay(n),this.fire("after:render"),this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(n){return this._centerObject(n,new fabric.Point(this.getCenter().left,n.getCenterPoint().y)),this.renderAll(),this},centerObjectV:function(n){return this._centerObject(n,new fabric.Point(n.getCenterPoint().x,this.getCenter().top)),this.renderAll(),this},centerObject:function(n){var t=this.getCenter();return this._centerObject(n,new fabric.Point(t.left,t.top)),this.renderAll(),this},_centerObject:function(n,t){return n.setPositionByOrigin(t,"center","center"),this},toDatalessJSON:function(n){return this.toDatalessObject(n)},toObject:function(n){return this._toObjectMethod("toObject",n)},toDatalessObject:function(n){return this._toObjectMethod("toDatalessObject",n)},_toObjectMethod:function(t,i){var r=this.getActiveGroup(),u;return r&&this.discardActiveGroup(),u={objects:this._toObjects(t,i)},n(u,this.__serializeBgOverlay()),fabric.util.populateWithProperties(this,u,i),r&&(this.setActiveGroup(new fabric.Group(r.getObjects(),{originX:"center",originY:"center"})),r.forEachObject(function(n){n.set("active",!0)}),this._currentTransform&&(this._currentTransform.target=this.getActiveGroup())),u},_toObjects:function(n,t){return this.getObjects().map(function(i){return this._toObject(i,n,t)},this)},_toObject:function(n,t,i){var r,u;return this.includeDefaultValues||(r=n.includeDefaultValues,n.includeDefaultValues=!1),u=n[t](i),this.includeDefaultValues||(n.includeDefaultValues=r),u},__serializeBgOverlay:function(){var n={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};return this.overlayColor&&(n.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor),this.backgroundImage&&(n.backgroundImage=this.backgroundImage.toObject()),this.overlayImage&&(n.overlayImage=this.overlayImage.toObject()),n},toSVG:function(n,t){n||(n={});var i=[];return this._setSVGPreamble(i,n),this._setSVGHeader(i,n),this._setSVGBgOverlayColor(i,"backgroundColor"),this._setSVGBgOverlayImage(i,"backgroundImage"),this._setSVGObjects(i,t),this._setSVGBgOverlayColor(i,"overlayColor"),this._setSVGBgOverlayImage(i,"overlayImage"),i.push("<\/svg>"),i.join("")},_setSVGPreamble:function(n,t){t.suppressPreamble||n.push('<?xml version="1.0" encoding="',t.encoding||"UTF-8",'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(n,t){n.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',t.viewBox?t.viewBox.width:this.width,'" ','height="',t.viewBox?t.viewBox.height:this.height,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,t.viewBox?'viewBox="'+t.viewBox.x+" "+t.viewBox.y+" "+t.viewBox.width+" "+t.viewBox.height+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",fabric.version,"<\/desc>","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"<\/defs>")},_setSVGObjects:function(n,t){var i=this.getActiveGroup();i&&this.discardActiveGroup();for(var r=0,u=this.getObjects(),f=u.length;r<f;r++)n.push(u[r].toSVG(t));i&&(this.setActiveGroup(new fabric.Group(i.getObjects())),i.forEachObject(function(n){n.set("active",!0)}))},_setSVGBgOverlayImage:function(n,t){this[t]&&this[t].toSVG&&n.push(this[t].toSVG())},_setSVGBgOverlayColor:function(n,t){this[t]&&this[t].source?n.push('<rect x="',this[t].offsetX,'" y="',this[t].offsetY,'" ','width="',this[t].repeat==="repeat-y"||this[t].repeat==="no-repeat"?this[t].source.width:this.width,'" height="',this[t].repeat==="repeat-x"||this[t].repeat==="no-repeat"?this[t].source.height:this.height,'" fill="url(#'+t+'Pattern)"',"><\/rect>"):this[t]&&t==="overlayColor"&&n.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[t],'"',"><\/rect>")},sendToBack:function(n){return t(this._objects,n),this._objects.unshift(n),this.renderAll&&this.renderAll()},bringToFront:function(n){return t(this._objects,n),this._objects.push(n),this.renderAll&&this.renderAll()},sendBackwards:function(n,i){var r=this._objects.indexOf(n),u;return r!==0&&(u=this._findNewLowerIndex(n,r,i),t(this._objects,n),this._objects.splice(u,0,n),this.renderAll&&this.renderAll()),this},_findNewLowerIndex:function(n,t,i){var u,r,f;if(i){for(u=t,r=t-1;r>=0;--r)if(f=n.intersectsWithObject(this._objects[r])||n.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(n),f){u=r;break}}else u=t-1;return u},bringForward:function(n,i){var r=this._objects.indexOf(n),u;return r!==this._objects.length-1&&(u=this._findNewUpperIndex(n,r,i),t(this._objects,n),this._objects.splice(u,0,n),this.renderAll&&this.renderAll()),this},_findNewUpperIndex:function(n,t,i){var u,r,f;if(i){for(u=t,r=t+1;r<this._objects.length;++r)if(f=n.intersectsWithObject(this._objects[r])||n.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(n),f){u=r;break}}else u=t+1;return u},moveTo:function(n,i){return t(this._objects,n),this._objects.splice(i,0,n),this.renderAll&&this.renderAll()},dispose:function(){return this.clear(),this.interactive&&this.removeListeners(),this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}});n(fabric.StaticCanvas.prototype,fabric.Observable);n(fabric.StaticCanvas.prototype,fabric.Collection);n(fabric.StaticCanvas.prototype,fabric.DataURLExporter);n(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(n){var t=fabric.util.createCanvasElement(),i;if(!t||!t.getContext||(i=t.getContext("2d"),!i))return null;switch(n){case"getImageData":return typeof i.getImageData!="undefined";case"setLineDash":return typeof i.setLineDash!="undefined";case"toDataURL":return typeof t.toDataURL!="undefined";case"toDataURLWithQuality":try{return t.toDataURL("image/jpeg",0),!0}catch(r){}return!1;default:return null}}});fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}();fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",setShadow:function(n){return this.shadow=new fabric.Shadow(n),this},_setBrushStyles:function(){var n=this.canvas.contextTop;n.strokeStyle=this.color;n.lineWidth=this.width;n.lineCap=this.strokeLineCap;n.lineJoin=this.strokeLineJoin},_setShadow:function(){if(this.shadow){var n=this.canvas.contextTop;n.shadowColor=this.shadow.color;n.shadowBlur=this.shadow.blur;n.shadowOffsetX=this.shadow.offsetX;n.shadowOffsetY=this.shadow.offsetY}},_resetShadow:function(){var n=this.canvas.contextTop;n.shadowColor="";n.shadowBlur=n.shadowOffsetX=n.shadowOffsetY=0}}),function(){var n=fabric.util.array.min,t=fabric.util.array.max;fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(n){this.canvas=n;this._points=[]},onMouseDown:function(n){this._prepareForDrawing(n);this._captureDrawingPath(n);this._render()},onMouseMove:function(n){this._captureDrawingPath(n);this.canvas.clearContext(this.canvas.contextTop);this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(n){var t=new fabric.Point(n.x,n.y);this._reset();this._addPoint(t);this.canvas.contextTop.moveTo(t.x,t.y)},_addPoint:function(n){this._points.push(n)},_reset:function(){this._points.length=0;this._setBrushStyles();this._setShadow()},_captureDrawingPath:function(n){var t=new fabric.Point(n.x,n.y);this._addPoint(t)},_render:function(){var t=this.canvas.contextTop,i=this.canvas.viewportTransform,n=this._points[0],r=this._points[1],u,e,f;for(t.save(),t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),t.beginPath(),this._points.length===2&&n.x===r.x&&n.y===r.y&&(n.x-=.5,r.x+=.5),t.moveTo(n.x,n.y),u=1,e=this._points.length;u<e;u++)f=n.midPointFrom(r),t.quadraticCurveTo(n.x,n.y,f.x,f.y),n=this._points[u],r=this._points[u+1];t.lineTo(n.x,n.y);t.stroke();t.restore()},_getSVGPathData:function(){return this.box=this.getPathBoundingBox(this._points),this.convertPointsToSVGPath(this._points,this.box.minX,this.box.minY)},getPathBoundingBox:function(i){for(var o,r=[],u=[],f=i[0],h=i[1],s=f,e=1,c=i.length;e<c;e++)o=f.midPointFrom(h),r.push(s.x),r.push(o.x),u.push(s.y),u.push(o.y),f=i[e],h=i[e+1],s=o;return r.push(f.x),u.push(f.y),{minX:n(r),minY:n(u),maxX:t(r),maxY:t(u)}},convertPointsToSVGPath:function(n,t,i){var f=[],u=new fabric.Point(n[0].x-t,n[0].y-i),o=new fabric.Point(n[1].x-t,n[1].y-i),r,s,e;for(f.push("M ",n[0].x-t," ",n[0].y-i," "),r=1,s=n.length;r<s;r++)e=u.midPointFrom(o),f.push("Q ",u.x," ",u.y," ",e.x," ",e.y," "),u=new fabric.Point(n[r].x-t,n[r].y-i),r+1<n.length&&(o=new fabric.Point(n[r+1].x-t,n[r+1].y-i));return f.push("L ",u.x," ",u.y," "),f},createPath:function(n){var t=new fabric.Path(n);return t.fill=null,t.stroke=this.color,t.strokeWidth=this.width,t.strokeLineCap=this.strokeLineCap,t.strokeLineJoin=this.strokeLineJoin,this.shadow&&(this.shadow.affectStroke=!0,t.setShadow(this.shadow)),t},_finalizeAndAddPath:function(){var u=this.canvas.contextTop,t,i,r,n;if(u.closePath(),t=this._getSVGPathData().join(""),t==="M 0 0 Q 0 0 0 0 L 0 0"){this.canvas.renderAll();return}i=this.box.minX+(this.box.maxX-this.box.minX)/2;r=this.box.minY+(this.box.maxY-this.box.minY)/2;this.canvas.contextTop.arc(i,r,3,0,Math.PI*2,!1);n=this.createPath(t);n.set({left:i,top:r,originX:"center",originY:"center"});this.canvas.add(n);n.setCoords();this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderAll();this.canvas.fire("path:created",{path:n})}})}();fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(n){this.canvas=n;this.points=[]},drawDot:function(n){var r=this.addPoint(n),t=this.canvas.contextTop,i=this.canvas.viewportTransform;t.save();t.transform(i[0],i[1],i[2],i[3],i[4],i[5]);t.fillStyle=r.fill;t.beginPath();t.arc(r.x,r.y,r.radius,0,Math.PI*2,!1);t.closePath();t.fill();t.restore()},onMouseDown:function(n){this.points.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.drawDot(n)},onMouseMove:function(n){this.drawDot(n)},onMouseUp:function(){var e=this.canvas.renderOnAddRemove,r,t,f,n,u,i;for(this.canvas.renderOnAddRemove=!1,r=[],t=0,f=this.points.length;t<f;t++)n=this.points[t],u=new fabric.Circle({radius:n.radius,left:n.x,top:n.y,originX:"center",originY:"center",fill:n.fill}),this.shadow&&u.setShadow(this.shadow),r.push(u);i=new fabric.Group(r,{originX:"center",originY:"center"});i.canvas=this.canvas;this.canvas.add(i);this.canvas.fire("path:created",{path:i});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=e;this.canvas.renderAll()},addPoint:function(n){var t=new fabric.Point(n.x,n.y),i=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,r=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return t.radius=i,t.fill=r,this.points.push(t),t}});fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(n){this.canvas=n;this.sprayChunks=[]},onMouseDown:function(n){this.sprayChunks.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.addSprayChunk(n);this.render()},onMouseMove:function(n){this.addSprayChunk(n);this.render()},onMouseUp:function(){var s=this.canvas.renderOnAddRemove,i,r,e,t,n,o,f,u;for(this.canvas.renderOnAddRemove=!1,i=[],r=0,e=this.sprayChunks.length;r<e;r++)for(t=this.sprayChunks[r],n=0,o=t.length;n<o;n++)f=new fabric.Rect({width:t[n].width,height:t[n].width,left:t[n].x+1,top:t[n].y+1,originX:"center",originY:"center",fill:this.color}),this.shadow&&f.setShadow(this.shadow),i.push(f);this.optimizeOverlapping&&(i=this._getOptimizedRects(i));u=new fabric.Group(i,{originX:"center",originY:"center"});u.canvas=this.canvas;this.canvas.add(u);this.canvas.fire("path:created",{path:u});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=s;this.canvas.renderAll()},_getOptimizedRects:function(n){for(var u,r={},t,i=0,f=n.length;i<f;i++)t=n[i].left+""+n[i].top,r[t]||(r[t]=n[i]);u=[];for(t in r)u.push(r[t]);return u},render:function(){var i=this.canvas.contextTop,n,r,u,t;for(i.fillStyle=this.color,n=this.canvas.viewportTransform,i.save(),i.transform(n[0],n[1],n[2],n[3],n[4],n[5]),r=0,u=this.sprayChunkPoints.length;r<u;r++)t=this.sprayChunkPoints[r],typeof t.opacity!="undefined"&&(i.globalAlpha=t.opacity),i.fillRect(t.x,t.y,t.width,t.width);i.restore()},addSprayChunk:function(n){var u,f,e,t,r,i;for(this.sprayChunkPoints=[],t=this.width/2,r=0;r<this.density;r++)u=fabric.util.getRandomInt(n.x-t,n.x+t),f=fabric.util.getRandomInt(n.y-t,n.y+t),e=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth,i=new fabric.Point(u,f),i.width=e,this.randomOpacity&&(i.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(i);this.sprayChunks.push(this.sprayChunkPoints)}});fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var t=20,i=fabric.document.createElement("canvas"),n=i.getContext("2d");return i.width=i.height=t+5,n.fillStyle=this.color,n.beginPath(),n.arc(t/2,t/2,t/2,0,Math.PI*2,!1),n.closePath(),n.fill(),i},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles");this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(n){var t=this.callSuper("createPath",n);return t.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction()}),t}}),function(){var u=fabric.util.getPointer,f=fabric.util.degreesToRadians,e=fabric.util.radiansToDegrees,r=Math.atan2,n=Math.abs,t=.5,i;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(n,t){t||(t={});this._initStatic(n,t);this._initInteractive();this._createCacheCanvas();fabric.Canvas.activeInstance=this},uniScaleTransform:!1,centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,_initInteractive:function(){this._currentTransform=null;this._groupSelector=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this);this.calcOffset()},_resetCurrentTransform:function(n){var t=this._currentTransform;t.target.set({scaleX:t.original.scaleX,scaleY:t.original.scaleY,left:t.original.left,top:t.original.top});this._shouldCenterTransform(n,t.target)?t.action==="rotate"?this._setOriginToCenter(t.target):(t.originX!=="center"&&(t.mouseXSign=t.originX==="right"?-1:1),t.originY!=="center"&&(t.mouseYSign=t.originY==="bottom"?-1:1),t.originX="center",t.originY="center"):(t.originX=t.original.originX,t.originY=t.original.originY)},containsPoint:function(n,t){var i=this.getPointer(n,!0),r=this._normalizePointer(t,i);return t.containsPoint(r)||t._findTargetCorner(i)},_normalizePointer:function(n,t){var r=this.getActiveGroup(),u=t.x,f=t.y,e=r&&n.type!=="group"&&r.contains(n),i;return e&&(i=new fabric.Point(r.left,r.top),i=fabric.util.transformPoint(i,this.viewportTransform,!0),u-=i.x,f-=i.y),{x:u,y:f}},isTargetTransparent:function(n,t,i){var u=n.hasBorders,f=n.transparentCorners,r;return n.hasBorders=n.transparentCorners=!1,this._draw(this.contextCache,n),n.hasBorders=u,n.transparentCorners=f,r=fabric.util.isTransparent(this.contextCache,t,i,this.targetFindTolerance),this.clearContext(this.contextCache),r},_shouldClearSelection:function(n,t){var i=this.getActiveGroup(),r=this.getActiveObject();return!t||t&&i&&!i.contains(t)&&i!==t&&!n.shiftKey||t&&!t.evented||t&&!t.selectable&&r&&r!==t},_shouldCenterTransform:function(n,t){if(t){var i=this._currentTransform,r;return i.action==="scale"||i.action==="scaleX"||i.action==="scaleY"?r=this.centeredScaling||t.centeredScaling:i.action==="rotate"&&(r=this.centeredRotation||t.centeredRotation),r?!n.altKey:n.altKey}},_getOriginFromCorner:function(n,t){var i={x:n.originX,y:n.originY};return t==="ml"||t==="tl"||t==="bl"?i.x="right":(t==="mr"||t==="tr"||t==="br")&&(i.x="left"),t==="tl"||t==="mt"||t==="tr"?i.y="bottom":(t==="bl"||t==="mb"||t==="br")&&(i.y="top"),i},_getActionFromCorner:function(n,t){var i="drag";return t&&(i=t==="ml"||t==="mr"?"scaleX":t==="mt"||t==="mb"?"scaleY":t==="mtr"?"rotate":"scale"),i},_setupCurrentTransform:function(n,t){if(t){var i=this.getPointer(n),u=t._findTargetCorner(this.getPointer(n,!0)),e=this._getActionFromCorner(t,u),r=this._getOriginFromCorner(t,u);this._currentTransform={target:t,action:e,scaleX:t.scaleX,scaleY:t.scaleY,offsetX:i.x-t.left,offsetY:i.y-t.top,originX:r.x,originY:r.y,ex:i.x,ey:i.y,left:t.left,top:t.top,theta:f(t.angle),width:t.width*t.scaleX,mouseXSign:1,mouseYSign:1};this._currentTransform.original={left:t.left,top:t.top,scaleX:t.scaleX,scaleY:t.scaleY,originX:r.x,originY:r.y};this._resetCurrentTransform(n)}},_translateObject:function(n,t){var i=this._currentTransform.target;i.get("lockMovementX")||i.set("left",n-this._currentTransform.offsetX);i.get("lockMovementY")||i.set("top",t-this._currentTransform.offsetY)},_scaleObject:function(n,t,i){var r=this._currentTransform,u=r.target,e=u.get("lockScalingX"),o=u.get("lockScalingY"),h=u.get("lockScalingFlip"),s,f;e&&o||(s=u.translateToOriginPoint(u.getCenterPoint(),r.originX,r.originY),f=u.toLocalPoint(new fabric.Point(n,t),r.originX,r.originY),this._setLocalMouse(f,r),this._setObjectScale(f,r,e,o,i,h),u.setPositionByOrigin(s,r.originX,r.originY))},_setObjectScale:function(n,t,i,r,u,f){var e=t.target,o=!1,s=!1;t.newScaleX=n.x/(e.width+e.strokeWidth);t.newScaleY=n.y/(e.height+e.strokeWidth);f&&t.newScaleX<=0&&t.newScaleX<e.scaleX&&(o=!0);f&&t.newScaleY<=0&&t.newScaleY<e.scaleY&&(s=!0);u!=="equally"||i||r?u?u!=="x"||e.get("lockUniScaling")?u!=="y"||e.get("lockUniScaling")||s||r||e.set("scaleY",t.newScaleY):o||i||e.set("scaleX",t.newScaleX):(o||i||e.set("scaleX",t.newScaleX),s||r||e.set("scaleY",t.newScaleY)):o||s||this._scaleObjectEqually(n,e,t);o||s||this._flipObject(t)},_scaleObjectEqually:function(n,t,i){var r=n.y+n.x,u=(t.height+t.strokeWidth)*i.original.scaleY+(t.width+t.strokeWidth)*i.original.scaleX;i.newScaleX=i.original.scaleX*r/u;i.newScaleY=i.original.scaleY*r/u;t.set("scaleX",i.newScaleX);t.set("scaleY",i.newScaleY)},_flipObject:function(n){n.newScaleX<0&&(n.originX==="left"?n.originX="right":n.originX==="right"&&(n.originX="left"));n.newScaleY<0&&(n.originY==="top"?n.originY="bottom":n.originY==="bottom"&&(n.originY="top"))},_setLocalMouse:function(t,i){var r=i.target;i.originX==="right"?t.x*=-1:i.originX==="center"&&(t.x*=i.mouseXSign*2,t.x<0&&(i.mouseXSign=-i.mouseXSign));i.originY==="bottom"?t.y*=-1:i.originY==="center"&&(t.y*=i.mouseYSign*2,t.y<0&&(i.mouseYSign=-i.mouseYSign));n(t.x)>r.padding?t.x<0?t.x+=r.padding:t.x-=r.padding:t.x=0;n(t.y)>r.padding?t.y<0?t.y+=r.padding:t.y-=r.padding:t.y=0},_rotateObject:function(n,t){var i=this._currentTransform;if(!i.target.get("lockRotation")){var f=r(i.ey-i.top,i.ex-i.left),o=r(t-i.top,n-i.left),u=e(o-f+i.theta);u<0&&(u=360+u);i.target.angle=u}},setCursor:function(n){this.upperCanvasEl.style.cursor=n},_resetObjectTransform:function(n){n.scaleX=1;n.scaleY=1;n.setAngle(0)},_drawSelection:function(){var i=this.contextTop,f=this._groupSelector,s=f.left,h=f.top,e=n(s),o=n(h),r,u;i.fillStyle=this.selectionColor;i.fillRect(f.ex-(s>0?0:-s),f.ey-(h>0?0:-h),e,o);i.lineWidth=this.selectionLineWidth;i.strokeStyle=this.selectionBorderColor;this.selectionDashArray.length>1?(r=f.ex+t-(s>0?0:e),u=f.ey+t-(h>0?0:o),i.beginPath(),fabric.util.drawDashedLine(i,r,u,r+e,u,this.selectionDashArray),fabric.util.drawDashedLine(i,r,u+o-1,r+e,u+o-1,this.selectionDashArray),fabric.util.drawDashedLine(i,r,u,r,u+o,this.selectionDashArray),fabric.util.drawDashedLine(i,r+e-1,u,r+e-1,u+o,this.selectionDashArray),i.closePath(),i.stroke()):i.strokeRect(f.ex+t-(s>0?0:e),f.ey+t-(h>0?0:o),e,o)},_isLastRenderedObject:function(n){return this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(n,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(n,!0))},findTarget:function(n,t){var i,r;if(!this.skipTargetFind)return this._isLastRenderedObject(n)?this.lastRenderedObjectWithControlsAboveOverlay:(i=this.getActiveGroup(),i&&!t&&this.containsPoint(n,i))?i:(r=this._searchPossibleTargets(n),this._fireOverOutEvents(r),r)},_fireOverOutEvents:function(n){n?this._hoveredTarget!==n&&(this.fire("mouse:over",{target:n}),n.fire("mouseover"),this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout")),this._hoveredTarget=n):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},_checkTarget:function(n,t,i){if(t&&t.visible&&t.evented&&this.containsPoint(n,t))if((this.perPixelTargetFind||t.perPixelTargetFind)&&!t.isEditing){var r=this.isTargetTransparent(t,i.x,i.y);if(!r)return!0}else return!0},_searchPossibleTargets:function(n){for(var i,r=this.getPointer(n,!0),t=this._objects.length;t--;)if(this._checkTarget(n,this._objects[t],r)){this.relatedTarget=this._objects[t];i=this._objects[t];break}return i},getPointer:function(n,t,i){i||(i=this.upperCanvasEl);var r=u(n,i),f=i.getBoundingClientRect(),e;return this.calcOffset(),r.x=r.x-this._offset.left,r.y=r.y-this._offset.top,t||(r=fabric.util.transformPoint(r,fabric.util.invertTransform(this.viewportTransform))),e=f.width===0||f.height===0?{width:1,height:1}:{width:i.width/f.width,height:i.height/f.height},{x:r.x*e.width,y:r.y*e.height}},_createUpperCanvas:function(){var n=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement();fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+n);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"});fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(n){var t=this.getWidth()||n.width,i=this.getHeight()||n.height;fabric.util.setStyle(n,{position:"absolute",width:t+"px",height:i+"px",left:0,top:0});n.width=t;n.height=i;fabric.util.makeElementUnselectable(n)},_copyCanvasStyle:function(n,t){t.style.cssText=n.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(n){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=n;n.set("active",!0)},setActiveObject:function(n,t){return this._setActiveObject(n),this.renderAll(),this.fire("object:selected",{target:n,e:t}),n.fire("selected",{e:t}),this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=null},discardActiveObject:function(n){return this._discardActiveObject(),this.renderAll(),this.fire("selection:cleared",{e:n}),this},_setActiveGroup:function(n){this._activeGroup=n;n&&n.set("active",!0)},setActiveGroup:function(n,t){return this._setActiveGroup(n),n&&(this.fire("object:selected",{target:n,e:t}),n.fire("selected",{e:t})),this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var n=this.getActiveGroup();n&&n.destroy();this.setActiveGroup(null)},discardActiveGroup:function(n){return this._discardActiveGroup(),this.fire("selection:cleared",{e:n}),this},deactivateAll:function(){for(var t=this.getObjects(),n=0,i=t.length;n<i;n++)t[n].set("active",!1);return this._discardActiveGroup(),this._discardActiveObject(),this},deactivateAllWithDispatch:function(n){var t=this.getActiveGroup()||this.getActiveObject();return t&&this.fire("before:selection:cleared",{target:t,e:n}),this.deactivateAll(),t&&this.fire("selection:cleared",{e:n}),this},drawControls:function(n){var t=this.getActiveGroup();t?this._drawGroupControls(n,t):this._drawObjectsControls(n)},_drawGroupControls:function(n,t){t._renderControls(n)},_drawObjectsControls:function(n){for(var t=0,i=this._objects.length;t<i;++t)this._objects[t]&&this._objects[t].active&&(this._objects[t]._renderControls(n),this.lastRenderedObjectWithControlsAboveOverlay=this._objects[t])}});for(i in fabric.StaticCanvas)i!=="prototype"&&(fabric.Canvas[i]=fabric.StaticCanvas[i]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){});fabric.Element=fabric.Canvas}(),function(){var i={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},n=fabric.util.addListener,t=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this._bindEvents();n(fabric.window,"resize",this._onResize);n(this.upperCanvasEl,"mousedown",this._onMouseDown);n(this.upperCanvasEl,"mousemove",this._onMouseMove);n(this.upperCanvasEl,"mousewheel",this._onMouseWheel);n(this.upperCanvasEl,"touchstart",this._onMouseDown);n(this.upperCanvasEl,"touchmove",this._onMouseMove);typeof Event!="undefined"&&"add"in Event&&(Event.add(this.upperCanvasEl,"gesture",this._onGesture),Event.add(this.upperCanvasEl,"drag",this._onDrag),Event.add(this.upperCanvasEl,"orientation",this._onOrientationChange),Event.add(this.upperCanvasEl,"shake",this._onShake))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);this._onOrientationChange=this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){t(fabric.window,"resize",this._onResize);t(this.upperCanvasEl,"mousedown",this._onMouseDown);t(this.upperCanvasEl,"mousemove",this._onMouseMove);t(this.upperCanvasEl,"mousewheel",this._onMouseWheel);t(this.upperCanvasEl,"touchstart",this._onMouseDown);t(this.upperCanvasEl,"touchmove",this._onMouseMove);typeof Event!="undefined"&&"remove"in Event&&(Event.remove(this.upperCanvasEl,"gesture",this._onGesture),Event.remove(this.upperCanvasEl,"drag",this._onDrag),Event.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),Event.remove(this.upperCanvasEl,"shake",this._onShake))},_onGesture:function(n,t){this.__onTransformGesture&&this.__onTransformGesture(n,t)},_onDrag:function(n,t){this.__onDrag&&this.__onDrag(n,t)},_onMouseWheel:function(n,t){this.__onMouseWheel&&this.__onMouseWheel(n,t)},_onOrientationChange:function(n,t){this.__onOrientationChange&&this.__onOrientationChange(n,t)},_onShake:function(n,t){this.__onShake&&this.__onShake(n,t)},_onMouseDown:function(i){this.__onMouseDown(i);n(fabric.document,"touchend",this._onMouseUp);n(fabric.document,"touchmove",this._onMouseMove);t(this.upperCanvasEl,"mousemove",this._onMouseMove);t(this.upperCanvasEl,"touchmove",this._onMouseMove);i.type==="touchstart"?t(this.upperCanvasEl,"mousedown",this._onMouseDown):(n(fabric.document,"mouseup",this._onMouseUp),n(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(i){if(this.__onMouseUp(i),t(fabric.document,"mouseup",this._onMouseUp),t(fabric.document,"touchend",this._onMouseUp),t(fabric.document,"mousemove",this._onMouseMove),t(fabric.document,"touchmove",this._onMouseMove),n(this.upperCanvasEl,"mousemove",this._onMouseMove),n(this.upperCanvasEl,"touchmove",this._onMouseMove),i.type==="touchend"){var r=this;setTimeout(function(){n(r.upperCanvasEl,"mousedown",r._onMouseDown)},400)}},_onMouseMove:function(n){!this.allowTouchScrolling&&n.preventDefault&&n.preventDefault();this.__onMouseMove(n)},_onResize:function(){this.calcOffset()},_shouldRender:function(n,t){var i=this.getActiveGroup()||this.getActiveObject();return!!(n&&(n.isMoving||n!==i)||!n&&!!i||!n&&!i&&!this._groupSelector||t&&this._previousPointer&&this.selection&&(t.x!==this._previousPointer.x||t.y!==this._previousPointer.y))},__onMouseUp:function(n){var t,i;if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(n);return}this._currentTransform?(this._finalizeCurrentTransform(),t=this._currentTransform.target):t=this.findTarget(n,!0);i=this._shouldRender(t,this.getPointer(n));this._maybeGroupObjects(n);t&&(t.isMoving=!1);i&&this.renderAll();this._handleCursorAndEvent(n,t)},_handleCursorAndEvent:function(n,t){this._setCursorFromEvent(n,t);var i=this;setTimeout(function(){i._setCursorFromEvent(n,t)},50);this.fire("mouse:up",{target:t,e:n});t&&t.fire("mouseup",{e:n})},_finalizeCurrentTransform:function(){var t=this._currentTransform,n=t.target;n._scaling&&(n._scaling=!1);n.setCoords();this.stateful&&n.hasStateChanged()&&(this.fire("object:modified",{target:n}),n.fire("modified"));this._restoreOriginXY(n)},_restoreOriginXY:function(n){if(this._previousOriginX&&this._previousOriginY){var t=n.translateToOriginPoint(n.getCenterPoint(),this._previousOriginX,this._previousOriginY);n.originX=this._previousOriginX;n.originY=this._previousOriginY;n.left=t.x;n.top=t.y;this._previousOriginX=null;this._previousOriginY=null}},_onMouseDownInDrawingMode:function(n){this._isCurrentlyDrawing=!0;this.discardActiveObject(n).renderAll();this.clipTo&&fabric.util.clipContext(this,this.contextTop);var t=fabric.util.invertTransform(this.viewportTransform),i=fabric.util.transformPoint(this.getPointer(n,!0),t);this.freeDrawingBrush.onMouseDown(i);this.fire("mouse:down",{e:n})},_onMouseMoveInDrawingMode:function(n){if(this._isCurrentlyDrawing){var t=fabric.util.invertTransform(this.viewportTransform),i=fabric.util.transformPoint(this.getPointer(n,!0),t);this.freeDrawingBrush.onMouseMove(i)}this.setCursor(this.freeDrawingCursor);this.fire("mouse:move",{e:n})},_onMouseUpInDrawingMode:function(n){this._isCurrentlyDrawing=!1;this.clipTo&&this.contextTop.restore();this.freeDrawingBrush.onMouseUp();this.fire("mouse:up",{e:n})},__onMouseDown:function(n){var f="which"in n?n.which===1:n.button===1,t,i,u,r;if(f||fabric.isTouchSupported){if(this.isDrawingMode){this._onMouseDownInDrawingMode(n);return}this._currentTransform||(t=this.findTarget(n),i=this.getPointer(n,!0),this._previousPointer=i,u=this._shouldRender(t,i),r=this._shouldGroup(n,t),this._shouldClearSelection(n,t)?this._clearSelection(n,t,i):r&&(this._handleGrouping(n,t),t=this.getActiveGroup()),t&&t.selectable&&!r&&(this._beforeTransform(n,t),this._setupCurrentTransform(n,t)),u&&this.renderAll(),this.fire("mouse:down",{target:t,e:n}),t&&t.fire("mousedown",{e:n}))}},_beforeTransform:function(n,t){var i;if(this.stateful&&t.saveState(),i=t._findTargetCorner(this.getPointer(n)))this.onBeforeScaleRotate(t);t!==this.getActiveGroup()&&t!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(t,n))},_clearSelection:function(n,t,i){this.deactivateAllWithDispatch(n);t&&t.selectable?this.setActiveObject(t,n):this.selection&&(this._groupSelector={ex:i.x,ey:i.y,top:0,left:0})},_setOriginToCenter:function(n){this._previousOriginX=this._currentTransform.target.originX;this._previousOriginY=this._currentTransform.target.originY;var t=n.getCenterPoint();n.originX="center";n.originY="center";n.left=t.x;n.top=t.y;this._currentTransform.left=n.left;this._currentTransform.top=n.top},_setCenterToOrigin:function(n){var t=n.translateToOriginPoint(n.getCenterPoint(),this._previousOriginX,this._previousOriginY);n.originX=this._previousOriginX;n.originY=this._previousOriginY;n.left=t.x;n.top=t.y;this._previousOriginX=null;this._previousOriginY=null},__onMouseMove:function(n){var t,r,i;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(n);return}i=this._groupSelector;i?(r=this.getPointer(n,!0),i.left=r.x-i.ex,i.top=r.y-i.ey,this.renderTop()):this._currentTransform?this._transformObject(n):(t=this.findTarget(n),t&&(!t||t.selectable)?this._setCursorFromEvent(n,t):this.setCursor(this.defaultCursor));this.fire("mouse:move",{target:t,e:n});t&&t.fire("mousemove",{e:n})},_transformObject:function(n){var i=this.getPointer(n),t=this._currentTransform;t.reset=!1;t.target.isMoving=!0;this._beforeScaleTransform(n,t);this._performTransformAction(n,t,i);this.renderAll()},_performTransformAction:function(n,t,i){var r=i.x,u=i.y,f=t.target,e=t.action;e==="rotate"?(this._rotateObject(r,u),this._fire("rotating",f,n)):e==="scale"?(this._onScale(n,t,r,u),this._fire("scaling",f,n)):e==="scaleX"?(this._scaleObject(r,u,"x"),this._fire("scaling",f,n)):e==="scaleY"?(this._scaleObject(r,u,"y"),this._fire("scaling",f,n)):(this._translateObject(r,u),this._fire("moving",f,n),this.setCursor(this.moveCursor))},_fire:function(n,t,i){this.fire("object:"+n,{target:t,e:i});t.fire(n,{e:i})},_beforeScaleTransform:function(n,t){if(t.action==="scale"||t.action==="scaleX"||t.action==="scaleY"){var i=this._shouldCenterTransform(n,t.target);(i&&(t.originX!=="center"||t.originY!=="center")||!i&&t.originX==="center"&&t.originY==="center")&&(this._resetCurrentTransform(n),t.reset=!0)}},_onScale:function(n,t,i,r){(n.shiftKey||this.uniScaleTransform)&&!t.target.get("lockUniScaling")?(t.currentAction="scale",this._scaleObject(i,r)):(t.reset||t.currentAction!=="scale"||this._resetCurrentTransform(n,t.target),t.currentAction="scaleEqually",this._scaleObject(i,r,"equally"))},_setCursorFromEvent:function(n,t){if(t&&t.selectable){var i=this.getActiveGroup(),r=t._findTargetCorner&&(!i||!i.contains(t))&&t._findTargetCorner(this.getPointer(n,!0));r?this._setCornerCursor(r,t):this.setCursor(t.hoverCursor||this.hoverCursor)}else return this.setCursor(this.defaultCursor),!1;return!0},_setCornerCursor:function(n,t){if(n in i)this.setCursor(this._getRotatedCornerCursor(n,t));else if(n==="mtr"&&t.hasRotatingPoint)this.setCursor(this.rotationCursor);else return this.setCursor(this.defaultCursor),!1},_getRotatedCornerCursor:function(n,t){var r=Math.round(t.getAngle()%360/45);return r<0&&(r+=8),r+=i[n],r%=8,this.cursorMap[r]}})}(),function(){var n=Math.min,t=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(n,t){var i=this.getActiveObject();return n.shiftKey&&(this.getActiveGroup()||i&&i!==t)&&this.selection},_handleGrouping:function(n,t){(t!==this.getActiveGroup()||(t=this.findTarget(n,!0),t&&!t.isType("group")))&&(this.getActiveGroup()?this._updateActiveGroup(t,n):this._createActiveGroup(t,n),this._activeGroup&&this._activeGroup.saveCoords())},_updateActiveGroup:function(n,t){var i=this.getActiveGroup();if(i.contains(n)){if(i.removeWithUpdate(n),this._resetObjectTransform(i),n.set("active",!1),i.size()===1){this.discardActiveGroup(t);this.setActiveObject(i.item(0));return}}else i.addWithUpdate(n),this._resetObjectTransform(i);this.fire("selection:created",{target:i,e:t});i.set("active",!0)},_createActiveGroup:function(n,t){if(this._activeObject&&n!==this._activeObject){var i=this._createGroup(n);i.addWithUpdate();this.setActiveGroup(i);this._activeObject=null;this.fire("selection:created",{target:i,e:t})}n.set("active",!0)},_createGroup:function(n){var t=this.getObjects(),i=t.indexOf(this._activeObject)<t.indexOf(n),r=i?[this._activeObject,n]:[n,this._activeObject];return new fabric.Group(r,{originX:"center",originY:"center",canvas:this})},_groupSelectedObjects:function(n){var t=this._collectObjects();t.length===1?this.setActiveObject(t[0],n):t.length>1&&(t=new fabric.Group(t.reverse(),{originX:"center",originY:"center",canvas:this}),t.addWithUpdate(),this.setActiveGroup(t,n),t.saveCoords(),this.fire("selection:created",{target:t}),this.renderAll())},_collectObjects:function(){for(var h=[],i,r=this._groupSelector.ex,u=this._groupSelector.ey,f=r+this._groupSelector.left,e=u+this._groupSelector.top,o=new fabric.Point(n(r,f),n(u,e)),s=new fabric.Point(t(r,f),t(u,e)),l=r===f&&u===e,c=this._objects.length;c--;)if((i=this._objects[c],i&&i.selectable&&i.visible)&&(i.intersectsWithRect(o,s)||i.isContainedWithinRect(o,s)||i.containsPoint(o)||i.containsPoint(s))&&(i.set("active",!0),h.push(i),l))break;return h},_maybeGroupObjects:function(n){this.selection&&this._groupSelector&&this._groupSelectedObjects(n);var t=this.getActiveGroup();t&&(t.setObjectsCoords().setCoords(),t.isMoving=!1,this.setCursor(this.defaultCursor));this._groupSelector=null;this._currentTransform=null}})}();fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(n){n||(n={});var t=n.format||"png",i=n.quality||1,r=n.multiplier||1,u={left:n.left,top:n.top,width:n.width,height:n.height};return r!==1?this.__toDataURLWithMultiplier(t,i,u,r):this.__toDataURL(t,i,u)},__toDataURL:function(n,t,i){var u,r,f;return this.renderAll(!0),u=this.upperCanvasEl||this.lowerCanvasEl,r=this.__getCroppedCanvas(u,i),n==="jpg"&&(n="jpeg"),f=fabric.StaticCanvas.supports("toDataURLWithQuality")?(r||u).toDataURL("image/"+n,t):(r||u).toDataURL("image/"+n),this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),r&&(r=null),f},__getCroppedCanvas:function(n,t){var i,r,u="left"in t||"top"in t||"width"in t||"height"in t;return u&&(i=fabric.util.createCanvasElement(),r=i.getContext("2d"),i.width=t.width||this.width,i.height=t.height||this.height,r.drawImage(n,-t.left||0,-t.top||0)),i},__toDataURLWithMultiplier:function(n,t,i,r){var f=this.getWidth(),e=this.getHeight(),s=f*r,h=e*r,o=this.getActiveObject(),u=this.getActiveGroup(),c=this.contextTop||this.contextContainer,l;return r>1&&this.setWidth(s).setHeight(h),c.scale(r,r),i.left&&(i.left*=r),i.top&&(i.top*=r),i.width?i.width*=r:r<1&&(i.width=s),i.height?i.height*=r:r<1&&(i.height=h),u?this._tempRemoveBordersControlsFromGroup(u):o&&this.deactivateAll&&this.deactivateAll(),this.renderAll(!0),l=this.__toDataURL(n,t,i),this.width=f,this.height=e,c.scale(1/r,1/r),this.setWidth(f).setHeight(e),u?this._restoreBordersControlsOnGroup(u):o&&this.setActiveObject&&this.setActiveObject(o),this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),l},toDataURLWithMultiplier:function(n,t,i){return this.toDataURL({format:n,multiplier:t,quality:i})},_tempRemoveBordersControlsFromGroup:function(n){n.origHasControls=n.hasControls;n.origBorderColor=n.borderColor;n.hasControls=!0;n.borderColor="rgba(0,0,0,0)";n.forEachObject(function(n){n.origBorderColor=n.borderColor;n.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(n){n.hideControls=n.origHideControls;n.borderColor=n.origBorderColor;n.forEachObject(function(n){n.borderColor=n.origBorderColor;delete n.origBorderColor})}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(n,t,i){return this.loadFromJSON(n,t,i)},loadFromJSON:function(n,t,i){var r,u;if(n)return r=typeof n=="string"?JSON.parse(n):n,this.clear(),u=this,this._enlivenObjects(r.objects,function(){u._setBgOverlay(r,t)},i),this},_setBgOverlay:function(n,t){var u=this,i={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1},r;if(!n.backgroundImage&&!n.overlayImage&&!n.background&&!n.overlay){t&&t();return}r=function(){i.backgroundImage&&i.overlayImage&&i.backgroundColor&&i.overlayColor&&(u.renderAll(),t&&t())};this.__setBgOverlay("backgroundImage",n.backgroundImage,i,r);this.__setBgOverlay("overlayImage",n.overlayImage,i,r);this.__setBgOverlay("backgroundColor",n.background,i,r);this.__setBgOverlay("overlayColor",n.overlay,i,r);r()},__setBgOverlay:function(n,t,i,r){var u=this;if(!t){i[n]=!0;return}n==="backgroundImage"||n==="overlayImage"?fabric.Image.fromObject(t,function(t){u[n]=t;i[n]=!0;r&&r()}):this["set"+fabric.util.string.capitalize(n,!0)](t,function(){i[n]=!0;r&&r()})},_enlivenObjects:function(n,t,i){var r=this,u;if(!n||n.length===0){t&&t();return}u=this.renderOnAddRemove;this.renderOnAddRemove=!1;fabric.util.enlivenObjects(n,function(n){n.forEach(function(n,t){r.insertAt(n,t,!0)});r.renderOnAddRemove=u;t&&t()},null,i)},_toDataURL:function(n,t){this.clone(function(i){t(i.toDataURL(n))})},_toDataURLWithMultiplier:function(n,t,i){this.clone(function(r){i(r.toDataURLWithMultiplier(n,t))})},clone:function(n,t){var i=JSON.stringify(this.toJSON(t));this.cloneWithoutData(function(t){t.loadFromJSON(i,function(){n&&n(t)})})},cloneWithoutData:function(n){var i=fabric.document.createElement("canvas"),t;i.width=this.getWidth();i.height=this.getHeight();t=new fabric.Canvas(i);t.clipTo=this.clipTo;this.backgroundImage?(t.setBackgroundImage(this.backgroundImage.src,function(){t.renderAll();n&&n(t)}),t.backgroundImageOpacity=this.backgroundImageOpacity,t.backgroundImageStretch=this.backgroundImageStretch):n&&n(t)}}),function(n){"use strict";var t=n.fabric||(n.fabric={}),u=t.util.object.extend,i=t.util.toFixed,f=t.util.string.capitalize,r=t.util.degreesToRadians,e=t.StaticCanvas.supports("setLineDash");t.Object||(t.Object=t.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockScalingFlip:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule shadow clipTo visible backgroundColor".split(" "),initialize:function(n){n&&this.setOptions(n)},_initGradient:function(n){!n.fill||!n.fill.colorStops||n.fill instanceof t.Gradient||this.set("fill",new t.Gradient(n.fill))},_initPattern:function(n){!n.fill||!n.fill.source||n.fill instanceof t.Pattern||this.set("fill",new t.Pattern(n.fill));!n.stroke||!n.stroke.source||n.stroke instanceof t.Pattern||this.set("stroke",new t.Pattern(n.stroke))},_initClipping:function(n){if(n.clipTo&&typeof n.clipTo=="string"){var i=t.util.getFunctionBody(n.clipTo);typeof i!="undefined"&&(this.clipTo=new Function("ctx",i))}},setOptions:function(n){for(var t in n)this.set(t,n[t]);this._initGradient(n);this._initPattern(n);this._initClipping(n)},transform:function(n,t){this.group&&this.group.transform(n,t);n.globalAlpha=this.opacity;var i=t?this._getLeftTopCoords():this.getCenterPoint();n.translate(i.x,i.y);n.rotate(r(this.angle));n.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(n){var r=t.Object.NUM_FRACTION_DIGITS,u={type:this.type,originX:this.originX,originY:this.originY,left:i(this.left,r),top:i(this.top,r),width:i(this.width,r),height:i(this.height,r),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:i(this.strokeWidth,r),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:i(this.strokeMiterLimit,r),scaleX:i(this.scaleX,r),scaleY:i(this.scaleY,r),angle:i(this.getAngle(),r),flipX:this.flipX,flipY:this.flipY,opacity:i(this.opacity,r),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor};return this.includeDefaultValues||(u=this._removeDefaultValues(u)),t.util.populateWithProperties(this,u,n),u},toDatalessObject:function(n){return this.toObject(n)},_removeDefaultValues:function(n){var i=t.util.getKlass(n.type).prototype,r=i.stateProperties;return r.forEach(function(t){n[t]===i[t]&&delete n[t]}),n},toString:function(){return"#<fabric."+f(this.type)+">"},get:function(n){return this[n]},_setObject:function(n){for(var t in n)this._set(t,n[t])},set:function(n,t){return typeof n=="object"?this._setObject(n):typeof t=="function"&&n!=="clipTo"?this._set(n,t(this.get(n))):this._set(n,t),this},_set:function(n,r){var u=n==="scaleX"||n==="scaleY";return u&&(r=this._constrainScale(r)),n==="scaleX"&&r<0?(this.flipX=!this.flipX,r*=-1):n==="scaleY"&&r<0?(this.flipY=!this.flipY,r*=-1):n==="width"||n==="height"?this.minScaleLimit=i(Math.min(.1,1/Math.max(this.width,this.height)),2):n!=="shadow"||!r||r instanceof t.Shadow||(r=new t.Shadow(r)),this[n]=r,this},toggle:function(n){var t=this.get(n);return typeof t=="boolean"&&this.set(n,!t),this},setSourcePath:function(n){return this.sourcePath=n,this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(n,i){if(this.width!==0&&this.height!==0&&this.visible){if(n.save(),this._setupFillRule(n),this._transform(n,i),this._setStrokeStyles(n),this._setFillStyles(n),this.group&&this.group.type==="path-group"){n.translate(-this.group.width/2,-this.group.height/2);var r=this.transformMatrix;r&&n.transform.apply(n,r)}n.globalAlpha=this.group?n.globalAlpha*this.opacity:this.opacity;this._setShadow(n);this.clipTo&&t.util.clipContext(this,n);this._render(n,i);this.clipTo&&n.restore();this._removeShadow(n);this._restoreFillRule(n);n.restore()}},_transform:function(n,t){var i=this.transformMatrix;i&&!this.group&&n.setTransform.apply(n,i);t||this.transform(n)},_setStrokeStyles:function(n){this.stroke&&(n.lineWidth=this.strokeWidth,n.lineCap=this.strokeLineCap,n.lineJoin=this.strokeLineJoin,n.miterLimit=this.strokeMiterLimit,n.strokeStyle=this.stroke.toLive?this.stroke.toLive(n):this.stroke)},_setFillStyles:function(n){this.fill&&(n.fillStyle=this.fill.toLive?this.fill.toLive(n):this.fill)},_renderControls:function(n,i){var f=this.getViewportTransform(),u;n.save();this.active&&!i&&(this.group&&(u=t.util.transformPoint(this.group.getCenterPoint(),f),n.translate(u.x,u.y),n.rotate(r(this.group.angle))),u=t.util.transformPoint(this.getCenterPoint(),f,null!=this.group),this.group&&(u.x*=this.group.scaleX,u.y*=this.group.scaleY),n.translate(u.x,u.y),n.rotate(r(this.angle)),this.drawBorders(n),this.drawControls(n));n.restore()},_setShadow:function(n){this.shadow&&(n.shadowColor=this.shadow.color,n.shadowBlur=this.shadow.blur,n.shadowOffsetX=this.shadow.offsetX,n.shadowOffsetY=this.shadow.offsetY)},_removeShadow:function(n){this.shadow&&(n.shadowColor="",n.shadowBlur=n.shadowOffsetX=n.shadowOffsetY=0)},_renderFill:function(n){if(this.fill){if(n.save(),this.fill.toLive&&n.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0),this.fill.gradientTransform){var t=this.fill.gradientTransform;n.transform.apply(n,t)}this.fillRule==="destination-over"?n.fill("evenodd"):n.fill();n.restore();this.shadow&&!this.shadow.affectStroke&&this._removeShadow(n)}},_renderStroke:function(n){if(this.stroke&&this.strokeWidth!==0){if(n.save(),this.strokeDashArray)1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),e?(n.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(n)):this._renderDashedStroke&&this._renderDashedStroke(n),n.stroke();else{if(this.stroke.gradientTransform){var t=this.stroke.gradientTransform;n.transform.apply(n,t)}this._stroke?this._stroke(n):n.stroke()}this._removeShadow(n);n.restore()}},clone:function(n,i){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(i),n):new t.Object(this.toObject(i))},cloneAsImage:function(n){var i=this.toDataURL();return t.util.loadImage(i,function(i){n&&n(new t.Image(i))}),this},toDataURL:function(n){var i,u,r,f,e,o;return n||(n={}),i=t.util.createCanvasElement(),u=this.getBoundingRect(),i.width=u.width,i.height=u.height,t.util.wrapElement(i,"div"),r=new t.Canvas(i),n.format==="jpg"&&(n.format="jpeg"),n.format==="jpeg"&&(r.backgroundColor="#fff"),f={active:this.get("active"),left:this.getLeft(),top:this.getTop()},this.set("active",!1),this.setPositionByOrigin(new t.Point(i.width/2,i.height/2),"center","center"),e=this.canvas,r.add(this),o=r.toDataURL(n),this.set(f).setCoords(),this.canvas=e,r.dispose(),r=null,o},isType:function(n){return this.type===n},complexity:function(){return 0},toJSON:function(n){return this.toObject(n)},setGradient:function(n,i){var r,u,f;i||(i={});r={colorStops:[]};r.type=i.type||(i.r1||i.r2?"radial":"linear");r.coords={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2};(i.r1||i.r2)&&(r.coords.r1=i.r1,r.coords.r2=i.r2);for(u in i.colorStops)f=new t.Color(i.colorStops[u]),r.colorStops.push({offset:u,color:f.toRgb(),opacity:f.getAlpha()});return this.set(n,t.Gradient.forObject(this,r))},setPatternFill:function(n){return this.set("fill",new t.Pattern(n))},setShadow:function(n){return this.set("shadow",n?new t.Shadow(n):null)},setColor:function(n){return this.set("fill",n),this},setAngle:function(n){var t=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return t&&this._setOriginToCenter(),this.set("angle",n),t&&this._resetOrigin(),this},centerH:function(){return this.canvas.centerObjectH(this),this},centerV:function(){return this.canvas.centerObjectV(this),this},center:function(){return this.canvas.centerObject(this),this},remove:function(){return this.canvas.remove(this),this},getLocalPointer:function(n,t){t=t||this.canvas.getPointer(n);var i=this.translateToOriginPoint(this.getCenterPoint(),"left","top");return{x:t.x-i.x,y:t.y-i.y}},_setupFillRule:function(n){this.fillRule&&(this._prevFillRule=n.globalCompositeOperation,n.globalCompositeOperation=this.fillRule)},_restoreFillRule:function(n){this.fillRule&&this._prevFillRule&&(n.globalCompositeOperation=this._prevFillRule)}}),t.util.createAccessors(t.Object),t.Object.prototype.rotate=t.Object.prototype.setAngle,u(t.Object.prototype,t.Observable),t.Object.NUM_FRACTION_DIGITS=2,t.Object.__uid=0)}(typeof exports!="undefined"?exports:this),function(){var n=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{translateToCenterPoint:function(t,i,r){var f=t.x,e=t.y,u=this.stroke?this.strokeWidth:0;return i==="left"?f=t.x+(this.getWidth()+u*this.scaleX)/2:i==="right"&&(f=t.x-(this.getWidth()+u*this.scaleX)/2),r==="top"?e=t.y+(this.getHeight()+u*this.scaleY)/2:r==="bottom"&&(e=t.y-(this.getHeight()+u*this.scaleY)/2),fabric.util.rotatePoint(new fabric.Point(f,e),t,n(this.angle))},translateToOriginPoint:function(t,i,r){var f=t.x,e=t.y,u=this.stroke?this.strokeWidth:0;return i==="left"?f=t.x-(this.getWidth()+u*this.scaleX)/2:i==="right"&&(f=t.x+(this.getWidth()+u*this.scaleX)/2),r==="top"?e=t.y-(this.getHeight()+u*this.scaleY)/2:r==="bottom"&&(e=t.y+(this.getHeight()+u*this.scaleY)/2),fabric.util.rotatePoint(new fabric.Point(f,e),t,n(this.angle))},getCenterPoint:function(){var n=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(n,this.originX,this.originY)},getPointByOrigin:function(n,t){var i=this.getCenterPoint();return this.translateToOriginPoint(i,n,t)},toLocalPoint:function(t,i,r){var u=this.getCenterPoint(),f=this.stroke?this.strokeWidth:0,e,o;return i&&r?(e=i==="left"?u.x-(this.getWidth()+f*this.scaleX)/2:i==="right"?u.x+(this.getWidth()+f*this.scaleX)/2:u.x,o=r==="top"?u.y-(this.getHeight()+f*this.scaleY)/2:r==="bottom"?u.y+(this.getHeight()+f*this.scaleY)/2:u.y):(e=this.left,o=this.top),fabric.util.rotatePoint(new fabric.Point(t.x,t.y),u,-n(this.angle)).subtractEquals(new fabric.Point(e,o))},setPositionByOrigin:function(n,t,i){var u=this.translateToCenterPoint(n,t,i),r=this.translateToOriginPoint(u,this.originX,this.originY);this.set("left",r.x);this.set("top",r.y)},adjustPosition:function(t){var i=n(this.angle),r=this.getWidth()/2,u=Math.cos(i)*r,f=Math.sin(i)*r,e=this.getWidth(),o=Math.cos(i)*e,s=Math.sin(i)*e;this.originX==="center"&&t==="left"||this.originX==="right"&&t==="center"?(this.left-=u,this.top-=f):this.originX==="left"&&t==="center"||this.originX==="center"&&t==="right"?(this.left+=u,this.top+=f):this.originX==="left"&&t==="right"?(this.left+=o,this.top+=s):this.originX==="right"&&t==="left"&&(this.left-=o,this.top-=s);this.setCoords();this.originX=t},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var n=this.getCenterPoint();this.originX="center";this.originY="center";this.left=n.x;this.top=n.y},_resetOrigin:function(){var n=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=n.x;this.top=n.y;this._originalOriginX=null;this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","center")}})}(),function(){var n=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(n,t){var i=this.oCoords,r=new fabric.Point(i.tl.x,i.tl.y),u=new fabric.Point(i.tr.x,i.tr.y),f=new fabric.Point(i.bl.x,i.bl.y),e=new fabric.Point(i.br.x,i.br.y),o=fabric.Intersection.intersectPolygonRectangle([r,u,e,f],n,t);return o.status==="Intersection"},intersectsWithObject:function(n){function r(n){return{tl:new fabric.Point(n.tl.x,n.tl.y),tr:new fabric.Point(n.tr.x,n.tr.y),bl:new fabric.Point(n.bl.x,n.bl.y),br:new fabric.Point(n.br.x,n.br.y)}}var t=r(this.oCoords),i=r(n.oCoords),u=fabric.Intersection.intersectPolygonPolygon([t.tl,t.tr,t.br,t.bl],[i.tl,i.tr,i.br,i.bl]);return u.status==="Intersection"},isContainedWithinObject:function(n){var t=n.getBoundingRect(),i=new fabric.Point(t.left,t.top),r=new fabric.Point(t.left+t.width,t.top+t.height);return this.isContainedWithinRect(i,r)},isContainedWithinRect:function(n,t){var i=this.getBoundingRect();return i.left>=n.x&&i.left+i.width<=t.x&&i.top>=n.y&&i.top+i.height<=t.y},containsPoint:function(n){var i=this._getImageLines(this.oCoords),t=this._findCrossPoints(n,i);return t!==0&&t%2==1},_getImageLines:function(n){return{topline:{o:n.tl,d:n.tr},rightline:{o:n.tr,d:n.br},bottomline:{o:n.br,d:n.bl},leftline:{o:n.bl,d:n.tl}}},_findCrossPoints:function(n,t){var r,f,e,s,u,h,o=0,i;for(var c in t)if((i=t[c],!(i.o.y<n.y)||!(i.d.y<n.y))&&(!(i.o.y>=n.y)||!(i.d.y>=n.y))&&(i.o.x===i.d.x&&i.o.x>=n.x?(u=i.o.x,h=n.y):(r=0,f=(i.d.y-i.o.y)/(i.d.x-i.o.x),e=n.y-r*n.x,s=i.o.y-f*i.o.x,u=-(e-s)/(r-f),h=e+r*u),u>=n.x&&(o+=1),o===2))break;return o},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var n=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],t=fabric.util.array.min(n),u=fabric.util.array.max(n),f=Math.abs(t-u),i=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],r=fabric.util.array.min(i),e=fabric.util.array.max(i),o=Math.abs(r-e);return{left:t,top:r,width:f,height:o}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(n){return Math.abs(n)<this.minScaleLimit?n<0?-this.minScaleLimit:this.minScaleLimit:n},scale:function(n){return n=this._constrainScale(n),n<0&&(this.flipX=!this.flipX,this.flipY=!this.flipY,n*=-1),this.scaleX=n,this.scaleY=n,this.setCoords(),this},scaleToWidth:function(n){var t=this.getBoundingRectWidth()/this.getWidth();return this.scale(n/this.width/t)},scaleToHeight:function(n){var t=this.getBoundingRectHeight()/this.getHeight();return this.scale(n/this.height/t)},setCoords:function(){var c=this.strokeWidth>1?this.strokeWidth:0,s=n(this.angle),ht=this.getViewportTransform(),u=function(n){return fabric.util.transformPoint(n,ht)},a=this.width,v=this.height,ut=this.strokeLineCap==="round"||this.strokeLineCap==="square",ft=this.type==="line"&&this.width===1,et=this.type==="line"&&this.height===1,ct=ut&&et||this.type!=="line",lt=ut&&ft||this.type!=="line";ft?a=c:et&&(v=c);ct&&(a+=c);lt&&(v+=c);this.currentWidth=a*this.scaleX;this.currentHeight=v*this.scaleY;this.currentWidth<0&&(this.currentWidth=Math.abs(this.currentWidth));var ot=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2)),l=Math.atan(isFinite(this.currentHeight/this.currentWidth)?this.currentHeight/this.currentWidth:0),at=Math.cos(l+s)*ot,vt=Math.sin(l+s)*ot,e=Math.sin(s),o=Math.cos(s),st=this.getCenterPoint(),t=new fabric.Point(this.currentWidth,this.currentHeight),f=new fabric.Point(st.x-at,st.y-vt),h=new fabric.Point(f.x+t.x*o,f.y+t.x*e),y=new fabric.Point(f.x-t.y*e,f.y+t.y*o),p=new fabric.Point(f.x+t.x/2*o,f.y+t.x/2*e),w=u(f),b=u(h),k=u(new fabric.Point(h.x-t.y*e,h.y+t.y*o)),d=u(y),g=u(new fabric.Point(f.x-t.y/2*e,f.y+t.y/2*o)),nt=u(p),tt=u(new fabric.Point(h.x-t.y/2*e,h.y+t.y/2*o)),it=u(new fabric.Point(y.x+t.x/2*o,y.y+t.x/2*e)),rt=u(new fabric.Point(p.x,p.y)),i=Math.cos(l+s)*this.padding*Math.sqrt(2),r=Math.sin(l+s)*this.padding*Math.sqrt(2);return w=w.add(new fabric.Point(-i,-r)),b=b.add(new fabric.Point(r,-i)),k=k.add(new fabric.Point(i,r)),d=d.add(new fabric.Point(-r,i)),g=g.add(new fabric.Point((-i-r)/2,(-r+i)/2)),nt=nt.add(new fabric.Point((r-i)/2,-(r+i)/2)),tt=tt.add(new fabric.Point((r+i)/2,(r-i)/2)),it=it.add(new fabric.Point((i-r)/2,(i+r)/2)),rt=rt.add(new fabric.Point((r-i)/2,-(r+i)/2)),this.oCoords={tl:w,tr:b,br:k,bl:d,ml:g,mt:nt,mr:tt,mb:it,mtr:rt},this._setCornerCoords&&this._setCornerCoords(),this}})}();fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(n){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,n):this.canvas.sendBackwards(this,n),this},bringForward:function(n){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,n):this.canvas.bringForward(this,n),this},moveTo:function(n){return this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,n):this.canvas.moveTo(this,n),this}});fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(){var n=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",t=this.fillRule==="destination-over"?"evenodd":this.fillRule,i=this.stroke?this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",r=this.strokeWidth?this.strokeWidth:"0",u=this.strokeDashArray?this.strokeDashArray.join(" "):"",f=this.strokeLineCap?this.strokeLineCap:"butt",e=this.strokeLineJoin?this.strokeLineJoin:"miter",o=this.strokeMiterLimit?this.strokeMiterLimit:"4",s=typeof this.opacity!="undefined"?this.opacity:"1",h=this.visible?"":" visibility: hidden;",c=this.shadow&&this.type!=="text"?"filter: url(#SVGID_"+this.shadow.id+");":"";return["stroke: ",i,"; ","stroke-width: ",r,"; ","stroke-dasharray: ",u,"; ","stroke-linecap: ",f,"; ","stroke-linejoin: ",e,"; ","stroke-miterlimit: ",o,"; ","fill: ",n,"; ","fill-rule: ",t,"; ","opacity: ",s,";",c,h].join("")},getSvgTransform:function(){if(this.group)return"";var t=fabric.util.toFixed,r=this.getAngle(),n=this.getViewportTransform(),u=fabric.util.transformPoint(this.getCenterPoint(),n),i=fabric.Object.NUM_FRACTION_DIGITS,f=this.type==="path-group"?"":"translate("+t(u.x,i)+" "+t(u.y,i)+")",e=r!==0?" rotate("+t(r,i)+")":"",o=this.scaleX===1&&this.scaleY===1&&n[0]===1&&n[3]===1?"":" scale("+t(this.scaleX*n[0],i)+" "+t(this.scaleY*n[3],i)+")",s=this.type==="path-group"?this.width*n[0]:0,h=this.flipX?" matrix(-1 0 0 1 "+s+" 0) ":"",c=this.type==="path-group"?this.height*n[3]:0,l=this.flipY?" matrix(1 0 0 -1 0 "+c+")":"";return[f,e,o,h,l].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+")":""},_createBaseSVGMarkup:function(){var n=[];return this.fill&&this.fill.toLive&&n.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&n.push(this.stroke.toSVG(this,!1)),this.shadow&&n.push(this.shadow.toSVG(this)),n}});fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(n){return this.get(n)!==this.originalState[n]},this)},saveState:function(n){return this.stateProperties.forEach(function(n){this.originalState[n]=this.get(n)},this),n&&n.stateProperties&&n.stateProperties.forEach(function(n){this.originalState[n]=this.get(n)},this),this},setupState:function(){return this.originalState={},this.saveState(),this}}),function(){var n=fabric.util.degreesToRadians,t=function(){return typeof G_vmlCanvasManager!="undefined"};fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(n){var r,u,i,f,t;if(!this.hasControls||!this.active)return!1;r=n.x;u=n.y;for(t in this.oCoords)if(this.isControlVisible(t)&&(t!=="mtr"||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||t!=="mt"&&t!=="mr"&&t!=="mb"&&t!=="ml")&&(f=this._getImageLines(this.oCoords[t].corner),i=this._findCrossPoints({x:r,y:u},f),i!==0&&i%2==1))return this.__corner=t,t;return!1},_setCornerCoords:function(){var t=this.oCoords,e=n(this.angle),o=n(45-this.angle),s=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,i=s*Math.cos(o),r=s*Math.sin(o),u=Math.sin(e),f=Math.cos(e);t.tl.corner={tl:{x:t.tl.x-r,y:t.tl.y-i},tr:{x:t.tl.x+i,y:t.tl.y-r},bl:{x:t.tl.x-i,y:t.tl.y+r},br:{x:t.tl.x+r,y:t.tl.y+i}};t.tr.corner={tl:{x:t.tr.x-r,y:t.tr.y-i},tr:{x:t.tr.x+i,y:t.tr.y-r},br:{x:t.tr.x+r,y:t.tr.y+i},bl:{x:t.tr.x-i,y:t.tr.y+r}};t.bl.corner={tl:{x:t.bl.x-r,y:t.bl.y-i},bl:{x:t.bl.x-i,y:t.bl.y+r},br:{x:t.bl.x+r,y:t.bl.y+i},tr:{x:t.bl.x+i,y:t.bl.y-r}};t.br.corner={tr:{x:t.br.x+i,y:t.br.y-r},bl:{x:t.br.x-i,y:t.br.y+r},br:{x:t.br.x+r,y:t.br.y+i},tl:{x:t.br.x-r,y:t.br.y-i}};t.ml.corner={tl:{x:t.ml.x-r,y:t.ml.y-i},tr:{x:t.ml.x+i,y:t.ml.y-r},bl:{x:t.ml.x-i,y:t.ml.y+r},br:{x:t.ml.x+r,y:t.ml.y+i}};t.mt.corner={tl:{x:t.mt.x-r,y:t.mt.y-i},tr:{x:t.mt.x+i,y:t.mt.y-r},bl:{x:t.mt.x-i,y:t.mt.y+r},br:{x:t.mt.x+r,y:t.mt.y+i}};t.mr.corner={tl:{x:t.mr.x-r,y:t.mr.y-i},tr:{x:t.mr.x+i,y:t.mr.y-r},bl:{x:t.mr.x-i,y:t.mr.y+r},br:{x:t.mr.x+r,y:t.mr.y+i}};t.mb.corner={tl:{x:t.mb.x-r,y:t.mb.y-i},tr:{x:t.mb.x+i,y:t.mb.y-r},bl:{x:t.mb.x-i,y:t.mb.y+r},br:{x:t.mb.x+r,y:t.mb.y+i}};t.mtr.corner={tl:{x:t.mtr.x-r+u*this.rotatingPointOffset,y:t.mtr.y-i-f*this.rotatingPointOffset},tr:{x:t.mtr.x+i+u*this.rotatingPointOffset,y:t.mtr.y-r-f*this.rotatingPointOffset},bl:{x:t.mtr.x-i+u*this.rotatingPointOffset,y:t.mtr.y+r-f*this.rotatingPointOffset},br:{x:t.mtr.x+r+u*this.rotatingPointOffset,y:t.mtr.y+i-f*this.rotatingPointOffset}}},drawBorders:function(n){var f,e,h;if(!this.hasBorders)return this;var i=this.padding,c=i*2,p=this.getViewportTransform();n.save();n.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;n.strokeStyle=this.borderColor;f=1/this._constrainScale(this.scaleX);e=1/this._constrainScale(this.scaleY);n.lineWidth=1/this.borderScaleFactor;var o=this.getWidth(),s=this.getHeight(),r=this.strokeWidth>1?this.strokeWidth:0,l=this.strokeLineCap==="round"||this.strokeLineCap==="square",a=this.type==="line"&&this.width===1,v=this.type==="line"&&this.height===1,w=l&&v||this.type!=="line",b=l&&a||this.type!=="line";a?o=r/f:v&&(s=r/e);w&&(o+=r/f);b&&(s+=r/e);var y=fabric.util.transformPoint(new fabric.Point(o,s),p,!0),u=y.x,t=y.y;return this.group&&(u=u*this.group.scaleX,t=t*this.group.scaleY),n.strokeRect(~~(-(u/2)-i)-.5,~~(-(t/2)-i)-.5,~~(u+c)+1,~~(t+c)+1),this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls&&(h=(-t-i*2)/2,n.beginPath(),n.moveTo(0,h),n.lineTo(0,h-this.rotatingPointOffset),n.closePath(),n.stroke()),n.restore(),this},drawControls:function(n){if(!this.hasControls)return this;var a=this.cornerSize,v=a/2,k=this.getViewportTransform(),h=this.strokeWidth>1?this.strokeWidth:0,c=this.width,l=this.height,y=this.strokeLineCap==="round"||this.strokeLineCap==="square",p=this.type==="line"&&this.width===1,w=this.type==="line"&&this.height===1,d=y&&w||this.type!=="line",g=y&&p||this.type!=="line";p?c=h:w&&(l=h);d&&(c+=h);g&&(l+=h);c*=this.scaleX;l*=this.scaleY;var b=fabric.util.transformPoint(new fabric.Point(c,l),k,!0),e=b.x,o=b.y,r=-(e/2),u=-(o/2),t=this.padding,i=v,s=v-a,f=this.transparentCorners?"strokeRect":"fillRect";return n.save(),n.lineWidth=1,n.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,n.strokeStyle=n.fillStyle=this.cornerColor,this._drawControl("tl",n,f,r-i-t,u-i-t),this._drawControl("tr",n,f,r+e-i+t,u-i-t),this._drawControl("bl",n,f,r-i-t,u+o+s+t),this._drawControl("br",n,f,r+e+s+t,u+o+s+t),this.get("lockUniScaling")||(this._drawControl("mt",n,f,r+e/2-i,u-i-t),this._drawControl("mb",n,f,r+e/2-i,u+o+s+t),this._drawControl("mr",n,f,r+e+s+t,u+o/2-i),this._drawControl("ml",n,f,r-i-t,u+o/2-i)),this.hasRotatingPoint&&this._drawControl("mtr",n,f,r+e/2-i,u-this.rotatingPointOffset-this.cornerSize/2-t),n.restore(),this},_drawControl:function(n,i,r,u,f){var e=this.cornerSize;this.isControlVisible(n)&&(t()||this.transparentCorners||i.clearRect(u,f,e,e),i[r](u,f,e,e))},isControlVisible:function(n){return this._getControlsVisibility()[n]},setControlVisible:function(n,t){return this._getControlsVisibility()[n]=t,this},setControlsVisibility:function(n){n||(n={});for(var t in n)this.setControlVisible(t,n[t]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility}})}();fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(n,t){t=t||{};var i=function(){},r=t.onComplete||i,u=t.onChange||i,f=this;return fabric.util.animate({startValue:n.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(t){n.set("left",t);f.renderAll();u()},onComplete:function(){n.setCoords();r()}}),this},fxCenterObjectV:function(n,t){t=t||{};var i=function(){},r=t.onComplete||i,u=t.onChange||i,f=this;return fabric.util.animate({startValue:n.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(t){n.set("top",t);f.renderAll();u()},onComplete:function(){n.setCoords();r()}}),this},fxRemove:function(n,t){t=t||{};var i=function(){},u=t.onComplete||i,f=t.onChange||i,r=this;return fabric.util.animate({startValue:n.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){n.set("active",!1)},onChange:function(t){n.set("opacity",t);r.renderAll();f()},onComplete:function(){r.remove(n);u()}}),this}});fabric.util.object.extend(fabric.Object.prototype,{animate:function(){var i,n,u,t,r;if(arguments[0]&&typeof arguments[0]=="object"){i=[];for(n in arguments[0])i.push(n);for(t=0,r=i.length;t<r;t++)n=i[t],u=t!==r-1,this._animate(n,arguments[0][n],arguments[1],u)}else this._animate.apply(this,arguments);return this},_animate:function(n,t,i,r){var f=this,u,e;t=t.toString();i=i?fabric.util.object.clone(i):{};~n.indexOf(".")&&(u=n.split("."));e=u?this.get(u[0])[u[1]]:this.get(n);"from"in i||(i.from=e);t=~t.indexOf("=")?e+parseFloat(t.replace("=","")):parseFloat(t);fabric.util.animate({startValue:i.from,endValue:t,byValue:i.by,easing:i.easing,duration:i.duration,abort:i.abort&&function(){return i.abort.call(f)},onChange:function(t){(u?f[u[0]][u[1]]=t:f.set(n,t),r)||i.onChange&&i.onChange()},onComplete:function(){r||(f.setCoords(),i.onComplete&&i.onComplete())}})}}),function(n){"use strict";function r(n,t){var u=n.origin,i=n.axis1,r=n.axis2,f=n.dimension,e=t.nearest,o=t.center,s=t.farthest;return function(){switch(this.get(u)){case e:return Math.min(this.get(i),this.get(r));case o:return Math.min(this.get(i),this.get(r))+.5*this.get(f);case s:return Math.max(this.get(i),this.get(r))}}}var t=n.fabric||(n.fabric={}),i=t.util.object.extend,u={x1:1,x2:1,y1:1,y2:1},f=t.StaticCanvas.supports("setLineDash");if(t.Line){t.warn("fabric.Line is already defined");return}t.Line=t.util.createClass(t.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(n,t){t=t||{};n||(n=[0,0,0,0]);this.callSuper("initialize",t);this.set("x1",n[0]);this.set("y1",n[1]);this.set("x2",n[2]);this.set("y2",n[3]);this._setWidthHeight(t)},_setWidthHeight:function(n){n||(n={});this.width=Math.abs(this.x2-this.x1)||1;this.height=Math.abs(this.y2-this.y1)||1;this.left="left"in n?n.left:this._getLeftToOriginX();this.top="top"in n?n.top:this._getTopToOriginY()},_set:function(n,t){return this[n]=t,typeof u[n]!="undefined"&&this._setWidthHeight(),this},_getLeftToOriginX:r({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:r({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(n,t){var i,r,u,e;n.beginPath();t&&(i=this.getCenterPoint(),n.translate(i.x,i.y));(!this.strokeDashArray||this.strokeDashArray&&f)&&(r=this.x1<=this.x2?-1:1,u=this.y1<=this.y2?-1:1,n.moveTo(this.width===1?0:r*this.width/2,this.height===1?0:u*this.height/2),n.lineTo(this.width===1?0:r*-1*this.width/2,this.height===1?0:u*-1*this.height/2));n.lineWidth=this.strokeWidth;e=n.strokeStyle;n.strokeStyle=this.stroke||n.fillStyle;this.stroke&&this._renderStroke(n);n.strokeStyle=e},_renderDashedStroke:function(n){var u=this.x1<=this.x2?-1:1,f=this.y1<=this.y2?-1:1,i=this.width===1?0:u*this.width/2,r=this.height===1?0:f*this.height/2;n.beginPath();t.util.drawDashedLine(n,i,r,-i,-r,this.strokeDashArray);n.closePath()},toObject:function(n){return i(this.callSuper("toObject",n),{x1:this.get("x1"),y1:this.get("y1"),x2:this.get("x2"),y2:this.get("y2")})},toSVG:function(n){var t=this._createBaseSVGMarkup(),i="",r,u;return this.group||(r=-this.width/2-(this.x1>this.x2?this.x2:this.x1),u=-this.height/2-(this.y1>this.y2?this.y2:this.y1),i="translate("+r+", "+u+") "),t.push("<line ",'x1="',this.x1,'" y1="',this.y1,'" x2="',this.x2,'" y2="',this.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),i,this.getSvgTransformMatrix(),'"/>\n'),n?n(t.join("")):t.join("")},complexity:function(){return 1}});t.Line.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" "));t.Line.fromElement=function(n,r){var u=t.parseAttributes(n,t.Line.ATTRIBUTE_NAMES),f=[u.x1||0,u.y1||0,u.x2||0,u.y2||0];return new t.Line(f,i(u,r))};t.Line.fromObject=function(n){var i=[n.x1,n.y1,n.x2,n.y2];return new t.Line(i,n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";function u(n){return"radius"in n&&n.radius>0}var t=n.fabric||(n.fabric={}),r=Math.PI*2,i=t.util.object.extend;if(t.Circle){t.warn("fabric.Circle is already defined.");return}t.Circle=t.util.createClass(t.Object,{type:"circle",radius:0,initialize:function(n){n=n||{};this.callSuper("initialize",n);this.set("radius",n.radius||0)},_set:function(n,t){return this.callSuper("_set",n,t),n==="radius"&&this.setRadius(t),this},toObject:function(n){return i(this.callSuper("toObject",n),{radius:this.get("radius")})},toSVG:function(n){var t=this._createBaseSVGMarkup(),i=0,r=0;return this.group&&(i=this.left+this.radius,r=this.top+this.radius),t.push("<circle ",'cx="'+i+'" cy="'+r+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n'),n?n(t.join("")):t.join("")},_render:function(n,t){n.beginPath();n.arc(t?this.left+this.radius:0,t?this.top+this.radius:0,this.radius,0,r,!1);this._renderFill(n);this._renderStroke(n)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(n){this.radius=n;this.set("width",n*2).set("height",n*2)},complexity:function(){return 1}});t.Circle.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("cx cy r".split(" "));t.Circle.fromElement=function(n,r){var f,e;if(r||(r={}),f=t.parseAttributes(n,t.Circle.ATTRIBUTE_NAMES),!u(f))throw new Error("value of `r` attribute is required and can not be negative");return f.left=f.left||0,f.top=f.top||0,e=new t.Circle(i(f,r)),e.left-=e.radius,e.top-=e.radius,e};t.Circle.fromObject=function(n){return new t.Circle(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={});if(t.Triangle){t.warn("fabric.Triangle is already defined");return}t.Triangle=t.util.createClass(t.Object,{type:"triangle",initialize:function(n){n=n||{};this.callSuper("initialize",n);this.set("width",n.width||100).set("height",n.height||100)},_render:function(n){var i=this.width/2,t=this.height/2;n.beginPath();n.moveTo(-i,t);n.lineTo(0,-t);n.lineTo(i,t);n.closePath();this._renderFill(n);this._renderStroke(n)},_renderDashedStroke:function(n){var r=this.width/2,i=this.height/2;n.beginPath();t.util.drawDashedLine(n,-r,i,0,-i,this.strokeDashArray);t.util.drawDashedLine(n,0,-i,r,i,this.strokeDashArray);t.util.drawDashedLine(n,r,i,-r,i,this.strokeDashArray);n.closePath()},toSVG:function(n){var t=this._createBaseSVGMarkup(),r=this.width/2,i=this.height/2,u=[-r+" "+i,"0 "+-i,r+" "+i].join(",");return t.push("<polygon ",'points="',u,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),n?n(t.join("")):t.join("")},complexity:function(){return 1}});t.Triangle.fromObject=function(n){return new t.Triangle(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),r=Math.PI*2,i=t.util.object.extend;if(t.Ellipse){t.warn("fabric.Ellipse is already defined.");return}t.Ellipse=t.util.createClass(t.Object,{type:"ellipse",rx:0,ry:0,initialize:function(n){n=n||{};this.callSuper("initialize",n);this.set("rx",n.rx||0);this.set("ry",n.ry||0);this.set("width",this.get("rx")*2);this.set("height",this.get("ry")*2)},toObject:function(n){return i(this.callSuper("toObject",n),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(n){var t=this._createBaseSVGMarkup(),i=0,r=0;return this.group&&(i=this.left+this.rx,r=this.top+this.ry),t.push("<ellipse ",'cx="',i,'" cy="',r,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),n?n(t.join("")):t.join("")},_render:function(n,t){n.beginPath();n.save();n.transform(1,0,0,this.ry/this.rx,0,0);n.arc(t?this.left+this.rx:0,t?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,r,!1);n.restore();this._renderFill(n);this._renderStroke(n)},complexity:function(){return 1}});t.Ellipse.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" "));t.Ellipse.fromElement=function(n,r){var u,f;return r||(r={}),u=t.parseAttributes(n,t.Ellipse.ATTRIBUTE_NAMES),u.left=u.left||0,u.top=u.top||0,f=new t.Ellipse(i(u,r)),f.top-=f.ry,f.left-=f.rx,f};t.Ellipse.fromObject=function(n){return new t.Ellipse(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),r=t.util.object.extend,i;if(t.Rect){console.warn("fabric.Rect is already defined");return}i=t.Object.prototype.stateProperties.concat();i.push("rx","ry","x","y");t.Rect=t.util.createClass(t.Object,{stateProperties:i,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(n){n=n||{};this.callSuper("initialize",n);this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(n,t){if(this.width===1&&this.height===1){n.fillRect(0,0,1,1);return}var u=this.rx?Math.min(this.rx,this.width/2):0,f=this.ry?Math.min(this.ry,this.height/2):0,e=this.width,o=this.height,i=t?this.left:0,r=t?this.top:0,h=u!==0||f!==0,s=1-.5522847498;n.beginPath();t||n.translate(-this.width/2,-this.height/2);n.moveTo(i+u,r);n.lineTo(i+e-u,r);h&&n.bezierCurveTo(i+e-s*u,r,i+e,r+s*f,i+e,r+f);n.lineTo(i+e,r+o-f);h&&n.bezierCurveTo(i+e,r+o-s*f,i+e-s*u,r+o,i+e-u,r+o);n.lineTo(i+u,r+o);h&&n.bezierCurveTo(i+s*u,r+o,i,r+o-s*f,i,r+o-f);n.lineTo(i,r+f);h&&n.bezierCurveTo(i,r+s*f,i+s*u,r,i+u,r);n.closePath();this._renderFill(n);this._renderStroke(n)},_renderDashedStroke:function(n){var i=-this.width/2,r=-this.height/2,u=this.width,f=this.height;n.beginPath();t.util.drawDashedLine(n,i,r,i+u,r,this.strokeDashArray);t.util.drawDashedLine(n,i+u,r,i+u,r+f,this.strokeDashArray);t.util.drawDashedLine(n,i+u,r+f,i,r+f,this.strokeDashArray);t.util.drawDashedLine(n,i,r+f,i,r,this.strokeDashArray);n.closePath()},toObject:function(n){var t=r(this.callSuper("toObject",n),{rx:this.get("rx")||0,ry:this.get("ry")||0});return this.includeDefaultValues||this._removeDefaultValues(t),t},toSVG:function(n){var t=this._createBaseSVGMarkup(),i=this.left,r=this.top;return this.group||(i=-this.width/2,r=-this.height/2),t.push("<rect ",'x="',i,'" y="',r,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),n?n(t.join("")):t.join("")},complexity:function(){return 1}});t.Rect.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" "));t.Rect.fromElement=function(n,i){if(!n)return null;i=i||{};var u=t.parseAttributes(n,t.Rect.ATTRIBUTE_NAMES);return u.left=u.left||0,u.top=u.top||0,new t.Rect(r(i?t.util.object.clone(i):{},u))};t.Rect.fromObject=function(n){return new t.Rect(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.toFixed;if(t.Polyline){t.warn("fabric.Polyline is already defined");return}t.Polyline=t.util.createClass(t.Object,{type:"polyline",points:null,initialize:function(n,t,i){t=t||{};this.set("points",n);this.callSuper("initialize",t);this._calcDimensions(i)},_calcDimensions:function(n){return t.Polygon.prototype._calcDimensions.call(this,n)},toObject:function(n){return t.Polygon.prototype.toObject.call(this,n)},toSVG:function(n){for(var u=[],r=this._createBaseSVGMarkup(),t=0,f=this.points.length;t<f;t++)u.push(i(this.points[t].x,2),",",i(this.points[t].y,2)," ");return r.push("<polyline ",'points="',u.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n'),n?n(r.join("")):r.join("")},_render:function(n){var i,t,r;for(n.beginPath(),n.moveTo(this.points[0].x,this.points[0].y),t=0,r=this.points.length;t<r;t++)i=this.points[t],n.lineTo(i.x,i.y);this._renderFill(n);this._renderStroke(n)},_renderDashedStroke:function(n){var r,u,i,f;for(n.beginPath(),i=0,f=this.points.length;i<f;i++)r=this.points[i],u=this.points[i+1]||r,t.util.drawDashedLine(n,r.x,r.y,u.x,u.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}});t.Polyline.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat();t.Polyline.fromElement=function(n,i){if(!n)return null;i||(i={});var r=t.parsePointsAttribute(n.getAttribute("points")),u=t.parseAttributes(n,t.Polyline.ATTRIBUTE_NAMES);return r===null?null:new t.Polyline(r,t.util.object.extend(u,i),!0)};t.Polyline.fromObject=function(n){var i=n.points;return new t.Polyline(i,n,!0)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend,r=t.util.array.min,u=t.util.array.max,f=t.util.toFixed;if(t.Polygon){t.warn("fabric.Polygon is already defined");return}t.Polygon=t.util.createClass(t.Object,{type:"polygon",points:null,initialize:function(n,t,i){t=t||{};this.points=n;this.callSuper("initialize",t);this._calcDimensions(i)},_calcDimensions:function(n){var t=this.points,i=r(t,"x"),f=r(t,"y"),s=u(t,"x"),h=u(t,"y"),e,o;(this.width=s-i||1,this.height=h-f||1,this.minX=i,this.minY=f,n)||(e=this.width/2+this.minX,o=this.height/2+this.minY,this.points.forEach(function(n){n.x-=e;n.y-=o},this))},toObject:function(n){return i(this.callSuper("toObject",n),{points:this.points.concat()})},toSVG:function(n){for(var r=[],i=this._createBaseSVGMarkup(),t=0,u=this.points.length;t<u;t++)r.push(f(this.points[t].x,2),",",f(this.points[t].y,2)," ");return i.push("<polygon ",'points="',r.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n'),n?n(i.join("")):i.join("")},_render:function(n){var i,t,r;for(n.beginPath(),n.moveTo(this.points[0].x,this.points[0].y),t=0,r=this.points.length;t<r;t++)i=this.points[t],n.lineTo(i.x,i.y);this._renderFill(n);(this.stroke||this.strokeDashArray)&&(n.closePath(),this._renderStroke(n))},_renderDashedStroke:function(n){var r,u,i,f;for(n.beginPath(),i=0,f=this.points.length;i<f;i++)r=this.points[i],u=this.points[i+1]||this.points[0],t.util.drawDashedLine(n,r.x,r.y,u.x,u.y,this.strokeDashArray);n.closePath()},complexity:function(){return this.points.length}});t.Polygon.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat();t.Polygon.fromElement=function(n,r){if(!n)return null;r||(r={});var u=t.parsePointsAttribute(n.getAttribute("points")),f=t.parseAttributes(n,t.Polygon.ATTRIBUTE_NAMES);return u===null?null:new t.Polygon(u,i(f,r),!0)};t.Polygon.fromObject=function(n){return new t.Polygon(n.points,n,!0)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";function i(n){return n[0]==="H"?n[1]:n[n.length-2]}function r(n){return n[0]==="V"?n[1]:n[n.length-1]}var t=n.fabric||(n.fabric={}),f=t.util.array.min,e=t.util.array.max,u=t.util.object.extend,s=Object.prototype.toString,o=t.util.drawArc,h={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},c={m:"l",M:"L"};if(t.Path){t.warn("fabric.Path is already defined");return}t.Path=t.util.createClass(t.Object,{type:"path",path:null,initialize:function(n,t){if(t=t||{},this.setOptions(t),!n)throw new Error("`path` argument is required");var i=s.call(n)==="[object Array]";(this.path=i?n:n.match&&n.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path)&&(i||(this.path=this._parsePath()),this._initializePath(t),t.sourcePath&&this.setSourcePath(t.sourcePath))},_initializePath:function(n){var t="width"in n&&n.width!=null,i="height"in n&&n.width!=null,r="left"in n,f="top"in n,e=r?this.left:0,o=f?this.top:0;t&&i?(f||(this.top=this.height/2),r||(this.left=this.width/2)):(u(this,this._parseDimensions()),t&&(this.width=n.width),i&&(this.height=n.height));this.pathOffset=this.pathOffset||this._calculatePathOffset(e,o)},_calculatePathOffset:function(n,t){return{x:this.left-n-this.width/2,y:this.top-t-this.height/2}},_render:function(n,t){var i,a=null,y=0,p=0,r=0,u=0,s=0,h=0,c,l,w,b,f=-(this.width/2+this.pathOffset.x),e=-(this.height/2+this.pathOffset.y),v,k;for(t&&(f+=this.width/2,e+=this.height/2),v=0,k=this.path.length;v<k;++v){i=this.path[v];switch(i[0]){case"l":r+=i[1];u+=i[2];n.lineTo(r+f,u+e);break;case"L":r=i[1];u=i[2];n.lineTo(r+f,u+e);break;case"h":r+=i[1];n.lineTo(r+f,u+e);break;case"H":r=i[1];n.lineTo(r+f,u+e);break;case"v":u+=i[1];n.lineTo(r+f,u+e);break;case"V":u=i[1];n.lineTo(r+f,u+e);break;case"m":r+=i[1];u+=i[2];y=r;p=u;n.moveTo(r+f,u+e);break;case"M":r=i[1];u=i[2];y=r;p=u;n.moveTo(r+f,u+e);break;case"c":c=r+i[5];l=u+i[6];s=r+i[3];h=u+i[4];n.bezierCurveTo(r+i[1]+f,u+i[2]+e,s+f,h+e,c+f,l+e);r=c;u=l;break;case"C":r=i[5];u=i[6];s=i[3];h=i[4];n.bezierCurveTo(i[1]+f,i[2]+e,s+f,h+e,r+f,u+e);break;case"s":c=r+i[3];l=u+i[4];s=s?2*r-s:r;h=h?2*u-h:u;n.bezierCurveTo(s+f,h+e,r+i[1]+f,u+i[2]+e,c+f,l+e);s=r+i[1];h=u+i[2];r=c;u=l;break;case"S":c=i[3];l=i[4];s=2*r-s;h=2*u-h;n.bezierCurveTo(s+f,h+e,i[1]+f,i[2]+e,c+f,l+e);r=c;u=l;s=i[1];h=i[2];break;case"q":c=r+i[3];l=u+i[4];s=r+i[1];h=u+i[2];n.quadraticCurveTo(s+f,h+e,c+f,l+e);r=c;u=l;break;case"Q":c=i[3];l=i[4];n.quadraticCurveTo(i[1]+f,i[2]+e,c+f,l+e);r=c;u=l;s=i[1];h=i[2];break;case"t":c=r+i[1];l=u+i[2];a[0].match(/[QqTt]/)===null?(s=r,h=u):a[0]==="t"?(s=2*r-w,h=2*u-b):a[0]==="q"&&(s=2*r-s,h=2*u-h);w=s;b=h;n.quadraticCurveTo(s+f,h+e,c+f,l+e);r=c;u=l;s=r+i[1];h=u+i[2];break;case"T":c=i[1];l=i[2];s=2*r-s;h=2*u-h;n.quadraticCurveTo(s+f,h+e,c+f,l+e);r=c;u=l;break;case"a":o(n,r+f,u+e,[i[1],i[2],i[3],i[4],i[5],i[6]+r+f,i[7]+u+e]);r+=i[6];u+=i[7];break;case"A":o(n,r+f,u+e,[i[1],i[2],i[3],i[4],i[5],i[6]+f,i[7]+e]);r=i[6];u=i[7];break;case"z":case"Z":r=y;u=p;n.closePath()}a=i}},render:function(n,i){if(this.visible){n.save();i&&n.translate(-this.width/2,-this.height/2);var r=this.transformMatrix;r&&n.transform(r[0],r[1],r[2],r[3],r[4],r[5]);i||this.transform(n);this._setStrokeStyles(n);this._setFillStyles(n);this._setShadow(n);this.clipTo&&t.util.clipContext(this,n);n.beginPath();n.globalAlpha=this.group?n.globalAlpha*this.opacity:this.opacity;this._render(n,i);this._renderFill(n);this._renderStroke(n);this.clipTo&&n.restore();this._removeShadow(n);n.restore()}},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(n){var t=u(this.callSuper("toObject",n),{path:this.path.map(function(n){return n.slice()}),pathOffset:this.pathOffset});return this.sourcePath&&(t.sourcePath=this.sourcePath),this.transformMatrix&&(t.transformMatrix=this.transformMatrix),t},toDatalessObject:function(n){var t=this.toObject(n);return this.sourcePath&&(t.path=this.sourcePath),delete t.sourcePath,t},toSVG:function(n){for(var u,r=[],t=this._createBaseSVGMarkup(),i=0,f=this.path.length;i<f;i++)r.push(this.path[i].join(" "));return u=r.join(" "),t.push("<path ",'d="',u,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n"),n?n(t.join("")):t.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var u,y,i,p,f=[],r=[],e,o,w=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/ig,a,v,s=0,n,b=this.path.length;s<b;s++){for(e=this.path[s],v=e.slice(1).trim(),r.length=0;a=w.exec(v);)r.push(a[0]);for(n=[e.charAt(0)],u=0,y=r.length;u<y;u++)o=parseFloat(r[u]),isNaN(o)||n.push(o);var t=n[0],l=h[t.toLowerCase()],k=c[t]||t;if(n.length-1>l)for(i=1,p=n.length;i<p;i+=l)f.push([t].concat(n.slice(i,i+l))),t=k;else f.push(n)}return f},_parseDimensions:function(){var n=[],t=[],s={};this.path.forEach(function(i,r){this._getCoordsFromCommand(i,r,n,t,s)},this);var i=f(n),r=f(t),h=e(n),c=e(t),u=h-i,o=c-r;return{left:this.left+(i+u/2),top:this.top+(r+o/2),width:u,height:o}},_getCoordsFromCommand:function(n,t,u,f,e){var h=!1,s,o;n[0]!=="H"&&(e.x=t===0?i(n):i(this.path[t-1]));n[0]!=="V"&&(e.y=t===0?r(n):r(this.path[t-1]));n[0]===n[0].toLowerCase()&&(h=!0);s=this._getXY(n,h,e);o=parseInt(s.x,10);isNaN(o)||u.push(o);o=parseInt(s.y,10);isNaN(o)||f.push(o)},_getXY:function(n,t,u){var f=t?u.x+i(n):n[0]==="V"?u.x:i(n),e=t?u.y+r(n):n[0]==="H"?u.y:r(n);return{x:f,y:e}}});t.Path.fromObject=function(n,i){typeof n.path=="string"?t.loadSVGFromURL(n.path,function(r){var u=r[0],f=n.path;delete n.path;t.util.object.extend(u,n);u.setSourcePath(f);i(u)}):i(new t.Path(n.path,n))};t.Path.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(["d"]);t.Path.fromElement=function(n,i,r){var f=t.parseAttributes(n,t.Path.ATTRIBUTE_NAMES);i&&i(new t.Path(f.d,u(f,r)))};t.Path.async=!0}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend,r=t.util.array.invoke,u=t.Object.prototype.toObject;if(t.PathGroup){t.warn("fabric.PathGroup is already defined");return}t.PathGroup=t.util.createClass(t.Path,{type:"path-group",fill:"",initialize:function(n,t){t=t||{};this.paths=n||[];for(var i=this.paths.length;i--;)this.paths[i].group=this;this.setOptions(t);t.widthAttr&&(this.scaleX=t.widthAttr/t.width);t.heightAttr&&(this.scaleY=t.heightAttr/t.height);this.setCoords();t.sourcePath&&this.setSourcePath(t.sourcePath)},render:function(n){var i,r,u;if(this.visible){for(n.save(),i=this.transformMatrix,i&&n.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this.transform(n),this._setShadow(n),this.clipTo&&t.util.clipContext(this,n),r=0,u=this.paths.length;r<u;++r)this.paths[r].render(n,!0);this.clipTo&&n.restore();this._removeShadow(n);n.restore()}},_set:function(n,t){if(n==="fill"&&t&&this.isSameColor())for(var i=this.paths.length;i--;)this.paths[i]._set(n,t);return this.callSuper("_set",n,t)},toObject:function(n){var t=i(u.call(this,n),{paths:r(this.getObjects(),"toObject",n)});return this.sourcePath&&(t.sourcePath=this.sourcePath),t},toDatalessObject:function(n){var t=this.toObject(n);return this.sourcePath&&(t.paths=this.sourcePath),t},toSVG:function(n){for(var r=this.getObjects(),u="translate("+this.left+" "+this.top+")",t=["<g ",'style="',this.getSvgStyles(),'" ','transform="',u,this.getSvgTransform(),'" ',">\n"],i=0,f=r.length;i<f;i++)t.push(r[i].toSVG(n));return t.push("<\/g>\n"),n?n(t.join("")):t.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var n=(this.getObjects()[0].get("fill")||"").toLowerCase();return this.getObjects().every(function(t){return(t.get("fill")||"").toLowerCase()===n})},complexity:function(){return this.paths.reduce(function(n,t){return n+(t&&t.complexity?t.complexity():0)},0)},getObjects:function(){return this.paths}});t.PathGroup.fromObject=function(n,i){typeof n.paths=="string"?t.loadSVGFromURL(n.paths,function(r){var f=n.paths,u;delete n.paths;u=t.util.groupSVGElements(r,n,f);i(u)}):t.util.enlivenObjects(n.paths,function(r){delete n.paths;i(new t.PathGroup(r,n))})};t.PathGroup.async=!0}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend,r=t.util.array.min,u=t.util.array.max,e=t.util.array.invoke,f;t.Group||(f={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0},t.Group=t.util.createClass(t.Object,t.Collection,{type:"group",initialize:function(n,t){t=t||{};this._objects=n||[];for(var r=this._objects.length;r--;)this._objects[r].group=this;this.originalState={};this.callSuper("initialize");this._calcBounds();this._updateObjectsCoords();t&&i(this,t);this._setOpacityIfSame();this.setCoords();this.saveCoords()},_updateObjectsCoords:function(){this.forEachObject(this._updateObjectCoords,this)},_updateObjectCoords:function(n){var t=n.getLeft(),i=n.getTop();n.set({originalLeft:t,originalTop:i,left:t-this.left,top:i-this.top});n.setCoords();n.__origHasControls=n.hasControls;n.hasControls=!1},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(n){return this._restoreObjectsState(),n&&(this._objects.push(n),n.group=this),this.forEachObject(this._setObjectActive,this),this._calcBounds(),this._updateObjectsCoords(),this},_setObjectActive:function(n){n.set("active",!0);n.group=this},removeWithUpdate:function(n){return this._moveFlippedObject(n),this._restoreObjectsState(),this.forEachObject(this._setObjectActive,this),this.remove(n),this._calcBounds(),this._updateObjectsCoords(),this},_onObjectAdded:function(n){n.group=this},_onObjectRemoved:function(n){delete n.group;n.set("active",!1)},delegatedProperties:{fill:!0,opacity:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(n,t){if(n in this.delegatedProperties){var i=this._objects.length;for(this[n]=t;i--;)this._objects[i].set(n,t)}else this[n]=t},toObject:function(n){return i(this.callSuper("toObject",n),{objects:e(this._objects,"toObject",n)})},render:function(n){if(this.visible){n.save();this.clipTo&&t.util.clipContext(this,n);for(var i=0,r=this._objects.length;i<r;i++)this._renderObject(this._objects[i],n);this.clipTo&&n.restore();n.restore()}},_renderControls:function(n,t){this.callSuper("_renderControls",n,t);for(var i=0,r=this._objects.length;i<r;i++)this._objects[i]._renderControls(n)},_renderObject:function(n,t){var i=n.hasRotatingPoint;n.visible&&(n.hasRotatingPoint=!1,n.render(t),n.hasRotatingPoint=i)},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},_moveFlippedObject:function(n){var i=n.get("originX"),r=n.get("originY"),u=n.getCenterPoint(),t;return n.set({originX:"center",originY:"center",left:u.x,top:u.y}),this._toggleFlipping(n),t=n.getPointByOrigin(i,r),n.set({originX:i,originY:r,left:t.x,top:t.y}),this},_toggleFlipping:function(n){this.flipX&&(n.toggle("flipX"),n.set("left",-n.get("left")),n.setAngle(-n.getAngle()));this.flipY&&(n.toggle("flipY"),n.set("top",-n.get("top")),n.setAngle(-n.getAngle()))},_restoreObjectState:function(n){return this._setObjectPosition(n),n.setCoords(),n.hasControls=n.__origHasControls,delete n.__origHasControls,n.set("active",!1),n.setCoords(),delete n.group,this},_setObjectPosition:function(n){var i=this.getLeft(),r=this.getTop(),t=this._getRotatedLeftTop(n);n.set({angle:n.getAngle()+this.getAngle(),left:i+t.left,top:r+t.top,scaleX:n.get("scaleX")*this.get("scaleX"),scaleY:n.get("scaleY")*this.get("scaleY")})},_getRotatedLeftTop:function(n){var t=this.getAngle()*(Math.PI/180);return{left:-Math.sin(t)*n.getTop()*this.get("scaleY")+Math.cos(t)*n.getLeft()*this.get("scaleX"),top:Math.cos(t)*n.getTop()*this.get("scaleY")+Math.sin(t)*n.getLeft()*this.get("scaleX")}},destroy:function(){return this._objects.forEach(this._moveFlippedObject,this),this._restoreObjectsState()},saveCoords:function(){return this._originalLeft=this.get("left"),this._originalTop=this.get("top"),this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){return this.forEachObject(function(n){n.setCoords()}),this},_setOpacityIfSame:function(){var n=this.getObjects(),t=n[0]?n[0].get("opacity"):1,i=n.every(function(n){return n.get("opacity")===t});i&&(this.opacity=t)},_calcBounds:function(n){for(var r,u=[],f=[],t,i=0,e=this._objects.length;i<e;++i){t=this._objects[i];t.setCoords();for(r in t.oCoords)u.push(t.oCoords[r].x),f.push(t.oCoords[r].y)}this.set(this._getBounds(u,f,n))},_getBounds:function(n,i,f){var h=t.util.invertTransform(this.getViewportTransform()),e=t.util.transformPoint(new t.Point(r(n),r(i)),h),o=t.util.transformPoint(new t.Point(u(n),u(i)),h),s={width:o.x-e.x||0,height:o.y-e.y||0};return f||(s.left=(e.x+o.x)/2||0,s.top=(e.y+o.y)/2||0),s},toSVG:function(n){for(var t=["<g ",'transform="',this.getSvgTransform(),'">\n'],i=0,r=this._objects.length;i<r;i++)t.push(this._objects[i].toSVG(n));return t.push("<\/g>\n"),n?n(t.join("")):t.join("")},get:function(n){if(n in f){if(this[n])return this[n];for(var t=0,i=this._objects.length;t<i;t++)if(this._objects[t][n])return!0;return!1}return n in this.delegatedProperties?this._objects[0]&&this._objects[0].get(n):this[n]}}),t.Group.fromObject=function(n,i){t.util.enlivenObjects(n.objects,function(r){delete n.objects;i&&i(new t.Group(r,n))})},t.Group.async=!0)}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=fabric.util.object.extend;if(n.fabric||(n.fabric={}),n.fabric.Image){fabric.warn("fabric.Image is already defined.");return}fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",initialize:function(n,t){t||(t={});this.filters=[];this.callSuper("initialize",t);this._initElement(n,t);this._initConfig(t);t.filters&&(this.filters=t.filters,this.applyFilters())},getElement:function(){return this._element},setElement:function(n,t){return this._element=n,this._originalElement=n,this._initConfig(),this.filters.length!==0&&this.applyFilters(t),this},setCrossOrigin:function(n){return this.crossOrigin=n,this._element.crossOrigin=n,this},getOriginalSize:function(){var n=this.getElement();return{width:n.width,height:n.height}},_stroke:function(n){n.save();this._setStrokeStyles(n);n.beginPath();n.strokeRect(-this.width/2,-this.height/2,this.width,this.height);n.closePath();n.restore()},_renderDashedStroke:function(n){var t=-this.width/2,i=-this.height/2,r=this.width,u=this.height;n.save();this._setStrokeStyles(n);n.beginPath();fabric.util.drawDashedLine(n,t,i,t+r,i,this.strokeDashArray);fabric.util.drawDashedLine(n,t+r,i,t+r,i+u,this.strokeDashArray);fabric.util.drawDashedLine(n,t+r,i+u,t,i+u,this.strokeDashArray);fabric.util.drawDashedLine(n,t,i+u,t,i,this.strokeDashArray);n.closePath();n.restore()},toObject:function(n){return t(this.callSuper("toObject",n),{src:this._originalElement.src||this._originalElement._src,filters:this.filters.map(function(n){return n&&n.toObject()}),crossOrigin:this.crossOrigin})},toSVG:function(n){var t=[],i=-this.width/2,r=-this.height/2,u;return this.group&&(i=this.left,r=this.top),t.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n','<image xlink:href="',this.getSvgSrc(),'" x="',i,'" y="',r,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="none"',"><\/image>\n"),(this.stroke||this.strokeDashArray)&&(u=this.fill,this.fill=null,t.push("<rect ",'x="',i,'" y="',r,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=u),t.push("<\/g>\n"),n?n(t.join("")):t.join("")},getSrc:function(){if(this.getElement())return this.getElement().src||this.getElement()._src},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(n,t){this.constructor.fromObject(this.toObject(t),n)},applyFilters:function(n){if(this._originalElement){if(this.filters.length===0){this._element=this._originalElement;n&&n();return}var t=this._originalElement,r=fabric.util.createCanvasElement(),i=fabric.util.createImage(),u=this;return r.width=t.width,r.height=t.height,r.getContext("2d").drawImage(t,0,0,t.width,t.height),this.filters.forEach(function(n){n&&n.applyTo(r)}),i.width=t.width,i.height=t.height,fabric.isLikelyNode?(i.src=r.toBuffer(undefined,fabric.Image.pngCompression),u._element=i,n&&n()):(i.onload=function(){u._element=i;n&&n();i.onload=r=t=null},i.src=r.toDataURL("image/png")),this}},_render:function(n,t){this._element&&n.drawImage(this._element,t?this.left:-this.width/2,t?this.top:-this.height/2,this.width,this.height);this._renderStroke(n)},_resetWidthHeight:function(){var n=this.getElement();this.set("width",n.width);this.set("height",n.height)},_initElement:function(n){this.setElement(fabric.util.getById(n));fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(n){n||(n={});this.setOptions(n);this._setWidthHeight(n);this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(n,t){n.filters&&n.filters.length?fabric.util.enlivenObjects(n.filters,function(n){t&&t(n)},"fabric.Image.filters"):t&&t()},_setWidthHeight:function(n){this.width="width"in n?n.width:this.getElement()?this.getElement().width||0:0;this.height="height"in n?n.height:this.getElement()?this.getElement().height||0:0},complexity:function(){return 1}});fabric.Image.CSS_CANVAS="canvas-img";fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc;fabric.Image.fromObject=function(n,t){fabric.util.loadImage(n.src,function(i){fabric.Image.prototype._initFilters.call(n,n,function(r){n.filters=r||[];var u=new fabric.Image(i,n);t&&t(u)})},null,n.crossOrigin)};fabric.Image.fromURL=function(n,t,i){fabric.util.loadImage(n,function(n){t(new fabric.Image(n,i))},null,i&&i.crossOrigin)};fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height xlink:href".split(" "));fabric.Image.fromElement=function(n,i,r){var u=fabric.parseAttributes(n,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(u["xlink:href"],i,t(r?fabric.util.object.clone(r):{},u))};fabric.Image.async=!0;fabric.Image.pngCompression=1}(typeof exports!="undefined"?exports:this);fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var n=this.getAngle()%360;return n>0?Math.round((n-1)/90)*90:Math.round(n/90)*90},straighten:function(){return this.setAngle(this._getAngleValueForStraighten()),this},fxStraighten:function(n){n=n||{};var i=function(){},r=n.onComplete||i,u=n.onChange||i,t=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(n){t.setAngle(n);u()},onComplete:function(){t.setCoords();r()},onStart:function(){t.set("active",!1)}}),this}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(n){return n.straighten(),this.renderAll(),this},fxStraightenObject:function(n){return n.fxStraighten({onChange:this.renderAll.bind(this)}),this}});fabric.Image.filters=fabric.Image.filters||{};fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}}),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Brightness=t.util.createClass(t.Image.filters.BaseFilter,{type:"Brightness",initialize:function(n){n=n||{};this.brightness=n.brightness||0},applyTo:function(n){for(var u=n.getContext("2d"),f=u.getImageData(0,0,n.width,n.height),i=f.data,r=this.brightness,t=0,e=i.length;t<e;t+=4)i[t]+=r,i[t+1]+=r,i[t+2]+=r;u.putImageData(f,0,0)},toObject:function(){return i(this.callSuper("toObject"),{brightness:this.brightness})}});t.Image.filters.Brightness.fromObject=function(n){return new t.Image.filters.Brightness(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Convolute=t.util.createClass(t.Image.filters.BaseFilter,{type:"Convolute",initialize:function(n){n=n||{};this.opaque=n.opaque;this.matrix=n.matrix||[0,0,0,0,1,0,0,0,0];var i=t.util.createCanvasElement();this.tmpCtx=i.getContext("2d")},_createImageData:function(n,t){return this.tmpCtx.createImageData(n,t)},applyTo:function(n){for(var t,i,r,l,a,u,f,b=this.matrix,k=n.getContext("2d"),v=k.getImageData(0,0,n.width,n.height),e=Math.round(Math.sqrt(b.length)),d=Math.floor(e/2),o=v.data,y=v.width,g=v.height,p=y,nt=g,tt=this._createImageData(p,nt),s=tt.data,ft=this.opaque?1:0,h=0;h<nt;h++)for(t=0;t<p;t++){var et=h,ot=t,c=(h*p+t)*4,it=0,rt=0,ut=0,w=0;for(i=0;i<e;i++)for(r=0;r<e;r++)(l=et+i-d,a=ot+r-d,l<0||l>g||a<0||a>y)||(u=(l*y+a)*4,f=b[i*e+r],it+=o[u]*f,rt+=o[u+1]*f,ut+=o[u+2]*f,w+=o[u+3]*f);s[c]=it;s[c+1]=rt;s[c+2]=ut;s[c+3]=w+ft*(255-w)}k.putImageData(tt,0,0)},toObject:function(){return i(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}});t.Image.filters.Convolute.fromObject=function(n){return new t.Image.filters.Convolute(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.GradientTransparency=t.util.createClass(t.Image.filters.BaseFilter,{type:"GradientTransparency",initialize:function(n){n=n||{};this.threshold=n.threshold||100},applyTo:function(n){for(var r=n.getContext("2d"),u=r.getImageData(0,0,n.width,n.height),i=u.data,e=this.threshold,f=i.length,t=0,o=i.length;t<o;t+=4)i[t+3]=e+255*(f-t)/f;r.putImageData(u,0,0)},toObject:function(){return i(this.callSuper("toObject"),{threshold:this.threshold})}});t.Image.filters.GradientTransparency.fromObject=function(n){return new t.Image.filters.GradientTransparency(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={});t.Image.filters.Grayscale=t.util.createClass(t.Image.filters.BaseFilter,{type:"Grayscale",applyTo:function(n){for(var f=n.getContext("2d"),r=f.getImageData(0,0,n.width,n.height),i=r.data,e=r.width*r.height*4,t=0,u;t<e;)u=(i[t]+i[t+1]+i[t+2])/3,i[t]=u,i[t+1]=u,i[t+2]=u,t+=4;f.putImageData(r,0,0)}});t.Image.filters.Grayscale.fromObject=function(){return new t.Image.filters.Grayscale}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={});t.Image.filters.Invert=t.util.createClass(t.Image.filters.BaseFilter,{type:"Invert",applyTo:function(n){for(var r=n.getContext("2d"),u=r.getImageData(0,0,n.width,n.height),i=u.data,f=i.length,t=0;t<f;t+=4)i[t]=255-i[t],i[t+1]=255-i[t+1],i[t+2]=255-i[t+2];r.putImageData(u,0,0)}});t.Image.filters.Invert.fromObject=function(){return new t.Image.filters.Invert}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Mask=t.util.createClass(t.Image.filters.BaseFilter,{type:"Mask",initialize:function(n){n=n||{};this.mask=n.mask;this.channel=[0,1,2,3].indexOf(n.channel)>-1?n.channel:0},applyTo:function(n){var o,s;if(this.mask){var e=n.getContext("2d"),u=e.getImageData(0,0,n.width,n.height),h=u.data,i=this.mask.getElement(),f=t.util.createCanvasElement(),c=this.channel,r,l=u.width*u.height*4;for(f.width=i.width,f.height=i.height,f.getContext("2d").drawImage(i,0,0,i.width,i.height),o=f.getContext("2d").getImageData(0,0,i.width,i.height),s=o.data,r=0;r<l;r+=4)h[r+3]=s[r+c];e.putImageData(u,0,0)}},toObject:function(){return i(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}});t.Image.filters.Mask.fromObject=function(n,i){t.util.loadImage(n.mask.src,function(r){n.mask=new t.Image(r,n.mask);i&&i(new t.Image.filters.Mask(n))})};t.Image.filters.Mask.async=!0}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Noise=t.util.createClass(t.Image.filters.BaseFilter,{type:"Noise",initialize:function(n){n=n||{};this.noise=n.noise||0},applyTo:function(n){for(var u=n.getContext("2d"),f=u.getImageData(0,0,n.width,n.height),i=f.data,e=this.noise,r,t=0,o=i.length;t<o;t+=4)r=(.5-Math.random())*e,i[t]+=r,i[t+1]+=r,i[t+2]+=r;u.putImageData(f,0,0)},toObject:function(){return i(this.callSuper("toObject"),{noise:this.noise})}});t.Image.filters.Noise.fromObject=function(n){return new t.Image.filters.Noise(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Pixelate=t.util.createClass(t.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(n){n=n||{};this.blocksize=n.blocksize||4},applyTo:function(n){for(var h=n.getContext("2d"),f=h.getImageData(0,0,n.width,n.height),i=f.data,w=f.height,s=f.width,t,u,c,l,a,v,e,y,o,p,r=0;r<w;r+=this.blocksize)for(u=0;u<s;u+=this.blocksize)for(t=r*4*s+u*4,c=i[t],l=i[t+1],a=i[t+2],v=i[t+3],e=r,y=r+this.blocksize;e<y;e++)for(o=u,p=u+this.blocksize;o<p;o++)t=e*4*s+o*4,i[t]=c,i[t+1]=l,i[t+2]=a,i[t+3]=v;h.putImageData(f,0,0)},toObject:function(){return i(this.callSuper("toObject"),{blocksize:this.blocksize})}});t.Image.filters.Pixelate.fromObject=function(n){return new t.Image.filters.Pixelate(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.RemoveWhite=t.util.createClass(t.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(n){n=n||{};this.threshold=n.threshold||30;this.distance=n.distance||20},applyTo:function(n){for(var h=n.getContext("2d"),c=h.getImageData(0,0,n.width,n.height),i=c.data,l=this.threshold,e=this.distance,o=255-l,s=Math.abs,r,u,f,t=0,a=i.length;t<a;t+=4)r=i[t],u=i[t+1],f=i[t+2],r>o&&u>o&&f>o&&s(r-u)<e&&s(r-f)<e&&s(u-f)<e&&(i[t+3]=1);h.putImageData(c,0,0)},toObject:function(){return i(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}});t.Image.filters.RemoveWhite.fromObject=function(n){return new t.Image.filters.RemoveWhite(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={});t.Image.filters.Sepia=t.util.createClass(t.Image.filters.BaseFilter,{type:"Sepia",applyTo:function(n){for(var u=n.getContext("2d"),f=u.getImageData(0,0,n.width,n.height),i=f.data,e=i.length,r,t=0;t<e;t+=4)r=.3*i[t]+.59*i[t+1]+.11*i[t+2],i[t]=r+100,i[t+1]=r+50,i[t+2]=r+255;u.putImageData(f,0,0)}});t.Image.filters.Sepia.fromObject=function(){return new t.Image.filters.Sepia}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={});t.Image.filters.Sepia2=t.util.createClass(t.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(n){for(var e=n.getContext("2d"),o=e.getImageData(0,0,n.width,n.height),i=o.data,s=i.length,r,u,f,t=0;t<s;t+=4)r=i[t],u=i[t+1],f=i[t+2],i[t]=(r*.393+u*.769+f*.189)/1.351,i[t+1]=(r*.349+u*.686+f*.168)/1.203,i[t+2]=(r*.272+u*.534+f*.131)/2.14;e.putImageData(o,0,0)}});t.Image.filters.Sepia2.fromObject=function(){return new t.Image.filters.Sepia2}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Tint=t.util.createClass(t.Image.filters.BaseFilter,{type:"Tint",initialize:function(n){n=n||{};this.color=n.color||"#000000";this.opacity=typeof n.opacity!="undefined"?n.opacity:new t.Color(this.color).getAlpha()},applyTo:function(n){var e=n.getContext("2d"),o=e.getImageData(0,0,n.width,n.height),r=o.data,y=r.length,i,s,h,c,l,a,v,u,f;for(f=new t.Color(this.color).getSource(),s=f[0]*this.opacity,h=f[1]*this.opacity,c=f[2]*this.opacity,u=1-this.opacity,i=0;i<y;i+=4)l=r[i],a=r[i+1],v=r[i+2],r[i]=s+l*u,r[i+1]=h+a*u,r[i+2]=c+v*u;e.putImageData(o,0,0)},toObject:function(){return i(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}});t.Image.filters.Tint.fromObject=function(n){return new t.Image.filters.Tint(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Multiply=t.util.createClass(t.Image.filters.BaseFilter,{type:"Multiply",initialize:function(n){n=n||{};this.color=n.color||"#000000"},applyTo:function(n){for(var f=n.getContext("2d"),e=f.getImageData(0,0,n.width,n.height),r=e.data,o=r.length,u=new t.Color(this.color).getSource(),i=0;i<o;i+=4)r[i]*=u[0]/255,r[i+1]*=u[1]/255,r[i+2]*=u[2]/255;f.putImageData(e,0,0)},toObject:function(){return i(this.callSuper("toObject"),{color:this.color})}});t.Image.filters.Multiply.fromObject=function(n){return new t.Image.filters.Multiply(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric;t.Image.filters.Blend=t.util.createClass({type:"Blend",initialize:function(n){n=n||{};this.color=n.color||"#000";this.image=n.image||!1;this.mode=n.mode||"multiply";this.alpha=n.alpha||1},applyTo:function(n){var v=n.getContext("2d"),y=v.getImageData(0,0,n.width,n.height),r=y.data,u,f,e,o,s,h,c,p=!1,a,l,w,i,b;for(this.image?(p=!0,a=t.util.createCanvasElement(),a.width=this.image.width,a.height=this.image.height,l=new t.StaticCanvas(a),l.add(this.image),w=l.getContext("2d"),c=w.getImageData(0,0,l.width,l.height).data):(c=new t.Color(this.color).getSource(),u=c[0]*this.alpha,f=c[1]*this.alpha,e=c[2]*this.alpha),i=0,b=r.length;i<b;i+=4){o=r[i];s=r[i+1];h=r[i+2];p&&(u=c[i]*this.alpha,f=c[i+1]*this.alpha,e=c[i+2]*this.alpha);switch(this.mode){case"multiply":r[i]=o*u/255;r[i+1]=s*f/255;r[i+2]=h*e/255;break;case"screen":r[i]=1-(1-o)*(1-u);r[i+1]=1-(1-s)*(1-f);r[i+2]=1-(1-h)*(1-e);break;case"add":r[i]=Math.min(255,o+u);r[i+1]=Math.min(255,s+f);r[i+2]=Math.min(255,h+e);break;case"diff":case"difference":r[i]=Math.abs(o-u);r[i+1]=Math.abs(s-f);r[i+2]=Math.abs(h-e);break;case"subtract":var k=o-u,d=s-f,g=h-e;r[i]=k<0?0:k;r[i+1]=d<0?0:d;r[i+2]=g<0?0:g;break;case"darken":r[i]=Math.min(o,u);r[i+1]=Math.min(s,f);r[i+2]=Math.min(h,e);break;case"lighten":r[i]=Math.max(o,u);r[i+1]=Math.max(s,f);r[i+2]=Math.max(h,e)}}v.putImageData(y,0,0)}});t.Image.filters.Blend.fromObject=function(n){return new t.Image.filters.Blend(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),u=t.util.object.extend,f=t.util.object.clone,i=t.util.toFixed,e=t.StaticCanvas.supports("setLineDash"),r;if(t.Text){t.warn("fabric.Text is already defined");return}r=t.Object.prototype.stateProperties.concat();r.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor","useNative","path");t.Text=t.util.createClass(t.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,textDecoration:!0,fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,text:!0},_reNewline:/\r?\n/,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.3,textBackgroundColor:"",path:null,useNative:!0,stateProperties:r,stroke:null,shadow:null,initialize:function(n,t){t=t||{};this.text=n;this.__skipDimension=!0;this.setOptions(t);this.__skipDimension=!1;this._initDimensions()},_initDimensions:function(){if(!this.__skipDimension){var n=t.util.createCanvasElement();this._render(n.getContext("2d"))}},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(n){typeof Cufon=="undefined"||this.useNative===!0?this._renderViaNative(n):this._renderViaCufon(n)},_renderViaNative:function(n){var i=this.text.split(this._reNewline);this._setTextStyles(n);this.width=this._getTextWidth(n,i);this.height=this._getTextHeight(n,i);this.clipTo&&t.util.clipContext(this,n);this._renderTextBackground(n,i);this._translateForTextAlign(n);this._renderText(n,i);this.textAlign!=="left"&&this.textAlign!=="justify"&&n.restore();this._renderTextDecoration(n,i);this.clipTo&&n.restore();this._setBoundaries(n,i);this._totalLineHeight=0},_renderText:function(n,t){n.save();this._setShadow(n);this._setupFillRule(n);this._renderTextFill(n,t);this._renderTextStroke(n,t);this._restoreFillRule(n);this._removeShadow(n);n.restore()},_translateForTextAlign:function(n){this.textAlign!=="left"&&this.textAlign!=="justify"&&(n.save(),n.translate(this.textAlign==="center"?this.width/2:this.width,0))},_setBoundaries:function(n,t){var i,u,r,f;for(this._boundaries=[],i=0,u=t.length;i<u;i++)r=this._getLineWidth(n,t[i]),f=this._getLineLeftOffset(r),this._boundaries.push({height:this.fontSize*this.lineHeight,width:r,left:f})},_setTextStyles:function(n){this._setFillStyles(n);this._setStrokeStyles(n);n.textBaseline="alphabetic";this.skipTextAlign||(n.textAlign=this.textAlign);n.font=this._getFontDeclaration()},_getTextHeight:function(n,t){return this.fontSize*t.length*this.lineHeight},_getTextWidth:function(n,t){for(var u,i=n.measureText(t[0]||"|").width,r=1,f=t.length;r<f;r++)u=n.measureText(t[r]).width,u>i&&(i=u);return i},_renderChars:function(n,t,i,r,u){t[n](i,r,u)},_renderTextLine:function(n,t,i,r,u,f){var h,s,e,l;if(u-=this.fontSize/4,this.textAlign!=="justify"){this._renderChars(n,t,i,r,u,f);return}if(h=t.measureText(i).width,s=this.width,s>h){var o=i.split(/\s+/),a=t.measureText(i.replace(/\s+/g,"")).width,v=s-a,y=o.length-1,p=v/y,c=0;for(e=0,l=o.length;e<l;e++)this._renderChars(n,t,o[e],r+c,u,f),c+=t.measureText(o[e]).width+p}else this._renderChars(n,t,i,r,u,f)},_getLeftOffset:function(){return t.isLikelyNode?0:-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextFill:function(n,t){var r,i,u,f;if(this.fill||this._skipFillStrokeCheck)for(this._boundaries=[],r=0,i=0,u=t.length;i<u;i++)f=this._getHeightOfLine(n,i,t),r+=f,this._renderTextLine("fillText",n,t[i],this._getLeftOffset(),this._getTopOffset()+r,i)},_renderTextStroke:function(n,t){var r,i,u,f;if(this.stroke&&this.strokeWidth!==0||this._skipFillStrokeCheck){for(r=0,n.save(),this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),e&&n.setLineDash(this.strokeDashArray)),n.beginPath(),i=0,u=t.length;i<u;i++)f=this._getHeightOfLine(n,i,t),r+=f,this._renderTextLine("strokeText",n,t[i],this._getLeftOffset(),this._getTopOffset()+r,i);n.closePath();n.restore()}},_getHeightOfLine:function(){return this.fontSize*this.lineHeight},_renderTextBackground:function(n,t){this._renderTextBoxBackground(n);this._renderTextLinesBackground(n,t)},_renderTextBoxBackground:function(n){this.backgroundColor&&(n.save(),n.fillStyle=this.backgroundColor,n.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),n.restore())},_renderTextLinesBackground:function(n,t){var i,u,r,f;if(this.textBackgroundColor){for(n.save(),n.fillStyle=this.textBackgroundColor,i=0,u=t.length;i<u;i++)t[i]!==""&&(r=this._getLineWidth(n,t[i]),f=this._getLineLeftOffset(r),n.fillRect(this._getLeftOffset()+f,this._getTopOffset()+i*this.fontSize*this.lineHeight,r,this.fontSize*this.lineHeight));n.restore()}},_getLineLeftOffset:function(n){return this.textAlign==="center"?(this.width-n)/2:this.textAlign==="right"?this.width-n:0},_getLineWidth:function(n,t){return this.textAlign==="justify"?this.width:n.measureText(t).width},_renderTextDecoration:function(n,t){function r(r){for(var e,s,f=0,o=t.length;f<o;f++)e=i._getLineWidth(n,t[f]),s=i._getLineLeftOffset(e),n.fillRect(i._getLeftOffset()+s,~~(r+f*i._getHeightOfLine(n,f,t)-u),e,1)}if(this.textDecoration){var u=this._getTextHeight(n,t)/2,i=this;this.textDecoration.indexOf("underline")>-1&&r(this.fontSize*this.lineHeight);this.textDecoration.indexOf("line-through")>-1&&r(this.fontSize*this.lineHeight-this.fontSize/2);this.textDecoration.indexOf("overline")>-1&&r(this.fontSize*this.lineHeight-this.fontSize)}},_getFontDeclaration:function(){return[t.isLikelyNode?this.fontWeight:this.fontStyle,t.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",t.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(n,t){if(this.visible){n.save();this._transform(n,t);var i=this.transformMatrix,r=this.group&&this.group.type==="path-group";r&&n.translate(-this.group.width/2,-this.group.height/2);i&&n.transform(i[0],i[1],i[2],i[3],i[4],i[5]);r&&n.translate(this.left,this.top);this._render(n);n.restore()}},toObject:function(n){var t=u(this.callSuper("toObject",n),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,path:this.path,textBackgroundColor:this.textBackgroundColor,useNative:this.useNative});return this.includeDefaultValues||this._removeDefaultValues(t),t},toSVG:function(n){var i=[],r=this.text.split(this._reNewline),t=this._getSVGLeftTopOffsets(r),u=this._getSVGTextAndBg(t.lineTop,t.textLeft,r),f=this._getSVGShadows(t.lineTop,r);return t.textTop+=this._fontAscent?this._fontAscent/5*this.lineHeight:0,this._wrapSVGTextAndBg(i,u,f,t),n?n(i.join("")):i.join("")},_getSVGLeftTopOffsets:function(n){var t=this.useNative?this.fontSize*this.lineHeight:-this._fontAscent-this._fontAscent/5*this.lineHeight,i=-(this.width/2),r=this.useNative?this.fontSize-1:this.height/2-n.length*this.fontSize-this._totalLineHeight;return{textLeft:i+(this.group?this.left:0),textTop:r+(this.group?this.top:0),lineTop:t}},_wrapSVGTextAndBg:function(n,t,r,u){n.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n',t.textBgRects.join(""),"<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" ','transform="translate(',i(u.textLeft,2)," ",i(u.textTop,2),')">',r.join(""),t.textSpans.join(""),"<\/text>\n","<\/g>\n")},_getSVGShadows:function(n,r){var f=[],u,o,e=1,s;if(!this.shadow||!this._boundaries)return f;for(u=0,o=r.length;u<o;u++)r[u]!==""?(s=this._boundaries&&this._boundaries[u]?this._boundaries[u].left:0,f.push('<tspan x="',i(s+e+this.shadow.offsetX,2),u===0||this.useNative?'" y':'" dy','="',i(this.useNative?n*u-this.height/2+this.shadow.offsetY:n+(u===0?this.shadow.offsetY:0),2),'" ',this._getFillAttributes(this.shadow.color),">",t.util.string.escapeXml(r[u]),"<\/tspan>"),e=1):e++;return f},_getSVGTextAndBg:function(n,t,i){var e=[],u=[],f=1,r,o;for(this._setSVGBg(u),r=0,o=i.length;r<o;r++)(i[r]!==""?(this._setSVGTextLineText(i[r],r,e,n,f,u),f=1):f++,this.textBackgroundColor&&this._boundaries)&&this._setSVGTextLineBg(u,r,t,n);return{textSpans:e,textBgRects:u}},_setSVGTextLineText:function(n,r,u,f,e){var o=this._boundaries&&this._boundaries[r]?i(this._boundaries[r].left,2):0;u.push('<tspan x="',o,'" ',r===0||this.useNative?"y":"dy",'="',i(this.useNative?f*r-this.height/2:f*e,2),'" ',this._getFillAttributes(this.fill),">",t.util.string.escapeXml(n),"<\/tspan>")},_setSVGTextLineBg:function(n,t,r,u){n.push("<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',i(r+this._boundaries[t].left,2),'" y="',i(u*t-this.height/2,2),'" width="',i(this._boundaries[t].width,2),'" height="',i(this._boundaries[t].height,2),'"><\/rect>\n')},_setSVGBg:function(n){this.backgroundColor&&this._boundaries&&n.push("<rect ",this._getFillAttributes(this.backgroundColor),' x="',i(-this.width/2,2),'" y="',i(-this.height/2,2),'" width="',i(this.width,2),'" height="',i(this.height,2),'"><\/rect>')},_getFillAttributes:function(n){var i=n&&typeof n=="string"?new t.Color(n):"";return!i||!i.getSource()||i.getAlpha()===1?'fill="'+n+'"':'opacity="'+i.getAlpha()+'" fill="'+i.setAlpha(1).toRgb()+'"'},_set:function(n,t){n==="fontFamily"&&this.path&&(this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,"$1"+t+"$3"));this.callSuper("_set",n,t);n in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}});t.Text.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" "));t.Text.DEFAULT_SVG_FONT_SIZE=16;t.Text.fromElement=function(n,i){var u,r,f;return n?(u=t.parseAttributes(n,t.Text.ATTRIBUTE_NAMES),i=t.util.object.extend(i?t.util.object.clone(i):{},u),"dx"in u&&(i.left+=u.dx),"dy"in u&&(i.top+=u.dy),"fontSize"in i||(i.fontSize=t.Text.DEFAULT_SVG_FONT_SIZE),i.originX||(i.originX="left"),r=new t.Text(n.textContent,i),f=0,r.originX==="left"&&(f=r.getWidth()/2),r.originX==="right"&&(f=-r.getWidth()/2),r.set({left:r.getLeft()+f,top:r.getTop()-r.getHeight()/2}),r):null};t.Text.fromObject=function(n){return new t.Text(n.text,f(n))};t.util.createAccessors(t.Text)}(typeof exports!="undefined"?exports:this),function(){var n=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,styles:null,caching:!0,_skipFillStrokeCheck:!0,_reSpace:/\s|\n/,_fontSizeFraction:4,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,_charWidthsCache:{},initialize:function(n,t){this.styles=t?t.styles||{}:{};this.callSuper("initialize",n,t);this.initBehavior();fabric.IText.instances.push(this);this.__lineWidths={};this.__lineHeights={};this.__lineOffsets={}},isEmptyStyles:function(){var n,t,i,r;if(!this.styles)return!0;n=this.styles;for(t in n)for(i in n[t])for(r in n[t][i])return!1;return!0},setSelectionStart:function(n){this.selectionStart!==n&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}));this.selectionStart=n;this.hiddenTextarea&&(this.hiddenTextarea.selectionStart=n)},setSelectionEnd:function(n){this.selectionEnd!==n&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}));this.selectionEnd=n;this.hiddenTextarea&&(this.hiddenTextarea.selectionEnd=n)},getSelectionStyles:function(n,t){var u,i,r;if(arguments.length===2){for(u=[],i=n;i<t;i++)u.push(this.getSelectionStyles(i));return u}return(r=this.get2DCursorLocation(n),this.styles[r.lineIndex])?this.styles[r.lineIndex][r.charIndex]||{}:{}},setSelectionStyles:function(n){if(this.selectionStart===this.selectionEnd)this._extendStyles(this.selectionStart,n);else for(var t=this.selectionStart;t<this.selectionEnd;t++)this._extendStyles(t,n);return this},_extendStyles:function(n,t){var i=this.get2DCursorLocation(n);this.styles[i.lineIndex]||(this.styles[i.lineIndex]={});this.styles[i.lineIndex][i.charIndex]||(this.styles[i.lineIndex][i.charIndex]={});fabric.util.object.extend(this.styles[i.lineIndex][i.charIndex],t)},_render:function(n){this.callSuper("_render",n);this.ctx=n;this.isEditing&&this.renderCursorOrSelection()},renderCursorOrSelection:function(){if(this.active){var t=this.text.split(""),n;this.selectionStart===this.selectionEnd?(n=this._getCursorBoundaries(t,"cursor"),this.renderCursor(n)):(n=this._getCursorBoundaries(t,"selection"),this.renderSelection(t,n))}},get2DCursorLocation:function(n){typeof n=="undefined"&&(n=this.selectionStart);var i=this.text.slice(0,n),t=i.split(this._reNewline);return{lineIndex:t.length-1,charIndex:t[t.length-1].length}},getCurrentCharStyle:function(n,t){var i=this.styles[n]&&this.styles[n][t===0?0:t-1];return{fontSize:i&&i.fontSize||this.fontSize,fill:i&&i.fill||this.fill,textBackgroundColor:i&&i.textBackgroundColor||this.textBackgroundColor,textDecoration:i&&i.textDecoration||this.textDecoration,fontFamily:i&&i.fontFamily||this.fontFamily,fontWeight:i&&i.fontWeight||this.fontWeight,fontStyle:i&&i.fontStyle||this.fontStyle,stroke:i&&i.stroke||this.stroke,strokeWidth:i&&i.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(n,t){return this.styles[n]&&this.styles[n][t===0?0:t-1]&&this.styles[n][t===0?0:t-1].fontSize||this.fontSize},getCurrentCharColor:function(n,t){return this.styles[n]&&this.styles[n][t===0?0:t-1]&&this.styles[n][t===0?0:t-1].fill||this.cursorColor},_getCursorBoundaries:function(n,t){var r=this.get2DCursorLocation(),u=this.text.split(this._reNewline),f=Math.round(this._getLeftOffset()),e=-this.height/2,i=this._getCursorBoundariesOffsets(n,t,r,u);return{left:f,top:e,leftOffset:i.left+i.lineLeft,topOffset:i.top}},_getCursorBoundariesOffsets:function(n,t,i,r){for(var c,s=0,u=0,e=0,o=0,h=t==="cursor"?this._getHeightOfLine(this.ctx,0)-this.getCurrentCharFontSize(i.lineIndex,i.charIndex):0,f=0;f<this.selectionStart;f++)n[f]==="\n"?(o=0,c=u+(t==="cursor"?1:0),h+=this._getCachedLineHeight(c),u++,e=0):(o+=this._getWidthOfChar(this.ctx,n[f],u,e),e++),s=this._getCachedLineOffset(u,r);return this._clearCache(),{top:h,left:o,lineLeft:s}},_clearCache:function(){this.__lineWidths={};this.__lineHeights={};this.__lineOffsets={}},_getCachedLineHeight:function(n){return this.__lineHeights[n]||(this.__lineHeights[n]=this._getHeightOfLine(this.ctx,n))},_getCachedLineWidth:function(n,t){return this.__lineWidths[n]||(this.__lineWidths[n]=this._getWidthOfLine(this.ctx,n,t))},_getCachedLineOffset:function(n,t){var i=this._getCachedLineWidth(n,t);return this.__lineOffsets[n]||(this.__lineOffsets[n]=this._getLineLeftOffset(i))},renderCursor:function(n){var t=this.ctx;t.save();var u=this.get2DCursorLocation(),i=u.lineIndex,r=u.charIndex,f=this.getCurrentCharFontSize(i,r),e=i===0&&r===0?this._getCachedLineOffset(i,this.text.split(this._reNewline)):n.leftOffset;t.fillStyle=this.getCurrentCharColor(i,r);t.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity;t.fillRect(n.left+e,n.top+n.topOffset,this.cursorWidth/this.scaleX,f);t.restore()},renderSelection:function(n,t){var u=this.ctx,i,r,y,e,p;u.save();u.fillStyle=this.selectionColor;var h=this.get2DCursorLocation(this.selectionStart),c=this.get2DCursorLocation(this.selectionEnd),l=h.lineIndex,o=c.lineIndex,f=this.text.split(this._reNewline);for(i=l;i<=o;i++){var a=this._getCachedLineOffset(i,f)||0,v=this._getCachedLineHeight(i),s=0;if(i===l)for(r=0,y=f[i].length;r<y;r++)r>=h.charIndex&&(i!==o||r<c.charIndex)&&(s+=this._getWidthOfChar(u,f[i][r],i,r)),r<h.charIndex&&(a+=this._getWidthOfChar(u,f[i][r],i,r));else if(i>l&&i<o)s+=this._getCachedLineWidth(i,f)||5;else if(i===o)for(e=0,p=c.charIndex;e<p;e++)s+=this._getWidthOfChar(u,f[i][e],i,e);u.fillRect(t.left+a,t.top+t.topOffset,s,v);t.topOffset+=v}u.restore()},_renderChars:function(n,t,i,r,u,f){var e,h,c;if(this.isEmptyStyles())return this._renderCharsFast(n,t,i,r,u);this.skipTextAlign=!0;r-=this.textAlign==="center"?this.width/2:this.textAlign==="right"?this.width:0;var l=this.text.split(this._reNewline),v=this._getWidthOfLine(t,f,l),y=this._getHeightOfLine(t,f,l),p=this._getLineLeftOffset(v),a=i.split(""),o,s="";for(r+=p||0,t.save(),e=0,h=a.length;e<=h;e++)o=o||this.getCurrentCharStyle(f,e),c=this.getCurrentCharStyle(f,e+1),(this._hasStyleChanged(o,c)||e===h)&&(this._renderChar(n,t,f,e-1,s,r,u,y),s="",o=c),s+=a[e];t.restore()},_renderCharsFast:function(n,t,i,r,u){this.skipTextAlign=!1;n==="fillText"&&this.fill&&this.callSuper("_renderChars",n,t,i,r,u);n==="strokeText"&&this.stroke&&this.callSuper("_renderChars",n,t,i,r,u)},_renderChar:function(n,t,i,r,u,f,e,o){var s,h,c,l,a;this.styles&&this.styles[i]&&(s=this.styles[i][r])?(l=s.stroke||this.stroke,a=s.fill||this.fill,t.save(),h=this._applyCharStylesGetWidth(t,u,i,r,s),c=this._getHeightOfChar(t,u,i,r),a&&t.fillText(u,f,e),l&&t.strokeText(u,f,e),this._renderCharDecoration(t,s,f,e,h,o,c),t.restore(),t.translate(h,0)):(n==="strokeText"&&this.stroke&&t[n](u,f,e),n==="fillText"&&this.fill&&t[n](u,f,e),h=this._applyCharStylesGetWidth(t,u,i,r),this._renderCharDecoration(t,null,f,e,h,o),t.translate(t.measureText(u).width,0))},_hasStyleChanged:function(n,t){return n.fill!==t.fill||n.fontSize!==t.fontSize||n.textBackgroundColor!==t.textBackgroundColor||n.textDecoration!==t.textDecoration||n.fontFamily!==t.fontFamily||n.fontWeight!==t.fontWeight||n.fontStyle!==t.fontStyle||n.stroke!==t.stroke||n.strokeWidth!==t.strokeWidth},_renderCharDecoration:function(n,t,i,r,u,f,e){var o=t?t.textDecoration||this.textDecoration:this.textDecoration,s=(t?t.fontSize:null)||this.fontSize;o&&(o.indexOf("underline")>-1&&this._renderCharDecorationAtOffset(n,i,r+this.fontSize/this._fontSizeFraction,u,0,this.fontSize/20),o.indexOf("line-through")>-1&&this._renderCharDecorationAtOffset(n,i,r+this.fontSize/this._fontSizeFraction,u,e/2,s/20),o.indexOf("overline")>-1&&this._renderCharDecorationAtOffset(n,i,r,u,f-this.fontSize/this._fontSizeFraction,this.fontSize/20))},_renderCharDecorationAtOffset:function(n,t,i,r,u,f){n.fillRect(t,i-u,r,f)},_renderTextLine:function(n,t,i,r,u,f){u+=this.fontSize/4;this.callSuper("_renderTextLine",n,t,i,r,u,f)},_renderTextDecoration:function(n,t){if(this.isEmptyStyles())return this.callSuper("_renderTextDecoration",n,t)},_renderTextLinesBackground:function(n,t){var u,e,i,h,f,o,s,r,c,l;if(this.textBackgroundColor||this.styles){for(n.save(),this.textBackgroundColor&&(n.fillStyle=this.textBackgroundColor),u=0,e=this.fontSize/this._fontSizeFraction,i=0,h=t.length;i<h;i++){if(f=this._getHeightOfLine(n,i,t),t[i]===""){u+=f;continue}if(o=this._getWidthOfLine(n,i,t),s=this._getLineLeftOffset(o),this.textBackgroundColor&&(n.fillStyle=this.textBackgroundColor,n.fillRect(this._getLeftOffset()+s,this._getTopOffset()+u+e,o,f)),this.styles[i])for(r=0,c=t[i].length;r<c;r++)this.styles[i]&&this.styles[i][r]&&this.styles[i][r].textBackgroundColor&&(l=t[i][r],n.fillStyle=this.styles[i][r].textBackgroundColor,n.fillRect(this._getLeftOffset()+s+this._getWidthOfCharsAt(n,i,r,t),this._getTopOffset()+u+e,this._getWidthOfChar(n,l,i,r,t)+1,f));u+=f}n.restore()}},_getCacheProp:function(n,t){return n+t.fontFamily+t.fontSize+t.fontWeight+t.fontStyle+t.shadow},_applyCharStylesGetWidth:function(t,i,r,u,f){var e=f||this.styles[r]&&this.styles[r][u],o,s;return(e=e?n(e):{},this._applyFontStyles(e),o=this._getCacheProp(i,e),this.isEmptyStyles()&&this._charWidthsCache[o]&&this.caching)?this._charWidthsCache[o]:(typeof e.shadow=="string"&&(e.shadow=new fabric.Shadow(e.shadow)),s=e.fill||this.fill,t.fillStyle=s.toLive?s.toLive(t):s,e.stroke&&(t.strokeStyle=e.stroke&&e.stroke.toLive?e.stroke.toLive(t):e.stroke),t.lineWidth=e.strokeWidth||this.strokeWidth,t.font=this._getFontDeclaration.call(e),this._setShadow.call(e,t),!this.caching)?t.measureText(i).width:(this._charWidthsCache[o]||(this._charWidthsCache[o]=t.measureText(i).width),this._charWidthsCache[o])},_applyFontStyles:function(n){n.fontFamily||(n.fontFamily=this.fontFamily);n.fontSize||(n.fontSize=this.fontSize);n.fontWeight||(n.fontWeight=this.fontWeight);n.fontStyle||(n.fontStyle=this.fontStyle)},_getStyleDeclaration:function(t,i){return this.styles[t]&&this.styles[t][i]?n(this.styles[t][i]):{}},_getWidthOfChar:function(n,t,i,r){var f=this._getStyleDeclaration(i,r),u,e;return(this._applyFontStyles(f),u=this._getCacheProp(t,f),this._charWidthsCache[u]&&this.caching)?this._charWidthsCache[u]:n?(n.save(),e=this._applyCharStylesGetWidth(n,t,i,r),n.restore(),e):void 0},_getHeightOfChar:function(n,t,i,r){return this.styles[i]&&this.styles[i][r]?this.styles[i][r].fontSize||this.fontSize:this.fontSize},_getWidthOfCharAt:function(n,t,i,r){r=r||this.text.split(this._reNewline);var u=r[t].split("")[i];return this._getWidthOfChar(n,u,t,i)},_getHeightOfCharAt:function(n,t,i,r){r=r||this.text.split(this._reNewline);var u=r[t].split("")[i];return this._getHeightOfChar(n,u,t,i)},_getWidthOfCharsAt:function(n,t,i,r){for(var f=0,u=0;u<i;u++)f+=this._getWidthOfCharAt(n,t,u,r);return f},_getWidthOfLine:function(n,t,i){return this._getWidthOfCharsAt(n,t,i[t].length,i)},_getTextWidth:function(n,t){var i,r,f,u;if(this.isEmptyStyles())return this.callSuper("_getTextWidth",n,t);for(i=this._getWidthOfLine(n,0,t),r=1,f=t.length;r<f;r++)u=this._getWidthOfLine(n,r,t),u>i&&(i=u);return i},_getHeightOfLine:function(n,t,i){var r,o,f;i=i||this.text.split(this._reNewline);var u=this._getHeightOfChar(n,i[t][0],t,0),s=i[t],e=s.split("");for(r=1,o=e.length;r<o;r++)f=this._getHeightOfChar(n,e[r],t,r),f>u&&(u=f);return u*this.lineHeight},_getTextHeight:function(n,t){for(var r=0,i=0,u=t.length;i<u;i++)r+=this._getHeightOfLine(n,i,t);return r},_getTopOffset:function(){var n=fabric.Text.prototype._getTopOffset.call(this);return n-this.fontSize/this._fontSizeFraction},_renderTextBoxBackground:function(n){this.backgroundColor&&(n.save(),n.fillStyle=this.backgroundColor,n.fillRect(this._getLeftOffset(),this._getTopOffset()+this.fontSize/this._fontSizeFraction,this.width,this.height),n.restore())},toObject:function(t){return fabric.util.object.extend(this.callSuper("toObject",t),{styles:n(this.styles)})}});fabric.IText.fromObject=function(t){return new fabric.IText(t.text,n(t))};fabric.IText.instances=[]}(),function(){var n=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler();this.initCursorSelectionHandlers();this.initDoubleClickSimulation()},initSelectedHandler:function(){this.on("selected",function(){var n=this;setTimeout(function(){n.selected=!0},100)})},initAddedHandler:function(){this.on("added",function(){this.canvas&&!this.canvas._hasITextHandlers&&(this.canvas._hasITextHandlers=!0,this._initCanvasHandlers())})},_initCanvasHandlers:function(){this.canvas.on("selection:cleared",function(){fabric.IText.prototype.exitEditingOnOthers.call()});this.canvas.on("mouse:up",function(){fabric.IText.instances.forEach(function(n){n.__isMousedown=!1})});this.canvas.on("object:selected",function(n){fabric.IText.prototype.exitEditingOnOthers.call(n.target)})},_tick:function(){if(!this._abortCursorAnimation){var n=this;this.animate("_currentCursorOpacity",1,{duration:this.cursorDuration,onComplete:function(){n._onTickComplete()},onChange:function(){n.canvas&&n.canvas.renderAll()},abort:function(){return n._abortCursorAnimation}})}},_onTickComplete:function(){if(!this._abortCursorAnimation){var n=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1);this._cursorTimeout1=setTimeout(function(){n.animate("_currentCursorOpacity",0,{duration:this.cursorDuration/2,onComplete:function(){n._tick()},onChange:function(){n.canvas&&n.canvas.renderAll()},abort:function(){return n._abortCursorAnimation}})},100)}},initDelayedCursor:function(n){var t=this,i=n?0:this.cursorDelay;n&&(this._abortCursorAnimation=!0,clearTimeout(this._cursorTimeout1),this._currentCursorOpacity=1,this.canvas&&this.canvas.renderAll());this._cursorTimeout2&&clearTimeout(this._cursorTimeout2);this._cursorTimeout2=setTimeout(function(){t._abortCursorAnimation=!1;t._tick()},i)},abortCursorAnimation:function(){this._abortCursorAnimation=!0;clearTimeout(this._cursorTimeout1);clearTimeout(this._cursorTimeout2);this._currentCursorOpacity=0;this.canvas&&this.canvas.renderAll();var n=this;setTimeout(function(){n._abortCursorAnimation=!1},10)},selectAll:function(){this.selectionStart=0;this.selectionEnd=this.text.length;this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(n){var i=0,t=n-1;if(this._reSpace.test(this.text.charAt(t)))while(this._reSpace.test(this.text.charAt(t)))i++,t--;while(/\S/.test(this.text.charAt(t))&&t>-1)i++,t--;return n-i},findWordBoundaryRight:function(n){var i=0,t=n;if(this._reSpace.test(this.text.charAt(t)))while(this._reSpace.test(this.text.charAt(t)))i++,t++;while(/\S/.test(this.text.charAt(t))&&t<this.text.length)i++,t++;return n+i},findLineBoundaryLeft:function(n){for(var i=0,t=n-1;!/\n/.test(this.text.charAt(t))&&t>-1;)i++,t--;return n-i},findLineBoundaryRight:function(n){for(var i=0,t=n;!/\n/.test(this.text.charAt(t))&&t<this.text.length;)i++,t++;return n+i},getNumNewLinesInSelectedText:function(){for(var r=this.getSelectedText(),t=0,n=0,i=r.split(""),u=i.length;n<u;n++)i[n]==="\n"&&t++;return t},searchWordBoundary:function(n,t){for(var i=this._reSpace.test(this.text.charAt(n))?n-1:n,r=this.text.charAt(i),u=/[ \n\.,;!\?\-]/;!u.test(r)&&i>0&&i<this.text.length;)i+=t,r=this.text.charAt(i);return u.test(r)&&r!=="\n"&&(i+=t===1?0:1),i},selectWord:function(n){var t=this.searchWordBoundary(n,-1),i=this.searchWordBoundary(n,1);this.setSelectionStart(t);this.setSelectionEnd(i);this.initDelayedCursor(!0)},selectLine:function(n){var t=this.findLineBoundaryLeft(n),i=this.findLineBoundaryRight(n);this.setSelectionStart(t);this.setSelectionEnd(i);this.initDelayedCursor(!0)},enterEditing:function(){if(!this.isEditing&&this.editable)return this.exitEditingOnOthers(),this.isEditing=!0,this.initHiddenTextarea(),this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._tick(),this.canvas&&this.canvas.renderAll(),this.fire("editing:entered"),this.canvas&&this.canvas.fire("text:editing:entered",{target:this}),this},exitEditingOnOthers:function(){fabric.IText.instances.forEach(function(n){n.selected=!1;n.isEditing&&n.exitEditing()},this)},_setEditingProps:function(){this.hoverCursor="text";this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text");this.borderColor=this.editingBorderColor;this.hasControls=this.selectable=!1;this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){this.hiddenTextarea&&(this.hiddenTextarea.value=this.text,this.hiddenTextarea.selectionStart=this.selectionStart)},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){return this.selected=!1,this.isEditing=!1,this.selectable=!0,this.selectionEnd=this.selectionStart,this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this.fire("editing:exited"),this.canvas&&this.canvas.fire("text:editing:exited",{target:this}),this},_removeExtraneousStyles:function(){var t=this.text.split(this._reNewline);for(var n in this.styles)t[n]||delete this.styles[n]},_removeCharsFromTo:function(n,t){for(var i=t,u,f,r;i!==n;)u=this.get2DCursorLocation(i).charIndex,i--,f=this.get2DCursorLocation(i).charIndex,r=f>u,r?this.removeStyleObject(r,i+1):this.removeStyleObject(this.get2DCursorLocation(i).charIndex===0,i);this.text=this.text.slice(0,n)+this.text.slice(t)},insertChars:function(n){var t=this.text.slice(this.selectionStart,this.selectionStart+1)==="\n";this.text=this.text.slice(0,this.selectionStart)+n+this.text.slice(this.selectionEnd);this.selectionStart===this.selectionEnd&&this.insertStyleObjects(n,t,this.copiedStyles);this.selectionStart+=n.length;this.selectionEnd=this.selectionStart;this.canvas&&this.canvas.renderAll().renderAll();this.setCoords();this.fire("changed");this.canvas&&this.canvas.fire("text:changed",{target:this})},insertNewlineStyleObject:function(t,i,r){var e,u,f;if(this.shiftLineStyles(t,1),this.styles[t+1]||(this.styles[t+1]={}),e=this.styles[t][i-1],u={},r)u[0]=n(e),this.styles[t+1]=u;else{for(f in this.styles[t])parseInt(f,10)>=i&&(u[parseInt(f,10)-i]=this.styles[t][f],delete this.styles[t][f]);this.styles[t+1]=u}},insertCharStyleObject:function(t,i,r){var f=this.styles[t],e=n(f),o,u;i!==0||r||(i=1);for(o in e)u=parseInt(o,10),u>=i&&(f[u+1]=e[u]);this.styles[t][i]=r||n(f[i-1])},insertStyleObjects:function(n,t,i){if(!this.isEmptyStyles()){var u=this.get2DCursorLocation(),r=u.lineIndex,f=u.charIndex;this.styles[r]||(this.styles[r]={});n==="\n"?this.insertNewlineStyleObject(r,f,t):i?this._insertStyles(i):this.insertCharStyleObject(r,f)}},_insertStyles:function(n){for(var t=0,i=n.length;t<i;t++){var r=this.get2DCursorLocation(this.selectionStart+t),u=r.lineIndex,f=r.charIndex;this.insertCharStyleObject(u,f,n[t])}},shiftLineStyles:function(t,i){var f=n(this.styles),u,r;for(u in this.styles)r=parseInt(u,10),r>t&&(this.styles[r+i]=f[r])},removeStyleObject:function(t,i){var s=this.get2DCursorLocation(i),r=s.lineIndex,e=s.charIndex,u,c,o,l,f;if(t){var a=this.text.split(this._reNewline),h=a[r-1],v=h?h.length:0;this.styles[r-1]||(this.styles[r-1]={});for(e in this.styles[r])this.styles[r-1][parseInt(e,10)+v]=this.styles[r][e];this.shiftLineStyles(r,-1)}else{u=this.styles[r];u&&(c=this.selectionStart===this.selectionEnd?-1:0,delete u[e+c]);o=n(u);for(l in o)f=parseInt(l,10),f>=e&&f!==0&&(u[f-1]=o[f],delete u[f])}},insertNewline:function(){this.insertChars("\n")}})}();fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date;this.__lastLastClickTime=+new Date;this.__lastPointer={};this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(n){this.__newClickTime=+new Date;var t=this.canvas.getPointer(n.e);this.isTripleClick(t)?(this.fire("tripleclick",n),this._stopEvent(n.e)):this.isDoubleClick(t)&&(this.fire("dblclick",n),this._stopEvent(n.e));this.__lastLastClickTime=this.__lastClickTime;this.__lastClickTime=this.__newClickTime;this.__lastPointer=t;this.__lastIsEditing=this.isEditing;this.__lastSelected=this.selected},isDoubleClick:function(n){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===n.x&&this.__lastPointer.y===n.y&&this.__lastIsEditing},isTripleClick:function(n){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===n.x&&this.__lastPointer.y===n.y},_stopEvent:function(n){n.preventDefault&&n.preventDefault();n.stopPropagation&&n.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler();this.initMousedownHandler();this.initMousemoveHandler();this.initMouseupHandler();this.initClicks()},initClicks:function(){this.on("dblclick",function(n){this.selectWord(this.getSelectionStartFromPointer(n.e))});this.on("tripleclick",function(n){this.selectLine(this.getSelectionStartFromPointer(n.e))})},initMousedownHandler:function(){this.on("mousedown",function(n){var t=this.canvas.getPointer(n.e);this.__mousedownX=t.x;this.__mousedownY=t.y;this.__isMousedown=!0;this.hiddenTextarea&&this.canvas&&this.canvas.wrapperEl.appendChild(this.hiddenTextarea);this.selected&&this.setCursorByClick(n.e);this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.initDelayedCursor(!0))})},initMousemoveHandler:function(){this.on("mousemove",function(n){if(this.__isMousedown&&this.isEditing){var t=this.getSelectionStartFromPointer(n.e);t>=this.__selectionStartOnMouseDown?(this.setSelectionStart(this.__selectionStartOnMouseDown),this.setSelectionEnd(t)):(this.setSelectionStart(t),this.setSelectionEnd(this.__selectionStartOnMouseDown))}})},_isObjectMoved:function(n){var t=this.canvas.getPointer(n);return this.__mousedownX!==t.x||this.__mousedownY!==t.y},initMouseupHandler:function(){this.on("mouseup",function(n){(this.__isMousedown=!1,this._isObjectMoved(n.e))||(this.__lastSelected&&(this.enterEditing(),this.initDelayedCursor(!0)),this.selected=!0)})},setCursorByClick:function(n){var t=this.getSelectionStartFromPointer(n);n.shiftKey?t<this.selectionStart?(this.setSelectionEnd(this.selectionStart),this.setSelectionStart(t)):this.setSelectionEnd(t):(this.setSelectionStart(t),this.setSelectionEnd(t))},_getLocalRotatedPointer:function(n){var t=this.canvas.getPointer(n),i=new fabric.Point(t.x,t.y),r=new fabric.Point(this.left,this.top),u=fabric.util.rotatePoint(i,r,fabric.util.degreesToRadians(-this.angle));return this.getLocalPointer(n,u)},getSelectionStartFromPointer:function(n){for(var c,l,u,e,a,f=this._getLocalRotatedPointer(n),i=this.text.split(this._reNewline),o=0,r=0,s=0,h=0,v,t=0,y=i.length;t<y;t++){for(s+=this._getHeightOfLine(this.ctx,t)*this.scaleY,c=this._getWidthOfLine(this.ctx,t,i),l=this._getLineLeftOffset(c),r=l*this.scaleX,this.flipX&&(i[t]=i[t].split("").reverse().join("")),u=0,e=i[t].length;u<e;u++){if(a=i[t][u],o=r,r+=this._getWidthOfChar(this.ctx,a,t,this.flipX?e-u:u)*this.scaleX,s<=f.y||r<=f.x){h++;continue}return this._getNewSelectionStartFromOffset(f,o,r,h+t,e)}if(f.y<s)return this._getNewSelectionStartFromOffset(f,o,r,h+t,e)}if(typeof v=="undefined")return this.text.length},_getNewSelectionStartFromOffset:function(n,t,i,r,u){var e=n.x-t,o=i-n.x,s=o>e?0:1,f=r+s;return this.flipX&&(f=u-f),f>this.text.length&&(f=this.text.length),f}});fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea");this.hiddenTextarea.setAttribute("autocapitalize","off");this.hiddenTextarea.style.cssText="position: absolute; top: 0; left: -9999px";fabric.document.body.appendChild(this.hiddenTextarea);fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this));fabric.util.addListener(this.hiddenTextarea,"keypress",this.onKeyPress.bind(this));fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this));fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this));!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},_keysMap:{8:"removeChars",13:"insertNewline",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMap:{65:"selectAll",88:"cut"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(n){if(this.isEditing){if(n.keyCode in this._keysMap&&n.charCode===0)this[this._keysMap[n.keyCode]](n);else if(n.keyCode in this._ctrlKeysMap&&(n.ctrlKey||n.metaKey))this[this._ctrlKeysMap[n.keyCode]](n);else return;n.stopPropagation();this.canvas&&this.canvas.renderAll()}},forwardDelete:function(n){this.selectionStart===this.selectionEnd&&this.moveCursorRight(n);this.removeChars(n)},copy:function(n){var t=this.getSelectedText(),i=this._getClipboardData(n);i&&i.setData("text",t);this.copiedText=t;this.copiedStyles=this.getSelectionStyles(this.selectionStart,this.selectionEnd)},paste:function(n){var t=null,i=this._getClipboardData(n);t=i?i.getData("text"):this.copiedText;t&&this.insertChars(t)},cut:function(n){this.selectionStart!==this.selectionEnd&&(this.copy(),this.removeChars(n))},_getClipboardData:function(n){return n&&(n.clipboardData||fabric.window.clipboardData)},onKeyPress:function(n){!this.isEditing||n.metaKey||n.ctrlKey||n.keyCode in this._keysMap&&n.charCode===0||(this.insertChars(String.fromCharCode(n.which)),n.stopPropagation())},getDownCursorOffset:function(n,t){var r=t?this.selectionEnd:this.selectionStart,f=this.text.split(this._reNewline),o,s,h=this.text.slice(0,r),c=this.text.slice(r),l=h.slice(h.lastIndexOf("\n")+1),w=c.match(/(.*)\n?/)[1],b=(c.match(/.*\n(.*)\n?/)||{})[1]||"",u=this.get2DCursorLocation(r),a,e,v,i,y,p;if(u.lineIndex===f.length-1||n.metaKey)return this.text.length-r;for(a=this._getWidthOfLine(this.ctx,u.lineIndex,f),s=this._getLineLeftOffset(a),e=s,v=u.lineIndex,i=0,y=l.length;i<y;i++)o=l[i],e+=this._getWidthOfChar(this.ctx,o,v,i);return p=this._getIndexOnNextLine(u,b,e,f),w.length+1+p},_getIndexOnNextLine:function(n,t,i,r){for(var c,o,s=n.lineIndex+1,l=this._getWidthOfLine(this.ctx,s,r),a=this._getLineLeftOffset(l),f=a,e=0,h,u=0,v=t.length;u<v;u++)if(c=t[u],o=this._getWidthOfChar(this.ctx,c,s,u),f+=o,f>i){h=!0;var y=f-o,p=f,w=Math.abs(y-i),b=Math.abs(p-i);e=b<w?u+1:u;break}return h||(e=t.length),e},moveCursorDown:function(n){this.abortCursorAnimation();this._currentCursorOpacity=1;var t=this.getDownCursorOffset(n,this._selectionDirection==="right");n.shiftKey?this.moveCursorDownWithShift(t):this.moveCursorDownWithoutShift(t);this.initDelayedCursor()},moveCursorDownWithoutShift:function(n){this._selectionDirection="right";this.selectionStart+=n;this.selectionStart>this.text.length&&(this.selectionStart=this.text.length);this.selectionEnd=this.selectionStart},moveCursorDownWithShift:function(n){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd){this.selectionStart+=n;this._selectionDirection="left";return}this._selectionDirection="right";this.selectionEnd+=n;this.selectionEnd>this.text.length&&(this.selectionEnd=this.text.length)},getUpCursorOffset:function(n,t){var u=t?this.selectionEnd:this.selectionStart,r=this.get2DCursorLocation(u),i,l,a;if(r.lineIndex===0||n.metaKey)return u;var f=this.text.slice(0,u),e=f.slice(f.lastIndexOf("\n")+1),o=(f.match(/\n?(.*)\n.*$/)||{})[1]||"",s=this.text.split(this._reNewline),h,v=this._getWidthOfLine(this.ctx,r.lineIndex,s),y=this._getLineLeftOffset(v),c=y,p=r.lineIndex;for(i=0,l=e.length;i<l;i++)h=e[i],c+=this._getWidthOfChar(this.ctx,h,p,i);return a=this._getIndexOnPrevLine(r,o,c,s),o.length-a+e.length},_getIndexOnPrevLine:function(n,t,i,r){for(var c,o,s=n.lineIndex-1,l=this._getWidthOfLine(this.ctx,s,r),a=this._getLineLeftOffset(l),f=a,e=0,h,u=0,v=t.length;u<v;u++)if(c=t[u],o=this._getWidthOfChar(this.ctx,c,s,u),f+=o,f>i){h=!0;var y=f-o,p=f,w=Math.abs(y-i),b=Math.abs(p-i);e=b<w?u:u-1;break}return h||(e=t.length-1),e},moveCursorUp:function(n){this.abortCursorAnimation();this._currentCursorOpacity=1;var t=this.getUpCursorOffset(n,this._selectionDirection==="right");n.shiftKey?this.moveCursorUpWithShift(t):this.moveCursorUpWithoutShift(t);this.initDelayedCursor()},moveCursorUpWithShift:function(n){if(this.selectionStart===this.selectionEnd)this.selectionStart-=n;else{if(this._selectionDirection==="right"){this.selectionEnd-=n;this._selectionDirection="right";return}this.selectionStart-=n}this.selectionStart<0&&(this.selectionStart=0);this._selectionDirection="left"},moveCursorUpWithoutShift:function(n){this.selectionStart===this.selectionEnd&&(this.selectionStart-=n);this.selectionStart<0&&(this.selectionStart=0);this.selectionEnd=this.selectionStart;this._selectionDirection="left"},moveCursorLeft:function(n){(this.selectionStart!==0||this.selectionEnd!==0)&&(this.abortCursorAnimation(),this._currentCursorOpacity=1,n.shiftKey?this.moveCursorLeftWithShift(n):this.moveCursorLeftWithoutShift(n),this.initDelayedCursor())},_move:function(n,t,i){n.altKey?this[t]=this["findWordBoundary"+i](this[t]):n.metaKey?this[t]=this["findLineBoundary"+i](this[t]):this[t]+=i==="Left"?-1:1},_moveLeft:function(n,t){this._move(n,t,"Left")},_moveRight:function(n,t){this._move(n,t,"Right")},moveCursorLeftWithoutShift:function(n){this._selectionDirection="left";this.selectionEnd===this.selectionStart&&this._moveLeft(n,"selectionStart");this.selectionEnd=this.selectionStart},moveCursorLeftWithShift:function(n){this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd?this._moveLeft(n,"selectionEnd"):(this._selectionDirection="left",this._moveLeft(n,"selectionStart"),this.text.charAt(this.selectionStart)==="\n"&&this.selectionStart--,this.selectionStart<0&&(this.selectionStart=0))},moveCursorRight:function(n){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||(this.abortCursorAnimation(),this._currentCursorOpacity=1,n.shiftKey?this.moveCursorRightWithShift(n):this.moveCursorRightWithoutShift(n),this.initDelayedCursor())},moveCursorRightWithShift:function(n){this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd?this._moveRight(n,"selectionStart"):(this._selectionDirection="right",this._moveRight(n,"selectionEnd"),this.text.charAt(this.selectionEnd-1)==="\n"&&this.selectionEnd++,this.selectionEnd>this.text.length&&(this.selectionEnd=this.text.length))},moveCursorRightWithoutShift:function(n){this._selectionDirection="right";this.selectionStart===this.selectionEnd?(this._moveRight(n,"selectionStart"),this.selectionEnd=this.selectionStart):(this.selectionEnd+=this.getNumNewLinesInSelectedText(),this.selectionEnd>this.text.length&&(this.selectionEnd=this.text.length),this.selectionStart=this.selectionEnd)},removeChars:function(n){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(n):this._removeCharsFromTo(this.selectionStart,this.selectionEnd);this.selectionEnd=this.selectionStart;this._removeExtraneousStyles();this.canvas&&this.canvas.renderAll().renderAll();this.setCoords();this.fire("changed");this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(n){var t,i,r;this.selectionStart!==0&&(n.metaKey?(t=this.findLineBoundaryLeft(this.selectionStart),this._removeCharsFromTo(t,this.selectionStart),this.selectionStart=t):n.altKey?(i=this.findWordBoundaryLeft(this.selectionStart),this._removeCharsFromTo(i,this.selectionStart),this.selectionStart=i):(r=this.text.slice(this.selectionStart-1,this.selectionStart)==="\n",this.removeStyleObject(r),this.selectionStart--,this.text=this.text.slice(0,this.selectionStart)+this.text.slice(this.selectionStart+1)))}});fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(n,t,i,r,u,f){this.styles[t]?this._setSVGTextLineChars(n,t,i,r,u,f):this.callSuper("_setSVGTextLineText",n,t,i,r,u)},_setSVGTextLineChars:function(n,t,i,r,u,f){for(var o,c,v=t===0||this.useNative?"y":"dy",s=n.split(""),h=0,l=this._getSVGLineLeftOffset(t),a=this._getSVGLineTopOffset(t),y=this._getHeightOfLine(this.ctx,t),e=0,p=s.length;e<p;e++)o=this.styles[t][e]||{},i.push(this._createTextCharSpan(s[e],o,l,a,v,h)),c=this._getWidthOfChar(this.ctx,s[e],t,e),o.textBackgroundColor&&f.push(this._createTextCharBg(o,l,a,y,c,h)),h+=c},_getSVGLineLeftOffset:function(n){return this._boundaries&&this._boundaries[n]?fabric.util.toFixed(this._boundaries[n].left,2):0},_getSVGLineTopOffset:function(n){for(var i=0,t=0;t<=n;t++)i+=this._getHeightOfLine(this.ctx,t);return i-this.height/2},_createTextCharBg:function(n,t,i,r,u,f){return['<rect fill="',n.textBackgroundColor,'" transform="translate(',-this.width/2," ",-this.height+r,")",'" x="',t+f,'" y="',i+r,'" width="',u,'" height="',r,'"><\/rect>'].join("")},_createTextCharSpan:function(n,t,i,r,u,f){var e=this.getSvgStyles.call(fabric.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text"},t));return['<tspan x="',i+f,'" ',u,'="',r,'" ',t.fontFamily?'font-family="'+t.fontFamily.replace(/"/g,"'")+'" ':"",t.fontSize?'font-size="'+t.fontSize+'" ':"",t.fontStyle?'font-style="'+t.fontStyle+'" ':"",t.fontWeight?'font-weight="'+t.fontWeight+'" ':"",t.textDecoration?'text-decoration="'+t.textDecoration+'" ':"",'style="',e,'">',fabric.util.string.escapeXml(n),"<\/tspan>"].join("")}}),function(){function n(n,t,i){var r=e.parse(n),f,u;r.port||(r.port=r.protocol.indexOf("https:")===0?443:80);f=r.port===443?s:o;u=f.request({hostname:r.hostname,port:r.port,path:r.path,method:"GET"},function(n){var r="";t&&n.setEncoding(t);n.on("end",function(){i(r)});n.on("data",function(t){n.statusCode===200&&(r+=t)})});u.on("error",function(n){n.errno===process.ECONNREFUSED?fabric.log("ECONNREFUSED: connection refused to "+r.hostname+":"+r.port):fabric.log(n.message)});u.end()}function i(n,t){var i=require("fs");i.readFile(n,function(n,i){if(n){fabric.log(n);throw n;}else t(i)})}var r,u;if(typeof document=="undefined"||typeof window=="undefined"){var f=require("xmldom").DOMParser,e=require("url"),o=require("http"),s=require("https"),t=require("canvas"),h=require("canvas").Image;fabric.util.loadImage=function(t,r,u){function e(n){f.src=new Buffer(n,"binary");f._src=t;r&&r.call(u,f)}var f=new h;t&&(t instanceof Buffer||t.indexOf("data")===0)?(f.src=f._src=t,r&&r.call(u,f)):t&&t.indexOf("http")!==0?i(t,e):t?n(t,"binary",e):r&&r.call(u,t)};fabric.loadSVGFromURL=function(t,r,u){t=t.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();t.indexOf("http")!==0?i(t,function(n){fabric.loadSVGFromString(n.toString(),r,u)}):n(t,"",function(n){fabric.loadSVGFromString(n,r,u)})};fabric.loadSVGFromString=function(n,t,i){var r=(new f).parseFromString(n);fabric.parseSVGDocument(r.documentElement,function(n,i){t&&t(n,i)},i)};fabric.util.getScript=function(t,i){n(t,"",function(body){eval(body);i&&i()})};fabric.Image.fromObject=function(n,t){fabric.util.loadImage(n.src,function(i){var r=new fabric.Image(i);r._initConfig(n);r._initFilters(n,function(n){r.filters=n||[];t&&t(r)})})};fabric.createCanvasForNode=function(n,i,r,u){var f,e,s,o;return u=u||r,f=fabric.document.createElement("canvas"),e=new t(n||600,i||600,u),f.style={},f.width=e.width,f.height=e.height,s=fabric.Canvas||fabric.StaticCanvas,o=new s(f,r),o.contextContainer=e.getContext("2d"),o.nodeCanvas=e,o.Font=t.Font,o};fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()};fabric.StaticCanvas.prototype.createJPEGStream=function(n){return this.nodeCanvas.createJPEGStream(n)};r=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(n,t){return r.call(this,n,t),this.nodeCanvas.width=n,this};fabric.Canvas&&(fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth);u=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(n,t){return u.call(this,n,t),this.nodeCanvas.height=n,this};fabric.Canvas&&(fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight)}}(),function(n){function st(){if(c)return!1;rt=!0;var t=document.forms[0],n=document.getElementById("RenderButton");return navigator.userAgent.indexOf("Firefox")==-1&&(n.disabled=!0),n.value="Creating...",$.post("Render",{logoId:f?s:Number(document.getElementById("LogoID").value),composite:f&&h?JSON.stringify(tt()):""},function(n){n&&(document.location.href=n.redirectLocation)}),!1}function ht(n){c++;document.getElementById("Spinner").style.visibility="visible";$.post("WaitRender",{renderId:n},lt)}function b(){ut&&(clearTimeout(ft),ft=setTimeout(ii,n.renderDelay))}function ii(){c++;document.getElementById("Spinner").style.visibility="visible";var n=$(o).serialize();f&&h&&(n+="&Composite="+JSON.stringify(tt()),h=!1);$.post("PostChange",n,lt).fail(ri)}function ct(){document.getElementById("Spinner").style.visibility="hidden";c--;rt&&st()}function k(n){return $(n).find("#LogoID").val()}function lt(n){var r,u;n&&(r=i[n.logoId],$(r).children("#LogoID").val(n.newId),i[n.newId]=r,f?(u=new Image,u.onload=function(){r.RenderImage.setElement(u);r.RenderImage.width=u.width;r.RenderImage.height=u.height;t.renderAll()},u.src=n.renderLocation,n.isAnimated&&at(n.logoId,n.renderLocation)):document.getElementById("PreviewImage").src=n.renderLocation);ct()}function at(n,t){$("#dummyImage_"+n).length>0?$("#dummyImage_"+n).attr("src",t):$(".dummyImage").first().append("<img id='dummyImage_"+n+"' src='"+t+"' class='dummyImage' />")}function ri(){ct();alert("Unfortunately, there has been an error on our web server.\nPlease try again or try something else.  We apologize for the inconvenience.\nA full error report has been sent to the web site administrators.")}function vt(n){var r,u,i;if($("#addTutorialTooltip").hide(),f=!0,s=n.id,$("#WorkCanvas").show(),$(".CompositeToolbar").each(function(){$(this).css("display","block")}),r=$("#PreviewImage"),u=r.attr("src"),r.hide(),ci(),n.addLogoData)nt(u,$("#InitialEditForm").find("form").get(0),n.firstAnimated),d(n.addLogoData),typeof Storage!="undefined"&&sessionStorage.getItem("tooltipsShown")||($("#resizeTutorialTooltip").show(500),setTimeout(function(){$("#resizeTutorialTooltip").hide({duration:500,easing:"linear"})},5e3),setTimeout(function(){$("#movingTutorialTooltip").show({duration:500,easing:"linear"});sessionStorage.setItem("tooltipsShown","true")},6e3),setTimeout(function(){$("#movingTutorialTooltip").hide({duration:500,easing:"linear"})},11e3));else{for(t.setWidth(n.width),t.setHeight(n.height),l(n.fileFormat),it("#"+Number(n.backgroundColor).toString(16)),p=!0,i=0;i<n.layers.length;++i)n.layers[i].selectOne=!0,n.selectedLayer==n.layers[i].layerId&&(n.layers[i].selected=!0),d(n.layers[i],i);h=!1}return!1}function ui(n){return $("#addLogoMenu").hide(),f?$.post("CompositeAdd",{logoId:s,style:n},d):$.post("CompositeCreate",{logoId:document.getElementById("LogoID").value,style:n},vt),!1}function yt(){var u=t.getActiveGroup()?"s":"",n,i,r;if(confirm("Are you sure you want to remove the selected logo"+u+"?")){if(t.getActiveGroup()){n=t.getActiveGroup().getObjects();t.discardActiveGroup();for(i in n)t.remove(n[i])}else if(t.getActiveObject())t.remove(t.getActiveObject());else return;r=t.item(0);pt(r);t.renderAll()}}function fi(){t.bringToFront(u);r()}function ei(){t.sendToBack(u);r()}function oi(){si(Number($("#RotationDegrees").val()))}function si(n){(isNaN(n)||!isFinite(n))&&(n=0);u.setAngle(n);t.renderAll();u.setCoords();r()}function hi(){var i=t.getObjects()[0],n=t.getObjects()[1];n.setTop(i.getTop()+i.getHeight()+5);t.setHeight(n.getTop()+n.getHeight());t.setWidth(Math.max(i.getWidth(),n.getWidth()));n.setCoords();p=!0}function d(n,t){var u=document.createElement("div"),r;u.innerHTML=n.editFormHtml;$("#EditForms").append(u);r=$(u).children()[0];i[n.layerId]=r;n.waitingForRenderId&&ht(n.waitingForRenderId);n.isAnimated&&at(n.layerId,n.renderLocation);typeof t=="number"?nt(n.renderLocation,r,n.isAnimated,n.positionX,n.positionY,n.rotation,!n.selectOne||n.selected,t):nt(n.renderLocation,r,n.isAnimated,n.positionX,n.positionY,n.rotation,!n.selectOne||n.selected)}function pt(n){if(u=n,$("#EditForms").children().hide(),n){g();var t=$(n.editFormElement);o=n.editFormElement;t.parent().show()}}function g(){u&&$("#RotationDegrees").val(u.angle.toFixed(1))}function ci(){t=new fabric.Canvas("WorkCanvas");var n=document.getElementById("WorkCanvas");t.on("object:added",function(n){n.target&&(n.target.cornerSize=8,n.target.setControlsVisibility({tl:!1,tr:!1,bl:!1,br:!1,mt:!1,mr:!1,ml:!1,mb:!1}),n.target.rotatingPointOffset=20,n.target.transparentCorners=!0,n.target.lockScalingX=!0,n.target.lockScalingY=!0,n.target.isAnimated&&bt(!0),r())});t.on("object:rotating",function(){g();r()});t.on("object:moving",function(){r()});t.on("object:removed",function(){var i,n;for(r(),i=!1,n=0;n<t.getObjects().length;n++)t.item(n).isAnimated&&(i=!0);bt(i)});t.on("mouse:down",function(i){var u=n.getBoundingClientRect(),f=i.e.clientX-u.left,e=i.e.clientY-u.top,r;f>t.getWidth()-10&&e>t.getHeight()-10&&(a=!0,v={x:f,y:e},y={width:t.getWidth(),height:t.getHeight()},r=document.getElementById("Popup"),r.style.background="#FFF",r.style.zIndex="9999999",r.style.paddingBottom="0",n.onmousemove=function(n){MenuScript.SetPos(MenuScript.GetPos(n),r)})});t.on("mouse:up",function(){a=!1;$("#Popup").hide()});t.on("mouse:move",function(i){var u;if(a){var f=n.getBoundingClientRect(),s=i.e.clientX-f.left,h=i.e.clientY-f.top,e=Math.min(ni,Math.round(y.width+(s-v.x))),o=Math.min(ti,Math.round(y.height+(h-v.y)));t.setWidth(e);t.setHeight(o);u=document.getElementById("Popup");u.innerHTML=e+"px x "+o+"px";MenuScript.SetPos(MenuScript.GetPos(i.e),u);u.style.display="block";r()}});$(".canvas-container").attr("tabindex",1e3);$(".canvas-container").css("outline","none");$(".canvas-container").keydown(function(n){switch(n.keyCode){case 46:yt()}})}function nt(n,i,u,f,e,o,s,h){fabric.Image.fromURL(n,function(n){n.isAnimated=u;typeof h!="undefined"?t.insertAt(n,h,!0):t.add(n);typeof f!="undefined"&&(n.setAngle(o),n.setLeft(f),n.setTop(e),n.setCoords());n.editFormElement=i;i.RenderImage=n;n.on("selected",function(){pt(n);r()});wt(i);p||t.getObjects().length!=2||hi();s&&t.setActiveObject(n)})}function wt(n){n.initalized||(n.initalized=!0,$(n).find(".minicolors").each(function(){$(this).minicolors({defaultValue:$(this).val(),theme:"bootstrap",change:b})}),$(n).find(".ddslick-dropdown").each(function(){$(this).ddslick({onSelected:b,sourceId:this.id})}),$(n).find("input[spinboxMin]").each(function(){$(this).spinbox({min:$(this).attr("spinboxMin"),max:$(this).attr("spinboxMax"),step:$(this).attr("spinboxStep")})}),gt())}function tt(){var i={ID:s,Width:Math.round(t.getWidth()),Height:Math.round(t.getHeight()),Format:e,BackgroundColor:parseInt(w.substring(1),16),SelectedLayer:u?k(u.editFormElement):"0",Layers:[]},r=t.getObjects(),f,n;for(f in r)n=r[f],n&&i.Layers.push({DesignId:k(n.editFormElement),PositionX:n.getLeft(),PositionY:n.getTop(),Rotation:n.getAngle()});return i}function bt(n){var i;if(ot!=n)if(ot=n,n){for(l(1),i=2;i<=8;i++)$("#"+i+"MenuItem").addClass("disabled");et=setInterval(function(){t.renderAll()},33)}else{for(l(6),i=2;i<=8;i++)$("#"+i+"MenuItem").removeClass("disabled");clearInterval(et)}}function r(){h=!0}function li(){$.ajax({url:"CompositeSave",type:"POST",dataType:"json",async:!1,data:JSON.stringify(tt()),contentType:"application/json; charset=utf-8",success:function(n){s=n.compositeDesignId}})}function ai(n){if(c)return!1;var t=k(o);return n=n.replace("#ID",t),document.location.href=f?n+"&LogoId="+s:n+"&LogoId="+t,!1}function l(n){e=n;kt()&&(t.setBackgroundColor("rgba(0, 0, 0, 0)"),t.renderAll());dt();r()}function vi(){$(".checkmark").each(function(){$(this).attr("id")==e+"CheckMark"?$(this).html("✓"):$(this).html("")})}function kt(){return e==6||e==2||e==3||e==7||e==8}function yi(){kt()?($("#BackgroundColorMenuItem").addClass("disabled"),$("#BackgroundColor").attr("disabled","true"),$("#BackgroundColorMenuItem").hide()):($("#BackgroundColorMenuItem").removeClass("disabled"),$("#BackgroundColor").removeAttr("disabled"),$("#BackgroundColorMenuItem").show())}function it(n){w=n;t.setBackgroundColor(w);t.renderAll();r()}function dt(){yi();vi()}function gt(){$("[name='FileFormat']").each(function(){var t,r,n;for(t in i)if($(i[t]).find("#FileFormat").get(0)===this){r=i[t];n=$(this).val();n=="1"||n=="4"||n=="5"?$(r).find(".background-setting").show():$(r).find(".background-setting").hide();break}})}function pi(){$("[name='Integer13']").each(function(){for(var n in i)if($(i[n]).find("#Integer13").get(0)===this){$(i[n]).find("#Integer11").get(0).disabled=this.checked;break}})}function wi(){$("[name='Integer12']").each(function(){for(var n in i)if($(i[n]).find("#Integer12").get(0)===this){$(i[n]).find("#Integer10").get(0).disabled=this.checked;break}})}function bi(){var n=document.getElementById("PreviewImage"),t=n.src;n.src=t.substring(0,t.length-1)+"1"}function ki(){var n=document.getElementById("PreviewImage"),t=n.src;n.src=t.substring(0,t.length-1)+"0"}var f=!1,s,rt=!1,ut=!1,c=0;n.renderDelay=300;var ft,et,h=!1,t,a,v,y,o,u,i=[],p=!1,ni=2e3,ti=2e3,e=6,w="#FFFFFF",ot=!1;n.submitForm=st;n.waitRender=ht;n.doPost=b;n.switchToComposite=vt;n.addLogo=ui;n.removeSelected=yt;n.bringToFront=fi;n.sendToBack=ei;n.updateRotation=oi;n.updateControls=g;n.goto=ai;n.setFileFormat=l;n.setBackgroundColor=it;n.FileFormatChanged=gt;n.ToggleWidthField=pi;n.ToggleHeightField=wi;n.OnPreviewMouseOver=bi;n.OnPreviewMouseOut=ki;$(document).ready(function(){if(o=document.forms[0],$("#BackgroundColor").minicolors({defaultValue:$(this).val(),theme:"bootstrap",change:function(){it($(this).val())}}),o){i[document.getElementById("LogoID").value]=o;wt(o);var n=document.getElementById("Text");n&&(n.focus(),n.select())}$("#main-menu").smartmenus({subIndicators:!1,subMenusMaxWidth:null,subMenusMaxHeight:null});$(window).bind("beforeunload",function(){f&&h&&li()});typeof Storage!="undefined"&&sessionStorage.getItem("tooltipsShown")||($("#addTutorialTooltip").show(1e3),setTimeout(function(){$("#addTutorialTooltip").hide({duration:1e3,easing:"linear"})},6e3));dt();ut=!0})}(CoolText||(CoolText={}));
/*
//# sourceMappingURL=CT.min.js.map
*/